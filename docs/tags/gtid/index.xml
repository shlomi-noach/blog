<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Gtid on code.openark.org</title>
    <link>/blog/tags/gtid/</link>
    <description>Recent content in Gtid on code.openark.org</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2016. All rights reserved.</copyright>
    <lastBuildDate>Wed, 28 Sep 2016 14:22:14 +0000</lastBuildDate>
    <atom:link href="/blog/tags/gtid/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Three wishes for a new year</title>
      <link>/blog/Three-wishes-for-a-new-year/Three-wishes-for-a-new-year/</link>
      <pubDate>Wed, 28 Sep 2016 14:22:14 +0000</pubDate>
      
      <guid>/blog/Three-wishes-for-a-new-year/Three-wishes-for-a-new-year/</guid>
      <description>&lt;p&gt;(Almost) another new year by Jewish calendar. What do I wish for the following year?&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;World peace&lt;/li&gt;
&lt;li&gt;Good health to all&lt;/li&gt;
&lt;li&gt;Relaxed GTID constraints&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I&#39;m still not using GTID, and still see operational issues with working with GTID. As a latest example, our new schema migration solution, gh-ost, allows us to test migrations in production, on replicas. The GTID catch? &lt;code&gt;gh-ost&lt;/code&gt;&amp;nbsp;has to write something to the binary log. Thus, it &#34;corrupts&#34; the replica with a bogus GTID entry that will never be met in another server, thus making said replica unsafe to promote. We can work around this, but...&lt;/p&gt;
&lt;p&gt;I understand the idea and need for the &lt;code&gt;Executed GTID Set&lt;/code&gt;. It will&amp;nbsp;certainly come in handy with multi-writer InnoDB Cluster. However for most use cases GTID poses a burden. The reason is that our topologies are imperfect, and we as humans are imperfect, and operations are most certainly imperfect. We may wish to operate on a replica: test something, by intention or mistake. We may wish to use a subchain as the seed for a new cluster split. We may wish to be able to write to downstream replicas. We may use a 3rd party tool that issues a &lt;code&gt;flush tables with read lock&lt;/code&gt;&amp;nbsp;without disabling &lt;code&gt;sql_log_bin&lt;/code&gt;. Things just happen.&lt;/p&gt;
&lt;p&gt;For that, I would like to suggest GTID control levels, such as:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;em&gt;Strict&lt;/em&gt;: same as Oracle&#39;s existing&amp;nbsp;implementation. Executed sets, purged sets, whatnot.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Last executed&lt;/em&gt;: a mode where the only thing that counts is the last executed GTID value. If I repoint replica,&amp;nbsp;all it needs to check is &#34;hey this is my last executed GTID entry, give me the coordinates of yours. And, no, I don&#39;t care about comparing executed and purged sets, I will trust you and keep running from that point on&#34;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Declarative&lt;/em&gt;: GTIDs are generated, are visible in each and every binary log entry, but are completely ignored.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I realize Oracle MySQL GTID is out for some over 3 years now, but I&#39;m sorry - I still have reservations and see&amp;nbsp;use cases where I fear it will not serve me right.&lt;/p&gt;
&lt;p&gt;How about my previous years wishes? World peace and good health never came through, however:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;My &lt;a href=&#34;http://code.openark.org/blog/mysql/three-wishes-for-a-new-year-2015&#34;&gt;2015 wish&lt;/a&gt; for &#34;decent, operations friendly built in online table refactoring&#34; was unmet, however &lt;code&gt;gh-ost&lt;/code&gt;&amp;nbsp;is a thing now and exceeds my expectations. No, really. Please come see &lt;a href=&#34;https://www.percona.com/live/plam16/sessions/introducing-gh-ost-triggerless-painless-trusted-online-schema-migrations&#34;&gt;Tom &amp;amp; myself present gh-ost&lt;/a&gt; and how it changed our migration paradigm.&lt;/li&gt;
&lt;li&gt;My &lt;a href=&#34;http://code.openark.org/blog/mysql/three-wishes-for-a-new-year-201&#34;&gt;2012 wish&lt;/a&gt; for &#34;decent, long waited for, implementation of &lt;a href=&#34;http://en.wikipedia.org/wiki/Window_function_%28SQL%29#Window_function&#34;&gt;Window Functions&lt;/a&gt; (aka Analytic Functions) for MySQL&#34; was met by&amp;nbsp;MariaDB&#39;s &lt;a href=&#34;https://mariadb.com/kb/en/mariadb/window-functions/&#34;&gt;window functions&lt;/a&gt;.&lt;br&gt;
Not strictly Window Functions, but Oracle MySQL 8.0 will &lt;a href=&#34;http://mysqlserverteam.com/mysql-8-0-labs-recursive-common-table-expressions-in-mysql-ctes/&#34;&gt;support CTE&lt;/a&gt; (hierarchial/recursive), worth a mention.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;See you in Amsterdam!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Refactoring replication topology with Pseudo GTID</title>
      <link>/blog/2014/10/23/refactoring-replication-topology-with-pseudo-gtid/</link>
      <pubDate>Thu, 23 Oct 2014 12:37:17 +0000</pubDate>
      
      <guid>/blog/2014/10/23/refactoring-replication-topology-with-pseudo-gtid/</guid>
      <description>&lt;p&gt;This post describes in detail the method of using Pseudo GTID to achieve unplanned replication topology changes, i.e. connecting two arbitrary slaves, or recovering from a master failure even as all its slaves are hanging in different positions.&lt;/p&gt;
&lt;p&gt;Please read &lt;a href=&#34;http://code.openark.org/blog/mysql/pseudo-gtid&#34;&gt;Pseudo GTID&lt;/a&gt; and &lt;a href=&#34;http://code.openark.org/blog/mysql/pseudo-gtid-row-based-replication&#34;&gt;Pseudo GTID, RBR&lt;/a&gt; as introduction.&lt;/p&gt;
&lt;p&gt;Consider the following case: the master dies unexpectedly, and its three slaves are all hanging, not necessarily at same binary log file/position (network broke down while some slaves managed to salvage more entries into their relay logs than others)&lt;/p&gt;
&lt;blockquote&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2014/10/orchestrator-failed-master.jpeg&#34;&gt;&lt;img class=&#34;alignnone size-full wp-image-7059&#34; src=&#34;/blog/blog/assets/orchestrator-failed-master.jpeg&#34; alt=&#34;orchestrator-failed-master&#34; width=&#34;801&#34; height=&#34;365&#34; /&gt;&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;(Did you notice the &lt;strong&gt;&#34;Candidate for master&#34;&lt;/strong&gt; message? To be discussed shortly)&lt;/p&gt;
&lt;h4&gt;GTID&lt;/h4&gt;
&lt;p&gt;With GTID each transaction (and entry in the binary log) is associated with a unique mark -- the Global Transaction ID. Just pick the slave with the most advanced GTID to be the next master, and just &lt;strong&gt;CHANGE MASTER TO MASTER_HOST=&#39;chosen_slave&#39;&lt;/strong&gt; on the other slaves, and everything magically works. A slave knows which GTID it has already processed, and can look that entry on its master&#39;s binary logs, resuming replication on the one that follows.&lt;/p&gt;
&lt;p&gt;How does that work? The master&#39;s binary logs are searched for that GTID entry. I&#39;m not sure how brute-force this is, since I&#39;m aware of a subtlety which requires brute-force scan of all binary logs; I don&#39;t actually know if it&#39;s always like that.&lt;/p&gt;
&lt;h4&gt;Pseudo GTID&lt;/h4&gt;
&lt;p&gt;We can mimick that above, but our solution can&#39;t be as fine grained. With the injection of Pseudo GTID we mark the binary log for unique entries. But instead of having a unique identifier for every entry, we have a unique identifier for every second, 10 seconds, or what have you, with otherwise normal, non-unique entries in between our Pseudo GTID entries.&lt;/p&gt;
&lt;h4&gt;Recognizing which slave is more up to date&lt;/h4&gt;
&lt;p&gt;Given two slaves, which is more up to date?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If both replicate(d) from same master, a &lt;strong&gt;SHOW SLAVE STATUS&lt;/strong&gt; comparison answers (safe method: wait till SQL thread catches up with broken IO thread, compare &lt;strong&gt;relay_master_log_file&lt;/strong&gt;, &lt;strong&gt;exec_master_log_pos&lt;/strong&gt; on both machines). This is the method by which the above &#34;Candidate for master&#34; message is produced.&lt;/li&gt;
&lt;li&gt;If one is/was descendent of the other, then obviously it is less advanced or equals its ancestor.&lt;/li&gt;
&lt;li&gt;Otherwise we&#39;re unsure - still solvable via bi-directional trial &amp;amp; error, as explained later on.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For now, let&#39;s assume we know which slave is more up to date (has received and executed more relay logs). Let&#39;s call it &lt;strong&gt;S1&lt;/strong&gt;, whereas the less up-to-date will be &lt;strong&gt;S2&lt;/strong&gt;. This will make our discussion simpler.&lt;!--more--&gt;&lt;/p&gt;
&lt;h4&gt;Prerequisites&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;We require a Pseudo GTID in place: a periodic injection of a known-to-be-unique query, and which we know how to intercept&lt;/li&gt;
&lt;li&gt;We require &lt;strong&gt;log_slave_updates&lt;/strong&gt; on all slaves. We will need to parse the binary logs on slaves. I have little trust in the availability of relay logs: these are flushed, rotated and auto-erased all too quickly. The proposed solution does not require any daemon running on the MySQL servers themselves. There will be nothing to back up the relay logs, so I can&#39;t trust these to exist. Binary logs, on the other hand, have expiry period in days, and so I can trust them to exist for a duration of a few minutes.&lt;/li&gt;
&lt;li&gt;Normal replication. Not multi threaded. Not multi-source.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;The process of rematching slaves&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;S1&lt;/strong&gt; is more up to date, hence we want to make &lt;strong&gt;S2&lt;/strong&gt; a slave of &lt;strong&gt;S1&lt;/strong&gt;. We expect the statements/entries found in &lt;strong&gt;S2&lt;/strong&gt;&#39;s binary logs to exist in &lt;strong&gt;S1&lt;/strong&gt;, in the same order, but somewhere back in the past, padded by additional entries (zero or more) that are not found in &lt;strong&gt;S2&lt;/strong&gt;. Steps are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Find latest Pseudo-GTID entry in &lt;strong&gt;S2&lt;/strong&gt;&#39;s logs. This can be done by iterating &lt;strong&gt;S2&lt;/strong&gt;&#39;s binary logs newest to oldest. The first (time DESC) binary log where such entry is found is to be searched for the last entry (latest). Keep record of the binlog &lt;strong&gt;file2:pos2&lt;/strong&gt; coordinates.&lt;/li&gt;
&lt;li&gt;Take note of the exact entry made in the above. This is the unique value.&lt;/li&gt;
&lt;li&gt;Search said unique value in &lt;strong&gt;S1&lt;/strong&gt;&#39;s binary logs. Since it is unique, your method of search is arbirtary, you just need to find it. Brute-force wise you start looking at newest binary log moving back in time. Not found? Unlikely, since this means the lag diff between &lt;strong&gt;S1&lt;/strong&gt; and &lt;strong&gt;S2&lt;/strong&gt; is as long as the binlog expiry. We will be handling with failures and with immediate actions; we can expect slave lags in the seconds or in the minutes - we don&#39;t even consider the possibility where the entry is not found.&lt;/li&gt;
&lt;li&gt;Take note of the coordinates &lt;strong&gt;file1:pos1&lt;/strong&gt; in &lt;strong&gt;S1&lt;/strong&gt; where we found the unique value.&lt;/li&gt;
&lt;li&gt;We now iterate &lt;strong&gt;S2&lt;/strong&gt;&#39;s binary logs starting with the Pseudo GTID &lt;strong&gt;file2:pos2&lt;/strong&gt;. We expect to find each entry in &lt;strong&gt;S1&lt;/strong&gt;&#39;s binary logs, successively, starting &lt;strong&gt;file1:pos1&lt;/strong&gt;. We verify the entries in both servers are identical. Exceptions above could be:
&lt;ul&gt;
&lt;li&gt;Meta-entries (start-of-log, end-of-log, shutdown), in which case we skip to the next entry (this is done in both &lt;strong&gt;S1&lt;/strong&gt; and &lt;strong&gt;S2&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;Local statements executed directly on either &lt;strong&gt;S1&lt;/strong&gt; or &lt;strong&gt;S2&lt;/strong&gt;, such as &lt;strong&gt;ANALYZE TABLE&lt;/strong&gt; or whatever, which make no impact on data -- we may skip these&lt;/li&gt;
&lt;li&gt;Local, evil statements executed directly on the slaves,which make for data impact (&lt;strong&gt;INSERT&lt;/strong&gt;, &lt;strong&gt;DELETE&lt;/strong&gt;, ...). We choose to fail the operation in such case&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;After all entries in &lt;strong&gt;S2&lt;/strong&gt; (matched by entries in &lt;strong&gt;S1&lt;/strong&gt;) are iterated, our &lt;strong&gt;S1&lt;/strong&gt; &#34;cursor&#34; now looks at the first statement that never made it to &lt;strong&gt;S2&lt;/strong&gt;. This is &lt;strong&gt;file_win:pos_win&lt;/strong&gt;, into which we will point &lt;strong&gt;S2&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Or, we might find that upon iterating all entries in &lt;strong&gt;S2&lt;/strong&gt; we have exactly reached the end of binlog entries for S1: this means both S1 and S2 are actually in identical state. We point &lt;strong&gt;S2&lt;/strong&gt; into &lt;strong&gt;S1&lt;/strong&gt;&#39;s next-binlog-position.
&lt;ul&gt;
&lt;li&gt;This is in fact no different than the previous case, but of particular interest.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Or, we might run out of entries in &lt;strong&gt;S1&lt;/strong&gt;. No, we can&#39;t, because our assumption was that &lt;strong&gt;S1&lt;/strong&gt; is more advanced than (or equally advanced as) &lt;strong&gt;S2&lt;/strong&gt;. But this answers the question: &#34;&lt;strong&gt;what if didn&#39;t know in advance who&#39;s more advanced?&lt;/strong&gt;&#34; (no pun intended). In such case we conclude &lt;strong&gt;S2&lt;/strong&gt; is actually more advanced than &lt;strong&gt;S1&lt;/strong&gt; and we can try the other way around.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That last bullet is of importance: if you have two slaves whose &#34;family connection&#34; is complex, you can still match one below the other; you may try one way and fail, then try the other way around and succeed.&lt;/p&gt;
&lt;p&gt;Comparison of the events following the Pseudo-GTID is a good way of sanity checking (some meta-stuff should be ignored, like transaction IDs, table IDs, these can vary across servers), and builds up confidence in the correctness of the operation.&lt;/p&gt;
&lt;p&gt;The codebase is actually complete and pushed; I&#39;ll release a BETA version or &lt;a href=&#34;https://github.com/outbrain/orchestrator&#34;&gt;orchestrator&lt;/a&gt; next week, that supports Pseudo GTID. Let me tell you, doing this kind of crazy stuff with visual feedback (of course command line is available) is very very cool.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Pseudo GTID, Row Based Replication</title>
      <link>/blog/2014/10/23/pseudo-gtid-row-based-replication/</link>
      <pubDate>Thu, 23 Oct 2014 06:18:52 +0000</pubDate>
      
      <guid>/blog/2014/10/23/pseudo-gtid-row-based-replication/</guid>
      <description>&lt;p&gt;This post continues &lt;a href=&#34;http://code.openark.org/blog/mysql/pseudo-gtid&#34;&gt;Pseudo GTID&lt;/a&gt;, in a series of posts describing an alternative to using MySQL GTIDs.&lt;/p&gt;
&lt;p&gt;The solution offered in the last post does not work too well for row based replication. The binary log entries for the INSERT statement look like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;# at 1020
# at 1074
#141020 12:36:21 server id 1  end_log_pos 1074  Table_map: `test`.`pseudo_gtid` mapped to number 33
#141020 12:36:21 server id 1  end_log_pos 1196  Update_rows: table id 33 flags: STMT_END_F

BINLOG &#39;
lddEVBMBAAAANgAAADIEAAAAACEAAAAAAAEABHRlc3QAC3BzZXVkb19ndGlkAAMDBw8CQAAE
lddEVBgBAAAAegAAAKwEAAAAACEAAAAAAAEAA///+AEAAACL10RUJDg2ZmRhMDk1LTU4M2MtMTFl
NC05NzYyLTNjOTcwZWEzMWVhOPgBAAAAlddEVCQ4Y2YzOWMyYy01ODNjLTExZTQtOTc2Mi0zYzk3
MGVhMzFlYTg=
&#39;/*!*/;
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Where&#39;s our unique value? Encoded within something that cannot be trusted to be unique. Issuing &lt;strong&gt;mysqlbinlog --verbose&lt;/strong&gt; helps out:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;BEGIN
/*!*/;
# at 183
# at 237
#141020 12:35:51 server id 1  end_log_pos 237   Table_map: `test`.`pseudo_gtid` mapped to number 33
#141020 12:35:51 server id 1  end_log_pos 359   Update_rows: table id 33 flags: STMT_END_F

BINLOG &#39;
d9dEVBMBAAAANgAAAO0AAAAAACEAAAAAAAEABHRlc3QAC3BzZXVkb19ndGlkAAMDBw8CQAAE
d9dEVBgBAAAAegAAAGcBAAAAACEAAAAAAAEAA///+AEAAABt10RUJDc1MWJkYzEwLTU4M2MtMTFl
NC05NzYyLTNjOTcwZWEzMWVhOPgBAAAAd9dEVCQ3YjExZDQzYy01ODNjLTExZTQtOTc2Mi0zYzk3
MGVhMzFlYTg=
&#39;/*!*/;
### UPDATE `test`.`pseudo_gtid`
### WHERE
###   @1=1
###   @2=1413797741
###   &lt;strong&gt;@3=&#39;751bdc10-583c-11e4-9762-3c970ea31ea8&#39;&lt;/strong&gt;
### SET
###   @1=1
###   @2=1413797751
###   @3=&#39;7b11d43c-583c-11e4-9762-3c970ea31ea8&#39;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;and that&#39;s something we can work with. However, I like to do stuff from within MySQL, and rely as little as possible on external tools. How do the binary log entries look via &lt;strong&gt;SHOW BINLOG EVENTS&lt;/strong&gt;? Not good.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;master [localhost] {msandbox} (test) &amp;gt; show binlog events in &#39;mysql-bin.000058&#39; limit 20;
+------------------+------+-------------+-----------+-------------+---------------------------------------+
| Log_name         | Pos  | Event_type  | Server_id | End_log_pos | Info                                  |
+------------------+------+-------------+-----------+-------------+---------------------------------------+
| mysql-bin.000058 |    4 | Format_desc |         1 |         107 | Server ver: 5.5.32-log, Binlog ver: 4 |
| mysql-bin.000058 |  107 | Query       |         1 |         183 | BEGIN                                 |
| mysql-bin.000058 |  183 | Table_map   |         1 |         237 | table_id: 33 (test.pseudo_gtid)       |
| mysql-bin.000058 |  237 | Update_rows |         1 |         359 | table_id: 33 flags: STMT_END_F        |
| mysql-bin.000058 |  359 | Xid         |         1 |         386 | COMMIT /* xid=5460 */                 |
| mysql-bin.000058 |  386 | Query       |         1 |         462 | BEGIN                                 |
| mysql-bin.000058 |  462 | Table_map   |         1 |         516 | table_id: 33 (test.pseudo_gtid)       |
| mysql-bin.000058 |  516 | Update_rows |         1 |         638 | table_id: 33 flags: STMT_END_F        |
| mysql-bin.000058 |  638 | Xid         |         1 |         665 | COMMIT /* xid=5471 */                 |
| mysql-bin.000058 |  665 | Query       |         1 |         741 | BEGIN                                 |
| mysql-bin.000058 |  741 | Table_map   |         1 |         795 | table_id: 33 (test.pseudo_gtid)       |
| mysql-bin.000058 |  795 | Update_rows |         1 |         917 | table_id: 33 flags: STMT_END_F        |
| mysql-bin.000058 |  917 | Xid         |         1 |         944 | COMMIT /* xid=5474 */                 |
| mysql-bin.000058 |  944 | Query       |         1 |        1020 | BEGIN                                 |
| mysql-bin.000058 | 1020 | Table_map   |         1 |        1074 | table_id: 33 (test.pseudo_gtid)       |
| mysql-bin.000058 | 1074 | Update_rows |         1 |        1196 | table_id: 33 flags: STMT_END_F        |
| mysql-bin.000058 | 1196 | Xid         |         1 |        1223 | COMMIT /* xid=5476 */                 |
| mysql-bin.000058 | 1223 | Query       |         1 |        1299 | BEGIN                                 |
| mysql-bin.000058 | 1299 | Table_map   |         1 |        1353 | table_id: 33 (test.pseudo_gtid)       |
| mysql-bin.000058 | 1353 | Update_rows |         1 |        1475 | table_id: 33 flags: STMT_END_F        |
+------------------+------+-------------+-----------+-------------+---------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The representation of row-format entries in the &lt;strong&gt;SHOW BINLOG EVENTS&lt;/strong&gt; output is really poor. Why, there&#39;s nothing to tell me at all about what&#39;s been done, except that this is some operation on &lt;strong&gt;test.pseudo_gtid&lt;/strong&gt;. Obviously I cannot find anything unique over here.&lt;/p&gt;
&lt;p&gt;Not all is lost. How about DDL statements? Those are still written in SBR format (there&#39;s no &lt;em&gt;rows&lt;/em&gt; to log upon creating a table). A solution could be somehow manipulating a unique value in a DDL statement. There could be various such solutions, and I chose to use a &lt;strong&gt;CREATE VIEW&lt;/strong&gt; statement, dynamically composed of a &lt;strong&gt;UUID()&lt;/strong&gt;:&lt;!--more--&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;drop event if exists test.update_pseudo_gtid_rbr_event;

delimiter ;;
create event if not exists
  test.update_pseudo_gtid_rbr_event
  on schedule every 10 second starts current_timestamp
  on completion preserve
  enable
  do
    begin
      set @pseudo_gtid := uuid();
      set @_create_statement := concat(&#39;create or replace view test.pseudo_gtid_v as select 
&lt;/blockquote&gt;
And this is how it looks on runtime (running this new event along with the old one):
&lt;blockquote&gt;
&lt;pre&gt;master [localhost] {msandbox} (test) &amp;gt; show binlog events in &#39;mysql-bin.000060&#39; limit 20;
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Log_name         | Pos  | Event_type  | Server_id | End_log_pos | Info                                                                                                                                                                                  |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| mysql-bin.000060 |    4 | Format_desc |         1 |         107 | Server ver: 5.5.32-log, Binlog ver: 4                                                                                                                                                 |
| mysql-bin.000060 |  107 | Query       |         1 |         183 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000060 |  183 | Table_map   |         1 |         237 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000060 |  237 | Update_rows |         1 |         359 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000060 |  359 | Xid         |         1 |         386 | COMMIT /* xid=5802 */                                                                                                                                                                 |
| mysql-bin.000060 |  386 | Query       |         1 |         638 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;7d2d44ca-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000060 |  638 | Query       |         1 |         714 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000060 |  714 | Table_map   |         1 |         768 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000060 |  768 | Update_rows |         1 |         890 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000060 |  890 | Xid         |         1 |         917 | COMMIT /* xid=5811 */                                                                                                                                                                 |
| mysql-bin.000060 |  917 | Query       |         1 |        1169 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;83234b13-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000060 | 1169 | Query       |         1 |        1245 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000060 | 1245 | Table_map   |         1 |        1299 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000060 | 1299 | Update_rows |         1 |        1421 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000060 | 1421 | Xid         |         1 |        1448 | COMMIT /* xid=5819 */                                                                                                                                                                 |
| mysql-bin.000060 | 1448 | Query       |         1 |        1700 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;89193a09-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Scroll to the right to find the unique value injected into the view&#39;s creation statement.&lt;/p&gt;
&lt;p&gt;Does it replicate well? Looking at a slave&#39;s binary logs:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;slave3 [localhost] {msandbox} ((none)) &amp;gt; show binlog events in &#39;mysql-bin.000064&#39;;
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Log_name         | Pos  | Event_type  | Server_id | End_log_pos | Info                                                                                                                                                                                  |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| mysql-bin.000064 |    4 | Format_desc |       103 |         107 | Server ver: 5.5.32-log, Binlog ver: 4                                                                                                                                                 |
| mysql-bin.000064 |  107 | Query       |         1 |         166 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000064 |  166 | Table_map   |         1 |         220 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000064 |  220 | Update_rows |         1 |         342 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000064 |  342 | Xid         |         1 |         369 | COMMIT /* xid=3184 */                                                                                                                                                                 |
| mysql-bin.000064 |  369 | Query       |         1 |         601 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;7d2d44ca-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000064 |  601 | Query       |         1 |         660 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000064 |  660 | Table_map   |         1 |         714 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000064 |  714 | Update_rows |         1 |         836 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000064 |  836 | Xid         |         1 |         863 | COMMIT /* xid=3194 */                                                                                                                                                                 |
| mysql-bin.000064 |  863 | Query       |         1 |        1095 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;83234b13-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000064 | 1095 | Query       |         1 |        1154 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000064 | 1154 | Table_map   |         1 |        1208 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000064 | 1208 | Update_rows |         1 |        1330 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000064 | 1330 | Xid         |         1 |        1357 | COMMIT /* xid=3198 */                                                                                                                                                                 |
| mysql-bin.000064 | 1357 | Query       |         1 |        1589 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;89193a09-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Not as pretty; I hate DDL operations that are not strictly required; but this solves the problem, plus rewriting the view means we&#39;re not littering the tablespace.&lt;/p&gt;
&lt;p&gt;Next post will describe the steps towards achieving GTID-like behaviour based on the above.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&#39;, @pseudo_gtid, &#39;
&lt;/blockquote&gt;
&lt;p&gt;And this is how it looks on runtime (running this new event along with the old one):&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;master [localhost] {msandbox} (test) &amp;gt; show binlog events in &#39;mysql-bin.000060&#39; limit 20;
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Log_name         | Pos  | Event_type  | Server_id | End_log_pos | Info                                                                                                                                                                                  |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| mysql-bin.000060 |    4 | Format_desc |         1 |         107 | Server ver: 5.5.32-log, Binlog ver: 4                                                                                                                                                 |
| mysql-bin.000060 |  107 | Query       |         1 |         183 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000060 |  183 | Table_map   |         1 |         237 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000060 |  237 | Update_rows |         1 |         359 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000060 |  359 | Xid         |         1 |         386 | COMMIT /* xid=5802 */                                                                                                                                                                 |
| mysql-bin.000060 |  386 | Query       |         1 |         638 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;7d2d44ca-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000060 |  638 | Query       |         1 |         714 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000060 |  714 | Table_map   |         1 |         768 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000060 |  768 | Update_rows |         1 |         890 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000060 |  890 | Xid         |         1 |         917 | COMMIT /* xid=5811 */                                                                                                                                                                 |
| mysql-bin.000060 |  917 | Query       |         1 |        1169 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;83234b13-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000060 | 1169 | Query       |         1 |        1245 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000060 | 1245 | Table_map   |         1 |        1299 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000060 | 1299 | Update_rows |         1 |        1421 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000060 | 1421 | Xid         |         1 |        1448 | COMMIT /* xid=5819 */                                                                                                                                                                 |
| mysql-bin.000060 | 1448 | Query       |         1 |        1700 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;89193a09-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Scroll to the right to find the unique value injected into the view&#39;s creation statement.&lt;/p&gt;
&lt;p&gt;Does it replicate well? Looking at a slave&#39;s binary logs:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;slave3 [localhost] {msandbox} ((none)) &amp;gt; show binlog events in &#39;mysql-bin.000064&#39;;
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Log_name         | Pos  | Event_type  | Server_id | End_log_pos | Info                                                                                                                                                                                  |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| mysql-bin.000064 |    4 | Format_desc |       103 |         107 | Server ver: 5.5.32-log, Binlog ver: 4                                                                                                                                                 |
| mysql-bin.000064 |  107 | Query       |         1 |         166 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000064 |  166 | Table_map   |         1 |         220 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000064 |  220 | Update_rows |         1 |         342 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000064 |  342 | Xid         |         1 |         369 | COMMIT /* xid=3184 */                                                                                                                                                                 |
| mysql-bin.000064 |  369 | Query       |         1 |         601 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;7d2d44ca-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000064 |  601 | Query       |         1 |         660 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000064 |  660 | Table_map   |         1 |         714 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000064 |  714 | Update_rows |         1 |         836 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000064 |  836 | Xid         |         1 |         863 | COMMIT /* xid=3194 */                                                                                                                                                                 |
| mysql-bin.000064 |  863 | Query       |         1 |        1095 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;83234b13-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000064 | 1095 | Query       |         1 |        1154 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000064 | 1154 | Table_map   |         1 |        1208 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000064 | 1208 | Update_rows |         1 |        1330 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000064 | 1330 | Xid         |         1 |        1357 | COMMIT /* xid=3198 */                                                                                                                                                                 |
| mysql-bin.000064 | 1357 | Query       |         1 |        1589 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;89193a09-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Not as pretty; I hate DDL operations that are not strictly required; but this solves the problem, plus rewriting the view means we&#39;re not littering the tablespace.&lt;/p&gt;
&lt;p&gt;Next post will describe the steps towards achieving GTID-like behaviour based on the above.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
 from dual&#39;);
      PREPARE st FROM @_create_statement;
      EXECUTE st;
      DEALLOCATE PREPARE st;    
    end
;;

delimiter ;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;And this is how it looks on runtime (running this new event along with the old one):&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;master [localhost] {msandbox} (test) &amp;gt; show binlog events in &#39;mysql-bin.000060&#39; limit 20;
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Log_name         | Pos  | Event_type  | Server_id | End_log_pos | Info                                                                                                                                                                                  |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| mysql-bin.000060 |    4 | Format_desc |         1 |         107 | Server ver: 5.5.32-log, Binlog ver: 4                                                                                                                                                 |
| mysql-bin.000060 |  107 | Query       |         1 |         183 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000060 |  183 | Table_map   |         1 |         237 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000060 |  237 | Update_rows |         1 |         359 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000060 |  359 | Xid         |         1 |         386 | COMMIT /* xid=5802 */                                                                                                                                                                 |
| mysql-bin.000060 |  386 | Query       |         1 |         638 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;7d2d44ca-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000060 |  638 | Query       |         1 |         714 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000060 |  714 | Table_map   |         1 |         768 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000060 |  768 | Update_rows |         1 |         890 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000060 |  890 | Xid         |         1 |         917 | COMMIT /* xid=5811 */                                                                                                                                                                 |
| mysql-bin.000060 |  917 | Query       |         1 |        1169 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;83234b13-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000060 | 1169 | Query       |         1 |        1245 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000060 | 1245 | Table_map   |         1 |        1299 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000060 | 1299 | Update_rows |         1 |        1421 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000060 | 1421 | Xid         |         1 |        1448 | COMMIT /* xid=5819 */                                                                                                                                                                 |
| mysql-bin.000060 | 1448 | Query       |         1 |        1700 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;89193a09-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Scroll to the right to find the unique value injected into the view&#39;s creation statement.&lt;/p&gt;
&lt;p&gt;Does it replicate well? Looking at a slave&#39;s binary logs:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;slave3 [localhost] {msandbox} ((none)) &amp;gt; show binlog events in &#39;mysql-bin.000064&#39;;
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Log_name         | Pos  | Event_type  | Server_id | End_log_pos | Info                                                                                                                                                                                  |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| mysql-bin.000064 |    4 | Format_desc |       103 |         107 | Server ver: 5.5.32-log, Binlog ver: 4                                                                                                                                                 |
| mysql-bin.000064 |  107 | Query       |         1 |         166 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000064 |  166 | Table_map   |         1 |         220 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000064 |  220 | Update_rows |         1 |         342 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000064 |  342 | Xid         |         1 |         369 | COMMIT /* xid=3184 */                                                                                                                                                                 |
| mysql-bin.000064 |  369 | Query       |         1 |         601 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;7d2d44ca-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000064 |  601 | Query       |         1 |         660 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000064 |  660 | Table_map   |         1 |         714 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000064 |  714 | Update_rows |         1 |         836 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000064 |  836 | Xid         |         1 |         863 | COMMIT /* xid=3194 */                                                                                                                                                                 |
| mysql-bin.000064 |  863 | Query       |         1 |        1095 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;83234b13-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
| mysql-bin.000064 | 1095 | Query       |         1 |        1154 | BEGIN                                                                                                                                                                                 |
| mysql-bin.000064 | 1154 | Table_map   |         1 |        1208 | table_id: 33 (test.pseudo_gtid)                                                                                                                                                       |
| mysql-bin.000064 | 1208 | Update_rows |         1 |        1330 | table_id: 33 flags: STMT_END_F                                                                                                                                                        |
| mysql-bin.000064 | 1330 | Xid         |         1 |        1357 | COMMIT /* xid=3198 */                                                                                                                                                                 |
| mysql-bin.000064 | 1357 | Query       |         1 |        1589 | &lt;strong&gt;use `test`; CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`msandbox`@`localhost` SQL SECURITY DEFINER VIEW `pseudo_gtid_v` AS select &#39;89193a09-583e-11e4-9762-3c970ea31ea8&#39; from dual&lt;/strong&gt; |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Not as pretty; I hate DDL operations that are not strictly required; but this solves the problem, plus rewriting the view means we&#39;re not littering the tablespace.&lt;/p&gt;
&lt;p&gt;Next post will describe the steps towards achieving GTID-like behaviour based on the above.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Pseudo GTID</title>
      <link>/blog/2014/10/22/pseudo-gtid/</link>
      <pubDate>Wed, 22 Oct 2014 07:22:26 +0000</pubDate>
      
      <guid>/blog/2014/10/22/pseudo-gtid/</guid>
      <description>&lt;p&gt;Pseudo GTID is a method to implement a GTID-like solution where slaves are easily connected to one another. This blog post and the following ones will describe work in progress (some 80% completed), where simulation of GTID makes for a &lt;em&gt;good enough&lt;/em&gt; basis for refactoring replication topologies. I&#39;m coding this in &lt;a href=&#34;https://github.com/outbrain/orchestrator&#34;&gt;orchestrator&lt;/a&gt;, which already provides a substantial infrastructure support for this.&lt;/p&gt;
&lt;p&gt;The final goal: &lt;em&gt;orchestrator&lt;/em&gt; will allow you to move a slave below another, using only the data available by those two slaves. The usage is obvious:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Easy master failover (master dead? &lt;em&gt;Orchestrator&lt;/em&gt; will choose the most advanced slave to promote &lt;em&gt;and&lt;/em&gt; make it master of its siblings)&lt;/li&gt;
&lt;li&gt;Slave promotion in complex topologies (with &lt;a href=&#34;http://code.openark.org/blog/mysql/using-deep-nested-replication-topologies&#34;&gt;deep nested topologies&lt;/a&gt;, be able to move a slave up the hierarchy even if its local master is corrupted).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This can all happen with your normal, &lt;em&gt;non GTID&lt;/em&gt;, MySQL replication, using your normal binary log files &amp;amp; positions.&lt;/p&gt;
&lt;p&gt;This work in progress is inspired by &lt;strong&gt;&lt;a href=&#34;https://github.com/samlambert&#34;&gt;Sam Lambert&lt;/a&gt;&lt;/strong&gt; at GitHub, who has worked on a similar solution with different implementation. I also recall discussions with other DBAs having similar solution.&lt;/p&gt;
&lt;h4&gt;Pseudo GTID&lt;/h4&gt;
&lt;p&gt;First thing&#39;s first, the basis for proposed solution is a &lt;em&gt;pseudo-GTID&lt;/em&gt;. A unique entry in the binary logs (not necessarily sequential; not necessarily in ascending order). While in GTID implementations we have a unique identifier &lt;em&gt;for each entry&lt;/em&gt; in the binary log, with pseudo-GTID we accept an &lt;em&gt;occasional&lt;/em&gt; (or &lt;em&gt;frequent&lt;/em&gt;) unique entry in the binary log.&lt;/p&gt;
&lt;p&gt;There are many ways to do so. Certainly a client can generate a unique Id and invoke some statement on MySQL involving that ID. That would serve as valid grounds for the proposed solution. But I like things to be contained within MySQL. Consider, for example, the following event, which would be my preferred choice in Statement Based Replication (for RBR solution, see next post):&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;drop table if exists test.pseudo_gtid;
create table if not exists test.pseudo_gtid (
  id int unsigned not null primary key,
  ts timestamp,
  gtid varchar(64) charset ascii
);


drop event if exists test.update_pseudo_gtid_event;

delimiter ;;
create event if not exists
  test.update_pseudo_gtid_event
  on schedule every 10 second starts current_timestamp
  on completion preserve
  enable
  do
    begin
      set @pseudo_gtid := uuid();
      insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid);
    end
;;

delimiter ;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The above is based on &lt;a title=&#34;Link to Making UUID() and RAND() replication safe&#34; href=&#34;http://code.openark.org/blog/mysql/making-uuid-and-rand-replication-safe&#34; rel=&#34;bookmark&#34;&gt;Making UUID() and RAND() replication safe&lt;/a&gt;. What do we get? Once in 10 seconds (or what have you), a unique entry is written to the binary log.&lt;/p&gt;
&lt;p&gt;&lt;!--more--&gt;Consider that the event is already running by now, and the next conventional statements executed by the application:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;master [localhost] {msandbox} (test) &amp;gt; create table test.vals(id int);
master [localhost] {msandbox} (test) &amp;gt; insert into test.vals (id) values (17);
master [localhost] {msandbox} (test) &amp;gt; insert into test.vals (id) values (18);
master [localhost] {msandbox} (test) &amp;gt; insert into test.vals (id) values (19);
master [localhost] {msandbox} (test) &amp;gt; insert into test.vals (id) values (23);

master [localhost] {msandbox} (test) &amp;gt; show master logs;
+------------------+-----------+
| Log_name         | File_size |
+------------------+-----------+
| mysql-bin.000036 |       531 |
| mysql-bin.000037 |      1269 |
| mysql-bin.000038 |      6627 |
| mysql-bin.000039 |      3313 |
+------------------+-----------+
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Let&#39;s look at the binary logs content:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;master [localhost] {msandbox} (test) &amp;gt; show binlog events in &#39;mysql-bin.000039&#39;;
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Log_name         | Pos  | Event_type  | Server_id | End_log_pos | Info                                                                                                                                        |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| mysql-bin.000039 |    4 | Format_desc |         1 |         107 | Server ver: 5.5.32-log, Binlog ver: 4                                                                                                       |
| mysql-bin.000039 |  107 | Query       |         1 |         183 | BEGIN                                                                                                                                       |
| mysql-bin.000039 |  183 | User var    |         1 |         263 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x37383435623633382D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000039 |  263 | Query       |         1 |         461 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000039 |  461 | Xid         |         1 |         488 | COMMIT /* xid=74 */                                                                                                                         |
| mysql-bin.000039 |  488 | Query       |         1 |         581 | use `test`; create table test.vals(id int)                                                                                                  |
| mysql-bin.000039 |  581 | Query       |         1 |         657 | BEGIN                                                                                                                                       |
| mysql-bin.000039 |  657 | User var    |         1 |         737 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x37653362616434382D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000039 |  737 | Query       |         1 |         935 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000039 |  935 | Xid         |         1 |         962 | COMMIT /* xid=82 */                                                                                                                         |
| mysql-bin.000039 |  962 | Query       |         1 |        1038 | BEGIN                                                                                                                                       |
| mysql-bin.000039 | 1038 | User var    |         1 |        1118 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x38343331396662332D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000039 | 1118 | Query       |         1 |        1316 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000039 | 1316 | Xid         |         1 |        1343 | COMMIT /* xid=84 */                                                                                                                         |
| mysql-bin.000039 | 1343 | Query       |         1 |        1411 | BEGIN                                                                                                                                       |
| mysql-bin.000039 | 1411 | Query       |         1 |        1512 | use `test`; insert into test.vals (id) values (17)                                                                                          |
| mysql-bin.000039 | 1512 | Xid         |         1 |        1539 | COMMIT /* xid=84 */                                                                                                                         |
| mysql-bin.000039 | 1539 | Query       |         1 |        1607 | BEGIN                                                                                                                                       |
| mysql-bin.000039 | 1607 | Query       |         1 |        1708 | use `test`; insert into test.vals (id) values (18)                                                                                          |
| mysql-bin.000039 | 1708 | Xid         |         1 |        1735 | COMMIT /* xid=85 */                                                                                                                         |
| mysql-bin.000039 | 1735 | Query       |         1 |        1803 | BEGIN                                                                                                                                       |
| mysql-bin.000039 | 1803 | Query       |         1 |        1904 | use `test`; insert into test.vals (id) values (19)                                                                                          |
| mysql-bin.000039 | 1904 | Xid         |         1 |        1931 | COMMIT /* xid=86 */                                                                                                                         |
| mysql-bin.000039 | 1931 | Query       |         1 |        2007 | BEGIN                                                                                                                                       |
| mysql-bin.000039 | 2007 | User var    |         1 |        2087 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x38613237376232352D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000039 | 2087 | Query       |         1 |        2285 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000039 | 2285 | Xid         |         1 |        2312 | COMMIT /* xid=89 */                                                                                                                         |
| mysql-bin.000039 | 2312 | Query       |         1 |        2380 | BEGIN                                                                                                                                       |
| mysql-bin.000039 | 2380 | Query       |         1 |        2481 | use `test`; insert into test.vals (id) values (23)                                                                                          |
| mysql-bin.000039 | 2481 | Xid         |         1 |        2508 | COMMIT /* xid=89 */                                                                                                                         |
| mysql-bin.000039 | 2508 | Query       |         1 |        2584 | BEGIN                                                                                                                                       |
| mysql-bin.000039 | 2584 | User var    |         1 |        2664 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x39303164373731612D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000039 | 2664 | Query       |         1 |        2862 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000039 | 2862 | Xid         |         1 |        2889 | COMMIT /* xid=92 */                                                                                                                         |
| mysql-bin.000039 | 2889 | Query       |         1 |        2965 | BEGIN                                                                                                                                       |
| mysql-bin.000039 | 2965 | User var    |         1 |        3045 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x39363133363965382D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000039 | 3045 | Query       |         1 |        3243 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000039 | 3243 | Xid         |         1 |        3270 | COMMIT /* xid=94 */                                                                                                                         |
| mysql-bin.000039 | 3270 | Rotate      |         1 |        3313 | mysql-bin.000040;pos=4                                                                                                                      |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Marked in bold are the pseudo-GTID statements, aptly read &lt;strong&gt;&#34;@`pseudo_gtid`=_utf8 0x...&#34;&lt;/strong&gt;, and which are the resulting entry of the &lt;strong&gt;set @pseudo_gtid := uuid();&lt;/strong&gt; statement. These are interleaved with our normal statements. In busier servers there could be hundreds or thousands of statements between any two pseudo-GTID entries.&lt;/p&gt;
&lt;p&gt;We have a replicating slave to the above, which uses &lt;strong&gt;log_slave_updates&lt;/strong&gt;. For reasons to be explained later, I prefer and require &lt;strong&gt;log_slave_updates&lt;/strong&gt;, and will examine the slave&#39;s binary logs (instead of directly looking at the slave&#39;s relay logs):&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;slave3 [localhost] {msandbox} ((none)) &amp;gt; show master logs;

+------------------+-----------+
| Log_name         | File_size |
+------------------+-----------+
| mysql-bin.000046 |      1077 |
| mysql-bin.000047 |       126 |
| mysql-bin.000048 |       150 |
| mysql-bin.000049 |       150 |
| mysql-bin.000050 |     13860 |
| mysql-bin.000051 |       107 |
+------------------+-----------+

slave3 [localhost] {msandbox} ((none)) &amp;gt; show binlog events in &#39;mysql-bin.000051&#39;;
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Log_name         | Pos  | Event_type  | Server_id | End_log_pos | Info                                                                                                                                        |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| mysql-bin.000051 |    4 | Format_desc |       103 |         107 | Server ver: 5.5.32-log, Binlog ver: 4                                                                                                       |
| mysql-bin.000051 |  107 | Query       |         1 |         174 | BEGIN                                                                                                                                       |
| mysql-bin.000051 |  174 | User var    |         1 |         254 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x37383435623633382D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000051 |  254 | Query       |         1 |         452 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000051 |  452 | Xid         |         1 |         479 | COMMIT /* xid=2141 */                                                                                                                       |
| mysql-bin.000051 |  479 | Query       |         1 |         572 | use `test`; create table test.vals(id int)                                                                                                  |
| mysql-bin.000051 |  572 | Query       |         1 |         639 | BEGIN                                                                                                                                       |
| mysql-bin.000051 |  639 | User var    |         1 |         719 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x37653362616434382D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000051 |  719 | Query       |         1 |         917 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000051 |  917 | Xid         |         1 |         944 | COMMIT /* xid=2150 */                                                                                                                       |
| mysql-bin.000051 |  944 | Query       |         1 |        1011 | BEGIN                                                                                                                                       |
| mysql-bin.000051 | 1011 | User var    |         1 |        1091 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x38343331396662332D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000051 | 1091 | Query       |         1 |        1289 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000051 | 1289 | Xid         |         1 |        1316 | COMMIT /* xid=2152 */                                                                                                                       |
| mysql-bin.000051 | 1316 | Query       |         1 |        1375 | BEGIN                                                                                                                                       |
| mysql-bin.000051 | 1375 | Query       |         1 |        1476 | use `test`; insert into test.vals (id) values (17)                                                                                          |
| mysql-bin.000051 | 1476 | Xid         |         1 |        1503 | COMMIT /* xid=2154 */                                                                                                                       |
| mysql-bin.000051 | 1503 | Query       |         1 |        1562 | BEGIN                                                                                                                                       |
| mysql-bin.000051 | 1562 | Query       |         1 |        1663 | use `test`; insert into test.vals (id) values (18)                                                                                          |
| mysql-bin.000051 | 1663 | Xid         |         1 |        1690 | COMMIT /* xid=2156 */                                                                                                                       |
| mysql-bin.000051 | 1690 | Query       |         1 |        1749 | BEGIN                                                                                                                                       |
| mysql-bin.000051 | 1749 | Query       |         1 |        1850 | use `test`; insert into test.vals (id) values (19)                                                                                          |
| mysql-bin.000051 | 1850 | Xid         |         1 |        1877 | COMMIT /* xid=2158 */                                                                                                                       |
| mysql-bin.000051 | 1877 | Query       |         1 |        1944 | BEGIN                                                                                                                                       |
| mysql-bin.000051 | 1944 | User var    |         1 |        2024 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x38613237376232352D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000051 | 2024 | Query       |         1 |        2222 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000051 | 2222 | Xid         |         1 |        2249 | COMMIT /* xid=2160 */                                                                                                                       |
| mysql-bin.000051 | 2249 | Query       |         1 |        2308 | BEGIN                                                                                                                                       |
| mysql-bin.000051 | 2308 | Query       |         1 |        2409 | use `test`; insert into test.vals (id) values (23)                                                                                          |
| mysql-bin.000051 | 2409 | Xid         |         1 |        2436 | COMMIT /* xid=2162 */                                                                                                                       |
| mysql-bin.000051 | 2436 | Query       |         1 |        2503 | BEGIN                                                                                                                                       |
| mysql-bin.000051 | 2503 | User var    |         1 |        2583 | &lt;strong&gt;@`pseudo_gtid`=_utf8 0x39303164373731612D353631612D313165342D393135642D336339373065613331656138 COLLATE utf8_general_ci&lt;/strong&gt;                     |
| mysql-bin.000051 | 2583 | Query       |         1 |        2781 | use `test`; insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid) |
| mysql-bin.000051 | 2781 | Xid         |         1 |        2808 | COMMIT /* xid=2164 */                                                                                                                       |
| mysql-bin.000051 | 2808 | Rotate      |       103 |        2851 | mysql-bin.000052;pos=4                                                                                                                      |
+------------------+------+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------------------------------------------+
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;We can see the &lt;strong&gt;&#34;@`pseudo_gtid`=_utf8 0x&#34;&lt;/strong&gt; entries are replicated well, and are identical throughout the topology (this continue to work well on second-level slaves etc.).&lt;/p&gt;
&lt;p&gt;To be continued.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>