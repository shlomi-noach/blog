<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>Triggers &middot; code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="code.openark.org" href="/blog/tags/triggers/index.xml" />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blogimg/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
      <li class="pure-menu-item">
        <a class="pure-menu-link" href="/blog/tags/triggers/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link">
        Shlomi Noach
        
          <div class="avatar-container">
        	  <div class="avatar-img-border">
                <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
        	  </div>
        	</div>
        
      </a>
    </li>

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Triggers</h1>
</div>

<div class="content">
  
    <article>
  <header>
    <h2><a href="/blog/2011/03/07/limiting-table-disk-quota-in-mysql/">Limiting table disk quota in MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Mar 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/file-system">File System</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/myisam">MyISAM</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Question asked by a student: is there a way to limit a table&rsquo;s quote on disk? Say, limit a table to 2GB, after which it will refuse to grow? Note that the requirement is that rows are never DELETEd. The table must simply refuse to be updated once it reaches a certain size.</p>
<p>There is no built-in way to limit a table&rsquo;s quota on disk. First thing to observe is that MySQL has nothing to do with this. It is entirely up to the storage engine to provide with such functionality. The storage engine is the one to handle data storage: how table and keys are stored on disk. Just consider the difference between MyISAM&rsquo;s <strong>.MYD</strong> &amp; <strong>.MYI</strong> to InnoDB&rsquo;s shared tablespace <strong>ibdata1</strong> to InnoDB&rsquo;s file-per table <strong>.ibd</strong> files.</p>
<p>The only engine I know of that has a quota is the MEMORY engine: it accepts the <strong>max_heap_table_size</strong>, which limits the size of a single table in memory. Hrmmm&hellip; In memory&hellip;</p>
<h4>Why limit?</h4>
<p>I&rsquo;m not as yet aware of the specific requirements of said company, but this is not the first time I heard this question.</p>
<p>The fact is: when MySQL runs out of disk space, it goes with a BOOM. It crashed ungracefully, with binary logs being out of sync, replication being out of sync. To date, and I&rsquo;ve seen some cases, InnoDB merely crashes and manages to recover once disk space is salvaged, but I am not certain this is guaranteed to be the case. Anyone?</p>
<p>And, with MyISAM&hellip;, who knows?</p>
<p>Rule #1 of MySQL disk usage: <em>don&rsquo;t run out of disk space.</em></p>
<h4>Workarounds</h4>
<p>I can think of two workarounds, none of which is pretty. The first involves triggers (actually, a few variations for this one), the second involves privileges.</p>

  </p>

  
  <footer>
    <a href="/blog/2011/03/07/limiting-table-disk-quota-in-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/2010/10/07/thoughts-and-ideas-for-online-schema-change/">Thoughts and ideas for Online Schema Change</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Oct 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/schema">Schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Here&rsquo;s a few thoughts on current status and further possibilities for Facebook&rsquo;s <a href="http://www.facebook.com/note.php?note_id=430801045932">Online Schema Change</a> (OSC) tool. I&rsquo;ve had these thoughts for months now, pondering over improving <a href="../../forge/openark-kit/oak-online-alter-table">oak-online-alter-table</a> but haven&rsquo;t got around to implement them nor even write them down. Better late than never.</p>
<p>The tool has some limitations. Some cannot be lifted, some could. Quoting from the <a href="http://www.facebook.com/notes/mysql-at-facebook/online-schema-change-for-mysql/430801045932">announcement</a> and looking at the code, I add a few comments. I conclude with a general opinion on the tool&rsquo;s abilities.</p>
<h4>&ldquo;The original table must have PK. Otherwise an error is returned.&rdquo;</h4>
<p>This restriction could be lifted: it&rsquo;s enough that the table has a UNIQUE KEY. My original <em>oak-online-alter-table</em> handled that particular case. As far as I see from their code, the Facebook code would work just as well with any unique key.</p>
<p>However, this restriction is of no real interest. As we&rsquo;re mostly interested in InnoDB tables, and since any InnoDB table <em>should have</em> a PRIMARY KEY, we shouldn&rsquo;t care too much.</p>
<h4>&ldquo;No foreign keys should exist. Otherwise an error is returned.&rdquo;</h4>
<p>Tricky stuff. With <em>oak-online-alter-table</em>, changes to the original table were immediately reflected in the <em>ghost</em> table. With InnoDB tables, that meant same transaction. And although I never got to update the text and code, there shouldn&rsquo;t be a reason for not using child-side foreign keys (the child-side is the table on which the FK constraint is defined).</p>
<p>The Facebook patch works differently: it captures changes and writes them to a <strong>delta</strong> table,  to be later (asynchronously) analyzed and make for a <em>replay</em> of actions on the <em>ghost</em> table.</p>

  </p>

  
  <footer>
    <a href="/blog/2010/10/07/thoughts-and-ideas-for-online-schema-change/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/2009/02/02/triggers-use-case-compilation-part-iii/">Triggers Use Case Compilation, Part III</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Feb 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/event-scheduler">Event Scheduler</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The previous two parts have looked at some solutions offered by triggers. Let&rsquo;s look now at some wishful triggers solutions, which are currently unavailable because of triggers limitations.</p>
<p><a href="http://code.openark.org/blog/mysql/triggers-use-case-compilation-part-i">Triggers Use Case Compilation, Part I</a></p>
<p><a href="http://code.openark.org/blog/mysql/triggers-use-case-compilation-part-ii">Triggers Use Case Compilation, Part II</a></p>
<h4>Limitations and wishful features</h4>
<p>Triggers are slow</p>
<p style="padding-left: 30px;">The overhead of adding triggers is usually an even breaker. But I would like to believe speed will improve in time!</p>
<p>Triggers cannot act on the same table which activated them.</p>
<p style="padding-left: 30px;">A thing I would like to do is have a rotating table. A log table is a perfect example: I only want to store logs up to 7 days back, or up to 1M rows. ON INSERT, (or once every 1000 inserts or so), I wish to remove oldest rows. This is not possible today since I can&rsquo;t DELETE rows from the same table which caused the ON INSERT trigger to run. It can&rsquo;t be hacked by calling on another table, then doing a circular trigger trick. MySQL will raise an error on run time, complaining about a loop.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/2009/02/02/triggers-use-case-compilation-part-iii/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/2009/01/15/triggers-use-case-compilation-part-ii/">Triggers Use Case Compilation, Part II</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Jan 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In <a title="Triggers Use Case Compilation, Part I" href="http://code.openark.org/blog/mysql/triggers-use-case-compilation-part-i">Triggers Use Case Compilation, Part I</a>, I&rsquo;ve demonstrated some triggers use scenarios.</p>
<p>We continue our examples of triggers usage.</p>
<h4>Counters and aggregations bookkeeping</h4>
<p>Consider the City table: each city belongs to a certain country. Some questions we may be interested in are:</p>
<ul>
<li>How many cities are there per country?</li>
<li>What&rsquo;s the sum of cities population per country?</li>
<li>What&rsquo;s the population of the largest city per country?</li>
</ul>
<p>Answering any of these questions is an easy SQL excercise. But aggregation is required, and full table scan (or full index scan, if we&rsquo;re lucky) is essentially part of any execution plan. What if we can&rsquo;t pay the price for these queries? What if we need immediate, or near immediate response?</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/2009/01/15/triggers-use-case-compilation-part-ii/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/2009/01/05/triggers-use-case-compilation-part-i/">Triggers Use Case Compilation, Part I</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Jan 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;ve run by quite a few triggers lately on production systems. In previous posts, I&rsquo;ve written about problems solved with triggers. So here&rsquo;s a compilation of some solutions based on triggers; and some problems which are not (yet?) solvable due to current triggers limitations.</p>
<p>Triggers can be used to:</p>
<ul>
<li>Maintain integrity</li>
<li>Enhance security</li>
<li>Enhance logging</li>
<li>Assist with archiving</li>
<li>Restrict table size</li>
<li>Manage caching</li>
<li>Manage counters</li>
</ul>
<p>Triggers are not fast. In fact, they can add quite an overhead if misused. Some of the triggers presented here are known to work on real life production systems, though, and work well. But make sure you benchmark before embarking on extensive application changes.</p>

  </p>

  
  <footer>
    <a href="/blog/2009/01/05/triggers-use-case-compilation-part-i/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/2009/01/01/using-triggers-to-block-malicious-code-an-example/">Using triggers to block malicious code: an example</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Jan 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Web applications face constant exploitation attempts. Those with a user base must keep their users&rsquo; private data, well&hellip; private.</p>
<p>While the MySQL security model allows restricting users access to databases, tables and even columns, it has no built in feature for restricting the rows access within the given table.</p>
<p>One cannot allow a user to only update rows 0 through 99, but restrict that user from updating rows 100 to 199. Such restrictions are usually managed in the application level, by adding a necessary &ldquo;&hellip; AND filtering_column = some_value&hellip;&rdquo;</p>
<p>Many web application have the notion of an &lsquo;admin&rsquo; account, or several such accounts, which provide greater control over the application. The &lsquo;admin&rsquo; account is one account to which many attacks are targeted. One such attack is an attempt to modify the admin&rsquo;s password, such that the attacker can later log in with and access restricted data.</p>

  </p>

  
  <footer>
    <a href="/blog/2009/01/01/using-triggers-to-block-malicious-code-an-example/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/2008/12/15/using-memcached-functions-for-mysql-an-automated-alternative-to-query-cache/">Using memcached functions for MySQL; an automated alternative to Query Cache</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Dec 2008</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/memcached">memcached</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/query-cache">Query Cache</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>There&rsquo;s a lot of buzz around memcached. memcached is widely used, and has clients for many programming languages and platforms. <a href="http://tangent.org/">TangentOrg</a> have developed a memcached client in the form of MySQL UDFs (User Defined Functions).</p>
<p>I wish to discuss the memcached functions for MySQL: if and how they should be used.</p>
<p>Disclaimer: I do not work with memcached functions for MySQL on a production system; all that is written here reflects my opinion on how things should be done.</p>
<p>With memcached functions for MySQL, we can do the following:</p>
<blockquote>
<pre><strong>SELECT </strong>memc_set(&lsquo;mykey&rsquo;, &lsquo;The answer is 42&rsquo;);
<strong>SELECT </strong>memc_get(&lsquo;mykey&rsquo;);</pre>
</blockquote>
<p>(See my previous post on how to <a title="Installing memcached functions for MySQL" href="http://code.openark.org/blog/mysql/installing-memcached-functions-for-mysql">install memcached functions for MySQL</a>).</p>
<h4>In what scenario should we use these functions?</h4>
<p>I believe memcached is the right tool for the application level. I am less enthusiastic about using it from MySQL. Sure, pushing it down to MySQL centralizes everything. Instead of having all my application code (PHP, Java etc.) access memcached separately, they can all access one single MySQL node, which gets to access memcached. I see two problems with this approach:</p>

  </p>

  
  <footer>
    <a href="/blog/2008/12/15/using-memcached-functions-for-mysql-an-automated-alternative-to-query-cache/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
</div>

</div>
</div>
<script src="/blogjs/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>
