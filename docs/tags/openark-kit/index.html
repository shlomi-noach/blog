<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>Openark Kit &middot; code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="code.openark.org" href="/blog/tags/openark-kit/index.xml" />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blogimg/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
      <li class="pure-menu-item">
        <a class="pure-menu-link" href="/blog/tags/openark-kit/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link">
        Shlomi Noach
        
          <div class="avatar-container">
        	  <div class="avatar-img-border">
                <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
        	  </div>
        	</div>
        
      </a>
    </li>

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Openark Kit</h1>
</div>

<div class="content">
  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-openark-kit-in-the-media-dbhangops-oursql/">common_schema &amp; openark-kit in the media: #DBHangOps, OurSQL</a></h2>

    <div class="post-meta">

  <div>

    <time>26 Jun 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/speaking">Speaking</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  #DBHangOps I had the pleasure of joining into @DBHangOps today, and speak about common_schema and openark-kit. What was meant to be a 15 minute session turned to be 50 -- sorry, people, I don't talk as much at home, but when it comes to my pet projects... I also realized I was missing on a great event: DBHangOps is a hangout where you can chat and discuss MySQL &amp; related technologies with friends and colleagues, with whom you typically only meet at conferences.
  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-openark-kit-in-the-media-dbhangops-oursql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/opeark-kit-revision-196-released/">opeark-kit revision 196 released</a></h2>

    <div class="post-meta">

  <div>

    <time>07 May 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This is a long due maintenance release of <a href="http://code.google.com/p/openarkkit/"><strong>openark-kit</strong>.</a> This release includes bugfixes and some enhancements, mainly to <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-online-alter-table.html">oak-online-alter-table</a>.</p>
<p><em>oak-online-alter-table</em> Changes / bug fixes include:</p>
<ul>
<li>Support for keyword-named columns</li>
<li>Use of FORCE INDEX due to lack of MySQL&rsquo;s ability for figure out the chunking key at all times</li>
<li><strong>&ndash;sleep-ratio</strong> option added; allows for sleep time proportional to execution time (as opposed to constant sleep time with <strong>&ndash;sleep</strong>)</li>
<li>Support for chunk-retry (in case of deadlock) via <strong>&ndash;max-lock-retries</strong>)</li>
<li>Fixed order of cleanup</li>
<li>Fixed bug with verbose messages with non-integer chunking key</li>
<li>Fixed bug with single-row tables (people, no need for this tool for single row tables :))</li>
<li>Friendly verbose messages to remind you what&rsquo;s being executed</li>
</ul>
<p><em>oak-chunk-update</em> changes includes:</p>
<ul>
<li>Verbosing query comment if exists (friendly printing of what&rsquo;s being executed)</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/opeark-kit-revision-196-released/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/speaking-at-percona-live-2013-common_schema-lightning-talks/">Speaking at Percona Live 2013: common_schema, lightning talks</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Apr 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/perconalive">PerconaLive</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  In two weeks time I will be giving these talks at Percona Live: common_schema: DBA's framework for MySQL: an introduction to common_schema, my evolving server side solutions project. This will be a revised version of the talk I gave at Percona Live London; I have felt some weaknesses during that talk, which I've thrown out, letting room for cool stuff. I will discuss common_schema's various views, interesting and useful routines, the power of QueryScript, and a brief intro to the newcomer rdebug, debugger and debugging API for MySQL.
  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-at-percona-live-2013-common_schema-lightning-talks/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-over-traditional-scripts/">common_schema over traditional scripts</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Dec 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>If you are familiar with both <a href="http://code.openark.org/forge/openark-kit">openark kit</a> and <a href="http://code.google.com/p/common-schema">common_schema</a>, you&rsquo;ll notice I&rsquo;ve incorporated some functionality already working in <em>openark kit</em> into <em>common_schema</em>, essentially rewriting what used to be a Python script into SQL/<a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">QueryScript</a>.</p>
<p>What was my reasoning for rewriting good code? I wish to explain that, and provide with a couple examples.</p>
<p>I&rsquo;m generally interested in pushing as much functionality into the MySQL server. When using an external script, one:</p>
<ul>
<li>Needs the right dependencies (OS, Perl/Python version, Perl/Python modules).</li>
<li>Needs to provide with connection params,</li>
<li>Needs to get acquainted with a lot of command line options,</li>
<li>Is limited by whatever command line options are provided.</li>
<li>Has to invoke that script (duh!) to get the work done.</li>
</ul>
<p>This last bullet is not so trivial: it means you can&rsquo;t work some operation with your favorite GUI client, because it has no notion of your Perl script; does not run on the same machine where your Python code resides; simply can&rsquo;t run those scripts for you.</p>
<p>With server-side code, functionality is accessible via any client. You run your operation via a query (e.g. <strong>CALL some_procedure</strong>). That can be done from your GUI client, your command line client, your event scheduler, your cronjob, all equally. You only need access to your MySQL server, which is trivial.</p>
<p>Of course, server side scripting is <a href="http://code.openark.org/blog/mysql/things-that-cant-and-some-that-can-be-done-from-within-a-mysql-stored-routine">limited</a>. Some stuff simply can&rsquo;t be written solely on server side. If you want to consult your replicating slave; gracefully take action on user&rsquo;s <strong>Ctrl+C</strong>, send data over the web, you&rsquo;ll have to do it with an external tool. There are actually a lot of surprising limitations to things one would assume <em>are</em> possible on server side. You may already know how frustrated I am by the fact one can <a href="http://code.openark.org/blog/mysql/reading-results-of-show-statements-on-server-side">hardly</a> get info from <strong>SHOW</strong> commands.</p>
<h4>But, when it works, it shines</h4>
<p>Let&rsquo;s review a couple examples. The first one is nearly trivial. The second less so.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-over-traditional-scripts/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/state-of-inndb-online-ddl-in-mysql-5-6-8-rc/">State of InnDB Online DDL in MySQL 5.6.8-RC</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Nov 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/review">Review</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong>5.6.8-rc</strong> is out, and so I&rsquo;m following up on InnoDB&rsquo;s online DDL new feature: the ability to SELECT, INSERT, DELETE, UPDATE a table even while an ALTER TABLE is executing on same table.</p>
<h4>The brief summary</h4>
<p>Not as advertised; many things can&rsquo;t be done.</p>
<h4>The longer review</h4>
<p>I&rsquo;m using <strong>5.6.8-rc 64bit</strong> binary distribution for Linux, installed via <a href="http://mysqlsandbox.net/">mysqlsandbox</a>. My hardware is irrelevant, but the fact I&rsquo;m testing on my laptop assists me in that <strong>ALTER TABLE</strong> operations take a while, so that I&rsquo;m able to easily type commands in two terminals and have the time to watch them being executed. Query cache is disabled.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/state-of-inndb-online-ddl-in-mysql-5-6-8-rc/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/experimenting-with-5-6-innodb-online-ddl-bugs-included/">Experimenting with 5.6 InnoDB Online DDL (bugs included)</a></h2>

    <div class="post-meta">

  <div>

    <time>18 Oct 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>MySQL <strong>5.6</strong> offers the groundbreaking online DDL operations for InnoDB. Most common use cases will enjoy this feature, and the need for <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-online-alter-table.html">online alter table</a> scripts will decrease. This is a killer feature!</p>
<p>I&rsquo;ve put this new feature to the usability test. How did it go? Not too well, I&rsquo;m afraid.</p>
<p>[Updates to this text inline], also see <a href="http://code.openark.org/blog/mysql/innodb-ddl-kudos-to-quick-responders-on-bugs-mysql-com">this followup</a>.</p>
<h4>sakila &amp; DDL</h4>
<p><a href="http://dev.mysql.com/doc/sakila/en/index.html">sakila</a> is still a very useful database. I say &ldquo;still&rdquo; because it is not very large, and computing power is getting stronger; yet on my laptop some operations can still take many seconds to complete, which is just fine for my tests.</p>
<p>Sakila tables are mostly InnoDB, and rental being the largest, I do:</p>
<blockquote>
<pre>node1 (sakila) &gt; <strong>alter table sakila.rental engine=InnoDB;</strong>
Query OK, 16044 rows affected (<strong>6.94</strong> sec)
Records: 16044  Duplicates: 0  Warnings: 0</pre>
</blockquote>
<p>So what can be executed during these <strong>6.94</strong> seconds? In a second terminal, I try the following:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/experimenting-with-5-6-innodb-online-ddl-bugs-included/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/how-common_schema-splits-tables-internals/">How common_schema split()s tables - internals</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Sep 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post exposes some of the internals, and the SQL behind QueryScript&rsquo;s <em>split</em>. <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">common_schema/QueryScript</a> <strong>1.1</strong> introduces the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split</strong></a> statement, which auto-breaks a &ldquo;large&rdquo; query (one which operates on large tables as a whole or without keys) into smaller queries, and executes them in sequence.</p>
<p>This makes for easier transactions, less locks held, potentially (depending on the user) more idle time released back to the database. <em>split<strong></strong></em> has similar concepts to <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-chunk-update.html">oak-chunk-update</a> and <a href="http://www.percona.com/doc/percona-toolkit/2.1/pt-archiver.html">pt-archiver</a>, but works differently, and implemented entirely in SQL on server side.</p>
<p>Take the following statement as example:</p>
<blockquote>
<pre><strong>split</strong> (<strong>UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR</strong>)
  pass;</pre>
</blockquote>
<p>It yields with (roughly) the following statements:</p>
<blockquote>
<pre>UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;1&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;1&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;1000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;1000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;1000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;2000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;2000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;2000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;3000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;3000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;3000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;4000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;4000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;4000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;4581&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;4581&rsquo;))));</pre>
</blockquote>
<p>(I say &ldquo;roughly&rdquo; because internally there are user defined variables at play, but for convenience, I verbose the actual values as constants.)</p>
<h4>How does that work?</h4>
<p><em>common_schema</em> works on server side. There is no Perl script or anything. It must therefore use server-side operations to:</p>
<ul>
<li>Identify table to be split</li>
<li>Analyze the table in the first place, deciding how to split it</li>
<li>Analyze the query, deciding on how to rewrite it</li>
<li>Split the table (logically) into unique and distinct chunks</li>
<li>Work out the query on each such chunk</li>
</ul>
<p>Following is an internal look at how <em>common_schema</em> does all the above.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/how-common_schema-splits-tables-internals/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/delete-dont-insert/">DELETE, don&#39;t INSERT</a></h2>

    <div class="post-meta">

  <div>

    <time>27 Jun 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Have just read <a href="http://blog.9minutesnooze.com/insert-delete/">INSERT, Don’t DELETE</a> by Aaron Brown, and have some lengthy response, which is why I write this post instead of commenting on said post.</p>
<p>I wish to offer my counter thought and suggest that <strong>DELETE</strong>s are probably the better choice.</p>
<p>Aaron suggests that, when one wishes to purge rows from some table, a trick can be used: instead of <strong>DELETE</strong>ing unwanted rows, one can <strong>INSERT</strong> &ldquo;good&rdquo; rows into a new table, then switch over with <strong>RENAME</strong> (but please read referenced post for complete details).</p>
<p>I respectfully disagree on several points discussed.</p>
<h4>Lockdown</h4>
<p>The fact one needs to block writes during the time of creation of new table is problematic: you need to essentially turn off parts of your application. The posts suggests one could use a slave - but this solution is far from being trivial as well. To switch over, you yet again need to turn off access to DB, even if for a short while.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/delete-dont-insert/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/webinar-review-zero-downtime-schema-changes-in-mysql/">Webinar review: Zero-Downtime Schema Changes In MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>03 May 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Yesterday I attended the <a href="http://www.percona.com/webinars/2012-05-02-zero-downtime-schema-changes-in-mysql/">Zero-Downtime Schema Changes In MySQL</a> webinar by Baron Schwartz, Percona (<em>do you say &ldquo;attended&rdquo; for something you listened to from your home office?</em>)</p>
<p>I was keen to learn about possible enhancements and improvements of <a href="http://www.percona.com/doc/percona-toolkit/2.1/pt-online-schema-change.html">pt-online-schema-change</a> over <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-online-alter-table.html">oak-online-alter-table</a>. Here are my impressions:</p>
<p>The base logic of <em>pt-online-schema-change</em> is essentially the same as of <em>oak-online-alter-table</em>. You create a ghost/shadow table, create complex triggers, copy in chunks, freeze and swap. Both work on any type of <strong>PRIMARY KEY</strong> (<em>oak-online-alter-table</em> can work with any <strong>UNIQUE KEY</strong>, I&rsquo;m not sure about <em>pt-online-schema-change</em> on this), be it an <strong>INTEGER</strong>, other type, or a multi column one.</p>
<p>However, <em>pt-online-schema-change</em> also adds the following:</p>
<ul>
<li>It supports <strong>FOREIGN KEY</strong>s (to some extent). This is something I&rsquo;ve wanted to do with <em>oak-online-alter-table</em> but never got around to it. Foreign keys are very tricky, as Baron noted. With child-side keys, things are reasonably manageable. With parent-side this becomes a nightmare, sometimes unsolvable (when I say &ldquo;unsolvable&rdquo;, I mean that under the constraint of having the operation run in a non-blocking, transparent way).</li>
<li>Chunk size is auto-calculated by the script. This is a cool addition. Instead of letting the user throwing out numbers like <strong>1,000</strong> rows per chunk, in the hope that this is neither too small nor too large, the tool monitors the time it takes a chunk to complete, then adjusts the size of next chunk accordingly. Hopefully this leads to a more optimized run, where locks are only held for very short periods, yet enough rows are being processed at a time.</li>
<li>The tool looks into replicating slaves to verify they&rsquo;re up to the job. If the slave lags too far, the tool slows down the work. This is an excellent feature, and again, one that I always wanted to have. Great work!</li>
</ul>
<p>So the three bullets above are what I understand to be the major advantages of Percona&rsquo;s tool over <em>oak-online-alter-table</em>.</p>
<h4>Q &amp; A</h4>
<p>The presentation itself was very good, and Baron answered some questions. There was one question he did not answer during the webinar, nor here, and I though I may pop in and answer it. Although I can&rsquo;t speak for the coders of <em>pt-online-schema-change</em>, I safely assume that since the logic follows that of <em>oak-online-alter-table</em>, the same answer applies in the case of Percona&rsquo;s toolkit.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/webinar-review-zero-downtime-schema-changes-in-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/documentation-in-sql-call-for-help/">Documentation in SQL: CALL for help()</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Jan 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/documentation">documentation</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Documentation is an important part of any project. On the projects I maintain I put a lot of effort on documentation, and, frankly, the majority of time spent on my projects is on documentation.</p>
<p>The matter of keeping the documentation faithful is a topic of interest. I&rsquo;d like to outline a few documentation bundling possibilities, and the present the coming new documentation method for <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>. I&rsquo;ll talk about any bundling that is NOT <em>man pages</em>.</p>
<h4>High level: web docs</h4>
<p>This is the initial method of documentation I used for <a title="openark kit" href="../../forge/openark-kit">openark kit</a> and <a title="mycheckpoint" href="../../forge/mycheckpoint">mycheckpoint</a>. It&rsquo;s still valid for <em>mycheckpoint</em>. Documentation is web-based. You need Internet access to read it. It&rsquo;s in HTML format.</p>
<p>Well, not exactly HTML format: I wrote it in WordPress. Yes, it&rsquo;s HTML, but there&rsquo;s a lot of noise around (theme, menus, etc.) which is not strictly part of the documentation.</p>
<p>While this is perhaps the easiest way to go, here&rsquo;s a few drawbacks:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/documentation-in-sql-call-for-help/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/slides-for-openark-kit-mysql-utilities-for-everyday-use/">Slides for &#34;openark-kit: MySQL utilities for everyday use&#34;</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Apr 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/mysqlconf">mysqlconf</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Today I have delivered my talk, openark-kit: MySQL utilities for everyday use, at the O'REILLY MySQL Conference 2011. The slides are uploaded to the O'Reilly site, and I'm attaching them here as well. Feel free to download the PDF: openark-kit-mysqlconf11.pdf I wish to thank all who attended my talk! &nbsp;
  </p>

  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/checking-for-auto_increment-capacity-with-single-query/">Checking for AUTO_INCREMENT capacity with single query</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Apr 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><em>Darn!</em> This means <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-show-limits.html">oak-show-limits</a> becomes redundant. Am I not supposed to speak about it on my <a href="http://en.oreilly.com/mysql2011/public/schedule/detail/17155">coming presentation</a>? Bad timing!</p>
<p>You have <strong>AUTO_INCREMENT</strong> columns. How far are you pushing the limits? Are you going to run out of <strong>AUTO_INCREMENT</strong> values soon? Perhaps you wonder whether you should <strong>ALTER</strong> from <strong>INT</strong> to <strong>BIGINT</strong>?</p>
<p>The answer is all there in <strong>INFORMATION_SCHEMA</strong>. The <strong>TABLES</strong> table shows the current <strong>AUTO_INCREMENT</strong> value per table, and the <strong>COLUMNS</strong> table tells us all about a column&rsquo;s data type.</p>
<p>It takes some ugly code to deduce the maximum value per column type, what with signed/unsigned and data type, but then its very simple. Here is the query:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/checking-for-auto_increment-capacity-with-single-query/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/would-you-be-my-friend-on-mysqlconf-tempting-offer-inside/">Would you be my friend on mysqlconf? (tempting offer inside)</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Mar 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/humor">Humor</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/mysqlconf">mysqlconf</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I'm still throwing papers to the trash and starting all over, fixing, rewriting and improving my talk at mysqlconf 2011, where I will be presenting openark-kit: MySQL utilities for everyday use. However I've got something up my sleeve: a benefit many can enjoy, that'll make me a respectful, popular and sought after speaker. While others may try and lure you with such earthly temptations as a 20% off discount, I am in a position to offer you a more spiritual gift: my friendship!
  </p>

  
  <footer>
    <a href="/blog/mysql/would-you-be-my-friend-on-mysqlconf-tempting-offer-inside/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/speaking-at-the-oreilly-mysql-conference-2011/">Speaking at the O&#39;Reilly MySQL Conference 2011</a></h2>

    <div class="post-meta">

  <div>

    <time>03 Jan 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/mysqlconf">mysqlconf</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I'm very pleased and humbled to announce that my submission to the upcoming O'Reilly MySQL Conference, April 2011, has been accepted. I will present a 45 minute session titled openark-kit: MySQL utilities for everyday use. In this session, I will present some of the tools in the openark kit. We'll discuss some limitations of the MySQL server, and how openark kit tools overcome those limitations and provide with solutions to common maintenance and audit problems.
  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-at-the-oreilly-mysql-conference-2011/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/oak-hook-general-log-your-poor-mans-query-analyzer/">oak-hook-general-log: your poor man&#39;s Query Analyzer</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Dec 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/logs">logs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The latest release of <a href="http://code.openark.org/forge/openark-kit">openark kit</a> introduces <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-hook-general-log.html">oak-hook-general-log</a>, a handy tool which allows for some analysis of executing queries.</p>
<p>Initially I just intended for the tool to be able to dump the general log to standard output, from any machine capable to connect to MySQL. Quick enough, I realized the power it brings.</p>
<p>With this tool, one can dump to standard output all queries using temporary tables; or using a specific index; or doing a full index scan; or just follow up on connections; or&hellip; For example, the following execution will only log queries which make for filesort:</p>
<blockquote>
<pre>oak-hook-general-log &ndash;user=root &ndash;host=localhost &ndash;password=123456 &ndash;filter-explain-filesort</pre>
</blockquote>
<h4>The problem with using the standard logs</h4>
<p>So you have the <em>general log</em>, which you don&rsquo;t often enable, since it tends to grow huge within moments. You then have the <em>slow log</em>. Slow log is great, and is among the top tools for MySQL diagnosis.</p>
<p>The slow log allows for <strong>log-queries-not-using-indexes</strong>, which is yet another nice feature. Not only should you log any query running for over <strong>X</strong> seconds, but also log any query which does not use an index.</p>
<p>Wait. This logs all single-row tables (no single row table will use an index), as well as very small tables (a common <strong>20</strong> rows lookup table will most often be scanned). These are OK scans. This makes for some noise in the slow log.</p>
<p>And how about queries which do use an index, but do so poorly? They use an index, but retrieve some <strong>12,500,000</strong> rows, <em>using temporary</em> table &amp; <em>filesort</em>?</p>
<h4>What oak-hook-general-log does for you</h4>
<p>This tool streams out the general log, and filters out queries based on their <em>role</em> or on their <em>execution plan</em>.</p>
<p>To work at all, it must enable the general log. Moreover, it directs the general log to log table. Mind that this makes for a performance impact, which is why the tool auto-terminates and restores original log settings (default is <strong>1</strong> minute, configurable). It&rsquo;s really not a tool you should keep running for days. But during the few moments it runs, it will:</p>
<ul>
<li>Routinely rotate the <strong>mysql.general_log</strong> table so that it doesn&rsquo;t fill up</li>
<li>Examine entries found in the general log</li>
<li>Cross reference entries to the PROCESSLIST so as to deduce database context (<a href="http://bugs.mysql.com/bug.php?id=52554">bug #52554</a>)</li>
<li>If required and appropriate, evaluate a query&rsquo;s execution plan</li>
<li>Decide whether to dump each entry based on filtering rules</li>
</ul>
<h4>Filtering rules</h4>
<p>Filtering rules are passed as command line options. At current, only one filtering rule applies (if more than one specified only one is used, so no point in passing more than one). Some of the rules are:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/oak-hook-general-log-your-poor-mans-query-analyzer/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/openark-kit-rev-170-new-tools-new-functionality/">openark-kit (rev. 170): new tools, new functionality</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Dec 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m pleased to announce a new release of the <a href="http://code.openark.org/forge/openark-kit">openark kit</a>. There&rsquo;s a lot of new functionality inside; following is a brief overview.</p>
<p>The <em>openark kit</em> is a set of utilities for MySQL. They  solve everyday maintenance tasks, which may be complicated or time  consuming to work by hand.</p>
<p>It&rsquo;s been a while since the last announced release. Most of my attention was on <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a>, building new features, writing documentation etc. However my own use of <em>openark kit</em> has only increased in the past few months, and there&rsquo;s new useful solutions to common problems that have been developed.</p>
<p>I&rsquo;ve used and improved many tools over this time, but doing the final cut, along with proper documentation, took some time. Anyway, here are the highlights:</p>
<h4>New tool: oak-hook-general-log</h4>
<p><em>oak-hook-general-log</em> hooks up a MySQL server and dumps the general log based on filtering rules, applying to query role or execution plan. It is possible to only dump connect/disconnect entries, queries which make a full table scan, or use temporary tables, or scan more than X number of rows, or&hellip;</p>
<p>I&rsquo;ll write more on this tool shortly.</p>
<h4>New tool: oak-prepare-shutdown</h4>
<p>This tool makes for an orderly and faster shutdown by safely stopping replication, and flushing InnoDB pages to disk prior to shutting down (keeping server available for connections even while attempting to flush dirty pages to disk). A typical use case would be:</p>
<blockquote>
<pre>oak-prepare-shutdown &ndash;user=root &ndash;ask-pass &ndash;socket=/tmp/mysql.sock &amp;&amp; /etc/init.d/mysql stop</pre>
</blockquote>
<h4>New tool: oak-repeat query</h4>
<p><em>oak-repeat-query</em> repeats executing a given query until some condition holds. The condition can be:</p>
<ul>
<li>Number of given iterations has been reached</li>
<li>Given time has elapsed</li>
<li>No rows have been affected by query</li>
</ul>
<p>The tool comes in handy for cleanup jobs, warming up caches, etc.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/openark-kit-rev-170-new-tools-new-functionality/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/thoughts-and-ideas-for-online-schema-change/">Thoughts and ideas for Online Schema Change</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Oct 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/schema">Schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Here&rsquo;s a few thoughts on current status and further possibilities for Facebook&rsquo;s <a href="http://www.facebook.com/note.php?note_id=430801045932">Online Schema Change</a> (OSC) tool. I&rsquo;ve had these thoughts for months now, pondering over improving <a href="../../forge/openark-kit/oak-online-alter-table">oak-online-alter-table</a> but haven&rsquo;t got around to implement them nor even write them down. Better late than never.</p>
<p>The tool has some limitations. Some cannot be lifted, some could. Quoting from the <a href="http://www.facebook.com/notes/mysql-at-facebook/online-schema-change-for-mysql/430801045932">announcement</a> and looking at the code, I add a few comments. I conclude with a general opinion on the tool&rsquo;s abilities.</p>
<h4>&ldquo;The original table must have PK. Otherwise an error is returned.&rdquo;</h4>
<p>This restriction could be lifted: it&rsquo;s enough that the table has a UNIQUE KEY. My original <em>oak-online-alter-table</em> handled that particular case. As far as I see from their code, the Facebook code would work just as well with any unique key.</p>
<p>However, this restriction is of no real interest. As we&rsquo;re mostly interested in InnoDB tables, and since any InnoDB table <em>should have</em> a PRIMARY KEY, we shouldn&rsquo;t care too much.</p>
<h4>&ldquo;No foreign keys should exist. Otherwise an error is returned.&rdquo;</h4>
<p>Tricky stuff. With <em>oak-online-alter-table</em>, changes to the original table were immediately reflected in the <em>ghost</em> table. With InnoDB tables, that meant same transaction. And although I never got to update the text and code, there shouldn&rsquo;t be a reason for not using child-side foreign keys (the child-side is the table on which the FK constraint is defined).</p>
<p>The Facebook patch works differently: it captures changes and writes them to a <strong>delta</strong> table,  to be later (asynchronously) analyzed and make for a <em>replay</em> of actions on the <em>ghost</em> table.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/thoughts-and-ideas-for-online-schema-change/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/openark-kit-facebook-online-schema-change-and-thoughts-on-open-source-licenses/">openark-kit, Facebook Online Schema Change, and thoughts on open source licenses</a></h2>

    <div class="post-meta">

  <div>

    <time>16 Sep 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/opinions">Opinions</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  MySQL@Facebook team have recently published an Online Schema Change code for non blocking ALTER TABLE operations. Thumbs Up! The code is derived from oak-online-alter-table, part of openark-kit, a toolkit I'm authoring. Looking at the documentation I can see many ideas were incorporated as well. And of course many things are different, a lot of work has been put to it by MySQL@Facebook. openark-kit is currently released under the new BSD license, and, as far as I can tell (I'm not a lawyer), Facebook's work has followed the license to the letter.
  </p>

  
  <footer>
    <a href="/blog/mysql/openark-kit-facebook-online-schema-change-and-thoughts-on-open-source-licenses/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/explain-missing-db-info/">EXPLAIN: missing db info</a></h2>

    <div class="post-meta">

  <div>

    <time>11 May 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/execution-plan">Execution plan</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/logs">logs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m further developing a general log hook, which can stream queries from the general log.</p>
<p>A particular direction I&rsquo;m taking is to filter queries by their type of actions. For example, the tool (<a href="http://code.google.com/p/openarkkit/source/browse/trunk/openarkkit/src/oak/oak-hook-general-log.py">oak-hook-general-log</a>) can be instructed to only stream out those queries which involve creation of a temporary table; or those which cause for a filesort, or full index scan, etc.</p>
<p>This is done by evaluating of query execution plans on the fly. I suspect the <a href="http://www.mysql.com/why-mysql/white-papers/mysql_wp_queryanalyzer.php">MySQL query analyzer</a> roughly does the same (as a small part of what it does).</p>
<p>It&rsquo;s almost nothing one cannot do with sed/awk. However, I bumped into a couple of problems:</p>
<ol>
<li>The general log (and the <strong>mysql.general_log table</strong>, in  particular) does not indicate the particular database one is using for the query. Since slow log does indicate this data, I <a href="http://bugs.mysql.com/bug.php?id=52554">filed a bug</a> on this. I currently solve this by crossing connection id with the process list, where the current database is listed. It&rsquo;s shaky, but mostly works.</li>
<li>Just realized: there&rsquo;s no DB info in the <strong>EXPLAIN</strong> output! It&rsquo;s weird, since I&rsquo;ve been EXPLAINing queries for years now. But I&rsquo;ve always had the advantage of <em>knowing</em> the schema used: either because I was manually executing the query on a known schema, or <a href="http://www.maatkit.org/doc/mk-query-digest.html">mk-query-digest</a> was kind enough to let me know.</li>
</ol>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/explain-missing-db-info/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/oak-hook-general-log-streaming-general-log/">oak-hook-general-log: streaming general log</a></h2>

    <div class="post-meta">

  <div>

    <time>21 Mar 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/logs">logs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m seeking input on a new <a href="http://code.openark.org/forge/openark-kit">openark kit</a> utility I&rsquo;ve started to implement.</p>
<p>The tool, <strong>oak-hook-general-log</strong>, will hook up to a MySQL (&gt;= 5.1) server, and stream the general log into standard output. It looks like this:</p>
<blockquote>
<pre>bash$ python src/oak/oak-hook-general-log.py &ndash;socket=/tmp/mysql.sock &ndash;user=root
2010-03-21 10:18:42     root[root] @ localhost []       79      1       Query   SELECT COUNT(*) FROM City
2010-03-21 10:18:48     root[root] @ localhost []       79      1       Query   DELETE FROM City WHERE id=1000
2010-03-21 10:18:54     root[root] @ localhost []       79      1       Query   SHOW PROCESSLIST
2010-03-21 10:19:06     root[root] @ localhost []       79      1       Quit
2010-03-21 10:19:07     root[root] @ localhost []       93      1       Connect root@localhost on
2010-03-21 10:19:07     root[root] @ localhost []       93      1       Query   select @@version_comment limit 1
2010-03-21 10:22:33     root[root] @ localhost []       93      1       Query   SELECT City.Name, Country.Name FROM Country JOIN City ON Country.Capit
2010-03-21 10:22:58     root[root] @ localhost []       93      1       Quit
</pre>
</blockquote>
<p>Since output is written to <strong>stdout</strong>, one can further:</p>
<blockquote>
<pre>bash$ python src/oak/oak-hook-general-log.py &ndash;socket=/tmp/mysql.sock &ndash;user=root | grep Connect
bash$ python src/oak/oak-hook-general-log.py &ndash;socket=/tmp/mysql.sock &ndash;user=root | grep webuser@webhost</pre>
</blockquote>
<p>What the tool does is to enable table logs, and periodically rotate the <strong>mysql.general_log</strong> table, read and dump its content.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/oak-hook-general-log-streaming-general-log/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mk-schema-change-check-out-ideas-from-oak-online-alter-table/">mk-schema-change? Check out ideas from oak-online-alter-table</a></h2>

    <div class="post-meta">

  <div>

    <time>10 Mar 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/schema">Schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In response to Mark Callaghan&rsquo;s post <a href="http://www.facebook.com/note.php?note_id=356997370932">mk-schema-change</a>.</p>
<p>I apologize for not commenting on the post itself, I do not hold a Facebook account. Anyway this is a long write, so it may as well deserve a post of its own.</p>
<p>Some of the work Mark is describing already exists under <a href="http://code.openark.org/forge/openark-kit">openark kit</a>&rsquo;s <a href="http://code.openark.org/forge/openark-kit/oak-online-alter-table">oak-online-alter-table</a>. Allow me to explain what I have gained there, and how the issue can be further pursued. There is relevance to Mark&rsquo;s suggestion.</p>
<p><em>oak-online-alter-table</em> uses a combination of locks, chunks and triggers to achieve an almost non-blocking <strong>ALTER TABLE</strong> effect. I had a very short opportunity to speak with Mark on last year&rsquo;s conference, in between bites. Mark stated that anything involving triggers was irrelevant in his case.</p>
<p>The triggers are a pain, but I believe a few other insights from <em>oak-online-alter-table</em> can be of interest.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mk-schema-change-check-out-ideas-from-oak-online-alter-table/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/rpm-builds-for-openark-kit/">RPM builds for openark kit</a></h2>

    <div class="post-meta">

  <div>

    <time>10 Dec 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Thanks to Lenz Grimmer, openark kit is now available in RPM format. .DEB or python packages are available, as usual, on project page on Google Code. Thank you, Lenz!
  </p>

  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/new-and-noteworthy-in-openark-kit/">New and Noteworthy in openark kit</a></h2>

    <div class="post-meta">

  <div>

    <time>30 Jun 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A new release of <a href="http://code.openark.org/forge/openark-kit">openark kit</a> is out. Some interesting additions.changes are:</p>
<ul>
<li><a href="http://code.openark.org/forge/openark-kit/oak-online-alter-table">oak-online-alter-table</a>: now works with multicolumn UNIQUE KEYs</li>
<li>New: <a title="oka-chunk-update" href="http://code.openark.org/forge/openark-kit/oak-chunk-update">oak-chunk-update</a>: break an long running or non indexed UPDATE/DELETE to small chunks</li>
<li><a href="http://code.openark.org/forge/openark-kit/oak-purge-master-logs">oak-purge-master-logs</a>, <a href="http://code.openark.org/forge/openark-kit/oak-show-replication-status">oak-show-replication-status</a>: support for non standard slave ports</li>
</ul>
<p>openark kit is a set of utilities for MySQL, helping in easing out everyday&rsquo;s work. Let&rsquo;s look more closely at the changes.</p>
<h4>oak-online-alter-table</h4>
<p>The utility allows for non-blocking ALTER TABLE operations, under certain limitations. One limitation which has been removed in the current release was the single-column UNIQUE KEY limitation. As of now, a requirement for running <strong>oak-online-alter-table</strong> is that the altered table has <em>some</em> UNIQUE KEY. It could be numerical, textual, single column, multi-column (compound), anything.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/new-and-noteworthy-in-openark-kit/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/online-alter-table-now-available-in-openark-kit/">Online ALTER TABLE now available in openark kit</a></h2>

    <div class="post-meta">

  <div>

    <time>24 Mar 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A new utility in <a title="openark kit home page" href="http://code.openark.org/forge/openark-kit">openark kit</a> allows for online ALTER TABLE operation. That is, the modification of table structure without locking down the entire table for the duration of the operation. The <a title="oak-online-alter-table utility" href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-online-alter-table.html">oak-online-alter-table</a> utility works under the following restrictions:</p>
<ul>
<li>The table has at least one single-column UNIQUE KEY <em>[<em>]</em></li>
<li>Altered table shares a single-column UNIQUE KEY with the original table <em>[</em>]</em></li>
<li>No &lsquo;AFTER&rsquo; triggers are defined on the table (the utility creates its own triggers for the duration of the operation)</li>
<li>The table has no FOREIGN KEYs <em>[<em>][#]</em></li>
<li>Table name is no longer than 57 characters</li>
</ul>
<p><em>[</em>]: Restriction is scheduled to be removed or partly removed.</em></p>
<p><em>[#]: &lsquo;Child-side&rsquo; foreign keys may actually work, but have not been tested.<br />
</em></p>
<p>Follows is a mini FAQ which attempts to introduce the utility.</p>
<h4>So what exactly does this utility provide?</h4>
<ul>
<li>First and foremost, the ability to perform a non blocking ALTER TABLE. This has long been an issue with MySQL, and complex Master-Master, application aware solutions are currently required in order to perform an ALTER TABLE with minimal downtime. The utility offers a no-downtime solution, albeit there is performance penalty for the duration of its runtime, and some requirements to meet.</li>
<li>It also supports a &lsquo;null&rsquo; ALTER. That is, an ALTER TABLE which does not change anything. This effectively means rebuilding of the table. For InnoDB tables with innodb_file_per_table, for example, this could be the means of regaining disk space after removing many rows from the table. Also, while it does not strictly act like OPTIMIZE TABLE, the effect of running this utility should build a better organized table on disk (this as yet unverified).</li>
<li>Another thing this utility supports is the building of a ghost table: a duplicate of a given table, which keeps mirroring the original table via triggers. <em>[May be removed in future versions]</em></li>
</ul>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/online-alter-table-now-available-in-openark-kit/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/blocking-user-accounts/">Blocking user accounts</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Mar 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A long time missing feature in MySQL is temporarily blocking accounts: denying a user to log in, without affecting any other of her privileges.</p>
<p>There is no such privilege as &lsquo;LOGIN&rsquo; in the grants table, as the ability to log in is the most basic one MySQL allows. This basic privilege is called USAGE.</p>
<p>I&rsquo;ll present a hack around this, one which <a title="openark kit: oak-block-account" href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-block-account.html">oak-block-account</a> implements. Before presenting the hack, lets lay down some requirements:</p>
<ul>
<li>A user can be blocked from logging in to MySQL.</li>
<li>Such a blocked user can later be &lsquo;released&rsquo;, re-enabling him to log in.</li>
<li>It should be possible to determine if a certain user is currently blocked or not.</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/blocking-user-accounts/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/announcing-openark-kit/">Announcing openark kit</a></h2>

    <div class="post-meta">

  <div>

    <time>25 Feb 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blogcategories/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blogtags/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blogtags/python">python</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>It is my great pleasure to announce the availability of the <a title="openark kit project home page" href="http://code.openark.org/forge/openark-kit">openark kit</a>, a set of lightweight utilities for MySQL, which eases every day tasks.</p>
<p>The available tools are:</p>
<ul>
<li><a title="oak-apply-ri" href="http://code.openark.org/forge/openark-kit/oak-apply-ri">oak-apply-ri</a>: apply referential integrity on two columns with parent-child  relationship.</li>
<li><a title="oak-block-account" href="http://code.openark.org/forge/openark-kit/oak-block-account">oak-block-account</a>: block or release MySQL users accounts, disabling them or enabling them to login.</li>
<li><a title="oak-kill-slow-queries" href="http://code.openark.org/forge/openark-kit/oak-kill-slow-queries">oak-kill-slow-queries</a>: terminate long running queries.</li>
<li><a title="oak-modify-charset" href="http://code.openark.org/forge/openark-kit/oak-modify-charset">oak-modify-charset</a>: change the character set (and collation) of a textual column.</li>
<li><a title="oak-purge-master-logs" href="http://code.openark.org/forge/openark-kit/oak-purge-master-logs">oak-purge-master-logs</a>: purge master logs, depending on the state of replicating slaves.</li>
<li><a title="oak-security-audit" href="http://code.openark.org/forge/openark-kit/oak-security-audit">oak-security-audit</a>: audit accounts, passwords, privileges and other security settings.</li>
<li><a title="oak-show-limits" href="http://code.openark.org/forge/openark-kit/oak-show-limits">oak-show-limits</a>: show AUTO_INCREMENT “free space”.</li>
<li><a title="oak-show-replication-status" href="http://code.openark.org/forge/openark-kit/oak-show-replication-status">oak-show-replication-status</a>: show how far behind are replicating slaves on a given master.</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/announcing-openark-kit/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
</div>

</div>
</div>
<script src="/blogjs/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>
