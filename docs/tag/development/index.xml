<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Development on code.openark.org</title>
    <link>/blog/tag/development/</link>
    <description>Recent content in Development on code.openark.org</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2016. All rights reserved.</copyright>
    <lastBuildDate>Mon, 01 Aug 2016 19:19:00 +0000</lastBuildDate>
    <atom:link href="/blog/tag/development/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Introducing gh-ost: triggerless online schema migrations</title>
      <link>/blog/mysql/introducing-gh-ost-triggerless-online-schema-migrations/</link>
      <pubDate>Mon, 01 Aug 2016 19:19:00 +0000</pubDate>
      
      <guid>/blog/mysql/introducing-gh-ost-triggerless-online-schema-migrations/</guid>
      <description>&lt;p&gt;I&#39;m thoroughly happy to introduce &lt;a href=&#34;https://github.com/github/gh-ost&#34;&gt;&lt;strong&gt;gh-ost&lt;/strong&gt;&lt;/a&gt;: triggerless, controllable, auditable, testable, trusted online schema change tool &lt;a href=&#34;http://githubengineering.com/gh-ost-github-s-online-migration-tool-for-mysql/&#34;&gt;released today by GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;gh-ost&lt;/em&gt; now powers our production schema migrations. We hit some serious limitations using &lt;a href=&#34;https://www.percona.com/doc/percona-toolkit/2.2/pt-online-schema-change.html&#34;&gt;pt-online-schema-change&lt;/a&gt; on our large volume, high traffic tables, to the effect of driving our database to a near grinding halt or even to the extent of causing outages. With &lt;em&gt;gh-ost&lt;/em&gt;, we are now able to migrate our busiest tables at any time, peak hours and heavy workloads included, without causing impact to our service.&lt;/p&gt;
&lt;p&gt;gh-ost supports testing in production. It goes a long way to build trust, both in integrity and in control. Are your databases just too busy and you cannot run existing online-schema-change tools? Have you suffered outages due to migrations? Are you tired of babysitting migrations that run up to 3:00am? Tired of being the only one tailing logs? Please, take a look at &lt;em&gt;gh-ost&lt;/em&gt;. I believe it changes online migration paradigm.&lt;/p&gt;
&lt;p&gt;For a more thorough overview, please read the &lt;a href=&#34;http://githubengineering.com/gh-ost-github-s-online-migration-tool-for-mysql/&#34;&gt;announcement&lt;/a&gt; on the GitHub Engineering Blog, and proceed to the &lt;a href=&#34;https://github.com/github/gh-ost/blob/master/README.md&#34;&gt;documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;gh-ost&lt;/em&gt; is open sourced under the MIT license.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Orchestrator progress</title>
      <link>/blog/mysql/orchestrator-progress/</link>
      <pubDate>Wed, 23 Dec 2015 18:01:59 +0000</pubDate>
      
      <guid>/blog/mysql/orchestrator-progress/</guid>
      <description>&lt;p&gt;This comes mostly to reassure, having moved into GitHub: &lt;a href=&#34;https://github.com/outbrain/orchestrator&#34;&gt;orchestrator&lt;/a&gt; development continues.&lt;/p&gt;
&lt;p&gt;I will have the privilege of working on this open source solution in GitHub. There are a few directions we can take orchestrator to, and we will be looking into the possibilities. We will continue to strengthen the crash recovery process, and in fact I&#39;ve got a couple ideas on drastically shortening Pseudo-GTID recovery time as well as other debts. We will look into yet other directions, which we will share. My new and distinguished team will co-work on/with orchestrator and will no doubt provide useful and actionable input.&lt;/p&gt;
&lt;p&gt;Orchestrator continues to be open for pull requests, with a temporal latency in response time (it&#39;s the Holidays, mostly).&lt;/p&gt;
&lt;p&gt;Some Go(lang) limitations (namely the import path, I&#39;ll blog more about it) will most probably imply some changes to the code, which will be well communicated to existing collaborators.&lt;/p&gt;
&lt;p&gt;Most of all, we will keep orchestrator a generic solution, while keeping focus on what we think is most important - and there&#39;s some interesting vision here. Time will reveal as we make progress.&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Speaking at Percona Live: common_schema, MySQL DevOps</title>
      <link>/blog/mysql/speaking-at-perconalive-common_schema-mysql-devops/</link>
      <pubDate>Mon, 10 Mar 2014 10:27:42 +0000</pubDate>
      
      <guid>/blog/mysql/speaking-at-perconalive-common_schema-mysql-devops/</guid>
      <description>&lt;p&gt;In less than a month I&#39;ll be giving these two talks at &lt;a href=&#34;https://www.percona.com/live/mysql-conference-2014/&#34;&gt;Percona Live&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.percona.com/live/mysql-conference-2014/sessions/commonschema-dbas-framework-mysql&#34;&gt;common_schema: DBA&#39;s framework for MySQL&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you are still unfamiliar with &lt;a href=&#34;http://code.google.com/p/common-schema/&#34;&gt;common_schema,&lt;/a&gt; this will make for a good introduction. I&#39;ll give you multiple reasons why you would want to use it, and how it would come to &lt;em&gt;immediate&lt;/em&gt; use at your company. I do mean &lt;em&gt;immediate&lt;/em&gt;, as in previous &lt;em&gt;common_schema&lt;/em&gt; presentations I happened to get feedback emails from attendees within the same or next day letting me know how &lt;em&gt;common_schema&lt;/em&gt; solved an insistent problem of theirs or how it exposed an unknown status.&lt;/p&gt;
&lt;p&gt;I&#39;ll review some useful views &amp;amp; routines, and discuss the ease and power of QueryScript. &lt;em&gt;common_schema&lt;/em&gt; is a Swiss-knife of solutions, and all from within your MySQL server.&lt;/p&gt;
&lt;p&gt;I am using &lt;em&gt;common_schema&lt;/em&gt; in production on a regular basis, and it happened to be hero of the day in multiple occasions. I&#39;ll present a couple such cases.&lt;/p&gt;
&lt;p&gt;http://www.slideshare.net/shlominoach/commonschema-22-dbas-framework-for-mysql&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.percona.com/live/mysql-conference-2014/sessions/mysql-devops-outbrain&#34;&gt;MySQL DevOps @ Outbrain&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is a technical talk touching at some cultural issues.&lt;/p&gt;
&lt;p&gt;At &lt;a href=&#34;http://www.outbrain.com/about/what-is-outbrain&#34;&gt;Outbrain&lt;/a&gt;, where I work, we have two blessings: a large group of engineers and a large dataset. We at the infrastructure team, together with the ops team, are responsible for the availability of the data. What we really like is technology which lets the owners of a problem be able to recognize it and take care of it. We want ops guys to do ops, and engineers to do engineering. And we want them to be able to talk to each other and &lt;em&gt;understand&lt;/em&gt; each other.&lt;/p&gt;
&lt;p&gt;What tools can you use to increase visibility? To allow sharing of data between the teams? I&#39;ll share some tools and techniques that allow us to automate deployments, detect a malfunctioning/abusing service, deploy schema changes across dozens of hosts, control data retention, monitor connections, and more.&lt;/p&gt;
&lt;p&gt;We like open source. The tools discussed are mostly open source, or open sourced by Outbrain.&lt;/p&gt;
&lt;p&gt;I&#39;ll explain why these tools matter, and how they serve the purpose of removing friction between teams, allowing for quick analysis of problems and overall visibility on all things that happen.&lt;/p&gt;
&lt;p&gt;http://www.slideshare.net/shlominoach/mysql-devops-at-outbrain&lt;/p&gt;
&lt;h4&gt;Do come by!&lt;/h4&gt;</description>
    </item>
    
    <item>
      <title>Why delegating code to MySQL Stored Routines is poor engineering practice</title>
      <link>/blog/mysql/why-delegating-code-to-mysql-stored-routines-is-poor-engineering-practice/</link>
      <pubDate>Thu, 06 Feb 2014 10:32:17 +0000</pubDate>
      
      <guid>/blog/mysql/why-delegating-code-to-mysql-stored-routines-is-poor-engineering-practice/</guid>
      <description>&lt;p&gt;I happen to use stored routines with MySQL. In fact, my open source project &lt;a href=&#34;http://code.google.com/p/common-schema/&#34;&gt;common_schema&lt;/a&gt; heavily utilizes them. DBA-wise, I think they provide with a lot of power (alas, the ANSI:SQL 2003 syntax feels more like COBOL than a sane programming language, which is why I use &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html&#34;&gt;QueryScript&lt;/a&gt; instead).&lt;/p&gt;
&lt;p&gt;However I wish to discuss the use of stored routines as integral part of your application code, which I discourage.&lt;/p&gt;
&lt;p&gt;The common discussion on whether to user or not use stored routines typically revolves around data transfer (with stored routines you transfer less data since it&#39;s being processed on server side), security (with stored routines you can obfuscate/hide internal datasets, and provide with limited and expected API) and performance (with MySQL this is not what you would expect, as routines are interpreted &amp;amp; their queries re-evaluated, as opposed to other RDBMS you may be used to).&lt;/p&gt;
&lt;p&gt;But I wish to discuss the use of stored routines from an engineering standpoint. The first couple of points I raise are cultural/behavioural.&lt;/p&gt;
&lt;h4&gt;2nd grade citizens&lt;/h4&gt;
&lt;p&gt;Your stored routines are not likely to integrate well with your IDE. While your Java/Scala/PHP/Ruby/whatnot code comfortably lies within your home directory, the stored routines live in their own space: a database container. They&#39;re not as visible to you as your standard code. Your IDE is unaware of their existence and is unlikely to have the necessary plugin/state of mind to be able to view these.&lt;/p&gt;
&lt;p&gt;This leads to difficulty in maintaining the code. People typically resort to using some SQL-oriented GUI tool such as MySQL Workbench, SequelPro or other, commercial tools. But these tools, while make it easy to edit your routine code, do not integrate (well?) with your source control. I can&#39;t say I&#39;ve used all GUI tools; but how many of them will have Git/SVN/Mercurial connectors? How many of them will keep local history changes once you edit a routine? I&#39;m happy to get introduced to such a tool.&lt;/p&gt;
&lt;p&gt;Even with such integration, you&#39;re split between two IDEs. And if you&#39;re the command line enthusiast, well, you can&#39;t just &lt;strong&gt;svn ci -m &#34;fixed my stored procedure bug&#34;&lt;/strong&gt;. Your code is simply not in your trunk directory.&lt;/p&gt;
&lt;p&gt;It &lt;em&gt;can&lt;/em&gt; be done. You &lt;em&gt;could&lt;/em&gt; maintain the entire routine code from within your source tree, and hats off to all those who do it. Most will not. See later on about deployments for more on this.&lt;!--more--&gt;&lt;/p&gt;
&lt;h4&gt;Testing&lt;/h4&gt;
&lt;p&gt;While engineers are keen on writing unit tests for every class and method they create, they are less keen on doing the same for stored routines. This is an observation, having seen many instalments. And I can tell you why: your stored routine testing will not integrate well with your JUnit/PHPUnit/...&lt;/p&gt;
&lt;p&gt;There are testing frameworks for databases, and indeed I hacked my own mini unit testing code with &lt;em&gt;common_schema&lt;/em&gt;. But it&#39;s a &lt;em&gt;different&lt;/em&gt; testing framework. You might also have realized by now that testing databases is somewhat different. It &lt;em&gt;can&lt;/em&gt; be done, and hats off again to those that implement it as common practice. Many don&#39;t. Database are often more heavyweight to test. Not all operations done by routines are easily rolled back, which leads to having to rebuild the entire dataset before tests. This in itself leads to longer test periods and a need for multiple test databases so as to allow for concurrent builds.&lt;/p&gt;
&lt;p&gt;How many companies practice both version control and unit testing over their routine code? I believe not many (and am happy to hear about those who do). To be more direct, of all the companies I ever consulted to: &lt;em&gt;I have never seen one that does both&lt;/em&gt;.&lt;/p&gt;
&lt;h4&gt;Debugging&lt;/h4&gt;
&lt;p&gt;MySQL stored routines have built in debugging capabilities. To debug your routines, you will have to use one of two methods:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Simulate your routine code (ie mimic their execution on top of some interpreter). There are tools to do that. For me this is a complete NO GO and utterly untrustworthy. You can mimic what you think is how the routine should behave, but never they full behaviour. While developing &lt;em&gt;common_schema&lt;/em&gt; I came upon plenty weird behaviour, some of it bugs, that you just can&#39;t build into your emulation.&lt;/li&gt;
&lt;li&gt;Inject debugging code into your routine code. I do that with &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html&#34;&gt;RDebug&lt;/a&gt;. You can do breakpoints, step into, step out, most of the interesting stuff. Other tools do that as well. It is not the right way to go: you&#39;re essentially modifying your code, placing more locks, communicating, and losing some functionality. It is a necessary evil solution for a necessary evil programming method... How good can that be?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The right way to go would be to have debugging API built into the MySQL server.&lt;/p&gt;
&lt;p&gt;But, wait, that would still be next to worthless, since our discussion is over programming with stored routines: letting your application call upon stored routines in your database. Until the day where I could use my IntelliJ debugger to step from my java method which calls upon a stored procedure, and into the stored procedure itself, debugging your code is completely detached from your stored routine debugging.&lt;/p&gt;
&lt;h4&gt;Refactoring &amp;amp; deploying&lt;/h4&gt;
&lt;p&gt;Say you wanted to add a column to your table: you would go ahead and add it, and perhaps populate it. You would then modify your application code to support this new column, and deploy. Say you wanted to drop a table column. You would first deploy changes to your application code that ignore said column, and once the code is in place you would go and actually make the DROP.&lt;/p&gt;
&lt;p&gt;How do you do the same with a stored routine? Support your routine accepts two parameters, and you wish to add a third?&lt;/p&gt;
&lt;p&gt;There is no support for optional parameters. Your routine either accepts two parameters or three. Your application code will have to provide the exact number of parameters. You will have to deploy &lt;em&gt;both your SQL changes and your application changes at the same time&lt;/em&gt;. This is by definition impossible, unless you are OK with a &lt;em&gt;stop the world approach&lt;/em&gt;, which is unlikely in production.&lt;/p&gt;
&lt;h4&gt;Code constraints&lt;/h4&gt;
&lt;p&gt;One solution to the above is to create a new routines. Somehow &#34;overload&#34; it. But you can&#39;t overload a stored routine; you&#39;ll have to create a routine by a new name. This will allow you to slowly and smoothly migrate between the two.&lt;/p&gt;
&lt;p&gt;Ahem, smoothly? How easy is it to find all invocations of a certain routines from your code? It will be typically lie in some String, or within some XML config file. There is no safe &#34;find references to this procedure&#34; IDE mechanism. There is no constraint in your IDE that will tell you &#34;there is no such procedure&#34; if you misspell the name.&lt;/p&gt;
&lt;h4&gt;Trash bin&lt;/h4&gt;
&lt;p&gt;Suppose you overcame the above. You now have two routines. You need to remember to DROP the old one, right? Will you?&lt;/p&gt;
&lt;p&gt;When presenting &lt;em&gt;common_schema&lt;/em&gt;, a common question I ask the audience is as follows:&lt;/p&gt;
&lt;blockquote&gt;Suppose I accessed your database and listed the entire set of stored functions and procedures. How many of them are you not even sure are in use anymore? How many of them you think you can DROP, but are too afraid to, and keep them in &lt;em&gt;just in case&lt;/em&gt;?&lt;/blockquote&gt;
&lt;p&gt;I wouldn&#39;t commonly ask that question had it not always provides a common nodding and smiling in the audience. People forget to drop their routines, and then forget about them, and are never sure whether they are used (your IDE doesn&#39;t easily tell you that, remember? Sure, you can grep around; that&#39;s not what most engineers would do). And those routines pile up to become trash.&lt;/p&gt;
&lt;h4&gt;Data or code?&lt;/h4&gt;
&lt;p&gt;Last but not least: a stored routine is a piece of code, right? Well, as far as the database is concerned, it&#39;s really a piece of data. It&#39;s located within a schema. It&#39;s &lt;em&gt;stored&lt;/em&gt;. It is an integral part of your data set: when you back up your &lt;em&gt;data&lt;/em&gt;, you&#39;re most likely to backup the &lt;em&gt;code&lt;/em&gt; as well. When you restore, you&#39;re likely to restore &lt;em&gt;both&lt;/em&gt;. There are obvious advantages to that, DB-wise. Or should I say, DBA-wise. Engineering-wise? Does a database-restore operation count as code deployment? We can argue over beer.&lt;/p&gt;
&lt;h4&gt;Final notes&lt;/h4&gt;
&lt;p&gt;Having said all that: yes, I&#39;m using an occasional stored routine. I see these occasions as a necessary evil, and sometimes it&#39;s just the correct solution.&lt;/p&gt;
&lt;p&gt;I&#39;m happy to know what methods have been developed out there to overcome the above, please share; and please feel free to contradict the above.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>On MySQL plugin configuration</title>
      <link>/blog/mysql/on-mysql-plugin-configuration/</link>
      <pubDate>Tue, 01 Oct 2013 08:50:08 +0000</pubDate>
      
      <guid>/blog/mysql/on-mysql-plugin-configuration/</guid>
      <description>&lt;p&gt;MySQL offers &lt;a href=&#34;http://dev.mysql.com/doc/refman/5.5/en/plugin-api.html&#34;&gt;plugin API&lt;/a&gt;, with which you can add &lt;a href=&#34;http://dev.mysql.com/doc/refman/5.5/en/plugin-types.html&#34;&gt;different types&lt;/a&gt; of plugins to the server. The API is roughly the same for all plugin types: you implement an init() function, a deinit(); you declare status variables and global variables associated with your plugin, and of course you implement the particular implementation of plugin call.&lt;/p&gt;
&lt;p&gt;I wish to discuss the creation and use of global variables for plugins.&lt;/p&gt;
&lt;p&gt;Consider the following declaration of a global variable in &lt;a href=&#34;https://github.com/outbrain/audit_login&#34;&gt;audit_login&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;static MYSQL_SYSVAR_BOOL(enabled, plugin_enabled, PLUGIN_VAR_NOCMDARG,
&#34;enable/disable the plugin&#39;s operation, namely writing to file&#34;, NULL, NULL, 1);

static struct st_mysql_sys_var * audit_login_sysvars[] = {
    MYSQL_SYSVAR(enabled),
    NULL
};&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The above creates a new global variables called &lt;strong&gt;&#34;simple_login_audit_enabled&#34;&lt;/strong&gt;: it is composed of the plugin name (known to be &lt;strong&gt;&#34;simple_login_audit&#34;&lt;/strong&gt; in our example) and declared name (&lt;strong&gt;&#34;enabled&#34;&lt;/strong&gt;). It is a boolean, defaults to &lt;strong&gt;1&lt;/strong&gt;, and is associated with the internal &lt;strong&gt;plugin_enabled&lt;/strong&gt; variable.&lt;/p&gt;
&lt;p&gt;Once this variable is declared, you can expect to be able to:&lt;!--more--&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; show global variables like &#39;%audit%&#39;;
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
| simple_login_audit_enabled | ON    |
+----------------------------+-------+

mysql&amp;gt; set global simple_login_audit_enabled := 0;
Query OK, 0 rows affected (0.00 sec)&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;and you can expect using the following in your &lt;strong&gt;my.cnf&lt;/strong&gt; file:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;[mysqld]
...
simple_login_audit_enabled=1&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Assuming your server agrees to start&lt;/h4&gt;
&lt;p&gt;Here&#39;s the catch: the &lt;strong&gt;simple_login_audit_enabled&lt;/strong&gt; variable is &lt;em&gt;only recognized as long as the plugin is installed&lt;/em&gt;. As you may know, plugins can be loaded upon startup time using an explicit &lt;strong&gt;my.cnf&lt;/strong&gt; entry such as:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;plugin_load=audit_login.so&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;But you may also, at any given time, &lt;a href=&#34;http://dev.mysql.com/doc/refman/5.5/en/install-plugin.html&#34;&gt;INSTALL&lt;/a&gt; or &lt;a href=&#34;http://dev.mysql.com/doc/refman/5.5/en/uninstall-plugin.html&#34;&gt;UNINSTALL&lt;/a&gt; the plugin dynamically.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;install plugin SIMPLE_LOGIN_AUDIT soname &#39;audit_login.so&#39;;
uninstall plugin SIMPLE_LOGIN_AUDIT;&lt;code&gt;
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;In fact there are good reasons to do so: you may be upgrading your plugin. You can&#39;t just throw in the new binary (it&#39;s a guaranteed crash on next server shutdown). You need to first &lt;strong&gt;UNINSTALL&lt;/strong&gt; it; you then put the new binary, and re-&lt;strong&gt;INSTALL&lt;/strong&gt;. This works well, and the price is some downtime for your plugin.&lt;/p&gt;
&lt;p&gt;But what happens if you restart the server while your plugin is uninstalled? Yep: the global variable is unrecognised, and your MySQL server refuses to start:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;130919  8:11:30 [ERROR] /usr/bin/mysqld: &lt;strong&gt;unknown variable &#39;simple_login_audit_enabled=1&#39;&lt;/strong&gt;
130919  8:11:30 [ERROR] &lt;strong&gt;Aborting&lt;/strong&gt;
130919  8:11:30  InnoDB: Starting shutdown...
130919  8:11:31  InnoDB: Shutdown completed; log sequence number 40185651
130919  8:11:31 [Note] /usr/bin/mysqld: Shutdown complete&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;I did happen on this case a couple times; it is frustrating.&lt;/p&gt;
&lt;h4&gt;What are the alternatives?&lt;/h4&gt;
&lt;p&gt;So adding variables to my.cnf may prevent MySQL from starting. In my dictionary, this spells &lt;strong&gt;&#34;NO GO&#34;&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;With &lt;strong&gt;audit_login&lt;/strong&gt; I chose to (additionally) support an external config file, &lt;strong&gt;audit_login.cnf&lt;/strong&gt;, expected to be found in the &lt;strong&gt;@@datadir&lt;/strong&gt;. It is similar in essence to the &lt;strong&gt;master.info&lt;/strong&gt; file which is expected by replication. The plugin reads this file (if existing) upon init(), which makes it execute upon server startup or upon &lt;strong&gt;INSTALL PLUGIN&lt;/strong&gt;. I can&#39;t argue that this is the best solution, but it is a solution that does not interfere with anyone. The file is ignored by all and does not disturb the public peace. The plugin does not require it to exist.&lt;/p&gt;
&lt;p&gt;I was hoping to be able to directly read from &lt;strong&gt;my.cnf&lt;/strong&gt;, but am unsure if there is a definitive way to do so from within the plugin. I did not go deep into this.&lt;/p&gt;
&lt;h4&gt;What would be best?&lt;/h4&gt;
&lt;p&gt;Hopefully I&#39;m not missing on anything. But it would be nice to have plugin-dedicated variables in my.cnf which are ignored by the server. These could take the form of:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;[mysql_plugin]
simple_login_audit_enabled=0&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;or similar. It would be the server&#39;s responsibility to pass these declarations to the plugins, but ignore them itself (or just pass warning).&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Introducing audit_login: simple MySQL login logfile based auditing</title>
      <link>/blog/mysql/introducing-audit_login-simple-mysql-login-logfile-based-auditing/</link>
      <pubDate>Tue, 17 Sep 2013 09:24:09 +0000</pubDate>
      
      <guid>/blog/mysql/introducing-audit_login-simple-mysql-login-logfile-based-auditing/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://github.com/outbrain/audit_login&#34;&gt;audit_login&lt;/a&gt; is a simple MySQL login auditing plugin, logging any login or login attempt to log file in JSON format.&lt;/p&gt;
&lt;p&gt;It seems that audit plugins are &lt;a href=&#34;http://serge.frezefond.com/2013/09/news-mariadb-audit-plugin-beta-is-out/&#34;&gt;all the rage&lt;/a&gt; lately... We&#39;ve developed out simple plugin a month ago as part of our database securing efforts; by auditing any login or login attempt we could either intercept or later investigate suspicious logins.&lt;/p&gt;
&lt;p&gt;However we quickly realized there is much more to be gathered by this info.&lt;/p&gt;
&lt;p&gt;In very short, you install this plugin onto your MySQL server, and your server starts writing into a text file called &lt;strong&gt;audit_login.log&lt;/strong&gt; entries such as follows:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;{&#34;ts&#34;:&#34;2013-09-11 09:11:47&#34;,&#34;type&#34;:&#34;successful_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153868&#34;,&#34;user&#34;:&#34;web_user&#34;,&#34;priv_user&#34;:&#34;web_user&#34;,&#34;host&#34;:&#34;web-87.localdomain&#34;,&#34;ip&#34;:&#34;10.0.0.87&#34;}
{&#34;ts&#34;:&#34;2013-09-11 09:11:55&#34;,&#34;type&#34;:&#34;failed_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153869&#34;,&#34;user&#34;:&#34;backup_user&#34;,&#34;priv_user&#34;:&#34;&#34;,&#34;host&#34;:&#34;web-32&#34;,&#34;ip&#34;:&#34;10.0.0.32&#34;}
{&#34;ts&#34;:&#34;2013-09-11 09:11:57&#34;,&#34;type&#34;:&#34;failed_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153870&#34;,&#34;user&#34;:&#34;backup_user&#34;,&#34;priv_user&#34;:&#34;&#34;,&#34;host&#34;:&#34;web-32&#34;,&#34;ip&#34;:&#34;10.0.0.32&#34;}
{&#34;ts&#34;:&#34;2013-09-11 09:12:48&#34;,&#34;type&#34;:&#34;successful_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153871&#34;,&#34;user&#34;:&#34;root&#34;,&#34;priv_user&#34;:&#34;root&#34;,&#34;host&#34;:&#34;localhost&#34;,&#34;ip&#34;:&#34;10.0.0.111&#34;}
{&#34;ts&#34;:&#34;2013-09-11 09:13:26&#34;,&#34;type&#34;:&#34;successful_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153872&#34;,&#34;user&#34;:&#34;web_user&#34;,&#34;priv_user&#34;:&#34;web_user&#34;,&#34;host&#34;:&#34;web-11.localdomain&#34;,&#34;ip&#34;:&#34;10.0.0.11&#34;}
{&#34;ts&#34;:&#34;2013-09-11 09:13:44&#34;,&#34;type&#34;:&#34;successful_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153873&#34;,&#34;user&#34;:&#34;web_user&#34;,&#34;priv_user&#34;:&#34;web_user&#34;,&#34;host&#34;:&#34;web-40.localdomain&#34;,&#34;ip&#34;:&#34;10.0.0.40&#34;}
{&#34;ts&#34;:&#34;2013-09-11 09:13:51&#34;,&#34;type&#34;:&#34;successful_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153874&#34;,&#34;user&#34;:&#34;web_user&#34;,&#34;priv_user&#34;:&#34;web_user&#34;,&#34;host&#34;:&#34;web-03.localdomain&#34;,&#34;ip&#34;:&#34;10.0.0.03&#34;}
{&#34;ts&#34;:&#34;2013-09-11 09:14:09&#34;,&#34;type&#34;:&#34;successful_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153875&#34;,&#34;user&#34;:&#34;web_user&#34;,&#34;priv_user&#34;:&#34;web_user&#34;,&#34;host&#34;:&#34;web-40.localdomain&#34;,&#34;ip&#34;:&#34;10.0.0.40&#34;}
{&#34;ts&#34;:&#34;2013-09-11 10:55:25&#34;,&#34;type&#34;:&#34;successful_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153876&#34;,&#34;user&#34;:&#34;web_user&#34;,&#34;priv_user&#34;:&#34;web_user&#34;,&#34;host&#34;:&#34;web-87.localdomain&#34;,&#34;ip&#34;:&#34;10.0.0.87&#34;}
{&#34;ts&#34;:&#34;2013-09-11 10:55:59&#34;,&#34;type&#34;:&#34;successful_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153877&#34;,&#34;user&#34;:&#34;web_user&#34;,&#34;priv_user&#34;:&#34;web_user&#34;,&#34;host&#34;:&#34;web-12.localdomain&#34;,&#34;ip&#34;:&#34;10.0.0.12&#34;}
{&#34;ts&#34;:&#34;2013-09-11 10:55:59&#34;,&#34;type&#34;:&#34;failed_login&#34;,&#34;myhost&#34;:&#34;gromit03&#34;,&#34;thread&#34;:&#34;74153878&#34;,&#34;user&#34;:&#34;(null)&#34;,&#34;priv_user&#34;:&#34;(null)&#34;,&#34;host&#34;:&#34;(null)&#34;,&#34;ip&#34;:&#34;10.0.0.1&#34;}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;In the above your MySQL server is on &lt;strong&gt;gromit03&lt;/strong&gt;, and is accepting connections from other hosts; some successful, some not. What kind of information can you gather from the above?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You can tell how many connections are being created on your server&lt;/li&gt;
&lt;li&gt;Where they came from&lt;/li&gt;
&lt;li&gt;Where &lt;strong&gt;&#39;root&#39;&lt;/strong&gt; connections come from&lt;/li&gt;
&lt;li&gt;Port scans (see last row) can be identified by no credentials. These don&#39;t have to be port scans &lt;em&gt;per se&lt;/em&gt;; any &lt;strong&gt;telnet localhost 3006&lt;/strong&gt; followed by &lt;strong&gt;Ctrl+D&lt;/strong&gt; will show the same. Typically these would be either load balancer or monitoring tools checks to see that the &lt;strong&gt;3306&lt;/strong&gt; port is active.&lt;/li&gt;
&lt;li&gt;You can tell which accounts connect, and how many times&lt;/li&gt;
&lt;li&gt;And you can infer which accounts are stale and can be dropped -- if an account does not connect within a week&#39;s time, it&#39;s probably stale (pick your own timeframe)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The above is quite interesting on one host; but we have dozens. We&#39;ve installed this plugin on all our MySQL servers, and we use &lt;a href=&#34;http://logstash.net/&#34;&gt;&lt;strong&gt;logstash&lt;/strong&gt;&lt;/a&gt; to aggregate them. We aggregate to two destinations:&lt;!--more--&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;All logs are being sent over to &lt;strong&gt;&lt;a href=&#34;http://kibana.org/&#34;&gt;kibana&lt;/a&gt;&lt;/strong&gt;, where they are easily searchable via &lt;a href=&#34;http://lucene.apache.org/core/&#34;&gt;lucene&lt;/a&gt; queries&lt;/li&gt;
&lt;li&gt;They are also all aggregated into one CSV formatted logfile, rotating daily; this format makes it easier for me to &lt;strong&gt;grep&lt;/strong&gt; and &lt;strong&gt;uniq -c&lt;/strong&gt; and generally produce very valuable data by scripting.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;By aggregating the logs from multiple hosts, we are able to gather such insight as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How well our load balancers are distributing connections&lt;/li&gt;
&lt;li&gt;How our various applications servers connect on our multiple data centres to our MySQL hosts&lt;/li&gt;
&lt;li&gt;Catching misbehaving apps with hardcoded server IPs&lt;/li&gt;
&lt;li&gt;Catching naughty developers logging into our masters directly (we have more mechanisms now to prevent and audit such cases)&lt;/li&gt;
&lt;li&gt;Identifying differences in behaviour of monitoring tools across our data centres&lt;/li&gt;
&lt;li&gt;etc.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Free to use&lt;/h4&gt;
&lt;p&gt;The &lt;strong&gt;audit_login&lt;/strong&gt; plugin has been made free to use, open source, licensed under GNU GPL v2. It is &lt;a href=&#34;https://github.com/outbrain/audit_login&#34;&gt;publicly available in our github repository&lt;/a&gt;, where more documentation on build and installation can be found.&lt;/p&gt;
&lt;p&gt;As MySQL plugins go, you must compile your plugin with your particular MySQL version. For you convenience, pre-compiled binaries are &lt;a href=&#34;https://github.com/outbrain/audit_login/tree/master/lib&#34;&gt;available in the repository&lt;/a&gt; (at this time for &lt;strong&gt;5.5.32&lt;/strong&gt; and &lt;strong&gt;5.5.21&lt;/strong&gt; linux 64 bit; likely to add more)&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>common_schema 2.2: better QueryScript isolation &amp; cleanup; TokuDB; table_rotate, split params</title>
      <link>/blog/mysql/common_schema-2-2-better-queryscript-isolation-tokudb-table_rotate-split-params/</link>
      <pubDate>Tue, 13 Aug 2013 05:39:12 +0000</pubDate>
      
      <guid>/blog/mysql/common_schema-2-2-better-queryscript-isolation-tokudb-table_rotate-split-params/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://code.google.com/p/common-schema/&#34;&gt;&lt;strong&gt;common_schema 2.2&lt;/strong&gt;&lt;/a&gt; is released. This is shortly after the 2.1 release; it was only meant as bug fixes release but some interesting things came up, leading to new functionality.&lt;/p&gt;
&lt;p&gt;Highlights of the &lt;strong&gt;2.2&lt;/strong&gt; release:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Better QueryScript isolation &amp;amp; cleanup: isolation improved across replication topology, cleanup done even on error&lt;/li&gt;
&lt;li&gt;Added &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/tokudb_views.html&#34;&gt;TokuDB related views&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html&#34;&gt;&lt;strong&gt;split&lt;/strong&gt;&lt;/a&gt; with &#34;index&#34; hint (Ike, this is for you)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/table_rotate.html&#34;&gt;&lt;strong&gt;table_rotate()&lt;/strong&gt;&lt;/a&gt;: a &lt;em&gt;logrotate&lt;/em&gt;-like mechanism for tables&lt;/li&gt;
&lt;li&gt;better throw()&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Drill down:&lt;/p&gt;
&lt;h4&gt;Better QueryScript isolation &amp;amp; cleanup&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;common_schema&lt;/em&gt; &lt;strong&gt;2.1&lt;/strong&gt; introduced persistent tables for QueryScript. This also introduced the problem of isolating concurrent scripts, all reading from and writing to shared tables. In &lt;strong&gt;2.1&lt;/strong&gt; isolation was based on session id. However although unique per machine, collisions were possible across replication topology: a script could be issued on master, another on slave (I have such use cases) and both use same (local) session id.&lt;/p&gt;
&lt;p&gt;With 2.2 isolation is based on server_id &amp;amp; session id combination; this is unique across a replication topology.&lt;/p&gt;
&lt;p&gt;Until &lt;strong&gt;2.1&lt;/strong&gt;, QueryScript used temporary tables. This meant any error would just break the script, and the tables were left (isolated as they were, and auto-destroyed in time). With persistent tables a script throwing an error meant legacy code piling up. With &lt;em&gt;common_schema&lt;/em&gt; &lt;strong&gt;2.2&lt;/strong&gt; and on MySQL &amp;gt;= &lt;strong&gt;5.5&lt;/strong&gt; all exceptions are caught, cleanup is made, leaving exceptions to be &lt;strong&gt;RESIGNAL&lt;/strong&gt;led.&lt;/p&gt;
&lt;h4&gt;TokuDB views&lt;/h4&gt;
&lt;p&gt;A couple TokuDB related views help out in converting to TokuDB and in figuring out tables status on disk:&lt;!--more--&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_alter_table_tokudb.html&#34;&gt;&lt;strong&gt;sql_alter_table_tokudb&lt;/strong&gt;&lt;/a&gt; will help you out to generate the complex ALTER statement to TokuDB engine if you happen to used COMPRESSED InnoDB tables with KEY_BLOCK_SIZE specified. The view generates a complex DROP KEYs &amp;amp; ADD KEYs statementl this is due to bug ...&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/tokudb_file_map.html&#34;&gt;&lt;strong&gt;tokudb_file_map&lt;/strong&gt;&lt;/a&gt; simplifies the &lt;strong&gt;INFORMATION_SCHEMA.Tokudb_file_map&lt;/strong&gt; table: the original view is not normalized and is difficult to interpret and follow when your table had many indexes or is partitioned (I will write more on this shortly). with &lt;em&gt;common_schema&lt;/em&gt;&#39;s &lt;strong&gt;tokudb_file_map&lt;/strong&gt; you get, per table, the list of files representing that table, along with a couple Shell commands to tell you &lt;em&gt;the thing you want to know most&lt;/em&gt;: &#34;what is the size of my TokuDB table on disk?&#34;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;split&lt;/h4&gt;
&lt;p&gt;QueryScript&#39;s &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html&#34;&gt;&lt;strong&gt;split&lt;/strong&gt;&lt;/a&gt; device now supports the &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html#parameters&#34;&gt;&#34;&lt;strong&gt;index&lt;/strong&gt;&#34; parameter&lt;/a&gt; (or &lt;em&gt;hint&lt;/em&gt;), which instructs the split() operation to use an explicitly named index. If used, the index must exist and must be UNIQUE.&lt;/p&gt;
&lt;h4&gt;table_rotate()&lt;/h4&gt;
&lt;p&gt;Rotate your tables a-la logrotate with &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/table_rotate.html&#34;&gt;&lt;strong&gt;table_rotate()&lt;/strong&gt;&lt;/a&gt;: generate a new, identical, empty table, version your table, pushing older versions along the line; optionally drop older versions. You get the picture. Got some nice use case behind this on cleaning up a test database.&lt;/p&gt;
&lt;h4&gt;throw()&lt;/h4&gt;
&lt;p&gt;On MySQL &amp;gt;= &lt;strong&gt;5.5&lt;/strong&gt; &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/throw.html&#34;&gt;&lt;strong&gt;throw()&lt;/strong&gt;&lt;/a&gt; uses SIGNAL. No more weird &lt;em&gt;&#34;table `Unknown column &#39;$t&#39; in &#39;field list&#39;` does not exist&#34;&lt;/em&gt; messages. Just plain old:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;ERROR 1054 (42S22): Unknown column &#39;$t&#39; in &#39;field list&#39;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Get it&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;common_schema&lt;/em&gt; is free and open source. It is licensed under GPL v2. This is where you can &lt;a href=&#34;https://code.google.com/p/common-schema/&#34;&gt;find and download latest common_schema release&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Your input is welcome! Please submit your bugs, or otherwise share your experience with &lt;em&gt;common_schema&lt;/em&gt;.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>common_schema roadmap thoughts</title>
      <link>/blog/mysql/common_schema-roadmap-thoughts/</link>
      <pubDate>Mon, 22 Jul 2013 14:36:08 +0000</pubDate>
      
      <guid>/blog/mysql/common_schema-roadmap-thoughts/</guid>
      <description>&lt;p&gt;I&#39;m happy with &lt;strong&gt;&lt;a href=&#34;https://code.google.com/p/common-schema/&#34;&gt;common_schema&lt;/a&gt;&lt;/strong&gt;; it is in fact a tool I use myself on an almost daily basis. I&#39;m also happy to see that it gains traction; which is why I&#39;m exposing a little bit of my thoughts on general future development. I&#39;d love to get feedback.&lt;/p&gt;
&lt;h4&gt;Supported versions&lt;/h4&gt;
&lt;p&gt;At this moment, &lt;em&gt;common_schema&lt;/em&gt; supports MySQL &amp;gt;= &lt;strong&gt;5.1&lt;/strong&gt;, all variants. This includes &lt;strong&gt;5.5&lt;/strong&gt;, &lt;strong&gt;5.6&lt;/strong&gt;, MySQL, Percona Server &amp;amp; MariaDB.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5.1&lt;/strong&gt; is today past end of line, and I&#39;m really missing the &lt;strong&gt;SIGNAL&lt;/strong&gt;/&lt;strong&gt;RESIGNAL&lt;/strong&gt; syntax that I would like to use; I can do in the meanwhile with version-specific code such as &lt;strong&gt;/*!50500 ... */&lt;/strong&gt;. Nevertheless, I&#39;m wondering whether I will eventually have to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Support different branches of &lt;em&gt;common_schema&lt;/em&gt; (one that supports &lt;strong&gt;5.1&lt;/strong&gt;, one that supports &amp;gt;= &lt;strong&gt;5.5&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;Stop support for &lt;strong&gt;5.1&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Of course community-wise, the former is preferred; but I have limited resources, so I would like to make a quick poll here:&lt;/p&gt;
&lt;p&gt;[poll id=&#34;3&#34;]&lt;/p&gt;
&lt;p&gt;I&#39;ll use the poll&#39;s results as a &lt;em&gt;vague idea of what people use and want&lt;/em&gt;. Or please use comments below to sound your voice!&lt;/p&gt;
&lt;h4&gt;rdebug&lt;/h4&gt;
&lt;p&gt;This was a crazy jump at providing a &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html&#34;&gt;stored routine debugger and debugging API&lt;/a&gt;. From some talk I made I don&#39;t see this getting traction. For the time being, I don&#39;t see that I will concentrate my efforts on this. Actually it is almost complete. You can step-into, step-out, step-over, set breakpoints, read variables, modify variables -- it&#39;s pretty cool.&lt;!--more--&gt;&lt;/p&gt;
&lt;p&gt;But someone will eventually have to write a GUI front-end for this (eclipse/IntelliJ/whatever); I know not many will use a command line approach for a debugger. I also know I&#39;m not going to write the GUI front-end. So the API is there, let&#39;s see how it rolls.&lt;/p&gt;
&lt;h4&gt;QueryScript&lt;/h4&gt;
&lt;p&gt;I will keep on improving &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html&#34;&gt;&lt;strong&gt;QueryScript&lt;/strong&gt;&lt;/a&gt;, and in particular split, error handling, and otherwise simplification of common tasks. I have no doubt QueryScript goes the right way: I just see how easy it is to solve complex problems with a QueryScript one-liner. Other bullets on my TODO for QueryScript:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Script tracking (a semi-debugging mechanism, which allows one to recognize status of script)&lt;/li&gt;
&lt;li&gt;Message passing to scripts (again, a semi-debugger approach)&lt;/li&gt;
&lt;li&gt;Error recovery; ability to resume script from point of failure or point of suspension. I have plenty use cases for that.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;performance_schema&lt;/h4&gt;
&lt;p&gt;I will most probably include parts of Mark Leith&#39;s &lt;a href=&#34;http://www.markleith.co.uk/ps_helper/&#34;&gt;&lt;strong&gt;ps_helper&lt;/strong&gt;&lt;/a&gt;, which is released under &lt;a href=&#34;http://www.wtfpl.net/&#34;&gt;a permissive license&lt;/a&gt;, and otherwise draw ideas from his work. I&#39;m happy to learn parts of &lt;em&gt;ps_helper&lt;/em&gt; were influenced by &lt;em&gt;common_schema&lt;/em&gt; itself.&lt;/p&gt;
&lt;h4&gt;Hosting&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;common_schema&lt;/em&gt; will most probably move out of Google Code; by Jan 2014 there will no longer be a &#34;Downloads&#34; section, and I really, &lt;em&gt;really&lt;/em&gt;, want there to be a &lt;em&gt;&#34;Downloads&#34;&lt;/em&gt; section.&lt;/p&gt;
&lt;p&gt;I could go LaunchPad, GitHub, BitBucket (they don&#39;t have &lt;em&gt;&#34;Downloads&#34;&lt;/em&gt; sections, either, do they?), other; any advice?&lt;/p&gt;
&lt;h4&gt;World domination&lt;/h4&gt;
&lt;p&gt;Yep. This is still &lt;em&gt;common_schema&lt;/em&gt;&#39;s goal. More seriously, I would want to see it installed on every single MySQL server instance. Then I would control your fate. bwahahaha!&lt;/p&gt;
&lt;p&gt;Even more seriously, if you are a happy user, please do pass the word. I can only blog so much and present so much; there are no financing resources for this project, and I need all the help I can get in promoting &lt;em&gt;common_schema&lt;/em&gt;. Thank you!&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>common_schema 2.1 released: advanced &amp; improved split(), persistent script tables, more schema analysis, and (ahem) charts!</title>
      <link>/blog/mysql/common_schema-2-1-released-advanced-improved-split-persistent-script-tables-more-schema-analysis-and-ahem-charts/</link>
      <pubDate>Wed, 17 Jul 2013 20:57:06 +0000</pubDate>
      
      <guid>/blog/mysql/common_schema-2-1-released-advanced-improved-split-persistent-script-tables-more-schema-analysis-and-ahem-charts/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://code.google.com/p/common-schema/&#34;&gt;&lt;strong&gt;common_schema 2.1&lt;/strong&gt;&lt;/a&gt; is released! &lt;em&gt;common_schema&lt;/em&gt; is your free &amp;amp; open source companion schema within your MySQL server, providing with a function library, scripting capabilities, powerful routines and ready-to-apply information and recommendations.&lt;/p&gt;
&lt;p&gt;New and noteworthy in version &lt;strong&gt;2.1&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Better &lt;em&gt;QueryScript&#39;&lt;/em&gt;s &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html&#34;&gt;&lt;strong&gt;split()&lt;/strong&gt;&lt;/a&gt; functionality&lt;/li&gt;
&lt;li&gt;Persistent tables for QueryScript: no long held temporary tables&lt;/li&gt;
&lt;li&gt;Index creation analysis, further range partition analysis&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/grant_access.html&#34;&gt;&lt;strong&gt;grant_access()&lt;/strong&gt;&lt;/a&gt;: allow everyone to use &lt;em&gt;common_schema&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;Ascii charts, google charts&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;debugged_routines&lt;/strong&gt;: show routines with debug code&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Other minor enhancements and bugfixes not listed.&lt;/p&gt;
&lt;p&gt;Here&#39;s a breakdown of the above:&lt;/p&gt;
&lt;h4&gt;split() enhancements&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html&#34;&gt;split&lt;/a&gt;&lt;/strong&gt; is one of those parts of &lt;em&gt;common_schema&lt;/em&gt; that (should) appeal to every DBA. Break a huge transaction automagically into smaller chunks, and don&#39;t worry about how it&#39;s done. If you like, throttle execution, or print progress, or...&lt;/p&gt;
&lt;p&gt;&lt;em&gt;split&lt;/em&gt; enhancements include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A much better auto-detection-and-selection of the chunking index. &lt;em&gt;split&lt;/em&gt; now consults all columns covered by the index, and uses realistic heuristics to decide which &lt;strong&gt;UNIQUE KEY&lt;/strong&gt; on your table is best for the chunking process. A couple bugs are solved on the way; &lt;em&gt;split&lt;/em&gt; is much smarter now.&lt;/li&gt;
&lt;li&gt;Better support for multi-column chunking keys. You may now utilize the &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html#parameters&#34;&gt;&lt;strong&gt;start&lt;/strong&gt;/&lt;strong&gt;stop&lt;/strong&gt; parameters&lt;/a&gt; even on multi column keys, passing a comma delimited of values for the &lt;em&gt;split&lt;/em&gt; operation to start/end with, respectively. Also fixed issue for nonexistent &lt;strong&gt;start/stop&lt;/strong&gt; values, which are now valid: &lt;em&gt;split&lt;/em&gt; will just keep to the given range.&lt;/li&gt;
&lt;li&gt;split no longer requires a temporary table open through the duration of its operation. See next section.&lt;!--more--&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Persistent script tables&lt;/h4&gt;
&lt;p&gt;QueryScript used to use several temporary tables for its operation. Thus, a script could hold open two or three temporary tables for the entire execution duration. For long &lt;em&gt;split&lt;/em&gt; operations, for example, this could mean hours and days.&lt;/p&gt;
&lt;p&gt;Temporary tables are nice and quick to respond (well, MyISAM tables are, until MySQL &lt;strong&gt;5.7&lt;/strong&gt; is out), but make for an inherent problem: stopped slaves must not shut down nor restart when replication has an open temporary table. Why? Well, because the slave forgets about the temporary tables. When it resumes operation, it will not recognize DML issued against those tables it has forgotten. That&#39;s why &lt;a href=&#34;http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-prepare-shutdown.html&#34;&gt;oak-prepare-shutdown&lt;/a&gt; is so good for slaves.&lt;/p&gt;
&lt;p&gt;When temporary tables are short-lived, this is typically not an issue. But if you are not allowed to restart your slave throughout a 24 hour operation, that&#39;s a limitation.&lt;/p&gt;
&lt;p&gt;As of &lt;strong&gt;2.1&lt;/strong&gt;, QueryScript does not require long held temporary tables. In fact, typical scripts do not create &lt;em&gt;any&lt;/em&gt; temporary tables. A &lt;em&gt;split&lt;/em&gt; operation creates and immediately drops a series of temporary tables. These are dropped even before actual &lt;em&gt;split&lt;/em&gt; operation begins. All tables operated on are persistent &lt;strong&gt;InnoDB&lt;/strong&gt; tables.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Result&lt;/em&gt;: safer script replication. There&#39;s another nice side effect I may take advantage of in a later release: ability to monitor and control flow of concurrent scripts.&lt;/p&gt;
&lt;h4&gt;Schema analysis&lt;/h4&gt;
&lt;p&gt;Two noteworthy additions to schema analysis views:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_alter_table.html&#34;&gt;&lt;strong&gt;sql_alter_table&lt;/strong&gt;&lt;/a&gt; now includes the &lt;strong&gt;sql_drop_keys&lt;/strong&gt; &amp;amp; &lt;strong&gt;sql_add_keys&lt;/strong&gt; columns. For each table, you get the SQL statements to create and drop the existing indexes. I developed this when I hit &lt;a href=&#34;https://groups.google.com/d/msg/tokudb-user/hLlHwlp2AL0/nvNlUCzhxAwJ&#34;&gt;this problem&lt;/a&gt; with TokuDB.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_range_partitions.html&#34;&gt;&lt;strong&gt;sql_range_partitions&lt;/strong&gt;&lt;/a&gt; now includes the &lt;strong&gt;count_past_partitions&lt;/strong&gt; &amp;amp; &lt;strong&gt;count_future_partitions&lt;/strong&gt;; when your table is partitioned by some type of time range, these views tell you how many partitions are in the past, and how many are to be written to in the future. This turns useful when you want to rotate or otherwise set a retention policy for your range partitions.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;grant_access()&lt;/h4&gt;
&lt;p&gt;The &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/grant_access.html&#34;&gt;&lt;strong&gt;grant_access()&lt;/strong&gt;&lt;/a&gt; routine &lt;strong&gt;GRANT&lt;/strong&gt;s all accounts on your server with &lt;strong&gt;SELECT&lt;/strong&gt; &amp;amp; &lt;strong&gt;EXECUTE&lt;/strong&gt; privileges on &lt;em&gt;common_schema&lt;/em&gt;. This is a quick complementary to the installation process (though you have to invoke it yourself; it&#39;s up to you).&lt;/p&gt;
&lt;h4&gt;Ascii/google line charts&lt;/h4&gt;
&lt;p&gt;Laugh all you want! And find how cool it is to get (poor man&#39;s) instant charting like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; call &lt;strong&gt;line_chart&lt;/strong&gt;(&#39;select ts, com_insert_psec, com_update_psec from mycheckpoint.sv_hour limit 100&#39;, &#39;insert per second, update per second&#39;) ;
+---------+------------------------------------------------------------------------------------------------------+
| y_scale | chart                                                                                                |
+---------+------------------------------------------------------------------------------------------------------+
| 162     | -#-------------------------------------------------------------------------------------------------- |
| 152     | ---------------------------------------------------------------------------------------------------- |
| 143     | ---------------------------------------------------------------------------------------------------- |
| 134     | ---------------------------------------------------------------------------------------------------- |
| 124     | ---------------------------------------------------------------------------------------------------- |
| 115     | ------------------------------------------------------------#--------------------------------------- |
| 106     | ---------------------------------------------------------------------------------------------------- |
| 96      | -*-------------------------------------------------------------------------------------------------- |
| 87      | ---------------------------------#-------------------------#---------------------------------------- |
| 77      | ---------------------------------------------------------------------------------#------------------ |
| 68      | ---------------------------------------------------------------------------#------------------------ |
| 59      | #-------------------------------#------------------------------------------------------------------- |
| 49      | ---##------#-#-##-#-#--#--###----------------##---------------------------------#-----#---###------- |
| 40      | --#------#--#-#--#-#-##-##----##--###########--######--------#############-*#-##--####-###---####### |
| 31      | *-**--#-#-*-**-**------**--**#-****-**-*****-*******-#---#-*------------**---#--*------------------- |
| 21      | ----*#*#*--*--*--******--**--**----*--*-----*-------**#*#**-************--#-****-******************* |
| 12      | -----*-*-*--------------------------------------------*-*-----------------*------------------------- |
|         | v::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 2010-10-06 20:00:00                                                              2010-10-10 23:00:00 |
|         |     # insert per second                                                                              |
|         |     * update per second                                                                              |
+---------+------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;You can get the same in &lt;a href=&#34;https://developers.google.com/chart/image/&#34;&gt;Google Image Charts&lt;/a&gt; format. Yes, it&#39;s deprecated (and has been for a year -- it&#39;s still working)&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; call &lt;strong&gt;google_line_chart&lt;/strong&gt;(&#39;select ts, com_insert_psec, com_update_psec from mycheckpoint.sv_hour limit 100&#39;, &#39;insert per second, update per second&#39;) \G

google_chart_url: &lt;a href=&#34;http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=800x350&amp;amp;chtt=SQL+chart+by+common_schema&amp;amp;chxt=x,y&amp;amp;chxr=1,11.9,161.7&amp;amp;chd=s:S9NOOGKFGKHQMONPONONNKNONNOOQINMRgLLNMMNNNNNNOONMNNNMHEFFJFfsLLMMMLLMNMMNNDVNIMKPaKLLMOMNNNONNNMMMMM,IiGGFCDBCBGFGGGGGFGGFEFGGGGGHDGGJGGGGGFGGGGGGGGGGGGGFCBCCCEHGGGFFFFFGGGFGGAKFDFFIFFFFFFFFFFFFFFFFFFF&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chxl=0:|2010-10-06%2020:00:00||||||||||||||||||||||||2010-10-07%2020:00:00|||||||||||||||||||||||||2010-10-08%2021:00:00|||||||||||||||||||||||||2010-10-09%2022:00:00|||||||||||||||||||||||||2010-10-10%2023:00:00&amp;amp;chg=1.010101010,25,1,2,0,0&amp;amp;chco=ff8c00,4682b4&amp;amp;chdl=insert%20per%20second|update%20per%20second&amp;amp;chdlp=b&#34;&gt;http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=800x350&amp;amp;chtt=SQL+chart+by+common_schema&amp;amp;chxt=x,y&amp;amp;chxr=1,11.9,161.7&amp;amp;chd=s:S9NOOGKFGKHQMONPONONNKNONNOOQINMRgLLNMMNNNNNNOONMNNNMHEFFJFfsLLMMMLLMNMMNNDVNIMKPaKLLMOMNNNONNNMMMMM,IiGGFCDBCBGFGGGGGFGGFEFGGGGGHDGGJGGGGGFGGGGGGGGGGGGGFCBCCCEHGGGFFFFFGGGFGGAKFDFFIFFFFFFFFFFFFFFFFFFF&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chxl=0:|2010-10-06%2020:00:00||||||||||||||||||||||||2010-10-07%2020:00:00|||||||||||||||||||||||||2010-10-08%2021:00:00|||||||||||||||||||||||||2010-10-09%2022:00:00|||||||||||||||||||||||||2010-10-10%2023:00:00&amp;amp;chg=1.010101010,25,1,2,0,0&amp;amp;chco=ff8c00,4682b4&amp;amp;chdl=insert%20per%20second|update%20per%20second&amp;amp;chdlp=b&lt;/a&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The above translates into the following image:&lt;/p&gt;
&lt;blockquote&gt;&lt;a href=&#34;http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=800x350&amp;amp;chtt=SQL+chart+by+common_schema&amp;amp;chxt=x,y&amp;amp;chxr=1,11.9,161.7&amp;amp;chd=s:S9NOOGKFGKHQMONPONONNKNONNOOQINMRgLLNMMNNNNNNOONMNNNMHEFFJFfsLLMMMLLMNMMNNDVNIMKPaKLLMOMNNNONNNMMMMM,IiGGFCDBCBGFGGGGGFGGFEFGGGGGHDGGJGGGGGFGGGGGGGGGGGGGFCBCCCEHGGGFFFFFGGGFGGAKFDFFIFFFFFFFFFFFFFFFFFFF&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chxl=0:|2010-10-06 20:00:00||||||||||||||||||||||||2010-10-07 20:00:00|||||||||||||||||||||||||2010-10-08 21:00:00|||||||||||||||||||||||||2010-10-09 22:00:00|||||||||||||||||||||||||2010-10-10 23:00:00&amp;amp;chg=1.010101010,25,1,2,0,0&amp;amp;chco=ff8c00,4682b4&amp;amp;chdl=insert per second|update per second&amp;amp;chdlp=b&#34;&gt;&lt;img class=&#34;aligncenter&#34; alt=&#34;&#34; src=&#34;/blog/blog/assets/chart?cht=lc&amp;amp;chs=800x350&amp;amp;chtt=SQL+chart+by+common_schema&amp;amp;chxt=x,y&amp;amp;chxr=1,11.9,161.7&amp;amp;chd=s:S9NOOGKFGKHQMONPONONNKNONNOOQINMRgLLNMMNNNNNNOONMNNNMHEFFJFfsLLMMMLLMNMMNNDVNIMKPaKLLMOMNNNONNNMMMMM,IiGGFCDBCBGFGGGGGFGGFEFGGGGGHDGGJGGGGGFGGGGGGGGGGGGGFCBCCCEHGGGFFFFFGGGFGGAKFDFFIFFFFFFFFFFFFFFFFFFF&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chxl=0:|2010-10-06 20:00:00||||||||||||||||||||||||2010-10-07 20:00:00|||||||||||||||||||||||||2010-10-08 21:00:00|||||||||||||||||||||||||2010-10-09 22:00:00|||||||||||||||||||||||||2010-10-10 23:00:00&amp;amp;chg=1.010101010,25,1,2,0,0&amp;amp;chco=ff8c00,4682b4&amp;amp;chdl=insert per second|update per second&amp;amp;chdlp=b&#34; width=&#34;800&#34; height=&#34;350&#34; /&gt;&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;Throw you own query in. Make &lt;strong&gt;1st&lt;/strong&gt; column your ordering column, &lt;strong&gt;2nd&lt;/strong&gt; [, &lt;strong&gt;3rd&lt;/strong&gt;...] value columns. Provide your own legend. Watch it instantly. And laugh all you want.&lt;/p&gt;
&lt;p&gt;Read more about &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/charting_routines.html&#34;&gt;common_schema&#39;s charting routines&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;debugged_routines&lt;/h4&gt;
&lt;p&gt;The new &lt;strong&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/debugged_routines.html&#34;&gt;debugged_routines&lt;/a&gt;&lt;/strong&gt; view shows you which routines are currently &#34;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug_compile_routine.html&#34;&gt;compiled with debug mode&lt;/a&gt;&#34;.&lt;/p&gt;
&lt;p&gt;I will write more on the state of &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html&#34;&gt;&lt;strong&gt;rdebug&lt;/strong&gt;&lt;/a&gt; in a future post.&lt;/p&gt;
&lt;h4&gt;Try it, get it&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;common_schema&lt;/em&gt; &lt;strong&gt;2.1&lt;/strong&gt; comes with over &lt;strong&gt;500&lt;/strong&gt; tests and fast growing.&lt;/li&gt;
&lt;li&gt;It supports MySQL &lt;strong&gt;5.1&lt;/strong&gt;, &lt;strong&gt;5.5&lt;/strong&gt;, &lt;strong&gt;5.6&lt;/strong&gt;, Percona Server and MariaDB.&lt;/li&gt;
&lt;li&gt;It has superb documentation (may I say so?) with a lot of examples &amp;amp; drill down into edge cases.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You are &lt;strong&gt;&lt;a href=&#34;https://code.google.com/p/common-schema/&#34;&gt;free to download&lt;/a&gt;&lt;/strong&gt; and use it.&lt;/p&gt;
&lt;p&gt;Your feedback is welcome! Indeed, many of this version&#39;s improvements originated with community feedback.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>mycheckpoint revision 231 released</title>
      <link>/blog/mysql/mycheckpoint-revision-released/</link>
      <pubDate>Thu, 23 May 2013 14:21:52 +0000</pubDate>
      
      <guid>/blog/mysql/mycheckpoint-revision-released/</guid>
      <description>&lt;p&gt;A &lt;a href=&#34;http://code.google.com/p/mycheckpoint/&#34;&gt;new release&lt;/a&gt; for &lt;strong&gt;&lt;a href=&#34;http://code.openark.org/forge/mycheckpoint&#34;&gt;mycheckpoint&lt;/a&gt;&lt;/strong&gt;: lightweight, SQL oriented MySQL monitoring solution.&lt;/p&gt;
&lt;p&gt;If you&#39;re unfamiliar with &lt;em&gt;mycheckpoint&lt;/em&gt;, well, the one minute sales pitch is: it&#39;s a free and open source monitoring tool for MySQL, which is extremely easy to install and execute, and which includes &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint/documentation/custom-monitoring&#34;&gt;custom queries&lt;/a&gt;, &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint/documentation/alerts&#34;&gt;alerts&lt;/a&gt; (via &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint/documentation/emails&#34;&gt;emails&lt;/a&gt;), and out of the box &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint/documentation/http-web-server&#34;&gt;HTTP server&lt;/a&gt; and &lt;a href=&#34;http://mycheckpoint.googlecode.com/svn/trunk/doc/html/sample/http/mcp_sql00/sv_report_html_brief&#34;&gt;charting&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This is mostly a maintenance release, with some long-time requested features, and of course solved bugs. Here are a few highlights:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Supports MariaDB and MySQL 5.6 (issues with new variables, space padded variables, text-valued variables)&lt;/li&gt;
&lt;li&gt;Supports alerts via function invocation on monitored host (so not only checking alerts via aggregated data like &lt;strong&gt;&#39;Seconds_behind_master&#39;&lt;/strong&gt; but also by &lt;strong&gt;SELECT my_sanity_check_function()&lt;/strong&gt; on monitored instance). See &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint/documentation/alerts&#34;&gt;alerts.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Supports single-running-instance via &lt;strong&gt;&#34;--single&#34;&lt;/strong&gt; command line argument&lt;/li&gt;
&lt;li&gt;Supports strict &lt;strong&gt;sql_mode&lt;/strong&gt;, including &lt;strong&gt;ONLY_FULL_GROUP_BY&lt;/strong&gt;, overcoming &lt;a href=&#34;http://bugs.mysql.com/bug.php?id=69310&#34;&gt;bug #69310&lt;/a&gt;.&lt;strong&gt;&lt;br /&gt;
&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Supports sending of pending email HTML report&lt;/li&gt;
&lt;li&gt;Better re-deployment process&lt;/li&gt;
&lt;li&gt;Better recognizing of SIGNED/UNSIGNED values&lt;/li&gt;
&lt;li&gt;Some other improvements in charting, etc.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;mycheckpoint&lt;/em&gt; is released under the BSD license.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://code.google.com/p/mycheckpoint/&#34;&gt;Downloads are available&lt;/a&gt; from the project&#39;s page.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>opeark-kit revision 196 released</title>
      <link>/blog/mysql/opeark-kit-revision-196-released/</link>
      <pubDate>Tue, 07 May 2013 07:47:22 +0000</pubDate>
      
      <guid>/blog/mysql/opeark-kit-revision-196-released/</guid>
      <description>&lt;p&gt;This is a long due maintenance release of &lt;a href=&#34;http://code.google.com/p/openarkkit/&#34;&gt;&lt;strong&gt;openark-kit&lt;/strong&gt;.&lt;/a&gt; This release includes bugfixes and some enhancements, mainly to &lt;a href=&#34;http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-online-alter-table.html&#34;&gt;oak-online-alter-table&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;oak-online-alter-table&lt;/em&gt; Changes / bug fixes include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Support for keyword-named columns&lt;/li&gt;
&lt;li&gt;Use of FORCE INDEX due to lack of MySQL&#39;s ability for figure out the chunking key at all times&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;--sleep-ratio&lt;/strong&gt; option added; allows for sleep time proportional to execution time (as opposed to constant sleep time with &lt;strong&gt;--sleep&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;Support for chunk-retry (in case of deadlock) via &lt;strong&gt;--max-lock-retries&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;Fixed order of cleanup&lt;/li&gt;
&lt;li&gt;Fixed bug with verbose messages with non-integer chunking key&lt;/li&gt;
&lt;li&gt;Fixed bug with single-row tables (people, no need for this tool for single row tables :))&lt;/li&gt;
&lt;li&gt;Friendly verbose messages to remind you what&#39;s being executed&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;oak-chunk-update&lt;/em&gt; changes includes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Verbosing query comment if exists (friendly printing of what&#39;s being executed)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;!--more--&gt;(Do check out &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html&#34;&gt;QueryScript&#39;s split()&lt;/a&gt;; it&#39;s a simple, server side solution which works almost same way as &lt;em&gt;oak-chunk-update&lt;/em&gt;)&lt;/p&gt;
&lt;p&gt;More issues and changes not listed here.&lt;/p&gt;
&lt;h4&gt;Download&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;openark-kit&lt;/em&gt; is released under the new BSD license, and is freely available.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://code.google.com/p/openarkkit/&#34;&gt;Download latest openark-kit revision (#196)&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Browse &lt;a href=&#34;http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/introduction.html&#34;&gt;openark-kit documentation&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>common_schema 2.0.0-alpha: rdebug, GPL</title>
      <link>/blog/mysql/common_schema-2-0-0-alpha-rdebug-gpl/</link>
      <pubDate>Tue, 09 Apr 2013 08:03:06 +0000</pubDate>
      
      <guid>/blog/mysql/common_schema-2-0-0-alpha-rdebug-gpl/</guid>
      <description>&lt;p&gt;A new release for &lt;a href=&#34;https://code.google.com/p/common-schema/&#34;&gt;common_schema&lt;/a&gt;: an alpha version of &lt;strong&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html&#34;&gt;rdebug&lt;/a&gt;: MySQL Debugger and Debugging API&lt;/strong&gt; is now included with &lt;em&gt;common_schema&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;With a different license in mind for &lt;em&gt;rdebug&lt;/em&gt;, &lt;em&gt;common_schema&lt;/em&gt; changes license to GPL (2 or above).&lt;/p&gt;
&lt;p&gt;&lt;em&gt;common_schema 2.0&lt;/em&gt; is ready for &lt;a href=&#34;http://code.google.com/p/common-schema/downloads/list&#34;&gt;download&lt;/a&gt;. All things &lt;strong&gt;rdebug&lt;/strong&gt;, it is alpha -- otherwise it&#39;s a stable release.&lt;/p&gt;
&lt;h4&gt;rdebug&lt;/h4&gt;
&lt;p&gt;I&#39;m very happy to release this alpha version of &lt;em&gt;rdebug&lt;/em&gt;, and urge everyone to try it out.&lt;/p&gt;
&lt;p&gt;The idea is to have an open, free, server side debugger and debugging API for MySQL stored routines. To elaborate:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It&#39;s server side by that it&#39;s implemented by stored routines. Not by a connector; not an emulator; not a GUI tool hack. The entire functionality lies within common_schema, a schema in your server.&lt;/li&gt;
&lt;li&gt;It&#39;s a debugger: you can debug your own stored routines (with limitations)&lt;/li&gt;
&lt;li&gt;It&#39;s a &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug_api.html&#34;&gt;&lt;strong&gt;debugging API&lt;/strong&gt;&lt;/a&gt;: there&#39;s a distinct specification and a set of calls which makes for a debugging process&lt;/li&gt;
&lt;li&gt;It&#39;s open since the source code is yours to browse.&lt;/li&gt;
&lt;li&gt;It&#39;s free as in free beer.&lt;/li&gt;
&lt;li&gt;It&#39;s free as it makes you independent of a specific debugger. It provides an API that anyone can use. You can run the API yourself from the command line; or plugins for your favorite GUI editor can be developed to use this API.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;On a separate blog post I will take you to a &lt;em&gt;rdebug&lt;/em&gt; test drive.&lt;/p&gt;
&lt;p&gt;As always, nothing is released before extensive &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html&#34;&gt;documentation&lt;/a&gt; is in place.&lt;/p&gt;
&lt;p&gt;I&#39;d love to get input on this.&lt;!--more--&gt;&lt;/p&gt;
&lt;h4&gt;GPL&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;common_schema&lt;/em&gt; &amp;lt; &lt;strong&gt;2.0&lt;/strong&gt; was released under the BSD license, which is less restrictive. I was pondering the BSD license for a couple years now, and with the arrival of &lt;em&gt;rdebug&lt;/em&gt; have decided to switch to GPL. I&#39;ve been through this thinking of change of license in other projects of mine; am generally agreeing that best not to change licensing throughout lifetime. I actually do see GPL as promoting open source software better than BSD, and with all the issues around GPL this actually means something to me. I write open source; I love people using it; I love people extending it; I want to be re-released as open source, or I want better control of the code.&lt;/p&gt;
&lt;p&gt;So this turns out to be something that is important to me, and just before &lt;em&gt;common_schema&lt;/em&gt; takes the world in storm (&lt;strong&gt;212&lt;/strong&gt; downloads today, &lt;strong&gt;212,000,000&lt;/strong&gt; tomorrow), I want to have this settled. If no storm comes, well, I&#39;ll have up to &lt;strong&gt;212&lt;/strong&gt; people banging on my door (I provide free coffee).&lt;/p&gt;
&lt;h4&gt;Text routines&lt;/h4&gt;
&lt;p&gt;Two text routines are added:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/replace_sections.html&#34;&gt;&lt;strong&gt;replace_sections()&lt;/strong&gt;&lt;/a&gt;: replace a text given a from-to combination, and a replacement string, which could include a back-reference. For example:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; select replace_sections(&lt;strong&gt;&#39;The &lt;span style=&#34;color: #000080;&#34;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;quick&lt;span style=&#34;color: #000080;&#34;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; brown &lt;span style=&#34;color: #000080;&#34;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;fox&lt;span style=&#34;color: #000080;&#34;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt;&#39;&lt;/strong&gt;, 
        &lt;strong&gt;&#39;&lt;span style=&#34;color: #000080;&#34;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;&#39;&lt;/strong&gt;, &lt;span style=&#34;color: #000080;&#34;&gt;&lt;strong&gt;&#39;&amp;lt;/b&amp;gt;&#39;&lt;/strong&gt;&lt;/span&gt;, 
        &lt;strong&gt;&lt;span style=&#34;color: #800000;&#34;&gt;&#39;&amp;lt;span&amp;gt;\0&amp;lt;/span&amp;gt;&#39;&lt;/span&gt;&lt;/strong&gt;) as result;
+-----------------------------------------------+
| result                                        |
+-----------------------------------------------+
| The &lt;span style=&#34;color: #800000;&#34;&gt;&amp;lt;span&amp;gt;quick&amp;lt;/span&amp;gt;&lt;/span&gt; brown &lt;span style=&#34;color: #800000;&#34;&gt;&amp;lt;span&amp;gt;fox&amp;lt;/span&amp;gt;&lt;/span&gt; |
+-----------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/hexcode_text.html&#34;&gt;&lt;strong&gt;hexcode_text()&lt;/strong&gt;&lt;/a&gt;: a convenience routine which shows a beautified hex-code of a given text. I get to need it when using UNICODE characters which are hard to detect, are visually identical to other characters, or are copied from MS Word.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; &lt;strong&gt;call hexcode_text(&#39;the quick brown fox jumps over the lazy dog&#39;);&lt;/strong&gt;
+-----------------------------------------------------------------------------------+
| &amp;gt;0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f   0 1 2 3 4 5 6 7 8 9 a b c d e f |
+-----------------------------------------------------------------------------------+
| 74 68 65 20 71 75 69 63 6B 20 62 72 6F 77 6E 20   t h e   q u i c k   b r o w n   |
| 66 6F 78 20 6A 75 6D 70 73 20 6F 76 65 72 20 74   f o x   j u m p s   o v e r   t |
| 68 65 20 6C 61 7A 79 20 64 6F 67                  h e   l a z y   d o g           |
+-----------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Get it&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://code.google.com/p/common-schema/&#34;&gt;Download &lt;em&gt;common_schema&lt;/em&gt; here&lt;/a&gt;.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>common_schema: 1.3: security goodies, parameterized split(), json-to-xml, query checksum</title>
      <link>/blog/mysql/common_schema-1-3-security-goodies-parameterized-split-json-to-xml-query-checksum/</link>
      <pubDate>Mon, 14 Jan 2013 08:25:07 +0000</pubDate>
      
      <guid>/blog/mysql/common_schema-1-3-security-goodies-parameterized-split-json-to-xml-query-checksum/</guid>
      <description>&lt;p&gt;common_schema &lt;strong&gt;1.3&lt;/strong&gt; is released and is &lt;a href=&#34;http://code.google.com/p/common-schema&#34;&gt;available for download&lt;/a&gt;. New and noteworthy in this version:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Parameterized &lt;strong&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html&#34;&gt;split()&lt;/a&gt;&lt;/strong&gt;: take further control over huge transactions by breaking them down into smaller chunks, now manually tunable if needed&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/duplicate_grantee.html&#34;&gt;&lt;strong&gt;duplicate_grantee()&lt;/strong&gt;&lt;/a&gt;: copy+paste existing accounts along with their full set of privileges&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/similar_grants.html&#34;&gt;&lt;strong&gt;similar_grants&lt;/strong&gt;&lt;/a&gt;: find which accounts share the exact same set of privileges (i.e. have the same &lt;em&gt;role&lt;/em&gt;)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/json_to_xml.html&#34;&gt;&lt;strong&gt;json_to_xml()&lt;/strong&gt;&lt;/a&gt;: translate any valid JSON object into its equivalent XML form&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/extract_json_value.html&#34;&gt;&lt;strong&gt;extract_json_value()&lt;/strong&gt;&lt;/a&gt;: use XPath notation to extract info from JSON data, just as you would from XML&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_checksum.html&#34;&gt;&lt;strong&gt;query_checksum()&lt;/strong&gt;&lt;/a&gt;: given a query, calculate a checksum on the result set&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/random_hash.html&#34;&gt;&lt;strong&gt;random_hash()&lt;/strong&gt;&lt;/a&gt;: get a 40 hexadecimal digits random hash, using a reasonably large changing input&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let&#39;s take a closer look at the above:&lt;/p&gt;
&lt;h4&gt;Parameterized split()&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html&#34;&gt;&lt;strong&gt;split&lt;/strong&gt;&lt;/a&gt; takes your bulk query and automagically breaks it down into smaller pieces. So instead of one huge &lt;strong&gt;UPDATE&lt;/strong&gt; or &lt;strong&gt;DELETE&lt;/strong&gt; or &lt;strong&gt;INSERT..SELECT&lt;/strong&gt; transaction, you get many smaller transactions, each with smaller impact on I/O, locks, CPU.&lt;/p&gt;
&lt;p&gt;As of &lt;strong&gt;1.3&lt;/strong&gt;, &lt;em&gt;split()&lt;/em&gt; gets more exposed: you can have some control on its execution, and you also get a lot of very interesting info during operation.&lt;/p&gt;
&lt;p&gt;Here&#39;s an example of &lt;em&gt;split()&lt;/em&gt; control:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;set @script := &#34;
  &lt;strong&gt;split&lt;/strong&gt;({&lt;em&gt;start&lt;/em&gt;:7015, &lt;em&gt;step&lt;/em&gt;:2000} : &lt;span style=&#34;color: #3366ff;&#34;&gt;UPDATE sakila.rental SET return_date = return_date + INTERVAL 1 DAY&lt;/span&gt;) 
    &lt;strong&gt;throttle&lt;/strong&gt; 1;
&#34;;
call common_schema.run(@script);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;In the above we choose a split size of 2,000 rows at a time; but we also choose to only start with &lt;strong&gt;7015&lt;/strong&gt;, skipping all rows prior to that value. Just what is that value? It depends on the splitting key (and see next example for just that); but in this table we can safely assume this is the &lt;strong&gt;rental_id&lt;/strong&gt; &lt;strong&gt;PRIMARY KEY&lt;/strong&gt; of the table.&lt;/p&gt;
&lt;p&gt;You don&#39;t &lt;em&gt;have to&lt;/em&gt; use these control &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html#parameters&#34;&gt;parameters&lt;/a&gt;. But they can save you some time and effort.&lt;!--more--&gt;&lt;/p&gt;
&lt;p&gt;And, look at some interesting info about the &lt;em&gt;splitting&lt;/em&gt; process:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;set @script := &#34;
  &lt;strong&gt;split&lt;/strong&gt;(&lt;span style=&#34;color: #339966;&#34;&gt;sakila.film_actor&lt;/span&gt;) 
    &lt;span style=&#34;color: #3366ff;&#34;&gt;&lt;strong&gt;select&lt;/strong&gt;&lt;/span&gt; $split_columns &lt;span style=&#34;color: #3366ff;&#34;&gt;as columns&lt;/span&gt;, $split_range_start &lt;span style=&#34;color: #3366ff;&#34;&gt;as range_start&lt;/span&gt;, $split_range_end &lt;span style=&#34;color: #3366ff;&#34;&gt;as range_end&lt;/span&gt;
&#34;;
call common_schema.run(@script);
+----------------------+-------------+------------+
| columns              | range_start | range_end  |
+----------------------+-------------+------------+
| `actor_id`,`film_id` | &#39;1&#39;,&#39;1&#39;     | &#39;39&#39;,&#39;293&#39; |
+----------------------+-------------+------------+

+----------------------+-------------+------------+
| columns              | range_start | range_end  |
+----------------------+-------------+------------+
| `actor_id`,`film_id` | &#39;39&#39;,&#39;293&#39;  | &#39;76&#39;,&#39;234&#39; |
+----------------------+-------------+------------+

+----------------------+-------------+-------------+
| columns              | range_start | range_end   |
+----------------------+-------------+-------------+
| `actor_id`,`film_id` | &#39;76&#39;,&#39;234&#39;  | &#39;110&#39;,&#39;513&#39; |
+----------------------+-------------+-------------+

+----------------------+-------------+-------------+
| columns              | range_start | range_end   |
+----------------------+-------------+-------------+
| `actor_id`,`film_id` | &#39;110&#39;,&#39;513&#39; | &#39;146&#39;,&#39;278&#39; |
+----------------------+-------------+-------------+

+----------------------+-------------+-------------+
| columns              | range_start | range_end   |
+----------------------+-------------+-------------+
| `actor_id`,`film_id` | &#39;146&#39;,&#39;278&#39; | &#39;183&#39;,&#39;862&#39; |
+----------------------+-------------+-------------+

+----------------------+-------------+-------------+
| columns              | range_start | range_end   |
+----------------------+-------------+-------------+
| `actor_id`,`film_id` | &#39;183&#39;,&#39;862&#39; | &#39;200&#39;,&#39;993&#39; |
+----------------------+-------------+-------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;In the above you get to be told exactly how table splitting occurs: you are being told what columns are used to split the table, and what range of values is used in each step. There&#39;s more to it: read the &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html&#34;&gt;split() documentation&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;similar_grants&lt;/h4&gt;
&lt;p&gt;Out of your &lt;strong&gt;100&lt;/strong&gt; different grants, which ones share the exact same set of privileges? MySQL has non notion of &lt;em&gt;roles&lt;/em&gt;, but that doesn&#39;t mean the notion does not exist. Multiple accounts share the same restrictions and privileges. Use &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/similar_grants.html&#34;&gt;&lt;strong&gt;similar_grants&lt;/strong&gt;&lt;/a&gt; to find out which. You might just realize there&#39;s a few redundant accounts in your system.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; SELECT * FROM similar_grants;
+-------------------------------+----------------+-------------------------------------------------------+
| sample_grantee                | count_grantees | similar_grantees                                      |
+-------------------------------+----------------+-------------------------------------------------------+
| &#39;root&#39;@&#39;127.0.0.1&#39;            |              3 | &lt;span style=&#34;color: #3366ff;&#34;&gt;&#39;root&#39;@&#39;127.0.0.1&#39;&lt;/span&gt;,&lt;span style=&#34;color: #0000ff;&#34;&gt;&#39;root&#39;@&#39;myhost&#39;&lt;/span&gt;,&lt;span style=&#34;color: #333399;&#34;&gt;&#39;root&#39;@&#39;localhost&#39;&lt;/span&gt; |
| &#39;repl&#39;@&#39;10.%&#39;                 |              2 | &lt;span style=&#34;color: #008000;&#34;&gt;&#39;repl&#39;@&#39;10.%&#39;&lt;/span&gt;,&lt;span style=&#34;color: #808000;&#34;&gt;&#39;replication&#39;@&#39;10.0.0.%&#39;&lt;/span&gt;                |
| &#39;apps&#39;@&#39;%&#39;                    |              1 | &#39;apps&#39;@&#39;%&#39;                                            |
| &#39;gromit&#39;@&#39;localhost&#39;          |              1 | &#39;gromit&#39;@&#39;localhost&#39;                                  |
| &#39;monitoring_user&#39;@&#39;localhost&#39; |              1 | &#39;monitoring_user&#39;@&#39;localhost&#39;                         |
+-------------------------------+----------------+-------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;duplicate_grantee()&lt;/h4&gt;
&lt;p&gt;Provide an existing account, and name your new, exact duplicate account. The complete set of privileges is copied, and so is the password. &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/duplicate_grantee.html&#34;&gt;&lt;strong&gt;duplicate_grantee()&lt;/strong&gt;&lt;/a&gt; is your Copy+Paste of MySQL accounts.&lt;/p&gt;
&lt;p&gt;Let&#39;s begin with some pre-existing account and see how it duplicates:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; show grants for &lt;span style=&#34;color: #000080;&#34;&gt;&#39;world_user&#39;@&#39;localhost&#39;&lt;/span&gt;;
+------------------------------------------------------------------------------------------------------------------------+
| Grants for world_user@localhost                                                                                        |
+------------------------------------------------------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO &#39;world_user&#39;@&#39;localhost&#39; IDENTIFIED BY PASSWORD &#39;*6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9&#39;      |
| GRANT ALL PRIVILEGES ON `world`.* TO &#39;world_user&#39;@&#39;localhost&#39;                                                          |
| GRANT EXECUTE, ALTER ROUTINE ON FUNCTION `sakila`.`get_customer_balance` TO &#39;world_user&#39;@&#39;localhost&#39; WITH GRANT OPTION |
+------------------------------------------------------------------------------------------------------------------------+

mysql&amp;gt; call &lt;strong&gt;duplicate_grantee&lt;/strong&gt;(&lt;span style=&#34;color: #000080;&#34;&gt;&#39;world_user@localhost&#39;&lt;/span&gt;, &lt;span style=&#34;color: #000080;&#34;&gt;&#39;copied_user@10.0.0.%&#39;&lt;/span&gt;);
Query OK, 0 rows affected (0.06 sec)

mysql&amp;gt; show grants for &lt;span style=&#34;color: #000080;&#34;&gt;&#39;copied_user&#39;@&#39;10.0.0.%&#39;&lt;/span&gt;;
+------------------------------------------------------------------------------------------------------------------------+
| Grants for copied_user@10.0.0.%                                                                                        |
+------------------------------------------------------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO &#39;copied_user&#39;@&#39;10.0.0.%&#39; IDENTIFIED BY PASSWORD &#39;*6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9&#39;      |
| GRANT ALL PRIVILEGES ON `world`.* TO &#39;copied_user&#39;@&#39;10.0.0.%&#39;                                                          |
| GRANT EXECUTE, ALTER ROUTINE ON FUNCTION `sakila`.`get_customer_balance` TO &#39;copied_user&#39;@&#39;10.0.0.%&#39; WITH GRANT OPTION |
+------------------------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The routine is quite relaxed in grantee format. &lt;strong&gt;copied_user@10.0.0.%&lt;/strong&gt;, &lt;strong&gt;copied_user@&#39;10.0.0.%&#39;&lt;/strong&gt; and &lt;strong&gt;&#39;copied_user&#39;@&#39;10.0.0.%&#39;&lt;/strong&gt; are all just fine, and represent the same account. Saves trouble with all that quoting.&lt;/p&gt;
&lt;h4&gt;json_to_xml()&lt;/h4&gt;
&lt;p&gt;JSON is becoming increasingly popular in storing dynamically-structured data. XML&#39;s tags overhead and its human unfriendliness make it less popular today. However, the two share similar concepts, and conversion between the two is possible. &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/json_to_xml.html&#34;&gt;&lt;strong&gt;json_to_xml()&lt;/strong&gt;&lt;/a&gt; will translate your valid JSON data into its equivalent XML format. The rules are simple (all-nodes-and-data, no attributes, arrays as repeating nodes, objects as subnodes) and the results are valid XML objects.&lt;/p&gt;
&lt;p&gt;Sample data taken from &lt;a href=&#34;http://json.org/example.html&#34;&gt;json.org&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; SET @json := &#39;
&lt;span style=&#34;color: #000080;&#34;&gt;{
  &#34;menu&#34;: {
    &#34;id&#34;: &#34;file&#34;,
    &#34;value&#34;: &#34;File&#34;,
    &#34;popup&#34;: {
      &#34;menuitem&#34;: [
        {&#34;value&#34;: &#34;New&#34;, &#34;onclick&#34;: &#34;CreateNewDoc()&#34;},
        {&#34;value&#34;: &#34;Open&#34;, &#34;onclick&#34;: &#34;OpenDoc()&#34;},
        {&#34;value&#34;: &#34;Close&#34;, &#34;onclick&#34;: &#34;CloseDoc()&#34;}
      ]
    }
  }
}&lt;/span&gt;
&#39;;

mysql&amp;gt; SELECT &lt;strong&gt;json_to_xml(@json)&lt;/strong&gt; AS &lt;strong&gt;xml&lt;/strong&gt; \G
*************************** 1. row ***************************
&lt;strong&gt;xml:&lt;/strong&gt; &amp;lt;menu&amp;gt;&amp;lt;id&amp;gt;file&amp;lt;/id&amp;gt;&amp;lt;value&amp;gt;File&amp;lt;/value&amp;gt;&amp;lt;popup&amp;gt;&amp;lt;menuitem&amp;gt;&amp;lt;value&amp;gt;New&amp;lt;/value&amp;gt;&amp;lt;onclick&amp;gt;CreateNewDoc()&amp;lt;/onclick&amp;gt;&amp;lt;/menuitem&amp;gt;&amp;lt;menuitem&amp;gt;&amp;lt;value&amp;gt;Open&amp;lt;/value&amp;gt;&amp;lt;onclick&amp;gt;OpenDoc()&amp;lt;/onclick&amp;gt;&amp;lt;/menuitem&amp;gt;&amp;lt;menuitem&amp;gt;&amp;lt;value&amp;gt;Close&amp;lt;/value&amp;gt;&amp;lt;onclick&amp;gt;CloseDoc()&amp;lt;/onclick&amp;gt;&amp;lt;/menuitem&amp;gt;&amp;lt;/popup&amp;gt;&amp;lt;/menu&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Beautified form of the above result:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&amp;lt;menu&amp;gt;
  &amp;lt;id&amp;gt;file&amp;lt;/id&amp;gt;
  &amp;lt;value&amp;gt;File&amp;lt;/value&amp;gt;
  &amp;lt;popup&amp;gt;
    &amp;lt;menuitem&amp;gt;
      &amp;lt;value&amp;gt;New&amp;lt;/value&amp;gt;
      &amp;lt;onclick&amp;gt;CreateNewDoc()&amp;lt;/onclick&amp;gt;
    &amp;lt;/menuitem&amp;gt;
    &amp;lt;menuitem&amp;gt;
      &amp;lt;value&amp;gt;Open&amp;lt;/value&amp;gt;
      &amp;lt;onclick&amp;gt;OpenDoc()&amp;lt;/onclick&amp;gt;
    &amp;lt;/menuitem&amp;gt;
    &amp;lt;menuitem&amp;gt;
      &amp;lt;value&amp;gt;Close&amp;lt;/value&amp;gt;
      &amp;lt;onclick&amp;gt;CloseDoc()&amp;lt;/onclick&amp;gt;
    &amp;lt;/menuitem&amp;gt;
  &amp;lt;/popup&amp;gt;
&amp;lt;/menu&amp;gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Note that linked examples page uses sporadically invented attributes; &lt;em&gt;common_schema&lt;/em&gt; prefers using well-defined nodes.&lt;/p&gt;
&lt;h4&gt;extract_json_value()&lt;/h4&gt;
&lt;p&gt;Which means things you can do with XML can also be done with JSON. XPath is a popular extraction DSL, working not only for XML but also for Object Oriented structures (see Groovy&#39;s nice integration of XPath into the language, or just commons-beans for conservative approach). JSON is a perfect data store for XPath expressions; by utilizing the translation between JSON and XML, one is now easily able to extract value from JSON (using same example as above):&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; SELECT &lt;strong&gt;extract_json_value&lt;/strong&gt;(@json, &lt;span style=&#34;color: #000080;&#34;&gt;&#39;//id&#39;&lt;/span&gt;) AS result;
+--------+
| result |
+--------+
| file   |
+--------+

mysql&amp;gt; SELECT &lt;strong&gt;extract_json_value&lt;/strong&gt;(@json, &lt;span style=&#34;color: #000080;&#34;&gt;&#39;count(/menu/popup/menuitem)&#39;&lt;/span&gt;) AS count_items;
+-------------+
| count_items |
+-------------+
| 3           |
+-------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Implementations of &lt;strong&gt;json_to_xml()&lt;/strong&gt; and &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/extract_json_value.html&#34;&gt;&lt;strong&gt;extract_json_value()&lt;/strong&gt;&lt;/a&gt; are CPU intensive. There is really just one justification for having these written in Stored Procedures: their lack in the standard MySQL function library. This is reason enough. Just be aware; test with &lt;a href=&#34;http://dev.mysql.com/doc/refman/5.5/en/information-functions.html#function_benchmark&#34;&gt;BENCHMARK()&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;query_checksum()&lt;/h4&gt;
&lt;p&gt;It looks like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; call &lt;strong&gt;query_checksum&lt;/strong&gt;(&lt;span style=&#34;color: #000080;&#34;&gt;&#39;select id from world.City where id in (select capital from world.Country) order by id&#39;&lt;/span&gt;);
+----------------------------------+
| checksum                         |
+----------------------------------+
| 5f35070b90b0c079ba692048c51a89fe |
+----------------------------------+

mysql&amp;gt; call &lt;strong&gt;query_checksum&lt;/strong&gt;(&lt;span style=&#34;color: #000080;&#34;&gt;&#39;select capital from world.Country where capital is not null order by capital&#39;&lt;/span&gt;);
+----------------------------------+
| checksum                         |
+----------------------------------+
| 5f35070b90b0c079ba692048c51a89fe |
+----------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The two queries above yield with the same result set. As consequence, &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_checksum.html&#34;&gt;&lt;strong&gt;query_checksum()&lt;/strong&gt;&lt;/a&gt; produces the same checksum value for both. The next query produces a different result set, hence a different checksum:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; call &lt;strong&gt;query_checksum&lt;/strong&gt;(&lt;span style=&#34;color: #000080;&#34;&gt;&#39;select id from world.City where id in (select capital from world.Country) order by id limit 10&#39;&lt;/span&gt;);
+----------------------------------+
| checksum                         |
+----------------------------------+
| 997079c2dfca34ba87ae44ed8965276e |
+----------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The routine actually invokes the given queries (modifying them a bit along the way) and uses a deterministic incremental checksum to get the final result.&lt;/p&gt;
&lt;p&gt;Its use? As a handy built-in mechanism for comparing your table data. This is meant for relatively small result sets - not for your &lt;strong&gt;20GB&lt;/strong&gt; table. Inspired by Baron&#39;s &lt;a href=&#34;http://www.xaprb.com/blog/2009/03/25/mysql-command-line-tip-compare-result-sets/&#34;&gt;old trick&lt;/a&gt;, and works on server side (Windows/GUI/automated clients to benefit).&lt;/p&gt;
&lt;h4&gt;random_hash()&lt;/h4&gt;
&lt;p&gt;Random hashes come handy. The naive way to produce them is by executing something like &lt;strong&gt;SELECT SHA1(RAND())&lt;/strong&gt;. However the &lt;strong&gt;RAND()&lt;/strong&gt; function just doesn&#39;t provide enough plaintext for the hash function. The &lt;strong&gt;SHA&lt;/strong&gt;/&lt;strong&gt;MD5&lt;/strong&gt; functions expect a textual input, and produce a &lt;strong&gt;160&lt;/strong&gt;/&lt;strong&gt;128&lt;/strong&gt; bit long hash. The maximum char length of a &lt;strong&gt;RAND()&lt;/strong&gt; result is &lt;strong&gt;20&lt;/strong&gt; characters or so, and these are limited to the &lt;strong&gt;0-9&lt;/strong&gt; digits. So at about &lt;strong&gt;10^20&lt;/strong&gt; options for input, which is about &lt;strong&gt;64&lt;/strong&gt; bit. Hmmmm. a 64 bit input to generate a &lt;strong&gt;160&lt;/strong&gt; bit output? I don&#39;t think so! &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/random_hash.html&#34;&gt;&lt;strong&gt;random_hash()&lt;/strong&gt;&lt;/a&gt; provides additional input in the form of your current status (at about 830 characters) as well as &lt;strong&gt;RAND()&lt;/strong&gt;, &lt;strong&gt;SYSDATE()&lt;/strong&gt; and server ID.&lt;/p&gt;
&lt;h4&gt;Bugfixes&lt;/h4&gt;
&lt;p&gt;Any bugfix adds at least one test; typically more. Currently with over &lt;strong&gt;470&lt;/strong&gt; tests, &lt;em&gt;common_schema&lt;/em&gt; is built to work.&lt;/p&gt;
&lt;h4&gt;Get common_schema&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;common_schema&lt;/em&gt; &lt;strong&gt;1.3&lt;/strong&gt; is available under the permissive New BSD License. &lt;a href=&#34;http://code.google.com/p/common-schema/&#34;&gt;Find the latest download here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you like to support &lt;em&gt;common_schema&lt;/em&gt;, I&#39;m always open for ideas and contributions. Or you can just spread the word!&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>common_schema 1.1 released: split(), try-catch, killall(), profiling</title>
      <link>/blog/mysql/common_schema-1-1-released-split-try-catch-killall-profiling/</link>
      <pubDate>Tue, 04 Sep 2012 08:15:25 +0000</pubDate>
      
      <guid>/blog/mysql/common_schema-1-1-released-split-try-catch-killall-profiling/</guid>
      <description>&lt;p&gt;I&#39;m very happy to announce the release of &lt;a href=&#34;http://code.google.com/p/common-schema/&#34;&gt;common_schema&lt;/a&gt;, version &lt;strong&gt;1.1&lt;/strong&gt; (revision &lt;strong&gt;300&lt;/strong&gt;).&lt;/p&gt;
&lt;p&gt;This version boasts with compelling new features: innovative QueryScript syntax, libraries, views which add to your skills as a DBA, making some maintenance and management tasks a breeze.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;QueryScript, &lt;strong&gt;split&lt;/strong&gt; statement: automagically break long queries into smaller chunks, avoid long locks and reduce query/transaction overhead&lt;/li&gt;
&lt;li&gt;QueryScript, &lt;strong&gt;try-catch&lt;/strong&gt; statement: just &lt;strong&gt;try { something; } catch { act_on_error; }&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;killall()&lt;/strong&gt;: quickly kill connections based on grantee/user/host information.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;profiling&lt;/strong&gt;/&lt;strong&gt;profiling_last&lt;/strong&gt;: utility views to assist in query profiling diagnostics&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;1 size fits all&lt;/strong&gt;: a single installer which auto-recognizes available server features and enables respective &lt;em&gt;common_schema&lt;/em&gt; features accordingly.&lt;/li&gt;
&lt;li&gt;QueryScript performance boost&lt;/li&gt;
&lt;li&gt;much much more...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Not familiar with &lt;em&gt;common_schema&lt;/em&gt;? It allows you to do stuff on server side, by selecting from views, calling upon useful routines or writing &lt;em&gt;easy-to-manage&lt;/em&gt; scripts.&lt;/p&gt;
&lt;p&gt;I&#39;m suggesting that &lt;em&gt;common_schema&lt;/em&gt; should be a &lt;em&gt;really-should-have&lt;/em&gt; tool to accompany your MySQL install. Did I say &#34;tool&#34;? It&#39;s merely a &lt;em&gt;schema&lt;/em&gt;. But it makes for a great framework:&lt;/p&gt;
&lt;p&gt;In &lt;a href=&#34;http://www.amazon.com/High-Performance-MySQL-Optimization-Replication/dp/1449314287/ref=dp_ob_title_bk&#34;&gt;High Performance MySQL, 3rd edition&lt;/a&gt;, Baron Schwartz describes &lt;em&gt;common_schema&lt;/em&gt;:&lt;/p&gt;
&lt;blockquote&gt;The &lt;em&gt;common_schema&lt;/em&gt; is to MySQL as jQuery is to javaScript&lt;/blockquote&gt;
&lt;p&gt;Reviewing highlights for version &lt;strong&gt;1.1&lt;/strong&gt;:&lt;/p&gt;
&lt;h4&gt;QueryScript&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html&#34;&gt;QueryScript&lt;/a&gt; is a scripting language. It sees some major improvements here. I&#39;ve made some speed boosts by &lt;a href=&#34;http://code.openark.org/blog/mysql/on-stored-routines-and-dynamic-statements&#34;&gt;avoiding using temporary tables&lt;/a&gt;, and by using string parsing instead.&lt;/p&gt;
&lt;p&gt;Without doubt the two most handy statements added to &lt;em&gt;QueryScript&lt;/em&gt; are:&lt;!--more--&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html&#34;&gt;&lt;strong&gt;split&lt;/strong&gt;&lt;/a&gt;: automagically break a long query into smaller, distinct chunks, and execute those iteratively. Just write your query; &lt;em&gt;split&lt;/em&gt; will parse it, analyze it, rewrite it, break your table into parts, iterate your table and apply query for each chunk of rows. You can reduce lock time, avoid huge transactions and give your server room to breathe on operations such as massive updates of rows, transferring of rows between tables, massive purging of rows etc. Consider: the following query will execute &lt;strong&gt;1,000&lt;/strong&gt; rows at a time, and the script will throttle execution so as to sleep in between chunks. And you need know nothing about how it works internally (though it&#39;s quite interesting):&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;pre&gt;create table world.City_dup like world.City;
split (insert into world.City_dup select * from world.City)
{
  throttle 2;
}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_try_catch.html&#34;&gt;&lt;strong&gt;try-catch&lt;/strong&gt;&lt;/a&gt;: if, like me, you are frustrated with stored routines way of handling errors, QueryScript now offers you familiar (yet enhanced) form of &lt;strong&gt;try something catch do_something_on_error&lt;/strong&gt;. It is limited in that you cant have a catch for particular error codes - MySQL &lt;a href=&#34;http://code.openark.org/blog/mysql/mysql-error-handling-on-server-side-a-no-go&#34;&gt;does not provide such info on server side&lt;/a&gt;. Nevertheless, consider:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;pre&gt;while (true)
{
  try
  {
    -- Attempt query which is expected to abort on deadlock:
    UPDATE some_table SET some_column = 1 WHERE some_condition;
    -- Got here? This means query is successful! We can leave now.
    break;
  }
  catch
  {
    -- Apparently there was a deadlock. Rest, then loop again until succeeds
    sleep 1;
  }
}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;QueryScript also adds:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_eval.html&#34;&gt;&lt;strong&gt;eval&lt;/strong&gt;&lt;/a&gt;: evaluate SQL statements on the fly. I&#39;ve got some very cool use cases already in production.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_sleep.html&#34;&gt;&lt;strong&gt;sleep&lt;/strong&gt;&lt;/a&gt;: just... sleep.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_pass.html&#34;&gt;&lt;strong&gt;pass&lt;/strong&gt;&lt;/a&gt;: similar to Python&#39;s pass statement, this statement does nothing and makes for a placeholder.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;QueryScript &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_variables.html&#34;&gt;variables&lt;/a&gt; now support:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Declare &amp;amp; assign syntax: &lt;strong&gt;var $sum := 0&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;New expansion syntax: &lt;strong&gt;DELETE FROM t LIMIT :${number_of_rows},&lt;/strong&gt; or&lt;strong&gt; CREATE TABLE customer_:${shard_number}_details&lt;br /&gt;
&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Support for expanded variables in expressions, &lt;em&gt;throttle&lt;/em&gt;, &lt;em&gt;sleep&lt;/em&gt;, &lt;em&gt;throw&lt;/em&gt; statements.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Routines:&lt;/h4&gt;
&lt;p&gt;Plenty of new routines. Most notable:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/killall.html&#34;&gt;&lt;strong&gt;killall()&lt;/strong&gt;&lt;/a&gt;: much like Unix &lt;em&gt;killall&lt;/em&gt; command, this routine kills connections based on names, rather than process IDs. Names are &lt;em&gt;grantee name&lt;/em&gt;, or just the &lt;em&gt;user&lt;/em&gt; part, or just the &lt;em&gt;host&lt;/em&gt; part. Which allows for quick killing of all connections coming from a specific user or host:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;pre&gt;CALL killall(&#39;host3.analytics.mycompany.com&#39;);
CALL killall(&#39;reporting_user&#39;);&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/table_exists.html&#34;&gt;&lt;strong&gt;table_exists()&lt;/strong&gt;&lt;/a&gt;: test for (isn&#39;t it clear?) table existence. This uses INFORMATION_SCHEMA optimizations: it&#39;s a lightweight query.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT table_exists(&#39;sakila&#39;, &#39;rental&#39;) AS does_it_exist;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;We also have text manipulation routines: &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/encode_xml.html&#34;&gt;&lt;strong&gt;encode_xml()&lt;/strong&gt;&lt;/a&gt; and &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/decode_xml.html&#34;&gt;&lt;strong&gt;decode_xml()&lt;/strong&gt;&lt;/a&gt;, &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/strip_urls.html&#34;&gt;&lt;strong&gt;strip_urls()&lt;/strong&gt;&lt;/a&gt;, &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/prettify_message.html&#34;&gt;&lt;strong&gt;prettify_message()&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;Views&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Profiling views, inspired by &lt;a href=&#34;http://www.mysqlperformanceblog.com/2012/02/20/how-to-convert-show-profiles-into-a-real-profile/&#34;&gt;How to convert MySQL’s SHOW PROFILES into a real profile&lt;/a&gt;: &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_profiling.html&#34;&gt;&lt;strong&gt;query_profiling&lt;/strong&gt;&lt;/a&gt; &amp;amp; &lt;strong&gt;&lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/last_query_profiling.html&#34;&gt;last_query_profiling&lt;/a&gt;:&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; SET PROFILING := 1;

mysql&amp;gt; SELECT COUNT(*) FROM sakila.nicer_but_slower_film_list INTO @dummy;

mysql&amp;gt; SELECT * FROM last_query_profiling;
+----------+----------------------+-------------+--------------------+-------------------------+--------------------+------------+
| QUERY_ID | STATE                | state_calls | state_sum_duration | state_duration_per_call | state_duration_pct | state_seqs |
+----------+----------------------+-------------+--------------------+-------------------------+--------------------+------------+
|       41 | checking permissions |           5 |           0.000320 |            0.0000640000 |               0.33 | 5,6,7,8,9  |
|       41 | cleaning up          |           1 |           0.000007 |            0.0000070000 |               0.01 | 31         |
|       41 | closing tables       |           1 |           0.000016 |            0.0000160000 |               0.02 | 29         |
|       41 | Copying to tmp table |           1 |           0.042363 |            0.0423630000 |              44.34 | 15         |
|       41 | Creating tmp table   |           1 |           0.000123 |            0.0001230000 |               0.13 | 13         |
|       41 | end                  |           1 |           0.000004 |            0.0000040000 |               0.00 | 23         |
|       41 | executing            |           2 |           0.000014 |            0.0000070000 |               0.01 | 14,22      |
|       41 | freeing items        |           2 |           0.000216 |            0.0001080000 |               0.23 | 25,27      |
|       41 | init                 |           1 |           0.000012 |            0.0000120000 |               0.01 | 20         |
|       41 | logging slow query   |           1 |           0.000004 |            0.0000040000 |               0.00 | 30         |
|       41 | Opening tables       |           1 |           0.028909 |            0.0289090000 |              30.26 | 2          |
|       41 | optimizing           |           2 |           0.000026 |            0.0000130000 |               0.03 | 10,21      |
|       41 | preparing            |           1 |           0.000018 |            0.0000180000 |               0.02 | 12         |
|       41 | query end            |           1 |           0.000004 |            0.0000040000 |               0.00 | 24         |
|       41 | removing tmp table   |           3 |           0.000130 |            0.0000433333 |               0.14 | 18,26,28   |
|       41 | Sending data         |           2 |           0.016823 |            0.0084115000 |              17.61 | 17,19      |
|       41 | Sorting result       |           1 |           0.006302 |            0.0063020000 |               6.60 | 16         |
|       41 | starting             |           1 |           0.000163 |            0.0001630000 |               0.17 | 1          |
|       41 | statistics           |           1 |           0.000048 |            0.0000480000 |               0.05 | 11         |
|       41 | System lock          |           1 |           0.000017 |            0.0000170000 |               0.02 | 3          |
|       41 | Table lock           |           1 |           0.000018 |            0.0000180000 |               0.02 | 4          |
+----------+----------------------+-------------+--------------------+-------------------------+--------------------+------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;common_schema&lt;/em&gt; meta info is in the &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/status.html&#34;&gt;&lt;strong&gt;status&lt;/strong&gt;&lt;/a&gt; view, which can be used, for example, in bug reports. It indicated version, revision, time and status of installation process.&lt;/p&gt;
&lt;h4&gt;Installer&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;common_schema&lt;/em&gt; comes with an invisible installer. It&#39;s just a SQL file, imported via &lt;strong&gt;SOURCE&lt;/strong&gt; command or your favorite import method. But, once base components are installed, it activates itself to spawn a smart-mode install phase, where it checks upon existing MySQL server features, and adding respective &lt;em&gt;common_schema&lt;/em&gt; features. So, if InnoDB plugin is present, you get the InnoDB plugin views in &lt;em&gt;common_schema&lt;/em&gt;. If this is a Percona Server, you also get those related views. This makes for a single distribution file, as opposed to &lt;strong&gt;3&lt;/strong&gt; different distributions in previous versions.&lt;/p&gt;
&lt;h4&gt;Documentation&lt;/h4&gt;
&lt;p&gt;There are no compromises here. Documenting &lt;em&gt;common_schema&lt;/em&gt; takes more time than writing &amp;amp; testing it. But everything is well documented. You can read the documentation online, or &lt;a href=&#34;http://code.google.com/p/common-schema/&#34;&gt;download&lt;/a&gt; a bundle, or call for &lt;a href=&#34;http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/help.html&#34;&gt;&lt;strong&gt;help()&lt;/strong&gt;&lt;/a&gt; from within &lt;em&gt;common_schema&lt;/em&gt;: the documentation is internal, too.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;root@mysql-5.1.51&amp;gt; CALL help(&#39;try&#39;);
+--------------------------------------------------------------------------------+
| help                                                                           |
+--------------------------------------------------------------------------------+
| QueryScript Flow Control: try-catch statement                                  |
|                                                                                |
| SYNOPSIS                                                                       |
|                                                                                |
|                                                                                |
|                                                                                |
|        try                                                                     |
|          statement;                                                            |
|        catch                                                                   |
|          statement;                                                            |
|                                                                                |
|                                                                                |
|                                                                                |
| DESCRIPTION                                                                    |
|                                                                                |
| try-catch is an error handling flow control structure. Flow is determined      |
| based on the appearance or non-appearance of execution errors.                 |
| The try statement (or block of statements) is executed. If no error occurs, it |
| completes, and the catch statement is never executed.                          |
| If an error is detected within execution of the try statement, the try         |
| statement is aborted at the point of error (i.e. all statements following the  |
| point of error are discarded), and the catch statement (or block of            |
| statements) is executed.                                                       |
...
+--------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Tests&lt;/h4&gt;
&lt;p&gt;With over &lt;strong&gt;350&lt;/strong&gt; tests and counting, &lt;em&gt;common_schema&lt;/em&gt; and &lt;em&gt;QueryScript&lt;/em&gt; are well tested. There are still tests to write, the cover is not complete, and I&#39;m working on it.&lt;/p&gt;
&lt;h4&gt;Bugfixes&lt;/h4&gt;
&lt;p&gt;Changed view definitions affected by &lt;a href=&#34;http://bugs.mysql.com/65388&#34;&gt;MySQL bug #65388&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Download&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;http://code.google.com/p/common-schema/&#34;&gt;Download common_schema&lt;/a&gt;. You will find it is rich and smart.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>sphinx, sphinx_snippets() &amp; MySQL 5.5</title>
      <link>/blog/mysql/sphinx-sphinx_snippets-mysql-5-5/</link>
      <pubDate>Wed, 21 Mar 2012 15:57:59 +0000</pubDate>
      
      <guid>/blog/mysql/sphinx-sphinx_snippets-mysql-5-5/</guid>
      <description>&lt;p&gt;I&#39;ve written a patch which completes Sphinx&#39;s integration with MySQL &lt;strong&gt;5.5&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Up until a couple months ago, Sphinx would not compile with MySQL &lt;strong&gt;5.5&lt;/strong&gt; at all. This is, thankfully, resolved as of Sphinx &lt;strong&gt;2.0.3&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;However, to my disdain, I&#39;ve found out that it only partially work: the &lt;a href=&#34;http://sphinxsearch.com/docs/manual-2.0.4.html#sphinxse-snippets&#34;&gt;sphinx_snippets()&lt;/a&gt; user defined function is not included within the plugin library. After some quick poking I discovered that it was not added to the build, and when added, would not compile.&lt;/p&gt;
&lt;p&gt;I rely on &lt;strong&gt;sphinx_snippets()&lt;/strong&gt; quite a lot, and like it. Eventually I wrote the fix to the &lt;strong&gt;snippets_udf.cc&lt;/strong&gt; which allows it to run in a MySQL &lt;strong&gt;5.5&lt;/strong&gt; server.&lt;/p&gt;
&lt;p&gt;Here are the changes for the &lt;strong&gt;2.0.4&lt;/strong&gt; version of Sphinx:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2012/03/snippets_udf.cc&#34;&gt;snippets_udf.cc&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2012/03/CMakeLists.txt&#34;&gt;CMakeLists.txt&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Replace your &lt;strong&gt;2.0.4&lt;/strong&gt; files with these two and get on compiling your MySQL server.&lt;/p&gt;
&lt;h4&gt;Compilation guide&lt;/h4&gt;
&lt;p&gt;For completeness, here&#39;s how to compile Percona Server &lt;strong&gt;5.5&lt;/strong&gt; with Sphinx &lt;strong&gt;2.0.4&lt;/strong&gt; including the above patches:&lt;!--more--&gt;&lt;/p&gt;
&lt;p&gt;Get &lt;a href=&#34;http://www.percona.com/downloads/Percona-Server-5.5/LATEST/&#34;&gt;Percona Server source code&lt;/a&gt; and &lt;a href=&#34;http://sphinxsearch.com/downloads/release/&#34;&gt;Sphinx Search source code&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I&#39;ll be using Percona Server &lt;strong&gt;5.5.21-25.0&lt;/strong&gt;. I use &lt;strong&gt;/data/tmp/mysql&lt;/strong&gt; as compilation path, and install MySQL on &lt;strong&gt;/usr/local/mysql55&lt;/strong&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mkdir -p /data/tmp/mysql
cd /data/tmp/mysql
tar xzfv Percona-Server-5.5.21-rel25.0.tar.gz
tar xzfv sphinx-2.0.4-release.tar.gz
cd Percona-Server-5.5.21-rel25.0/
cp -R /data/tmp/mysql/sphinx-2.0.4-release/mysqlse storage/sphinx&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Overwrite with patched files included in this post:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;cp /tmp/CMakeLists.txt storage/sphinx/CMakeLists.txt
cp /tmp/snippets_udf.cc storage/sphinx/snippets_udf.cc&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Build MySQL:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;sh BUILD/autorun.sh
./configure --with-plugin-sphinx --prefix=/usr/local/mysql55
make
sudo make install&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Install the mysql55 service:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;cd /usr/local/mysql55
sudo cp support-files/mysql.server /etc/init.d/mysql55&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;In &lt;strong&gt;/etc/bash.bashrc&lt;/strong&gt;, add:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;export PATH=/usr/local/mysql55/bin:${PATH}&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Start MySQL:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;sudo service mysql55 start&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Login to MySQL as an administrato (typically &lt;strong&gt;root&lt;/strong&gt;) and install Sphinx:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; INSTALL PLUGIN sphinx SONAME &#39;ha_sphinx.so&#39;;
mysql&amp;gt; CREATE FUNCTION sphinx_snippets RETURNS STRING SONAME &#39;ha_sphinx.so&#39;;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Notes&lt;/h4&gt;
&lt;p&gt;See also &lt;a href=&#34;http://sphinxsearch.com/bugs/view.php?id=1090&#34;&gt;http://sphinxsearch.com/bugs/view.php?id=1090&lt;/a&gt; and &lt;a href=&#34;http://sphinxsearch.com/forum/view.html?id=8982&#34;&gt;http://sphinxsearch.com/forum/view.html?id=8982&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>