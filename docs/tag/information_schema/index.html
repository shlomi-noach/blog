<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>Information_schema &middot; code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="code.openark.org" href="/blog/tag/information_schema/index.xml" />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blogimg/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
      <li class="pure-menu-item">
        <a class="pure-menu-link" href="/blog/tag/information_schema/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link">
        Shlomi Noach
        
          <div class="avatar-container">
        	  <div class="avatar-img-border">
                <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
        	  </div>
        	</div>
        
      </a>
    </li>

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Information_schema</h1>
</div>

<div class="content">
  
    <article>
  <header>
    <h2><a href="/blog/mysql/baffling-5-7-globalstatus-variables-issues-unclean-migration-path/">Baffling 5.7 global/status variables issues, unclean migration path</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Aug 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance_schema">performance_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>MySQL <strong>5.7</strong> introduces a change in the way we query for global variables and status variables: the <strong>INFORMATION<em>SCHEMA.(GLOBAL|SESSION)</em>(VARIABLES|STATUS)</strong> tables are now deprecated and empty. Instead, we are to use the respective <strong>performance<em>schema.(global|session)</em>(variables|status)</strong> tables.</p>
<p>But the change goes farther than that; there is also a security change. Oracle created a pitfall of <strong>2</strong> changes at the same time:</p>
<ol>
<li>Variables/status moved to a different table</li>
<li>Privileges required on said table</li>
</ol>
<p>As an example, my non-root user gets:</p>
<blockquote>
<pre>mysql&gt; show session variables like &lsquo;tx_isolation&rsquo;;
ERROR 1142 (42000): SELECT command denied to user &lsquo;normal_user&rsquo;@&lsquo;my_host&rsquo; for table &lsquo;session_variables&rsquo;</pre>
</blockquote>
<p>Who gets affected by this? Nearly <em>everyone and everything</em>.</p>
<ul>
<li>Your Nagios will not be able to read status variables</li>
<li>Your ORM will not be able to determine session variables</li>
<li>Your replication user will fail connecting (see <a href="http://datacharmer.blogspot.nl/2015/08/mysql-578-features-bugs-and-rumors.html">this post by Giuseppe</a>)</li>
<li>And most everyone else.</li>
</ul>
<p>The problem with the above is that involves two unrelated changes to your setup, which are not entirely simple to coordinate:</p>
<ol>
<li>Change your app code to choose the correct schema (information_schema vs. performance_schema)</li>
<li><strong>GRANT</strong> the permissions on your database</li>
</ol>
<p>Perhaps at this point you still do not consider this to be a problem. You may be thinking: <em>well, let&rsquo;s first prepare by creating the GRANTs, and once that is in place, we can, at our leisure, modify the code</em>.</p>
<p>Not so fast. Can you really that simply create those GRANTs?</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/baffling-5-7-globalstatus-variables-issues-unclean-migration-path/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-openark-kit-in-the-media-dbhangops-oursql/">common_schema &amp; openark-kit in the media: #DBHangOps, OurSQL</a></h2>

    <div class="post-meta">

  <div>

    <time>26 Jun 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  #DBHangOps I had the pleasure of joining into @DBHangOps today, and speak about common_schema and openark-kit. What was meant to be a 15 minute session turned to be 50 -- sorry, people, I don't talk as much at home, but when it comes to my pet projects... I also realized I was missing on a great event: DBHangOps is a hangout where you can chat and discuss MySQL &amp; related technologies with friends and colleagues, with whom you typically only meet at conferences.
  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-openark-kit-in-the-media-dbhangops-oursql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/hierarchical-data-in-information_schema-and-derivatives/">Hierarchical data in INFORMATION_SCHEMA and derivatives</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Jan 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Just how often do you encounter hierarchical data? Consider a table with some parent-child relation, like the this classic <strong>employee</strong> table:</p>
<blockquote>
<pre>CREATE TABLE employee (
  employee_id INT UNSIGNED PRIMARY KEY,
  employee_name VARCHAR(100),
  manager_id INT UNSIGNED,
  CONSTRAINT <code>employee_manager_fk</code> FOREIGN KEY (manager_id) REFERENCES employee (employee_id)
) engine=innodb
;
+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;+
| employee_id | employee_name | manager_id |
+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;+
|           1 | Rachel        |       NULL |
|           2 | John          |          1 |
|           3 | Stan          |          1 |
|           4 | Naomi         |          2 |
+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;+</pre>
</blockquote>
<p>Questions like <em>&ldquo;What is the (nested) list of employees managed by Rachel?&rdquo;</em> or <em>&ldquo;Get Naomi&rsquo;s managers chain of command&rdquo;</em> are classical questions. There are sometimes dependencies: if John leaves, does that mean Naomi loses her job, or does she get promoted, or something else? If John and Stan are on sick leave, does Rachel have any reason to come to work?</p>
<p>Hierarchical data is not limited to a single-table structure. Sometimes it takes a combination of a few tables (it&rsquo;s just a <strong>JOIN</strong>) to make out the parent-child relation.</p>
<p>Hierarchical data is difficult to manage with SQL. This is especially true for MySQL, which does not support the <strong>WITH</strong> recursive query syntax.</p>
<h4>Where can you find hierarchical data?</h4>
<p>Even if you do not provide it by yourself, MySQL&rsquo;s <strong>INFORMATION_SCHEMA</strong> has some for you. Partly obvious, partly implicit, here are some examples:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/hierarchical-data-in-information_schema-and-derivatives/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/killing-innodb-idle-transactions/">Killing InnoDB idle transactions</a></h2>

    <div class="post-meta">

  <div>

    <time>04 Dec 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The issue of terminating long-time idle open InnoDB transaction has been discussed recently by many. I wish to add my share, by proposing a quick and clean solution via <a href="http://code.google.com/p/common-schema/">common_schema</a>.</p>
<p><em>common_schema <strong>1.2</strong></em> provides with the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/innodb_transactions.html"><strong>innodb_transactions</strong></a> view, which relies on <strong>INNODB_TRX</strong> - one of the InnoDB Plugin views in <strong>INFORMATION_SCHEMA</strong> - as well as on <strong>PROCESSLIST</strong>, and so is able to determine with certainty that a transaction has been idle for a long time.</p>
<p><strong>innodb_transactions</strong> offers us with a <strong>sql_kill_query</strong> column, which produces a <strong>&lsquo;KILL QUERY 12345&rsquo;</strong> type of value. So we can:</p>
<blockquote>
<pre>SELECT <strong>sql_kill_query</strong> FROM <strong>innodb_transactions</strong> WHERE <strong>trx_idle_seconds &gt;= 10;
</strong>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
| sql_kill_query    |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
| KILL QUERY 292509 |
| KILL QUERY 292475 |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+<strong> </strong></pre>
</blockquote>
<p><em>common_schema</em>&rsquo;s useful <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/eval.html"><strong>eval()</strong></a> routine allows us to actually invoke those <strong>KILL</strong> statements, all in a one-liner:</p>
<blockquote>
<pre>call <strong>eval</strong>(<span style="color: #003366;">&lsquo;SELECT <strong>sql_kill_query</strong> FROM innodb_transactions WHERE <strong>trx_idle_seconds &gt;= 10</strong>&lsquo;</span>);</pre>
</blockquote>
<h4>Technical details</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/killing-innodb-idle-transactions/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/how-common_schema-splits-tables-internals/">How common_schema split()s tables - internals</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Sep 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post exposes some of the internals, and the SQL behind QueryScript&rsquo;s <em>split</em>. <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">common_schema/QueryScript</a> <strong>1.1</strong> introduces the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split</strong></a> statement, which auto-breaks a &ldquo;large&rdquo; query (one which operates on large tables as a whole or without keys) into smaller queries, and executes them in sequence.</p>
<p>This makes for easier transactions, less locks held, potentially (depending on the user) more idle time released back to the database. <em>split<strong></strong></em> has similar concepts to <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-chunk-update.html">oak-chunk-update</a> and <a href="http://www.percona.com/doc/percona-toolkit/2.1/pt-archiver.html">pt-archiver</a>, but works differently, and implemented entirely in SQL on server side.</p>
<p>Take the following statement as example:</p>
<blockquote>
<pre><strong>split</strong> (<strong>UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR</strong>)
  pass;</pre>
</blockquote>
<p>It yields with (roughly) the following statements:</p>
<blockquote>
<pre>UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;1&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;1&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;1000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;1000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;1000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;2000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;2000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;2000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;3000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;3000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;3000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;4000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;4000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;4000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;4581&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;4581&rsquo;))));</pre>
</blockquote>
<p>(I say &ldquo;roughly&rdquo; because internally there are user defined variables at play, but for convenience, I verbose the actual values as constants.)</p>
<h4>How does that work?</h4>
<p><em>common_schema</em> works on server side. There is no Perl script or anything. It must therefore use server-side operations to:</p>
<ul>
<li>Identify table to be split</li>
<li>Analyze the table in the first place, deciding how to split it</li>
<li>Analyze the query, deciding on how to rewrite it</li>
<li>Split the table (logically) into unique and distinct chunks</li>
<li>Work out the query on each such chunk</li>
</ul>
<p>Following is an internal look at how <em>common_schema</em> does all the above.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/how-common_schema-splits-tables-internals/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/table-split-for-the-masses/">Table split(...) for the masses</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Sep 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>(pun intended)</p>
<p><em>common_schema</em>&rsquo;s new <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split</strong></a> statement (see <a href="http://code.openark.org/blog/mysql/common_schema-1-1-released-split-try-catch-killall-profiling">release announcement</a>) auto-splits complex queries over large tables into smaller ones: instead of issuing one huge query, <em>split</em> breaks one&rsquo;s query into smaller queries, each working on a different set of rows (a chunk).</p>
<p>Thus, it is possible to avoid holding locks for long times, allowing for smaller transactions. It also makes for breathing space for the RDBMS, at times boosting operation speed, and at times prolonging operation speed at will.</p>
<p>In this post I show how <em>split</em> exposes itself to the user, should the user wish so.</p>
<p><em>split</em> can manage queries of the following forms:</p>
<ul>
<li>DELETE FROM table_name [WHERE]&hellip;</li>
<li>DELETE FROM table_name USING &lt;multi table syntax&gt; [WHERE]&hellip;</li>
<li>UPDATE table_name SET &hellip; [WHERE]&hellip;</li>
<li>UPDATE &lt;multiple tables&gt; SET &hellip; [WHERE]&hellip;</li>
<li>INSERT INTO some_table SELECT &hellip; FROM &lt;single or multiple tables&gt; [WHERE]&hellip;</li>
<li>REPLACE INTO some_table SELECT &hellip; FROM &lt;single or multiple tables&gt; [WHERE]&hellip;</li>
<li>SELECT &hellip; FROM &lt;multiple tables&gt; [WHERE]&hellip;</li>
</ul>
<p>The latter being a non-obvious one at first sight.</p>
<h4>Basically, it&rsquo; automatic</h4>
<p>You just say:</p>
<blockquote>
<pre><strong>split</strong> (UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR)
  throttle 2;</pre>
</blockquote>
<p>And <em>split</em> identifies <strong>sakila.inventory</strong> as the table which needs to be split, and injects appropriate conditions so as to work on a subset of the rows, in multiple steps.</p>
<p>By the way, here&rsquo;s <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_execution.html">how to execute a QueryScript code</a> like the above.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/table-split-for-the-masses/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/auto-caching-information_schema-tables-seeking-input/">Auto caching INFORMATION_SCHEMA tables: seeking input</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Mar 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><h4>The short version</h4>
<p>I have it all working. It&rsquo;s kind of magic. But there are issues, and I&rsquo;m not sure it should even exist, and am looking for input.</p>
<h4>The long version</h4>
<p>In <a title="Link to Auto caching tables" href="http://code.openark.org/blog/mysql/auto-caching-tables" rel="bookmark">Auto caching tables</a> I presented with a hack which allows getting cached or fresh results via a simple SELECT queries.</p>
<p>The drive for the above hack was <strong>INFORMATION_SCHEMA</strong> tables. There are two major problems with <strong>INFORMATION_SCHEMA</strong>:</p>
<ol>
<li>Queries on schema-oriented tables such as <strong>TABLES</strong>, <strong>COLUMNS</strong>, <strong>STATISTICS</strong>, etc. are heavyweight. How heavyweight? Enough to make a lockdown of your database. Enough to crash down your database in some cases.</li>
<li>The data is always generated on-the-fly, as you request it. Query the <strong>COLUMNS</strong> table twice, and risk two lockdowns of your database.</li>
</ol>
<p>The auto-cache mechanism solves issue <strong>#2</strong>. I have it working, time based. I have an auto-cache table for each of the <strong>INFORMATION_SCHEMA</strong> heavyweight tables. Say, every <strong>30</strong> minutes the cache is invalidated. Throughout those <strong>30</strong> minutes, you get a free pass!</p>
<p>The auto-cache mechanism also paves the road to solving issue <strong>#1</strong>: since it works by invoking a stored routine, I have better control of the way I read <strong>INFORMATION_SCHEMA</strong>. This, I can take advantage of <a href="http://dev.mysql.com/doc/refman/5.1/en/information-schema-optimization.html">INFORMATION_SCHEMA optimization</a>. It&rsquo;s tedious, but not complicated.</p>
<p>For example, if I wanted to cache the <strong>TABLES</strong> table, I don&rsquo;t necessarily read the entire <strong>TABLES</strong> data in one read. Instead, I can iterate the schemata, get a list of table names per schema, then read full row data for these, table by table. The result? Many many more <strong>SELECT</strong>s, but more optimized, and no one-big-lock-it-all query.</p>
<h4>And the problem is&hellip;</h4>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/auto-caching-information_schema-tables-seeking-input/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/information_schema-optimizations-still-crashing-my-servers/">INFORMATION_SCHEMA Optimizations: still crashing my servers</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Dec 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong>[Update</strong>: need to take more breaks: now<strong> NOT</strong> crashing my servers! See clarifications below<strong>]</strong></p>
<p><a href="http://dev.mysql.com/doc/refman/5.1/en/information-schema-optimization.html">INFORMATION_SCHEMA Optimizations</a> are meant to make your <strong>INFORMATION_SCHEMA</strong> queries lighter and safer.</p>
<p>For example, if you&rsquo;re going to query the <strong>COLUMNS</strong> table for just the columns of a single table, then the following:</p>
<blockquote>
<pre>SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA=&lsquo;sakila&rsquo; AND TABLE_NAME=&lsquo;rental&rsquo;</pre>
</blockquote>
<p>makes for an optimization: specifying a literal on <strong>TABLE_SCHEMA</strong> avoid scanning the directories of other schemata. Specifying a literal on <strong>TABLE_NAME</strong> avoids checking up on other tables. So it&rsquo;s a one-schema-one-table read operation, as opposed to <em>&ldquo;first read every single column from all and any single schema and table, then return only those I&rsquo;m interested in&rdquo;</em>.</p>
<p>Here&rsquo;s the execution plan for the above query:</p>
<blockquote>
<pre>*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: COLUMNS
         type: ALL
possible_keys: NULL
          key: TABLE_SCHEMA,TABLE_NAME
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Using where; Open_frm_only; Scanned 0 databases</pre>
</blockquote>
<p>What I tried to do is to read the entire <strong>COLUMNS</strong> table, one schema at a time, one table at a time. I&rsquo;m good with this taking longer time.</p>
<p>I have a production system on which reads from <strong>COLUMNS</strong> <em>consistently crash the servers</em>. Well, one read at a time can&rsquo;t do harm, right?</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/information_schema-optimizations-still-crashing-my-servers/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/more-mysql-foreach/">More MySQL foreach()</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Dec 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In my <a href="http://code.openark.org/blog/mysql/mysql-foreach">previous post</a> I&rsquo;ve shown several generic use cases for <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/foreach.html"><em>foreach()</em></a>, a new scripting functionality introduced in <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>.</p>
<p>In this part I present DBA&rsquo;s handy syntax for schema and table operations and maintenance.</p>
<p>Confession: while I love <strong>INFORMATION_SCHEMA</strong>&rsquo;s power, I just <em>hate</em> writing queries against it. It&rsquo;s just so much typing! Just getting the list of tables in a schema makes for this heavy duty query:</p>
<blockquote>
<pre>SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA=&lsquo;sakila&rsquo; AND TABLE_TYPE=&lsquo;BASE TABLE&rsquo;;</pre>
</blockquote>
<p>When a join is involved this really becomes a nightmare. I think it&rsquo;s cumbersome, and as result, many do not remember the names and meaning of columns, making for <em>&ldquo;oh, I need to read the manual all over again just to get that query right&rdquo;</em>. Anyway, that&rsquo;s my opinion.</p>
<p>A <strong>SHOW TABLES</strong> statement is easier to type, but cannot be integrated into a <strong>SELECT</strong> query (though <a href="http://code.openark.org/blog/mysql/reading-results-of-show-statements-on-server-side">we have a partial solution</a> for that, too), and besides, when filtering out the views, the <strong>SHOW</strong> statement becomes almost as cumbersome as the one on <strong>INFORMATION_SCHEMA</strong>.</p>
<p>Which is why <em>foreach()</em> offers handy shortcuts to common iterations on schemata and tables, as follows:</p>
<h4>Use case: iterate all databases</h4>
<blockquote>
<pre>call foreach(<span style="color: #808000;">&lsquo;schema&rsquo;</span>, <span style="color: #003366;">&lsquo;CREATE TABLE ${schema}.event(event<em>id INT, msg VARCHAR(128))&rsquo;</span>);</pre>
</blockquote>
<p>In the above we execute a query on each database. Hmmm, maybe not such a good idea to perform this operation on all databases? Let&rsquo;s filter them:</p>
<h4>Use case: iterate databases by name match</h4>
<blockquote>
<pre>call foreach(<span style="color: #808000;">&lsquo;schema like wordpress</em>%&rsquo;</span>, <span style="color: #003366;">&lsquo;ALTER TABLE ${schema}.wp_posts MODIFY COLUMN comment_author VARCHAR(96) NOT NULL&rsquo;</span>);</pre>
</blockquote>
<p>The above will only iterate my WordPress databases (I have several of these), performing an <strong>ALTER</strong> on <strong>wp_posts</strong> for each of those databases.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/more-mysql-foreach/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/reading-results-of-show-statements-on-server-side/">Reading results of SHOW statements, on server side</a></h2>

    <div class="post-meta">

  <div>

    <time>25 Nov 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/hacks">Hacks</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong>SHOW</strong> statements are show stoppers on server side. While clients can get a <a href="http://dev.mysql.com/doc/refman/5.1/en/show.html">SHOW statement</a> as a result set just as any normal <strong>SELECT</strong>, things are not as such on server side.</p>
<p>On server side, that is, from within MySQL itself, one <em>cannot</em>:</p>
<blockquote>
<pre>SELECT <code>Database</code> FROM (SHOW DATABASES);</pre>
</blockquote>
<p>One <em>cannot</em>:</p>
<blockquote>
<pre>DECLARE show_cursor CURSOR FOR SHOW TABLES;</pre>
</blockquote>
<p>One <em>cannot</em>:</p>
<blockquote>
<pre>SHOW TABLES INTO OUTFILE &lsquo;/tmp/my_file.txt&rsquo;;</pre>
</blockquote>
<p>So it is impossible to get the results with a query; impossible to get the results from a stored routine; impossible to get the results by file reading&hellip;</p>
<h4>Bwahaha! A hack!</h4>
<p>For some <strong>SHOW</strong> statements, there is a way around this. I&rsquo;ve been banging my head against the wall for weeks now on this. Now I have a partial solution: I&rsquo;m able to read <strong>SHOW</strong> output for several <strong>SHOW</strong> statements. Namely, those <strong>SHOW</strong> statements <a href="http://dev.mysql.com/doc/refman/5.1/en/extended-show.html">which allow a LIKE or a WHERE</a> clause.</p>
<p>For example, most are familiar with the following syntax:</p>
<blockquote>
<pre>USE mysql;
SHOW TABLE STATUS LIKE &lsquo;user&rsquo;;</pre>
</blockquote>
<p>However not so many know that any <strong>SHOW</strong> statement which accepts <strong>LIKE</strong>, can also accept <strong>WHERE</strong>:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/reading-results-of-show-statements-on-server-side/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mysql-global-status-difference-using-single-query/">MySQL Global status difference using single query</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Aug 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Have just read <a href="http://karlssonondatabases.blogspot.com/2011/08/mysql-global-status-difference-using_12.html">MySQL Global status difference using MySQL procedures / functions</a>, by Andres Karlsson. Have commented, but realized I did not provide with a direct answer. In the comment, I suggested checking out <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/global_status_diff.html">a solution based on views</a>, found in <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>. But the solution in <em>common_schema</em> is split into two views, due to the fact views cannot handle derived tables subqueries.</p>
<p>Well, here&rsquo;s a single query to do that: it checks <strong>GLOBAL_STATUS</strong> twice, <strong>10</strong> seconds apart in the following sample. It uses <strong>SLEEP()</strong> to actually wait between the two reads. Yes, you can do that with a query.</p>
<p>The following query shows all <strong>GLOBAL_STATUS</strong> values that have changed during the sample period.</p>
<p><strong>[UPDATE]</strong> query updated to work with MySQL <strong>5.6</strong> optimizer</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-global-status-difference-using-single-query/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/announcing-common_schema-common-views-routines-for-mysql/">Announcing common_schema: common views &amp; routines for MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Jul 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-types">Data Types</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/schema">Schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Today I have released <a title="common_schema" href="http://code.openark.org/forge/common_schema">common_schema</a>, a utility schema for MySQL which includes many views and functions, and is aimed to be installed on any MySQL server.</p>
<h4>What does it do?</h4>
<p>There are views answering for all sorts of useful information: stuff related to schema analysis, data dimensions, monitoring, processes &amp; transactions, security, internals&hellip; There are basic functions answering for common needs.</p>
<p>Some of the views/routines simply formalize those queries we tend to write over and over again. Others take the place of external tools, answering complex questions via SQL and metadata. Still others help out with SQL generation.</p>
<p>Here are a few highlights:</p>
<ul>
<li>Did you know you can work out <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/global_status_diff_nonzero.html">simple monitoring</a> of your server with a <em>query</em>?  There&rsquo;s a view to do that for you.</li>
<li>How about showing just <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/processlist_top.html">the good parts of the processlist</a>?</li>
<li>Does your schema have <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/redundant_keys.html">redundant keys</a>?</li>
<li>Or InnoDB tables with <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/no_pk_innodb_tables.html">no PRIMARY KEY</a>?</li>
<li>Is AUTO_INCREMENT <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/auto_increment_columns.html">running out of space</a>?</li>
<li>Can I get the SQL statements to <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_foreign_keys.html">generate my FOREIGN KEYs</a>? To drop them?</li>
<li>And can we finally get <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">SHOW GRANTS for all accounts</a>, and as an <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">SQL query</a>?</li>
<li>Ever needed a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/general_functions.html#crc64">64 bit CRC function</a>?</li>
<li>And aren&rsquo;t you tired of writing the cumbersome SUBSTRING_INDEX(SUBSTRING_INDEX(str, &lsquo;,&rsquo;, 3), &lsquo;,&rsquo;, -1)? <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/string_functions.html#split_token">There&rsquo;s an alternative</a>.</li>
</ul>
<p>There&rsquo;s more. Take a look at the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/introduction.html">common_schema documentation</a> for full listing. And it&rsquo;s evolving: I&rsquo;ve got quite a few ideas already for future components.</p>
<p>Some of these views rely on heavyweight INFORMATION_SCHEMA tables. You should be aware of the impact and <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/risks.html">risks</a>.</p>
<h4>What do I need to install?</h4>
<p>There&rsquo;s no script or executable file. It&rsquo;s just a schema. The distribution in an SQL file which generates <em>common_schema</em>. Much like a dump file.</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/announcing-common_schema-common-views-routines-for-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/routine_privileges-implementation/">ROUTINE_PRIVILEGES implementation</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Jun 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/views">Views</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Following up on MySQL security: inconsistencies, and on MySQL bug #61596, I was thinking it may take a long time till the non-existent ROUTINE_PRIVILEGES view is implemented. Here's my own implementation of the view. I've followed the somewhat strange conventions used in the *_PRIVILEGES tables in INFORMATION_SCHEMA, where the IS_GRANTABLE is a separate column, although in 2nd 1st normal form. I present it here as a query, using session variables, rather than a view definition: SELECT STRAIGHT_JOIN CONCAT('\'', User, '\'@\'', Host, '\'') AS GRANTEE, NULL AS ROUTINE_CATALOG, Db AS ROUTINE_SCHEMA, Routine_name AS ROUTINE_NAME, Routine_type AS ROUTINE_TYPE, UPPER(SUBSTRING_INDEX(SUBSTRING_INDEX(Proc_priv, ',', n+1), ',', -1)) AS PRIVILEGE_TYPE, IF(grantable_procs_priv.User IS NULL, 'NO', 'YES') AS IS_GRANTABLE FROM mysql.procs_priv CROSS JOIN (SELECT @counter := -1) select_init CROSS JOIN ( SELECT @counter := @counter+1 AS n FROM INFORMATION_SCHEMA.COLLATIONS LIMIT 5 ) numbers LEFT JOIN ( SELECT DISTINCT User, Host, Db, Routine_name FROM mysql.procs_priv WHERE find_in_set('Grant', Proc_priv) &gt; 0 ) grantable_procs_priv USING (User, Host, Db, Routine_name) WHERE numbers.n BETWEEN 0 AND CHAR_LENGTH(Proc_priv) - CHAR_LENGTH(REPLACE(Proc_priv, ',', '')) AND UPPER(SUBSTRING_INDEX(SUBSTRING_INDEX(Proc_priv, ',', n+1), ',', -1)) != 'GRANT' ORDER BY GRANTEE, ROUTINE_SCHEMA, ROUTINE_NAME, ROUTINE_TYPE, n ; It takes 2 views and a table to make this a VIEW rather than a query.
  </p>

  
  <footer>
    <a href="/blog/mysql/routine_privileges-implementation/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mysql-security-inconsistencies/">MySQL security: inconsistencies</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Jun 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Doing some work with MySQL security, I&rsquo;ve noticed a few inconsistencies. They&rsquo;re mostly not-too-terrible for daily work, except they get in my way right now.</p>
<h4>The ALL PRIVILEGES inconsistency</h4>
<p>The preferred way of assigning account privileges in MySQL is by way of using <a href="http://dev.mysql.com/doc/refman/5.1/en/grant.html">GRANT</a>.</p>
<p>With <strong>GRANT</strong>, one assigns one or more privileges to an account, such as <strong>SELECT</strong>, <strong>UPDATE</strong>, <strong>ALTER</strong>, <strong>SUPER</strong> ,etc. Sometimes it makes sense for an account to have complete control over a domain. For example, the <strong>root</strong> account is typically assigned with all privileges. Or, some user may require all possible privileges on a certain schema.</p>
<p>Instead of listing the entire set of privileges, the <strong>ALL PRIVILEGES</strong> meta-privilege can be used. There is a fine issue to notice here; typically this is not a problem, but I see it as a flaw. Assume the following account:</p>
<blockquote>
<pre>root@mysql-5.1.51&gt; GRANT <strong>ALL PRIVILEGES</strong> ON world.* TO &lsquo;world_user&rsquo;@&lsquo;localhost&rsquo;;</p>

<p>root@mysql-5.1.51&gt; SHOW GRANTS FOR &lsquo;world_user&rsquo;@&lsquo;localhost&rsquo;;
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| Grants for world_user@localhost                               |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| GRANT USAGE ON <em>.</em> TO &lsquo;world_user&rsquo;@&lsquo;localhost&rsquo;                |
| GRANT <strong>ALL PRIVILEGES</strong> ON <code>world</code>.* TO &lsquo;world_user&rsquo;@&lsquo;localhost&rsquo; |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</pre>
</blockquote>
<p>This makes sense. We granted <strong>ALL PRIVILEGES</strong> and we see that the account is granted with <strong>ALL PRIVILEGES</strong>.</p>
<p>Now notice the following:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-security-inconsistencies/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/checking-for-auto_increment-capacity-with-single-query/">Checking for AUTO_INCREMENT capacity with single query</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Apr 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><em>Darn!</em> This means <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-show-limits.html">oak-show-limits</a> becomes redundant. Am I not supposed to speak about it on my <a href="http://en.oreilly.com/mysql2011/public/schedule/detail/17155">coming presentation</a>? Bad timing!</p>
<p>You have <strong>AUTO_INCREMENT</strong> columns. How far are you pushing the limits? Are you going to run out of <strong>AUTO_INCREMENT</strong> values soon? Perhaps you wonder whether you should <strong>ALTER</strong> from <strong>INT</strong> to <strong>BIGINT</strong>?</p>
<p>The answer is all there in <strong>INFORMATION_SCHEMA</strong>. The <strong>TABLES</strong> table shows the current <strong>AUTO_INCREMENT</strong> value per table, and the <strong>COLUMNS</strong> table tells us all about a column&rsquo;s data type.</p>
<p>It takes some ugly code to deduce the maximum value per column type, what with signed/unsigned and data type, but then its very simple. Here is the query:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/checking-for-auto_increment-capacity-with-single-query/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/thoughts-and-ideas-for-online-schema-change/">Thoughts and ideas for Online Schema Change</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Oct 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/schema">Schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Here&rsquo;s a few thoughts on current status and further possibilities for Facebook&rsquo;s <a href="http://www.facebook.com/note.php?note_id=430801045932">Online Schema Change</a> (OSC) tool. I&rsquo;ve had these thoughts for months now, pondering over improving <a href="../../forge/openark-kit/oak-online-alter-table">oak-online-alter-table</a> but haven&rsquo;t got around to implement them nor even write them down. Better late than never.</p>
<p>The tool has some limitations. Some cannot be lifted, some could. Quoting from the <a href="http://www.facebook.com/notes/mysql-at-facebook/online-schema-change-for-mysql/430801045932">announcement</a> and looking at the code, I add a few comments. I conclude with a general opinion on the tool&rsquo;s abilities.</p>
<h4>&ldquo;The original table must have PK. Otherwise an error is returned.&rdquo;</h4>
<p>This restriction could be lifted: it&rsquo;s enough that the table has a UNIQUE KEY. My original <em>oak-online-alter-table</em> handled that particular case. As far as I see from their code, the Facebook code would work just as well with any unique key.</p>
<p>However, this restriction is of no real interest. As we&rsquo;re mostly interested in InnoDB tables, and since any InnoDB table <em>should have</em> a PRIMARY KEY, we shouldn&rsquo;t care too much.</p>
<h4>&ldquo;No foreign keys should exist. Otherwise an error is returned.&rdquo;</h4>
<p>Tricky stuff. With <em>oak-online-alter-table</em>, changes to the original table were immediately reflected in the <em>ghost</em> table. With InnoDB tables, that meant same transaction. And although I never got to update the text and code, there shouldn&rsquo;t be a reason for not using child-side foreign keys (the child-side is the table on which the FK constraint is defined).</p>
<p>The Facebook patch works differently: it captures changes and writes them to a <strong>delta</strong> table,  to be later (asynchronously) analyzed and make for a <em>replay</em> of actions on the <em>ghost</em> table.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/thoughts-and-ideas-for-online-schema-change/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/verifying-group_concat-limit-without-using-variables/">Verifying GROUP_CONCAT limit without using variables</a></h2>

    <div class="post-meta">

  <div>

    <time>10 Jun 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I have a case where I must know if <strong>group_concat_max_len</strong> is at its default value (<strong>1024</strong>), which means there are some operation I cannot work out. I&rsquo;ve ranted on this <a href="http://code.openark.org/blog/mysql/those-oversized-undersized-variables-defaults">here</a>.</p>
<p>Normally, I would simply:</p>
<blockquote><pre>
SELECT @@group_concat_max_len
</pre></blockquote>
<p>However, I am using views, where session variables are not allowed. Using a stored function can <a href="http://code.openark.org/blog/mysql/views-better-performance-with-condition-pushdown">do the trick</a>, but I wanted to avoid stored routines. So here&rsquo;s a very simple test case: is the current <strong>group_concat_max_len</strong> long enough or not? I&rsquo;ll present the long version and the short version.</p>
<h4>The long version</h4>
<blockquote><pre>
SELECT
  CHAR_LENGTH(
    GROUP_CONCAT(
      COLLATION_NAME SEPARATOR &ldquo;
    )
  )
FROM
  INFORMATION_SCHEMA.COLLATIONS;
</pre></blockquote>
<p>If the result is <strong>1024</strong>, we are in a bad shape. I happen to know that the total length of collation names is above <strong>1800</strong>, and so it is trimmed down. Another variance of the above query would be:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/verifying-group_concat-limit-without-using-variables/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/how-to-calculate-a-good-innodb-log-file-size-recap/">How to calculate a good InnoDB log file size - recap</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Oct 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Following Baron Schwartz&rsquo; post: <a href="http://www.mysqlperformanceblog.com/2008/11/21/how-to-calculate-a-good-innodb-log-file-size/">How to calculate a good InnoDB log file size</a>, which shows how to make an estimate for the InnoDB log file size, and based on <a href="http://code.openark.org/blog/mysql/sql-querying-for-status-difference-over-time">SQL: querying for status difference over time</a>, I&rsquo;ve written a query to run on MySQL 5.1, which, upon sampling 60 seconds of status, estimates the InnoDB transaction log bytes that are expected to be written in the period of 1 hour.</p>
<p><em>Recap</em>: this information can be useful if you&rsquo;re looking for a good <strong>innodb_log_file_size</strong> value, such that will not pose too much I/O (smaller values will make for more frequent flushes), not will make for a too long recovery time (larger values mean more transactions to recover upon crash).</p>
<p>It is assumed that the 60 seconds period represents an average system load, not some activity spike period. Edit the sleep time and factors as you will to sample longer or shorter periods.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/how-to-calculate-a-good-innodb-log-file-size-recap/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/sql-querying-for-status-difference-over-time/">SQL: querying for status difference over time</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Oct 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The InnoDB plugin has a nice <strong>INFORMATION_SCHEMA</strong> concept: resetting tables. For example, the <strong>INNODB_CMP</strong> table lists information about compression operation. A similar table, <strong>INNODB_CMP_RESET</strong>, provides the same information, but resets the values. The latter can be used to measure, for example, number of compression operations over time.</p>
<p>I wish to present a SQL trick which does the same, without need for resetting tables. Suppose you have some status table, and you wish to measure the change in status per second, per minute etc. The trick is to query for the value twice in the same query, with some pause in between, and make the difference calculation.</p>
<p>For sake of simplicity, I&rsquo;ll demonstrate using 5.1&rsquo;s <strong>INFORMATION_SCHEMA.GLOBAL_STATUS</strong>. Please refer to <a href="http://code.openark.org/blog/mysql/information_schema-global_status-watch-out">INFORMATION_SCHEMA.GLOBAL_STATUS: watch out</a> for some discussion on this.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-querying-for-status-difference-over-time/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/information_schema-global_status-watch-out/">INFORMATION_SCHEMA.GLOBAL_STATUS: watch out</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Oct 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>MySQL 5.1 boasts some new and useful <strong>INFORMATION_SCHEMA</strong> tables. Among them is the <strong>GLOBAL_STATUS </strong>table.</p>
<p>At last, it is possible to ask questions like:</p>
<blockquote>
<pre>node1&gt; SELECT * FROM INFORMATION_SCHEMA.GLOBAL_STATUS WHERE VARIABLE_NAME = &lsquo;innodb_os_log_written&rsquo;;
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;&mdash;-+
| VARIABLE_NAME         | VARIABLE_VALUE |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;&mdash;-+
| INNODB_OS_LOG_WRITTEN | 512            |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;&mdash;-+
1 row in set (0.00 sec)</p>

<p>node1&gt; SELECT * FROM INFORMATION_SCHEMA.GLOBAL_STATUS WHERE VARIABLE_NAME = &lsquo;questions&rsquo;;
+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;-+
| VARIABLE_NAME | VARIABLE_VALUE |
+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;-+
| QUESTIONS     | 28             |
+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;-+
1 row in set (0.00 sec)</pre>
</blockquote>
<h4>Watch out #1</h4>
<p>As with all <strong>INFORMATION_SCHEMA</strong> tables, to get a single row one needs to materialize the entire table. To ask the above two questions, the table will materialize twice. This means gathering all the information &ndash; twice. To get 20 values, we materialize the table 20 times. It not only takes time, but also increases some of the status variables themselves, like <strong>questions</strong>, <strong>select_scan</strong>, <strong>created_tmp_tables</strong>. Ironically, when we used <strong>SHOW GLOBAL STATUS</strong> and had to parse the results in our application code, we only issued the query once. But with the convenience of <strong>INFORMATION_SCHEMA</strong>, it&rsquo;s much easier (and makes more sense!) to query per variable.</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/information_schema-global_status-watch-out/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/useful-database-analysis-queries-with-information_schema/">Useful database analysis queries with INFORMATION_SCHEMA</a></h2>

    <div class="post-meta">

  <div>

    <time>26 Nov 2008</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A set of useful queries on INFORMATION_SCHEMA follows. These queries can be used when approaching a new database, to learn about some of its properties, or they can be regularly used on an existing schema, so as to verify its integrity.</p>
<p>I will present queries for:</p>
<ul>
<li>Checking on database engines and size</li>
<li>Locating duplicate and redundant indexes</li>
<li>Checking on character sets for columns and tables, looking for variances</li>
<li>Checking on processes and long queries (only with MySQL 5.1)</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/useful-database-analysis-queries-with-information_schema/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
</div>

</div>
</div>
<script src="/blog/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>
