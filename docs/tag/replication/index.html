<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>Replication &middot; code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="code.openark.org" href="/blog/tag/replication/index.xml" />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blog/img/favicon.ico" type="image/x-icon" />


  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
      <li class="pure-menu-item">
        <a class="pure-menu-link" href="/blog/tag/replication/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    <li class="pure-menu-item">
      <a class="pure-menu-link avatar">
        
          <div class="avatar-container">
            <div class="avatar-img-border">
              <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
            </div>
          </div>
        
        Shlomi Noach
      </a>
    </li>

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Replication</h1>
</div>

<div class="content">
  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/three-wishes-for-a-new-year-4">Three wishes for a new year</a></h2>

    <div class="post-meta">

  <div>

    <time>28 Sep 2016</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/gh-ost">gh-ost</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/gtid">GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/operations">operations</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  (Almost) another new year by Jewish calendar. What do I wish for the following year? World peace Good health to all Relaxed GTID constraints I'm still not using GTID, and still see operational issues with working with GTID. As a latest example, our new schema migration solution, gh-ost, allows us to test migrations in production, on replicas. The GTID catch? gh-ost&nbsp;has to write something to the binary log. Thus, it "corrupts" the replica with a bogus GTID entry that will never be met in another server, thus making said replica unsafe to promote.
  </p>

  
  <footer>
    <a href="/blog/mysql/three-wishes-for-a-new-year-4">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/state-of-automated-recovery-via-pseudo-gtid-orchestrator-booking-com/">State of automated recovery via Pseudo-GTID &amp; Orchestrator @ Booking.com</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Nov 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/failover">Failover</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/high-availability">High availability</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post sums up some of my work on MySQL resilience and high availability at <a href="http://www.booking.com">Booking.com</a> by presenting the current state of automated master and intermediate master recoveries via <a href="http://code.openark.org/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo-GTID</a> &amp; <strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong>.</p>
<p>Booking.com uses many different MySQL topologies, of varying vendors, configurations and workloads: Oracle MySQL, MariaDB, statement based replication, row based replication, hybrid, OLTP, OLAP, GTID (few), no GTID (most), Binlog Servers, filters, hybrid of all the above.</p>
<p>Topologies size varies from a single server to many-many-many. Our typical topology has a master in one datacenter, a bunch of slaves in same DC, a slave in another DC acting as an intermediate master to further bunch of slaves in the other DC. Something like this, give or take:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2015/11/booking-topology-sample.png"><img class="alignnone wp-image-7480 size-medium" src="/blog/assets/booking-topology-sample-300x169.png" alt="booking-topology-sample" width="300" height="169" /></a></blockquote>
<p>However as we are building our third data center (with MySQL deployments mostly completed) the graph turns more complex.</p>
<p>Two high availability questions are:</p>
<ul>
<li>What happens when an intermediate master dies? What of all its slaves?</li>
<li>What happens when the master dies? What of the entire topology?</li>
</ul>
<p>This is not a technical drill down into the solution, but rather on overview of the state. For more, please refer to recent presentations in <a href="https://speakerdeck.com/shlominoach/managing-and-visualizing-your-replication-topologies-with-orchestrator">September</a> and <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">April</a>.</p>
<p>At this time we have:</p>
<ul>
<li>Pseudo-GTID deployed on all chains
<ul>
<li>Injected every 5 seconds</li>
<li>Using the <a href="http://code.openark.org/blog/mysql/pseudo-gtid-ascending">monotonically ascending</a> variation</li>
</ul>
</li>
<li>Pseudo-GTID based automated failover for intermediate masters on all chains</li>
<li>Pseudo-GTID based automated failover for masters on roughly 30% of the chains.
<ul>
<li>The rest of 70% of chains are set for manual failover using Pseudo-GTID.</li>
</ul>
</li>
</ul>
<p>Pseudo-GTID is in particular used for:</p>
<ul>
<li>Salvaging slaves of a dead intermediate master</li>
<li>Correctly grouping and connecting slaves of a dead master</li>
<li>Routine refactoring of topologies. This includes:
<ul>
<li>Manual repointing of slaves for various operations (e.g. offloading slaves from a busy box)</li>
<li>Automated refactoring (for example, used by our automated upgrading script, which consults with <em>orchestrator</em>, upgrades, shuffles slaves around, updates intermediate master, suffles back&hellip;)</li>
</ul>
</li>
<li>(In the works), failing over binlog reader apps that audit our binary logs.</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/state-of-automated-recovery-via-pseudo-gtid-orchestrator-booking-com/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-pseudo-gtid-for-binlog-reader-failover/">Orchestrator &amp; Pseudo-GTID for binlog reader failover</a></h2>

    <div class="post-meta">

  <div>

    <time>19 Nov 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/failover">Failover</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>One of our internal apps at <strong>Booking.com</strong> audits changes to our tables on various clusters. We used to use <em>tungsten replicator</em>, but have since migrated onto our own solution.</p>
<p>We have a binlog reader (uses <a href="https://github.com/zendesk/open-replicator">open-replicator</a>) running on a slave. It expects Row Based Replication, hence our slave runs with <strong>log-slave-updates</strong>, <strong>binlog-format=&lsquo;ROW&rsquo;</strong>, to translate from the master&rsquo;s Statement Based Replication. The binlog reader reads what it needs to read, audits what it needs to audit, and we&rsquo;re happy.</p>
<h3>However what happens if that slave dies?</h3>
<p>In such case we need to be able to point our binlog reader to another slave, and it needs to be able to pick up auditing from the same point.</p>
<p>This sounds an awful lot like slave repointing in case of master/intermediate master failure, and indeed the solutions are similar. However our binlog reader is not a real MySQL server and does not understands replication. It does not really replicate, it just parses binary logs.</p>
<p>We&rsquo;re also not using GTID. But we <em>are</em> using Pseudo-GTID. As it turns out, the failover solution is already built in by <a href="https://github.com/outbrain/orchestrator">orchestrator</a>, and this is how it goes:</p>
<h3>Normal execution</h3>
<p>Our binlog app reads entries from the binary log. Some are of interest for auditing purposes, some are not. An occasional Pseudo-GTID entry is found, and is being stored to ZooKeeper tagged as  &rdquo;last seen and processed Pseudo-GTID&rdquo;.</p>
<h3>Upon slave failure</h3>
<p>We recognize the death of a slave; we have other slaves in the pool; we pick another. Now we need to find the coordinates from which to carry on.</p>
<p>We read our &ldquo;last seen and processed Pseudo-GTID&rdquo;. Say it reads:</p>
<blockquote>
<pre>drop view if exists <code>meta</code>.<code>_pseudo_gtid_hint__asc:56373F17:00000000012B1C8B:50EC77A1</code></pre>
</blockquote>
<p>. We now issue:</p>
<blockquote>
<pre>$ orchestrator <strong>-c find-binlog-entry</strong> <strong>-i new.slave.fqdn.com</strong> &ndash;pattern=&lsquo;drop view if exists <code>meta</code>.<code>_pseudo_gtid_hint__asc:56373F17:00000000012B1C8B:50EC77A1</code>&lsquo;</pre>
</blockquote>
<p>The output of such command are the binlog coordinates of that same entry as found in the new slave&rsquo;s binlogs:</p>
<blockquote>
<pre>binlog.000148:43664433</pre>
</blockquote>
<p>Pseudo-GTID entries are only injected once every few seconds (<strong>5</strong> in our case). Either:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-pseudo-gtid-for-binlog-reader-failover/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/new-features-id-like-to-see-in-mysql-5-8/">New features I&#39;d like to see in MySQL 5.8</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Oct 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/operations">operations</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Following up on Morgan Tocker's What would you like to see in MySQL 5.8?, having attended and participated at the brainstorming at Percona Live Amsterdam, and publishing this post while failing to comply with any of Morgan's suggested media, these are the features I would like to see in MySQL 5.8: Dynamicly enable/disable log-bin and log-slave-updates Today, when changing chef/puppet role of a server from a simple slave to an intermediate master and vice versa, a MySQL restart is required.
  </p>

  
  <footer>
    <a href="/blog/mysql/new-features-id-like-to-see-in-mysql-5-8/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-visual-cheatsheet-tldr-the-smart-way/">Orchestrator visual cheatsheet, TL;DR the &#34;smart&#34; way</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Sep 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong> is <em>really</em> growing. And the amount of users (DBAs, sys admins) using it is growing. Which gives me a lot of immediate feedback in the form of <em>&ldquo;Look, there&rsquo;s just too many options to move slaves around! Which ones should we use?&rdquo;</em></p>
<h3>TL;DR look at the two visualized commands below</h3>
<p>They are enough</p>
<h3>The &ldquo;smart&rdquo; commands to end all commands</h3>
<p>So all relocation commands are important, and give you fine-grained, pin-pointed control of the method of topology refactoring. However, most of the time you <em>just want to move those servers around</em>. Which is why there&rsquo;s a new &ldquo;smart&rdquo; mode which support these two commands, which you should be happy using:</p>
<ul>
<li><strong>relocate</strong>: move a single slave to another position</li>
<li><strong>relocate-slaves</strong>: move all/some slaves of some server to another position.</li>
</ul>
<p>What makes these commands Smart? You can move slaves around from <em>anywhere</em> to <em>anywhere</em>. And <em>orchestrator</em> figures out the bast execution path. If possible, it uses GTID. Not possible? Is Pseudo-GTID available? Great, using Pseudo-GTID. Oh, are there binlog servers involved? Really simple, use them. None of the above? <em>Orchestrator</em> will use &ldquo;standard&rdquo; binlog file:pos math (with limitations). <em>Orchestrator</em> will even figure out if multiple steps are necessary and will combine any of the above.</p>
<p>So you don&rsquo;t have to remember all the possible ways and options. The visual cheatsheet now boils down to these two:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2015/08/orchestrator-cheatsheet-visualized-relocate.png"><img class="alignnone size-full wp-image-7357" src="/blog/assets/orchestrator-cheatsheet-visualized-relocate.png" alt="orchestrator-cheatsheet-visualized-relocate" width="720" height="405" /></a></p>
<p><a href="http://code.openark.org/blog/wp-content/uploads/2015/08/orchestrator-cheatsheet-visualized-relocate-slaves.png"><img class="alignnone size-full wp-image-7350" src="/blog/assets/orchestrator-cheatsheet-visualized-relocate-slaves.png" alt="orchestrator-cheatsheet-visualized-relocate-slaves" width="720" height="405" /></a></blockquote>
<p>Let&rsquo;s take a slightly deeper look</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-visual-cheatsheet-tldr-the-smart-way/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-1-4-340-gtid-binlog-servers-smart-mode-failovers-and-lots-of-goodies/">Orchestrator 1.4.340: GTID, binlog servers, Smart Mode, failovers and lots of goodies</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Sep 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://github.com/outbrain/orchestrator/releases"><strong>Orchestrator</strong> 1.4.340 is released</a>. Not quite competing with the MySQL latest changelog, and as I haven&rsquo;t blogged about <em>orchestrator</em> featureset in a while, this is a quick listing of <em>orchestrator</em> features available since my last publication:</p>
<ul>
<li>Supports <strong>GTID</strong> (Oracle &amp; MariaDB)
<ul>
<li>GTID still not being used in automated recovery &ndash; in progress.</li>
<li><strong>enable-gtid</strong>, <strong>disable-gtid</strong>, <strong>skip-query</strong> for GTID commands</li>
</ul>
</li>
<li>Supports <strong>binlog servers</strong> (MaxScale)
<ul>
<li>Discovery &amp; operations on binlog servers</li>
<li>Understanding slave repositioning in a binlog-server architecture</li>
</ul>
</li>
<li><strong>Smart mode</strong>: relocate &amp; relocate-below commands (or Web/GUI drag-n-drop) let <em>orchestrator</em> figure out the best way of slave repositioning. <em>Orchestrator</em> picks from GTID, Pseudo GTID, binlog servers, binlog file:pos math (and more) options, or combinations of the above. Fine grained commands still there, but mostly you won&rsquo;t need them.</li>
<li><strong>Crash recoveries</strong> (did you know <em>orchestrator</em> does that?):
<ul>
<li>For intermediate master recovery: improved logic in picking the best recovery plan (prefer in-DC, prefer promoting local slave, supporting binlog server topologies, &hellip;)</li>
<li>For master recovery: even better slave promotion; supports <em>candidate slaves </em>(prefer promoting such slaves); supports binlog server shared topologies</li>
<li>Better auditing and logging of recovery cases</li>
<li>Better analysis of crash scenarios, also in the event of lost VIPs, hanging connections; emergent checks in crash suspected scenarios</li>
<li>recover-lite: do all topology-only recovery steps, without invoking external processes</li>
</ul>
</li>
<li><strong>Better browser support</strong>: used to only work on Firefox and Chrome (and the latter has had issues), the Web UI should now work well on all browsers, at the cost of reduced <strong>d3</strong> animation. More work still in progress.</li>
<li><strong>Faster</strong>, more parallel, less blocking operations on all counts; removed a lots of serialized code; less locks.</li>
<li><strong>Web enhancements</strong>
<ul>
<li>More verbose drag-n-drop (operation hint; color hints)</li>
<li>Drag-n-drop for <em>slaves-of-a-server</em></li>
<li>Replication/crash analysis dashboard</li>
</ul>
</li>
<li><strong>Pools</strong>: <em>orchestrator</em> can be <em>told</em> about instance-to-pool association (<strong>submit-pool-instances</strong> command)
<ul>
<li>And can then present pool status (web)</li>
<li>Or pool hints within topologies (web)</li>
<li>Or queried for all pools (<strong>cluster-pool-instances</strong> command)</li>
</ul>
</li>
<li>Other:
<ul>
<li>Supports MySQL <strong>5.7</strong> (tested with <strong>5.7.8</strong>)</li>
<li>Configurable graphite path for metrics</li>
<li><strong>&ndash;noop</strong> flag; does all the work except for actually changing master on slaves. Shows intentions.</li>
<li>Web (or cli <strong>which-cluster-osc-slaves</strong> command) provide list of control slaves to use in <strong>pt-osc</strong> operation</li>
<li><strong>hostname-unresolve</strong>: force <em>orchestrator</em> to unresolve a fqdn into VIP/CNAME/&hellip; when issuing a CHANGE MASTER TO</li>
</ul>
</li>
<li>3rd party contributions (hey, thanks!) include:
<ul>
<li>More &amp; better SSL support</li>
<li>Vagrant templates</li>
</ul>
</li>
<li>For developers:
<ul>
<li><em>Orchestrator</em> now go-gettable. Just <strong>go get github.com/outbrain/orchestrator</strong></li>
<li>Improved build script; supports more architectures</li>
</ul>
</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-4-340-gtid-binlog-servers-smart-mode-failovers-and-lots-of-goodies/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/on-show-binlogrelaylog-events/">On SHOW BINLOG/RELAYLOG EVENTS</a></h2>

    <div class="post-meta">

  <div>

    <time>04 Aug 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Some notes after working with <a href="https://dev.mysql.com/doc/refman/5.6/en/show-binlog-events.html">SHOW BINLOG EVENTS</a> and <a href="https://dev.mysql.com/doc/refman/5.6/en/show-relaylog-events.html">SHOW RELAYLOG EVENTS</a> statements; there are a few gotchas and some interesting facts. My reflections also follow.</p>
<p>I&rsquo;m calling these commands from <a href="https://github.com/outbrain/orchestrator">orchestrator</a> when working with <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">Pseudo-GTID</a> (which I do <em>alot</em>). I prefer to work with agent-free design, where a single, remote service can do everything: examine replication status, scan binary logs for information, and recover broken topologies via gluing together servers that were not previously directly associated.</p>
<p>Alas, documentation is short on these commands, and some stuff I learned the hard way.</p>
<p>Basically, <strong>SHOW BINLOG/RELAYLOG EVENTS</strong> commands are a poor man&rsquo;s replacement to <strong>mysqlbinlog</strong>, only you can issue them on MySQL protocol, and you do not have to have the binary/relay log files locally on your host.</p>
<h3>Fun fact</h3>
<p>The binary logs are called so because they are compressed. You are familiar with the binlog position you see on <strong>SHOW MASTER STATUS</strong> or <strong>SHOW SLAVE STATUS</strong>. You are familiar with the binlog position as you see it when you execute <strong>&ldquo;mysqlbinlog mybinlog.001234&rdquo;</strong>. The position of a new entry equals to the file size of the binary log at that time. If:</p>
<blockquote>
<pre>$ ls -l master/data/mysql-bin.015901
-rw-rw&mdash;- 1 user user 401408 Jul 18 02:44 master/data/mysql-bin.015901</pre>
</blockquote>
<p>Then the next entry will be at position <strong>401408</strong>, as this is the file size in bytes.</p>
<p>And so when MySQL writes an entry to the binary log, it (of course) knows the entry&rsquo;s position in the binary log, but then also immediately knows the position of the next entry.</p>
<p>We&rsquo;ll revisit this fact later.</p>
<h3>Output of SHOW BINLOG/RELAYLOG EVENTS</h3>
<p>The output of both statement depends on the <strong>binlog_format</strong>. In Statement Based Replication it may look like:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/on-show-binlogrelaylog-events/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/pseudo-gtid-ascending/">Pseudo GTID, ASCENDING</a></h2>

    <div class="post-meta">

  <div>

    <time>29 Jul 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Pseudo GTID is a technique where we inject Globally Unique entries into MySQL, gaining GTID abilities without using GTID. It is supported by <strong><a href="https://github.com/outbrain/orchestrator">orchestrator</a></strong> and described in more detail <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">here</a>, <a href="http://code.openark.org/blog/tag/pseudo-gtid">here</a> and <a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual#pseudo-gtid">here</a>.</p>
<p>Quick recap: we can join two slaves to replicate from one another even if they never were in parent-child relationship, based on our uniquely identifiable entries which can be found in the slaves&rsquo; binary logs or relay logs. Having Pseudo-GTID injected and controlled by us allows us to optimize failovers into quick operations, especially where a large number of server is involved.</p>
<p><strong>Ascending Pseudo-GTID</strong> further speeds up this process for delayed/lagging slaves.</p>
<h3>Recap, visualized</h3>
<p>(but do look at the <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">presentation</a>):</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2015/07/pseudo-gtid-quick1.png"><img class="alignnone size-full wp-image-7303" src="/blog/assets/pseudo-gtid-quick1.png" alt="pseudo-gtid-quick" width="636" height="366" /></a></p>
<ol>
<li>Find last pseudo GTID in slave’s binary log (or last applied one in relay log)</li>
<li>Search for exact match on new master’s binary logs</li>
<li>Fast forward both through successive identical statements until end of slave’s applied entries is reached</li>
<li>Point slave into cursor position on master</li>
</ol>
</blockquote>
<p>What happens if the slave we wish to reconnect is lagging? Or perhaps it is a delayed replica, set to run <strong>24</strong> hours behind its master?</p>
<p>The naive approach would expand bullet <strong>#2</strong> into:</p>
<ul>
<li>Search for exact match on master’s last binary logs</li>
<li>Unfound? Move on to previous (older) binary log on master</li>
<li>Repeat</li>
</ul>
<p>The last Pseudo-GTID executed by the slave was issued by the master over <strong>24</strong> hours ago. Suppose the master generates one binary log per hour. This means we would need to full-scan <strong>24</strong> binary logs of the master where the entry will not be found; to only be matched in the <strong>25th</strong> binary log (it&rsquo;s an off-by-one problem, don&rsquo;t hold the exact number against me).</p>
<h3>Ascending Pseudo GTID</h3>
<p>Since we control the generation of Pseudo-GTID, and since we control the search for Pseudo-GTID, we are free to choose the form of Pseudo-GTID entries. We recently switched into using Ascending Pseudo-GTID entries, and this works like a charm. Consider these Pseudo-GTID entries:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/pseudo-gtid-ascending/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/what-makes-a-mysql-server-failurerecovery-case/">What makes a MySQL server failure/recovery case?</a></h2>

    <div class="post-meta">

  <div>

    <time>25 Jul 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/failover">Failover</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Or: How do you reach the conclusion your MySQL master/intermediate-master is dead and must be recovered?</p>
<p>This is an attempt at making a holistic diagnosis of our replication topologies. The aim is to cover obvious and not-so-obvious crash scenarios, and to be able to act accordingly and heal the topology.</p>
<p>At <strong>Booking.com</strong> we are dealing with very large amounts of MySQL servers. We have many topologies, and many servers in each topology. <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">See past numbers</a> to get a feel for it. At these numbers failures happen frequently. Typically we would see normal slaves failing, but occasionally &ndash; and far more frequently than we would like to be paged for &ndash; an intermediate master or a master would crash. But our current (and ever in transition) setup also include SANs, DNS records, VIPs, any of which can fail and bring down our topologies.</p>
<p>Tackling issues of monitoring, disaster analysis and recovery processes, I feel safe to claim the following statements:</p>
<ul>
<li>The fact your monitoring tool cannot access your database does not mean your database has failed.</li>
<li>The fact your monitoring tool can access your database does not mean your database is available.</li>
<li>The fact your database master is unwell does not mean you should fail over.</li>
<li>The fact your database master is alive and well does not mean you should not fail over.</li>
</ul>
<p>Bummer. Let&rsquo;s review a simplified topology with a few failure scenarios. Some of these scenarios you will find familiar. Some others may be caused by setups you&rsquo;re not using. I would love to say <em>I&rsquo;ve seen it all</em> but the more I see the more I know how strange things can become.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/what-makes-a-mysql-server-failurerecovery-case/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-visual-cheatsheet/">Orchestrator visual cheatsheet</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Jun 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong> is growing. Supporting automatic detection of topologies, simple refactoring of topology trees, complex refactoring via Pseudo-GTID, failure detection and automated discovery, it is becoming larger and larger by the day.</p>
<p>One of the problems with growign projects is hwo to properly document them. Orchestrator enjoys <a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">a comprehensive manual</a>, but as these get more and more detailed, it is becoming difficult to get oriented and pointed in the right direction. I&rsquo;ve done my best to advise the simple use cases throughout the manual.</p>
<p>One thing that is difficult to put into words is topologies. Explaining &ldquo;failover of an intermediate master S1 that has S2,&hellip;,Sn slaves onto a sibling of S1 provided that&hellip;&rdquo; is too verbose. So here&rsquo;s a quick visual cheatsheet for (current) topology refactoring commands. Refactoring commands are a mere subset of overall orchestrator commands, but they&rsquo;re great to play with and perfect for visualization.</p>
<p>The &ldquo;move&rdquo; and related commands use normal replication commands (STOP SLAVE; CHANGE MASTER TO; START SLAVE UNTIL;&ldquo;&hellip;).</p>
<p>The &ldquo;match&rdquo; and related commands utilize Pseudo-GTID and use more elaborate MySQL commands (SHOW BINLOG EVENTS, SHOW RELAYLOG EVENTS).</p>
<p>So without further ado, here&rsquo;s what each command does (and do run &ldquo;orchestrator&rdquo; from the command line to get a man-like explanation of everything, or just <a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual#executing-via-command-line">go to the manual</a>).</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-visual-cheatsheet/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/speaking-at-percona-live-pseudo-gtid-and-easy-replication-topology-management/">Speaking at Percona Live: Pseudo GTID and Easy Replication Topology Management</a></h2>

    <div class="post-meta">

  <div>

    <time>31 Mar 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/secondary">secondary</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In two weeks time I will be presenting <a href="https://www.percona.com/live/mysql-conference-2015/sessions/pseudo-gtid-and-easy-replication-management">Pseudo GTID and Easy Replication Topology Management</a> at Percona Live. From the time I submitted the proposal a LOT has been developed, experimented, deployed and used with both <a href="http://code.openark.org/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a> and with <a href="https://github.com/outbrain/orchestrator">orchestrator</a>. In my talk I will:</p>
<ul>
<li>Suggest that you skip the &ldquo;to GTID or not to GTID&rdquo; question and go for the lightweight Pseudo GTID</li>
<li>Show how Pseudo GTID is used in production to recover from various replication failures and server crashes</li>
<li>Do an outrageous demonstration</li>
<li>Tell you about 50,000 successful experiments and tests done in production</li>
<li>Show off orchestrator and its support for Pseudo GTID, including automated crash analysis and recovery mechanism.</li>
</ul>
<p>I will further show how the orchestrator tooling makes for a less restrictive, more performant, less locking, non-intrusive, trusted and lightweight replication topology management solution.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-at-percona-live-pseudo-gtid-and-easy-replication-topology-management/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/speaking-at-fosdem-pseudo-gtid-and-easy-replication-management/">Speaking at FOSDEM: Pseudo GTID and easy replication management</a></h2>

    <div class="post-meta">

  <div>

    <time>29 Jan 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  This coming Sunday I'll be presenting Pseudo GTID and easy replication management at FOSDEM, Brussels. There's been a lot of development on Pseudo GTID these last few weeks. In this talk I'll show you how you can use Pseudo GTID instead of "normal" GTID to easily repoint your slaves, recover from intermediate master failure, promote slaves to masters as well as emply crash safe replication without crash safe replication. Moreover, I will show how you can achieve all the above with less constraints than GTID, and for bulk operations -- with less overhead and in shorter time.
  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-at-fosdem-pseudo-gtid-and-easy-replication-management/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/reading-rbr-binary-logs-with-pt-query-digest/">Reading RBR binary logs with pt-query-digest</a></h2>

    <div class="post-meta">

  <div>

    <time>26 Jan 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/percona-toolkit">Percona Toolkit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>For purposes of auditing anything that goes on our servers we&rsquo;re looking to parse the binary logs of all servers (masters), as with &ldquo;<a href="http://code.openark.org/blog/mysql/anemomaster-dml-visibility-your-must-do-for-tomorrow">Anemomaster</a>&rdquo;. With Row Based Replication this is problematic since <strong>pt-query-digest</strong> <a href="https://bugs.launchpad.net/percona-toolkit/+bug/1377887">does not support parsing RBR binary logs</a> (true for <strong>2.2.12</strong>, latest at this time).</p>
<p>I&rsquo;ve written a simple script that translates RBR logs to SBR-like logs, with a little bit of cheating. My interest is that <strong>pt-query-digest</strong> is able to capture and count the queries, nothing else. By doing some minimal text manipulation on the binary log I&rsquo;m able to now feed it to <strong>pt-query-digest</strong> which seems to be happy.</p>
<p>The script of course does not parse the binary log directly; furthermore, it requires the binary log to be extracted via:</p>
<blockquote>
<pre>mysqlbinlog &ndash;verbose &ndash;base64-output=DECODE-ROWS your-mysql-binlog-filemame.000001</pre>
</blockquote>
<p>The above adds the interpretation of the RBR entires in the form of (unconventional) statements, commented, and strips out the cryptic RBR text. All that is left is to do a little manipulation on entry headers and uncomment the interpreted queries.</p>
<p>The script can be found in <a href="https://gist.github.com/shlomi-noach/cc243fd690403e7617e3">my gist repositories</a>. Current version is as follows:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/reading-rbr-binary-logs-with-pt-query-digest/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-1-2-9-ga-released/">Orchestrator 1.2.9 GA released</a></h2>

    <div class="post-meta">

  <div>

    <time>18 Dec 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Orchestrator 1.2.9 GA has been released. Noteworthy: Added "ReadOnly" (true/false) configuration param. You can have orchestrator completely read-only Added "AuthenticationMethod": "multi": works like BasicAuth (your normal HTTP user+password) only it also accepts the special user called "readonly", which, surprise, can only view and not modify Centralized/serialized most backend database writes (with hundreds/thousands monitored servers it was possible or probable that high concurrency led to too-many-connections openned on the backend database). Fixed evil evil bug that would skip some checks if binary logs were not enabled Better hostname resolve (now also asking MySQL server to resolve hostname; resolving is cached) Pseudo-GTID (read here, here, here) support now considered stable (apart from being tested it has already been put to practice multiple times in production at Outbrain, in different planned and unplanned crash scenarios) I continue developing orchestrator as free and open source at my new employer, Booking.com.
  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-2-9-ga-released/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/semi-automatic-slavemaster-promotion-via-pseudo-gtid/">Semi-automatic slave/master promotion via Pseudo GTID</a></h2>

    <div class="post-meta">

  <div>

    <time>10 Nov 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://github.com/outbrain/orchestrator">Orchestrator</a> release <a href="https://github.com/outbrain/orchestrator/releases">1.2.7-beta</a> now supports semi-automatic slave promotion to master upon master death, via <a href="code.openark.org/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a>.</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/10/orchestrator-make-master-highlighted.png"><img class="alignnone size-full wp-image-7150" src="/blog/assets/orchestrator-make-master-highlighted.png" alt="orchestrator-make-master-highlighted" width="809" height="363" /></a></blockquote>
<p>When the master is dead, <em>orchestrator</em> automatically picks the most up-to-date slaves and marks them as <strong>&ldquo;Master candidates&rdquo;</strong>. It allows a <strong>/api/make-master</strong> call on such a slave (S), in which case it uses <a href="http://code.openark.org/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a> to enslave its siblings, and set S as <strong>read-only = 0</strong>. All we need to do is click the <strong>&ldquo;Make master&rdquo;</strong> button.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/semi-automatic-slavemaster-promotion-via-pseudo-gtid/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour/">Refactoring replication topologies with Pseudo GTID: a visual tour</a></h2>

    <div class="post-meta">

  <div>

    <time>27 Oct 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><em>Orchestrator</em> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.2.1-beta">1.2.1-beta</a> supports Pseudo GTID (<a href="http://code.openark.org/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure">read announcement</a>): a means to refactor the replication topology and connect slaves even without direct relationship; even across failed servers. This post illustrates two such scenarios and shows the visual way of mathcing/re-synching slaves.</p>
<p>Of course, orchestrator is not just a GUI tool; anything done with drag-and-drop is also done via web API (in fact, the drag-and-drop invoke the web API) as well as via command line. I&rsquo;m mentioning this as this is the grounds for failover automation planned for the future.</p>
<h4>Scenario 1: the master unexpectedly dies</h4>
<p>The master crashes and cannot be contacted. All slaves are stopped as effect, but each in a different position. Some managed to salvage relay logs just before the master dies, some didn&rsquo;t. In our scenario, all three slaves are at least caught up with the relay log (that is, whatever they managed to pull through the network, they already managed to execute). So they&rsquo;re otherwise sitting idle waiting for something to happen. Well, something&rsquo;s about to happen.</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master.png"><img class="alignnone size-large wp-image-7090" src="/blog/assets/orchestrator-pseudo-gtid-dead-master-1024x323.png" alt="orchestrator-pseudo-gtid-dead-master" width="1024" height="323" /></a></blockquote>
<p>Note the green &ldquo;Safe mode&rdquo; button to the right. This means operation is through calculation of binary log files &amp; positions with relation to one&rsquo;s master. But the master is now dead, so let&rsquo;s switch to adventurous mode; in this mode we can drag and drop slaves onto instances normally forbidden. At this stage the web interface allows us to drop a slave onto its sibling or any of its ancestors (including its very own parent, which is a means of reconnecting a slave with its parent). Anyhow:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode.png"><img class="alignnone size-large wp-image-7091" src="/blog/assets/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode-1024x296.png" alt="orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode" width="1024" height="296" /></a></blockquote>
<p>We notice that orchestrator is already kind enough to say which slave is best candidate to be the new master (<strong>127.0.0.1:22990</strong>): this is the slave (or one of the slaves) with most up-to-date data. So we choose to take another server and make it a slave of <strong>127.0.0.1:22990</strong>:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure/">Orchestrator 1.2.1 BETA: Pseudo GTID support, reconnect slaves even after master failure</a></h2>

    <div class="post-meta">

  <div>

    <time>27 Oct 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><em>orchestrator</em> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.2.1-beta">1.2.1 BETA is released</a>. This version supports <a href="http://code.openark.org/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a>, and provides one with powerful refactoring of one&rsquo;s replication topologies, even across failed instances.</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag.png"><img class="alignnone size-large wp-image-7101" src="/blog/assets/orchestrator-pseudo-gtid-dead-relay-master-begin-drag-1024x292.png" alt="orchestrator-pseudo-gtid-dead-relay-master-begin-drag" width="1024" height="292" /></a></p>
<p>Depicted: moving a slave up the topology even though its local master is inaccessible</blockquote>
<h4>Enabling Pseudo-GTID</h4>
<p>You will need to:</p>
<ol>
<li>Inject a periodic unique entry onto your binary logs</li>
<li>Configure <em>orchestrator</em> to recognize said entry.</li>
</ol>
<h4>Pseudo GTID injection example</h4>
<p>We will use the <a href="http://dev.mysql.com/doc/refman/5.5/en/events.html">event scheduler</a> (must be enabled) to inject an entry every <strong>10</strong> seconds, recognized both in statement-based and row-based replication.</p>
<blockquote>
<pre>create database if not exists meta;</p>

<p>drop event if exists meta.create_pseudo_gtid_view_event;</p>

<p>delimiter ;;
create event if not exists
  meta.create_pseudo_gtid_view_event
  on schedule every 10 second starts current_timestamp
  on completion preserve
  enable
  do
    begin
      set @pseudo_gtid := uuid();
      set @_create_statement := concat(&lsquo;create or replace view meta.pseudo_gtid_view as select
</blockquote>
Make sure to enable <em>event_scheduler</em> in your <strong>my.cnf</strong> config file.
An entry in the binary logs would look like this:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/refactoring-replication-topology-with-pseudo-gtid/">Refactoring replication topology with Pseudo GTID</a></h2>

    <div class="post-meta">

  <div>

    <time>23 Oct 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/gtid">GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post describes in detail the method of using Pseudo GTID to achieve unplanned replication topology changes, i.e. connecting two arbitrary slaves, or recovering from a master failure even as all its slaves are hanging in different positions.</p>
<p>Please read <a href="http://code.openark.org/blog/mysql/pseudo-gtid">Pseudo GTID</a> and <a href="http://code.openark.org/blog/mysql/pseudo-gtid-row-based-replication">Pseudo GTID, RBR</a> as introduction.</p>
<p>Consider the following case: the master dies unexpectedly, and its three slaves are all hanging, not necessarily at same binary log file/position (network broke down while some slaves managed to salvage more entries into their relay logs than others)</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/10/orchestrator-failed-master.jpeg"><img class="alignnone size-full wp-image-7059" src="/blog/assets/orchestrator-failed-master.jpeg" alt="orchestrator-failed-master" width="801" height="365" /></a></blockquote>
<p>(Did you notice the <strong>&ldquo;Candidate for master&rdquo;</strong> message? To be discussed shortly)</p>
<h4>GTID</h4>
<p>With GTID each transaction (and entry in the binary log) is associated with a unique mark &ndash; the Global Transaction ID. Just pick the slave with the most advanced GTID to be the next master, and just <strong>CHANGE MASTER TO MASTER_HOST=&lsquo;chosen_slave&rsquo;</strong> on the other slaves, and everything magically works. A slave knows which GTID it has already processed, and can look that entry on its master&rsquo;s binary logs, resuming replication on the one that follows.</p>
<p>How does that work? The master&rsquo;s binary logs are searched for that GTID entry. I&rsquo;m not sure how brute-force this is, since I&rsquo;m aware of a subtlety which requires brute-force scan of all binary logs; I don&rsquo;t actually know if it&rsquo;s always like that.</p>
<h4>Pseudo GTID</h4>
<p>We can mimick that above, but our solution can&rsquo;t be as fine grained. With the injection of Pseudo GTID we mark the binary log for unique entries. But instead of having a unique identifier for every entry, we have a unique identifier for every second, 10 seconds, or what have you, with otherwise normal, non-unique entries in between our Pseudo GTID entries.</p>
<h4>Recognizing which slave is more up to date</h4>
<p>Given two slaves, which is more up to date?</p>
<ul>
<li>If both replicate(d) from same master, a <strong>SHOW SLAVE STATUS</strong> comparison answers (safe method: wait till SQL thread catches up with broken IO thread, compare <strong>relay_master_log_file</strong>, <strong>exec_master_log_pos</strong> on both machines). This is the method by which the above &ldquo;Candidate for master&rdquo; message is produced.</li>
<li>If one is/was descendent of the other, then obviously it is less advanced or equals its ancestor.</li>
<li>Otherwise we&rsquo;re unsure - still solvable via bi-directional trial &amp; error, as explained later on.</li>
</ul>
<p>For now, let&rsquo;s assume we know which slave is more up to date (has received and executed more relay logs). Let&rsquo;s call it <strong>S1</strong>, whereas the less up-to-date will be <strong>S2</strong>. This will make our discussion simpler.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/refactoring-replication-topology-with-pseudo-gtid/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/pseudo-gtid-row-based-replication/">Pseudo GTID, Row Based Replication</a></h2>

    <div class="post-meta">

  <div>

    <time>23 Oct 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/gtid">GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post continues <a href="http://code.openark.org/blog/mysql/pseudo-gtid">Pseudo GTID</a>, in a series of posts describing an alternative to using MySQL GTIDs.</p>
<p>The solution offered in the last post does not work too well for row based replication. The binary log entries for the INSERT statement look like this:</p>
<blockquote>
<pre># at 1020</p>

<h1 id="at-1074">at 1074</h1>

<p>#141020 12:36:21 server id 1  end_log_pos 1074  Table_map: <code>test</code>.<code>pseudo_gtid</code> mapped to number 33
#141020 12:36:21 server id 1  end_log_pos 1196  Update_rows: table id 33 flags: STMT_END_F</p>

<p>BINLOG &lsquo;
lddEVBMBAAAANgAAADIEAAAAACEAAAAAAAEABHRlc3QAC3BzZXVkb19ndGlkAAMDBw8CQAAE
lddEVBgBAAAAegAAAKwEAAAAACEAAAAAAAEAA///+AEAAACL10RUJDg2ZmRhMDk1LTU4M2MtMTFl
NC05NzYyLTNjOTcwZWEzMWVhOPgBAAAAlddEVCQ4Y2YzOWMyYy01ODNjLTExZTQtOTc2Mi0zYzk3
MGVhMzFlYTg=
&lsquo;/<em>!</em>/;
</pre>
</blockquote>
<p>Where&rsquo;s our unique value? Encoded within something that cannot be trusted to be unique. Issuing <strong>mysqlbinlog &ndash;verbose</strong> helps out:</p>
<blockquote>
<pre>BEGIN
/<em>!</em>/;</p>

<h1 id="at-183">at 183</h1>

<h1 id="at-237">at 237</h1>

<p>#141020 12:35:51 server id 1  end_log_pos 237   Table_map: <code>test</code>.<code>pseudo_gtid</code> mapped to number 33
#141020 12:35:51 server id 1  end_log_pos 359   Update_rows: table id 33 flags: STMT_END_F</p>

<p>BINLOG &lsquo;
d9dEVBMBAAAANgAAAO0AAAAAACEAAAAAAAEABHRlc3QAC3BzZXVkb19ndGlkAAMDBw8CQAAE
d9dEVBgBAAAAegAAAGcBAAAAACEAAAAAAAEAA///+AEAAABt10RUJDc1MWJkYzEwLTU4M2MtMTFl
NC05NzYyLTNjOTcwZWEzMWVhOPgBAAAAd9dEVCQ3YjExZDQzYy01ODNjLTExZTQtOTc2Mi0zYzk3
MGVhMzFlYTg=
&lsquo;/<em>!</em>/;</p>

<h3 id="update-test-pseudo-gtid">UPDATE <code>test</code>.<code>pseudo_gtid</code></h3>

<h3 id="where">WHERE</h3>

<p>###   @1=1
###   @2=1413797741
###   <strong>@3=&lsquo;751bdc10-583c-11e4-9762-3c970ea31ea8&rsquo;</strong></p>

<h3 id="set">SET</h3>

<p>###   @1=1
###   @2=1413797751
###   @3=&lsquo;7b11d43c-583c-11e4-9762-3c970ea31ea8&rsquo;</pre>
</blockquote>
<p>and that&rsquo;s something we can work with. However, I like to do stuff from within MySQL, and rely as little as possible on external tools. How do the binary log entries look via <strong>SHOW BINLOG EVENTS</strong>? Not good.</p>
<blockquote>
<pre>master [localhost] {msandbox} (test) &gt; show binlog events in &lsquo;mysql-bin.000058&rsquo; limit 20;
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| Log_name         | Pos  | Event_type  | Server_id | End_log_pos | Info                                  |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| mysql-bin.000058 |    4 | Format_desc |         1 |         107 | Server ver: 5.5.32-log, Binlog ver: 4 |
| mysql-bin.000058 |  107 | Query       |         1 |         183 | BEGIN                                 |
| mysql-bin.000058 |  183 | Table_map   |         1 |         237 | table_id: 33 (test.pseudo_gtid)       |
| mysql-bin.000058 |  237 | Update_rows |         1 |         359 | table_id: 33 flags: STMT_END_F        |
| mysql-bin.000058 |  359 | Xid         |         1 |         386 | COMMIT /* xid=5460 <em>/                 |
| mysql-bin.000058 |  386 | Query       |         1 |         462 | BEGIN                                 |
| mysql-bin.000058 |  462 | Table_map   |         1 |         516 | table_id: 33 (test.pseudo_gtid)       |
| mysql-bin.000058 |  516 | Update_rows |         1 |         638 | table_id: 33 flags: STMT_END_F        |
| mysql-bin.000058 |  638 | Xid         |         1 |         665 | COMMIT /</em> xid=5471 <em>/                 |
| mysql-bin.000058 |  665 | Query       |         1 |         741 | BEGIN                                 |
| mysql-bin.000058 |  741 | Table_map   |         1 |         795 | table_id: 33 (test.pseudo_gtid)       |
| mysql-bin.000058 |  795 | Update_rows |         1 |         917 | table_id: 33 flags: STMT_END_F        |
| mysql-bin.000058 |  917 | Xid         |         1 |         944 | COMMIT /</em> xid=5474 <em>/                 |
| mysql-bin.000058 |  944 | Query       |         1 |        1020 | BEGIN                                 |
| mysql-bin.000058 | 1020 | Table_map   |         1 |        1074 | table_id: 33 (test.pseudo_gtid)       |
| mysql-bin.000058 | 1074 | Update_rows |         1 |        1196 | table_id: 33 flags: STMT_END_F        |
| mysql-bin.000058 | 1196 | Xid         |         1 |        1223 | COMMIT /</em> xid=5476 */                 |
| mysql-bin.000058 | 1223 | Query       |         1 |        1299 | BEGIN                                 |
| mysql-bin.000058 | 1299 | Table_map   |         1 |        1353 | table_id: 33 (test.pseudo_gtid)       |
| mysql-bin.000058 | 1353 | Update_rows |         1 |        1475 | table_id: 33 flags: STMT_END_F        |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+</pre>
</blockquote>
<p>The representation of row-format entries in the <strong>SHOW BINLOG EVENTS</strong> output is really poor. Why, there&rsquo;s nothing to tell me at all about what&rsquo;s been done, except that this is some operation on <strong>test.pseudo_gtid</strong>. Obviously I cannot find anything unique over here.</p>
<p>Not all is lost. How about DDL statements? Those are still written in SBR format (there&rsquo;s no <em>rows</em> to log upon creating a table). A solution could be somehow manipulating a unique value in a DDL statement. There could be various such solutions, and I chose to use a <strong>CREATE VIEW</strong> statement, dynamically composed of a <strong>UUID()</strong>:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/pseudo-gtid-row-based-replication/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/making-uuid-and-rand-replication-safe/">Making UUID() and RAND() replication safe</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Oct 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>MySQL&rsquo;s <a href="http://dev.mysql.com/doc/refman/5.5/en/miscellaneous-functions.html#function_uuid"><strong>UUID()</strong></a> and <a href="http://dev.mysql.com/doc/refman/5.5/en/mathematical-functions.html#function_rand"><strong>RAND()</strong></a> functions both provide with (pseudo) indeterministic result. <strong>UUID()</strong>&rsquo;s result is moreover bound to the host on which it executes. For this reason, both are unsafe to replicate with <strong>STATEMENT</strong> binlog format. As an example, consider:</p>
<blockquote>
<pre><strong>master&gt;</strong> create table test.uuid_test (id int, u varchar(64));</p>

<p><strong>master&gt;</strong> insert into test.uuid_test values (1, UUID());
Query OK, 1 row affected, 1 warning (0.03 sec)</p>

<p><strong>master&gt;</strong> select * from test.uuid_test;
+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
| id   | u                                    |
+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
|    1 | 7e3596d8-56ac-11e4-b284-3c970ea31ea8 |
+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+</pre>
</blockquote>
<p>The warning we got on the insert directly relates to the following inconsistency on a slave:</p>
<blockquote>
<pre><strong>slave1&gt;</strong> select * from test.uuid_test;
+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
| id   | u                                    |
+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
|    1 | 7e379d63-56ac-11e4-8477-3c970ea31ea8 |
+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+</pre>
</blockquote>
<p>The data on the slave is clearly inconsistent with the master&rsquo;s. The slave, replicating via <strong>STATEMENT</strong> binlog format, re-executes the <strong>INSERT</strong> command and gets a different UUID value.</p>
<h4>External</h4>
<p>One solution to the above is to generate the UUID value from your application. By the time MySQL gets the <strong>INSERT</strong> statement, the UUID value is a constant string, as far as MySQL is concerned.</p>
<h4>Internal</h4>
<p>However there&rsquo;s a way to do it from within MySQL, by decoupling the <strong>UUID()</strong> function from the <strong>INSERT</strong> statement. It takes a session variable. Consider:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/making-uuid-and-rand-replication-safe/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-1-1-18-new-features-support-for-orchestrator-agent/">orchestrator 1.1.18: new features, support for orchestrator-agent</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Oct 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://github.com/outbrain">Outbrain</a>&rsquo;s <a href="https://github.com/outbrain/orchestrator"><strong>orchestrator 1.1.18</strong></a> is released:</p>
<ul>
<li>Support for <a href="https://github.com/outbrain/orchestrator-agent"><strong>orchestrator-agent</strong></a> (see <a href="http://code.openark.org/blog/mysql/announcing-orchestrator-agent">announcement</a>): agent pages, support for agent actions, initiation of seeds (provisioning of new/corrupted servers), auditing of seeds.</li>
<li>Clusters dashboard</li>
<li>Support for long query auditing</li>
<li>SSL</li>
<li>Proxy authentication (e.g. apache2 serving as reverse-proxy with LDAP)</li>
<li>User control</li>
<li>Better slave moving rules.</li>
</ul>
<p>Quick links:</p>
<ul>
<li>Get <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.1.18"><strong>orchestrator 1.1.18</strong></a></li>
<li>Read the <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">orchestrator manual</a></strong></li>
<li>Check out <strong><a href="https://github.com/outbrain/orchestrator-agent">orchestrator-agent</a></strong></li>
</ul>
<p><em>orchestrator</em> now allows for seeding/provisioning of servers via <em>orchestrator-agent</em>. It communicates with agents executing on the MySQL hosts and coordinate transfer of data between them. orchestrator now supports invocation and auditing of seeding operations, and protects you from breaking your seeds. The <em>orchestrator-agent</em> is a solution to Outbrain&rsquo;s specific use case, and may not appeal to the greater crowd. Nonetheless it is extendible and is released as open source.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-1-18-new-features-support-for-orchestrator-agent/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/announcing-orchestrator-agent/">Announcing orchestrator-agent</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Oct 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/backup">Backup</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong><a href="https://github.com/outbrain/orchestrator-agent">orchestrator-agent</a></strong> is a side-kick, complementary project of <strong><a href="https://github.com/outbrain/orchestrator">orchestrator</a></strong>, implementing a daemon service on one&rsquo;s MySQL hosts which communicates with and accepts commands from <em>orchestrator</em>, built with the original purpose of providing an automated solution for provisioning new or corrupted slaves.</p>
<p>It was built by <a href="https://github.com/outbrain">Outbrain</a>, with Outbrain&rsquo;s specific use case in mind. While we release it as open source, only a small part of its functionality will appeal to the public (this is why it&rsquo;s not strictly part of the <em>orchestrator</em> project, which is a general purpose, wide-audience solution). Nevertheless, it is a simple implementation of a daemon, such that can be easily extended by the community. The project is open for pull-requests!</p>
<p>A quick breakdown of <em>orchestrator-agent</em> is as follows:</p>
<ul>
<li>Executes as a daemon on linux hosts</li>
<li>Interacts and invokes OS commands (via <em>bash</em>)</li>
<li>Does not directly interact with a MySQL server running on that host (does not connect via mysql credentials)</li>
<li>Expects a single MySQL service on host</li>
<li>Can control the MySQL service (e.g. stop, start)</li>
<li>Is familiar with LVM layer on host</li>
<li>Can take LVM snapshots, mount snapshots, remove snapshots</li>
<li>Is familiar with the MySQL data directory, disk usage, file system</li>
<li>Can send snapshot data from a mounted snapshot on a running MySQL host</li>
<li>Can prepare data directory and receive snapshot data from another host</li>
<li>Recognizes local/remote datacenters</li>
<li>Controlled by <em>orchestrator,</em> two <em>orchestrator-agents</em> implement an automated and audited solution for seeding a new/corrupted MySQL host based on a running server.</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/announcing-orchestrator-agent/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-1-0-5-refactoring-masters-multi-master-replication/">Orchestrator 1.0.5: refactoring masters, multi-master replication</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Aug 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Outbrain&rsquo;s <em>orchestrator</em> Version <strong>1.0.5</strong> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.0.5">is released</a>.</p>
<blockquote>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></blockquote>
<p><em>Orchestrator</em> now supports refactoring of masters via master-master topologies. It now allows promoting slaves as co-masters and detachment of instances from a co-master topology, effectively allowing for replacing an active master.</p>
<h4>Like this</h4>
<p>Drag a master:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/08/orchestator-cm-simple-drag-master-01.png"><img class="alignnone size-full wp-image-6965" src="/blog/assets/orchestator-cm-simple-drag-master-01.png" alt="orchestator-cm-simple-drag-master-01" width="804" height="340" /></a></blockquote>
<p>Onto one of its slaves:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-0-5-refactoring-masters-multi-master-replication/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-1-0-4-released/">Orchestrator 1.0.4 released</a></h2>

    <div class="post-meta">

  <div>

    <time>29 Jul 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Outbrain&rsquo;s <em>orchestrator</em> Version <strong>1.0.4</strong> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.0.4">is released</a>.</p>
<blockquote>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></blockquote>
<p>What&rsquo;s new?</p>
<h4>Co-masters</h4>
<p>orchestrator now does a much better visualization of Master-Master replication:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/07/orchestrator-co-masters.png"><img class="alignnone size-full wp-image-6946" src="/blog/assets/orchestrator-co-masters.png" alt="orchestrator-co-masters" width="783" height="357" /></a></blockquote>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-0-4-released/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/introducing-orchestrator-manage-and-visualize-your-mysql-replication-topologies-and-get-home-for-dinner/">Introducing Orchestrator: manage and visualize your MySQL replication topologies and get home for dinner</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Jun 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tools">tools</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m happy to announce the availability of <a href="http://www.outbrain.com/">Outbrain</a>&rsquo;s <strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong>: MySQL replication management &amp; visualization tool.</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/05/orchestrator-simple.png"><img class="alignnone size-full wp-image-6898" src="/blog/assets/orchestrator-simple.png" alt="orchestrator - simple topology" width="785" height="353" /></a></blockquote>
<ul>
<li>Orchestrator reads your replication topologies (give it one server - be it master or slave - in each topology, and it will reveal the rest).</li>
<li>It keeps a state of this topology.</li>
<li>It can continuously poll your servers to get an up to date topology map.</li>
<li>It visualizes the topology in a clear and slick D3 tree.</li>
<li>It allows you to <em>modify your topology;</em> move slaves around. You can use the command line variation, the JSON API, or you can use the web interface.</li>
</ul>
<p>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></p>
<h4>Nothing like nice screenshots</h4>
<p>To move slaves around the topology (repoint a slave to a different master) through <em>orchestrator</em>&rsquo;s web interface, we use <em>Drag and Drop</em>,</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/introducing-orchestrator-manage-and-visualize-your-mysql-replication-topologies-and-get-home-for-dinner/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/using-deep-nested-replication-topologies/">Using deep nested replication topologies</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Jun 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>If you&rsquo;re running more than a few slaves in a replication topology, you might choose to use deeply nested replication: slaves replicating from other slaves at 2, 3 or even 4 levels. There are pros and cons to such topologies, discussed below.</p>
<p>A simple, small deep nested topology is depicted below (it is also a real production topology of ours):</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/05/topology-sample-02.png"><img class="alignnone size-full wp-image-6878" src="/blog/assets/topology-sample-02.png" alt="topology-sample-02" width="736" height="309" /></a></blockquote>
<p>Two slaves, <strong>srv-4</strong> and <strong>srv-8</strong> act as local masters to yet other slaves. Why would we want to have this complexity?</p>
<h4>Pros</h4>
<ul>
<li>Reduce load on master: too many slaves replicating from single master means the master becomes loaded with serving the binary logs. Typically, when all slaves are up to date, this isn&rsquo;t a big deal, since they all get served roughly the same entries, and caching works great. If not all are in sync, the master needs to look up different log entries and pays with more disk I/O.</li>
<li>Reduce network load. We serve from three different data centres. Our master is in one DC, and our slaves are spread through all three. Inter-DC network is naturally slower; it is also more expensive, hence more easily saturated. Reducing cross-DC network is done across all our systems, including MySQL. <strong>srv-4</strong>, for example, could depict a slave that is a local master in its own DC, serving <strong>srv-5</strong>, <strong>srv-6</strong>, <strong>srv-7</strong> all in the same DC, hence only using cross-DC network for one slave instead of four. A bit over-simplistic example but true.</li>
<li>Failover. <a href="http://code.google.com/p/mysql-master-ha/">MHA</a> does a good job at synchronizing slaves of same master by figuring out the missing binary log entries for each slave. It should do well within a single region, but I do not know that it would do the same cross region (I&rsquo;m assuming the binlog entries copy should work, but I haven&rsquo;t tried it cross region). In case of a disaster such as an entire DC going down (we actually had such a case a couple weeks ago; power went out for the entire DC), we have a designated master into which we can fail over in each other DC, and which contains enough slaves (from each remaining DCs) to keep serving. That it, we&rsquo;re willing to skip the fancy syncing and just point to a newly promoted master, with the benefit that the entire replication topology under it is intact.</li>
<li>Testing &amp; upgrades. For example, I might want to upgrade to <strong>5.6</strong>. Upgrading a slave from <strong>5.5</strong> to <strong>5.6</strong> is a good start; we look at replication and see that nothing gets broken. But how will our production master behave with <strong>5.6</strong>? Put some more slaves under your newly upgraded <strong>5.6</strong> server and get a clearer picture. At some stage you might just promote this entire subtree as the new topology.</li>
</ul>
<p>Here&rsquo;s another topology; DC info is not depicted in this image, but you can guess what designated masters we have:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/using-deep-nested-replication-topologies/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/from-percona-server-to-mysql-and-back-to-percona-server-beware-of-crash-safe-replication-info/">From Percona Server to MySQL and back to Percona Server: beware of crash safe replication info</a></h2>

    <div class="post-meta">

  <div>

    <time>27 May 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>We&rsquo;re migrating some of our &ldquo;vanilla&rdquo; MySQL 5.5 servers to Percona Server 5.5. One of the major incentives is the <a href="http://www.percona.com/doc/percona-server/5.5/reliability/crash_resistant_replication.html">crash-safe replication</a> feature, allowing slaves to die (power failure) and resume replication without losing position in relay logs.</p>
<p>Whether or not we will migrate all our servers depends on further benchmarking; so far we&rsquo;ve noticed unexpected results, but these are still premature to publish.</p>
<p>However the fact that we are using both MySQL &amp; Percona Server has led us into a peculiar situation which I&rsquo;d like to share. We reseed our servers via LVM snapshots. If we need a new machine, or have a corrupted slave, we capture an image of a running slave and duplicate it, a process which takes the better part of a day. This duplicates not only the data, of course, but also the relay logs, the <strong>relay-log.info</strong> file, <strong>master.info</strong> file, implying the <em>position within the topology</em>.</p>
<p>With crash safe replication this also means the transactional relay log position. Recap: crash safe replication writes, per transaction, the relay log status into <strong>ibdata1</strong> file. So the relay log info in <strong>ibdata1</strong> is in perfect alignment with your committed transactions. Upon server startup, Percona Server reads the info from <strong>ibdata1</strong> and overwrites <strong>relay-log.info</strong> file (it completely disregards whatever was in that file prior to startup).</p>
<p>Can you guess what could get wrong here? Here&rsquo;s the scenario we had; the same problem can unfold in different scenarios.</p>
<p>Take a look at the following topology:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/05/simple-topology.png"><img class="alignnone size-full wp-image-6869" src="/blog/assets/simple-topology.png" alt="simple topology" width="701" height="297" /></a></blockquote>
<p>(this image is an actual online visualization of a replication topology; for purposes of this blog it&rsquo;s a sandbox topology on my laptop. Please stand by for some very cool open source release announcement shortly)</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/from-percona-server-to-mysql-and-back-to-percona-server-beware-of-crash-safe-replication-info/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/when-you-cannot-replicate-from-master-m-to-slave-s/">When you cannot replicate from master M to slave S</a></h2>

    <div class="post-meta">

  <div>

    <time>28 Apr 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Working on some replication topology automation, here are some rules that will prevent you from replicating from a MySQL server M to a slave S: M does not have binary logs (log_bin) enabled M is itself a slave and does not have log_slave_updates enabled M has a higher major version than S (e.g. M is 5.6 and S is 5.5, but do note log_bin_use_v1_row_events) Both servers have same server_id S has log_bin &amp; log_slave_updates, uses STATEMENT binlog_format, and M uses ROW or MIXED binlog_format S has log_bin &amp; log_slave_updates, uses MIXED binlog_format, and M uses ROW binlog_format S and M are using different replication filters (some rules could work; good luck if you're that adventurous) [EDIT: the above is configuration-wise] Did I miss anything?
  </p>

  
  <footer>
    <a href="/blog/mysql/when-you-cannot-replicate-from-master-m-to-slave-s/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/the-mystery-of-mysql-5-6-excessive-buffer-pool-flushing/">The mystery of MySQL 5.6 excessive buffer pool flushing</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Apr 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m experimenting with upgrading to MySQL <strong>5.6</strong> and am experiencing an unexplained increase in disk I/O utilization. After discussing this with several people I&rsquo;m publishing in the hope that someone has an enlightenment on this.</p>
<p>We have a few dozens servers in a normal replication topology. On this particular replication topology we&rsquo;ve already evaluated that <strong>STATEMENT</strong> based replication is faster than <strong>ROW</strong> based replication, and so we use <strong>SBR</strong>. We have two different workloads on our slaves, applied by two different HAProxy groups, on three different data centres. Hardware-wise, servers of two groups use either Virident SSD cards or normal SAS spindle disks.</p>
<p>Our servers are I/O bound. A common query used by both workloads looks up data that does not necessarily have a hotspot, and is very large in volume. DML is low, and we only have a few hundred statements per second executed on master (and propagated through replication).</p>
<p>We have upgraded <strong>6</strong> servers from all datacenters to <strong>5.6</strong>, both on SSD and spindle disks, and are experiencing the following phenomena:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/the-mystery-of-mysql-5-6-excessive-buffer-pool-flushing/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/anemomaster-dml-visibility-your-must-do-for-tomorrow/">&#34;Anemomaster&#34;: DML visibility. Your must-do for tomorrow</a></h2>

    <div class="post-meta">

  <div>

    <time>18 Apr 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/anemometer">Anemometer</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/devops">DevOps</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Here&rsquo;s our take of master DML query monitoring at <a href="http://www.outbrain.com/">Outbrain</a> (<a href="https://www.percona.com/live/mysql-conference-2014/sessions/mysql-devops-outbrain">presented April 2014</a>). It took a half-day to code, implement, automate and deploy, and within the first hour of work we managed to catch multiple ill-doing services and scripts. You might want to try this out for yourself.</p>
<h4>What&rsquo;s this about?</h4>
<p>What queries do you monitor on your MySQL servers? Many don&rsquo;t monitor queries at all, and only look up slow queries on occasion, using <a href="http://www.percona.com/doc/percona-toolkit/2.2/pt-query-digest.html">pt-query-digest</a>. Some monitor slow queries, where <a href="https://github.com/box/Anemometer/wiki">Anemometer</a> (relying on pt-query-digest) is a very good tool. To the extreme, some monitor TCP traffic on all MySQL servers &ndash; good for you! In between, there&rsquo;s a particular type of queries that are of special interest: DML (<strong>INSERT/UPDATE/DELETE</strong>) queries issued against the master.</p>
<p>They are of particular interest because they are only issued once against the master, yet propagate through replication topology to execute on all slaves. These queries have a direct impact on your slave lag and on your overall replication capacity. I suggest you should be familiar with your DMLs just as you are with your slow queries.</p>
<p>In particular, we had multiple occasions in the past where all or most slaves started lagging. Frantically we would go to our metrics; yes! We would see a spike in <strong>com_insert</strong>. Someone (some service) was obviously generating more <strong>INSERT</strong>s than usual, at a high rate that the slaves could not keep up with. But, <em>which</em> <strong>INSERT</strong> was that? Blindly, we would look at the binary logs. Well, erm, what are we looking for, exactly?</p>
<p>Two such occasions convinced us that there should be a solution, but it took some time till it hit us. We were already using <em>Anemometer</em> for monitoring our slow logs. We can do the same for monitoring our binary logs. Thus was born <em>&ldquo;Anemomaster&rdquo;</em>.</p>
<p>Quick recap on how Anemometer works: you issue <em>pt-query-digest</em> on your slow logs on all MySQL hosts (we actually first ship the slow logs to a central place where we analyse them; same thing). This is done periodically, and slow logs are then rotated. You throw the output of <em>pt-query-digest</em> to a central database (this is built in with <em>pt-query-digest</em>; it doesn&rsquo;t necessarily produce human readable reports). <em>Anemometer</em> would read this central database and visualize the slow queries.</p>
<h4>Analysing DMLs</h4>
<p>But then, <em>pt-query-digest</em> doesn&rsquo;t only parse slow logs. It can parse binary logs. Instead of asking for total query time, we ask for query count, and on we go to establish the same mechanism, using same <em>pt-query-digest</em> and same <em>Anemometer</em> to store and visualize the DMLs issued on our masters.</p>
<p>When analysing DMLs we&rsquo;re interested in parsing binary logs &ndash; and it makes no sense to do the same on all slaves. All slaves just have same copy of binlog entries as the master produces. It only takes <em>one</em> server to get an accurate picture of the DMLs on your replication topology.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/anemomaster-dml-visibility-your-must-do-for-tomorrow/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/the-once-and-for-all-show-slave-status-log-files-positions-explained/">The &#34;once and for all&#34; SHOW SLAVE STATUS log files &amp; positions explained</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Mar 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>True, GTID is upon us whether via MySQL 5.6 or Tungsten Replicator (and wasn&rsquo;t it in Google Patches since 2009?).</p>
<p>But some of us are still using standard replication with MySQL 5.5, and the &ldquo;what&rsquo;s with all these binary log files and positions&rdquo; question is ever erupting. The output of <strong>SHOW SLAVE STATUS</strong> confuses people new to it. It confuses me time and again.</p>
<p>So here&rsquo;s the semi visual guide to interpreting the <strong>SHOW SLAVE STATUS</strong>.</p>
<h4>About binary logs and relay logs</h4>
<p>A master writes binary logs. These are typically and conventionally called <strong>mysql-bin.#####</strong> or <strong>mysqld-bin.#####</strong> (replace ##### with digits).</p>
<p>A slave connects to its master, and reads entries from the master&rsquo;s binary logs. The slave writes those entries into its own relay logs. These are typically and conventionally called <strong>mysql-relay.#####</strong> or <strong>mysqld-relay.#####</strong> (replace ##### with digits).</p>
<p>There is nothing at all that connects the name or number of a slave&rsquo;s relay log with the master&rsquo;s binary log. There is nothing at all that connects the position within the relay log with the position within the master binary log. Files are flushed/rotated; have different size configuration; are re-created. However the slave does keep track on the current relay-log entry: it knows what&rsquo;s the matching entry on the master&rsquo;s binary logs. This is an important piece of information.</p>
<p>While the slave fetches entries and writes them into the relay log (via the <strong>IO_THREAD</strong>), it also reads the relay log to replay those entries (via the <strong>SQL_THREAD</strong>).</p>
<p>And so at each point in time we are interested in the following &ldquo;coordinates&rdquo;:</p>
<ul>
<li>What are we fetching from the master? Which file are we fetching and from which position?</li>
<li>Where are we writing this to? (This is implicitly the latest relay log file and its size)</li>
<li>What&rsquo;s the position of currently executing slave query, in relay-log coordinates? As the slave lags these coordinates are farther (smaller) than the written-to position.</li>
<li>What&rsquo;s the position of currently executing slave query, in master binary-log coordinates? This information really tells us how far apart we are from the master.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/the-once-and-for-all-show-slave-status-log-files-positions-explained/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/seconds_behind_master-vs-absolute-slave-lag/">Seconds_behind_master vs. Absolute slave lag</a></h2>

    <div class="post-meta">

  <div>

    <time>24 Jan 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I am unable to bring myself to trust the <strong>Seconds_behind_master</strong> value on <strong>SHOW SLAVE STATUS</strong>. Even with MySQL <strong>5.5</strong>&rsquo;s <strong>CHANGE MASTER TO &hellip; MASTER_HEARTBEAT_PERIOD</strong> (good thing, applied when no traffic goes from master to slave) it&rsquo;s easy and common to find fluctuations in <strong>Seconds_behind_master</strong> value.</p>
<p>And, when sampled by your favourite monitoring tool, this often leads to <em>many</em> false negatives.</p>
<p>At Outbrain we use HAProxy as proxy to our slaves, on multiple clusters. More about that in a future post. What&rsquo;s important here is that our decision whether a slave enters or leaves a certain pool (i.e. gets UP or DOWN status in HAProxy) is based on replication lag. Taking slaves out when they are actually replicating well is bad, since this reduces the amount of serving instances. Putting slaves in the pool when they are actually lagging too much is bad as they contain invalid, irrelevant data.</p>
<p>To top it all, even when correct, the <strong>Seconds_behind_master</strong> value is practically irrelevant on <strong>2nd</strong> level slaves. In a <em>Master -&gt; Slave1 -&gt; Slave2</em> setup, what does it mean that <em>Slave2</em> has <strong>Seconds_behind_master = 0</strong>? Nothing much to the application: <em>Slave1</em> might be lagging an hour behind the master, or may not be replicating at all. <em>Slave2</em> might have an hour&rsquo;s data missing even though it says its own replication is fine.</p>
<p>None of the above is news, and yet many fall in this pitfall. The solution is quite old as well; it is also very simple: do your own heartbeat mechanism, at your favourite time resolution, and measure slave lag by timestamp you yourself updated on the master.</p>
<p><strong>Maatkit</strong>/<strong>percona-toolkit</strong> did this long time ago with <strong>mk-heartbeat</strong>/<strong><a href="http://www.percona.com/doc/percona-toolkit/2.2/pt-heartbeat.html">pt-heartbeat</a></strong>. We&rsquo;re doing it in a very similar manner. The benefit is obvious. Consider the following two graphs; the first shows <strong>Seconds_behind_master</strong>, the seconds shows our own <strong>Absolute_slave_lag</strong> measurement.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/seconds_behind_master-vs-absolute-slave-lag/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/thoughts-on-mysql-5-6-new-replication-features/">Thoughts on MySQL 5.6 new replication features</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Oct 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>After playing a little bit with MySQL <strong>5.6</strong> (RC), and following closely on Giuseppe&rsquo;s <a href="http://datacharmer.blogspot.co.il/2012/08/mysql-56-replication-gotchas-and-bugs.html">MySQL 5.6 replication gotchas (and bugs)</a>, I was having some thoughts.</p>
<p>These are shared for a few reasons:</p>
<ul>
<li>Maybe I didn&rsquo;t understand it well, and someone could correct me</li>
<li>Or I understood it well, and my input could be of service to the developers</li>
<li>Or it could be of service to the users</li>
</ul>
<h4>InnoDB tables in mysql schema</h4>
<p>The introduction of InnoDB tables in <strong>mysql</strong> makes for crash-safe replication information: the exact replication position (master log file+pos, relay log file+pos etc.) is updated on InnoDB tables; with <strong>innodb_flush_logs_at_trx_commit=1</strong> this means replication status is durable and consistent with server data. This is great news!</p>
<p>However, the introduction of InnoDB tables to the mysql schema also breaks some common usage on installation and setup of MySQL servers. You can&rsquo;t just drop your <strong>ib_data1</strong> file upon dump+restore, since it also contains internal data. Giuseppe outlines the workaround for that.</p>
<p>I was thinking: would it be possible to have a completely different tablespace for MySQL&rsquo;s internal InnoDB tables? That could be a single tablespace file (who cares about file-per-table on a few internal tables). And I&rsquo;m throwing an idea without being intimate with the internals: you know how it is possible to span the shared tablespace across multiple files, as in:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/thoughts-on-mysql-5-6-new-replication-features/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-5-6-new-features-the-users-perspective/">MySQL 5.6 new features: the user&#39;s perspective</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Oct 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/memcached">memcached</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This is a yet-another compilation of the new MySQL <strong>5.6</strong> feature set. It is not a complete drill down. This list reflects what I believe to be the interesting new features user and usability -wise.</p>
<p>For example, I won&rsquo;t be listing InnoDB&rsquo;s split of kernel mutex. I&rsquo;m assuming it can have a great impact on overall performance due to reducing lock contention; but usability-wise, this is very internal.</p>
<p>The complication is an aggregate of the many announcements and other complications published earlier on. See a reference at the end of this post.</p>
<p>Do note I am not using <strong>5.6</strong> as yet; it is in RC, not GA. I am mostly excited just to write down this list.</p>
<h4>InnoDB</h4>
<ul>
<li>Online <strong>ALTER TABLE</strong>: if there is one major new feature in <strong>5.6</strong> you would want to upgrade for, this would be it. Add columns, drop columns, rename columns, add indexes, drop indexes - now online, while your <strong>SELECT, INSERT, UPDATE</strong> and <strong>DELETE</strong> statements are running.</li>
<li>Transportable tablespace files: copy+paste <strong>your_table.ibd</strong> files with <strong>FLUSH TABLE FOR EXPORT</strong> and <strong>ALTER TABLE &hellip; IMPORT TABLESPACE</strong>.</li>
<li><strong>FULLTEXT</strong>: for many, the one thing holding them back from leaving MyISAM behind. Now available in InnoDB with same syntax as with MyISAM.</li>
<li>Memcached API: access InnoDB data via memcahced protocol, and skip the SQL interface.</li>
<li>User defined table location: place your tables in your pre-defined location. Place other tables elsewhere. This is something I&rsquo;ve been asked about for ages.</li>
</ul>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-5-6-new-features-the-users-perspective/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/notes-on-row-based-replication/">Notes on row based replication</a></h2>

    <div class="post-meta">

  <div>

    <time>04 Jul 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>MySQL&rsquo;s <a href="http://dev.mysql.com/doc/refman/5.1/en/replication-formats.html">Row Based Replication</a> (RBR) succeeds (though not replaces) Statement Based Replication (SBR), as of version <strong>5.1</strong>.</p>
<p>Anyone who is familiar with replication data drift &ndash; the unexplained growing data difference between master &amp; slave &ndash; might wish to look into row based replication. On multiple servers I&rsquo;m handling the change to RBR has eliminated (to the best of my findings) replication data drift.</p>
<p>This is easily explained, as RBR writes particular row IDs into the binary log. You no longer need to hope the statement</p>
<blockquote>
<pre>DELETE FROM my_table ORDER BY my_column LIMIT 100</pre>
</blockquote>
<p>acts deterministically on all servers (is <strong>my_column</strong> UNIQUE?). With row based replication the particular rows deleted on the master are then deleted on the slave.</p>
<p>Here are three notes on RBR:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/notes-on-row-based-replication/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/auto-caching-information_schema-tables-seeking-input/">Auto caching INFORMATION_SCHEMA tables: seeking input</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Mar 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><h4>The short version</h4>
<p>I have it all working. It&rsquo;s kind of magic. But there are issues, and I&rsquo;m not sure it should even exist, and am looking for input.</p>
<h4>The long version</h4>
<p>In <a title="Link to Auto caching tables" href="http://code.openark.org/blog/mysql/auto-caching-tables" rel="bookmark">Auto caching tables</a> I presented with a hack which allows getting cached or fresh results via a simple SELECT queries.</p>
<p>The drive for the above hack was <strong>INFORMATION_SCHEMA</strong> tables. There are two major problems with <strong>INFORMATION_SCHEMA</strong>:</p>
<ol>
<li>Queries on schema-oriented tables such as <strong>TABLES</strong>, <strong>COLUMNS</strong>, <strong>STATISTICS</strong>, etc. are heavyweight. How heavyweight? Enough to make a lockdown of your database. Enough to crash down your database in some cases.</li>
<li>The data is always generated on-the-fly, as you request it. Query the <strong>COLUMNS</strong> table twice, and risk two lockdowns of your database.</li>
</ol>
<p>The auto-cache mechanism solves issue <strong>#2</strong>. I have it working, time based. I have an auto-cache table for each of the <strong>INFORMATION_SCHEMA</strong> heavyweight tables. Say, every <strong>30</strong> minutes the cache is invalidated. Throughout those <strong>30</strong> minutes, you get a free pass!</p>
<p>The auto-cache mechanism also paves the road to solving issue <strong>#1</strong>: since it works by invoking a stored routine, I have better control of the way I read <strong>INFORMATION_SCHEMA</strong>. This, I can take advantage of <a href="http://dev.mysql.com/doc/refman/5.1/en/information-schema-optimization.html">INFORMATION_SCHEMA optimization</a>. It&rsquo;s tedious, but not complicated.</p>
<p>For example, if I wanted to cache the <strong>TABLES</strong> table, I don&rsquo;t necessarily read the entire <strong>TABLES</strong> data in one read. Instead, I can iterate the schemata, get a list of table names per schema, then read full row data for these, table by table. The result? Many many more <strong>SELECT</strong>s, but more optimized, and no one-big-lock-it-all query.</p>
<h4>And the problem is&hellip;</h4>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/auto-caching-information_schema-tables-seeking-input/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/problems-with-mmm-for-mysql/">Problems with MMM for MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>16 May 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/high-availability">High availability</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I recently encountered troubling issues with MMM for MySQL deployments, leading me to the decision to cease using it on production.</p>
<p>At the very same day I started writing about it, Baron published <a href="http://www.xaprb.com/blog/2011/05/04/whats-wrong-with-mmm/">What&rsquo;s wrong with MMM?</a>. I wish to present the problems I encountered and the reasons I find MMM is flawed. In a period of two weeks, two different deployments presented me with <strong>4</strong> crashes, in <strong>3</strong> different scenarios.</p>
<p>In all the following scenarios, there is an Active/Passive Master-Master deployment, with one VIP (virtual IP) set for <em>writer</em> role, one VIP set for <em>reader</em> role.</p>
<h4>Problem #1: unjustified failover, broken replication</h4>
<p>Unjustified failover must be the common scenario. It&rsquo;s also a scenario I can live with. A few seconds of downtime are OK with me once in a couple of months.</p>
<p>But on two different installations, a few days apart, I had two seemingly unjustified failovers followed by a troubling issue: replication got broken.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/problems-with-mmm-for-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/impressions-from-mysql-conf-2011-part-iii-bof-replication/">Impressions from MySQL conf 2011, part III: BoF Replication</a></h2>

    <div class="post-meta">

  <div>

    <time>19 Apr 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/mysqlconf">mysqlconf</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post continues my impressions from some of the talks I&rsquo;ve been to. I&rsquo;ll dedicate this post to a single session.</p>
<h4>Wednesday</h4>
<ul>
<li>BoF: Replication, Lars Thalmann<em>, </em>Mat Keep<em> (Oracle)</em></li>
</ul>
<p>Lars Thallman presented the MySQL 5.5 replication features, as well as the expected 5.6 features. Among other features, one could notice parallel replication, binlog checksums, sub-second resolution and more. There was an open discussion about these features, asking for comments; looking for new ideas and suggestion from the audience.</p>
<p>I can&rsquo;t possibly cover it all. I&rsquo;ll note two discussion I participated in, and which have interested me. This also serves for noting down to myself my ideas and thoughts.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/impressions-from-mysql-conf-2011-part-iii-bof-replication/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/recovering-a-mysql-root-password-the-fourth-solution/">Recovering a MySQL `root` password: the fourth solution</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Mar 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Have just read Darren Cassar's Recovering a MySQL `root` password – Three solutions. There's a fourth solution: using an init-file, which leads to just one restart of the database instead of two. It also avoids the security issue involved with using skip-grant-tables. I've written all about it before on Dangers of skip-grant-tables. Darren's 1st advice (look for password ini files, scripts, etc.) is a very good one. One password that can always be looked up in files is the replication's password.
  </p>

  
  <footer>
    <a href="/blog/mysql/recovering-a-mysql-root-password-the-fourth-solution/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/upgrading-to-barracuda-getting-rid-of-huge-ibdata1-file/">Upgrading to Barracuda &amp; getting rid of huge ibdata1 file</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Feb 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/backup">Backup</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mysqldump">mysqldump</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Some of this is old stuff, but more people are now converting to InnoDB plugin, so as to enjoy table compression, performance boosts. Same holds for people converting to Percona&rsquo;s XtraDB. InnoDB plugin requires <strong>innodb_file_per_table</strong>. No more shared tablespace file.</p>
<p>So your <strong>ibdata1</strong> file is some <strong>150GB</strong>, and it won&rsquo;t reduce. Really, it won&rsquo;t reduce. You set <strong>innodb_file_per_table=1</strong>, do <strong>ALTER TABLE t ENGINE=InnoDB</strong> (optionally <strong>ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8</strong>), and you get all your tables in file-per-table <strong>.ibd</strong> files.</p>
<p>But the original <strong>ibdata1</strong> file is still there. It has to be there, don&rsquo;t delete it! It contains more than your old data.</p>
<p>InnoDB tablespace files never reduce in size, it&rsquo;s an old-time annoyance. The only way to go round it, if you need the space, is to completely drop them and start afresh. That&rsquo;s one of the things so nice about file-per-table: an <strong>ALTER TABLE</strong> actually creates a new tablespace file and drops the original one.</p>
<h4>The procedure</h4>
<p>The procedure is somewhat painful:</p>
<ul>
<li>Dump everything logically (either use <em>mysqldump</em>, <a href="http://www.maatkit.org/doc/mk-parallel-dump.html">mk-parallel-dump</a>, or do it your own way)</li>
<li>Erase your data (literally, delete everything under your <strong>datadir</strong>)</li>
<li>Generate a new empty database</li>
<li>Load your dumped data.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/upgrading-to-barracuda-getting-rid-of-huge-ibdata1-file/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/openark-kit-rev-170-new-tools-new-functionality/">openark-kit (rev. 170): new tools, new functionality</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Dec 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m pleased to announce a new release of the <a href="http://code.openark.org/forge/openark-kit">openark kit</a>. There&rsquo;s a lot of new functionality inside; following is a brief overview.</p>
<p>The <em>openark kit</em> is a set of utilities for MySQL. They  solve everyday maintenance tasks, which may be complicated or time  consuming to work by hand.</p>
<p>It&rsquo;s been a while since the last announced release. Most of my attention was on <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a>, building new features, writing documentation etc. However my own use of <em>openark kit</em> has only increased in the past few months, and there&rsquo;s new useful solutions to common problems that have been developed.</p>
<p>I&rsquo;ve used and improved many tools over this time, but doing the final cut, along with proper documentation, took some time. Anyway, here are the highlights:</p>
<h4>New tool: oak-hook-general-log</h4>
<p><em>oak-hook-general-log</em> hooks up a MySQL server and dumps the general log based on filtering rules, applying to query role or execution plan. It is possible to only dump connect/disconnect entries, queries which make a full table scan, or use temporary tables, or scan more than X number of rows, or&hellip;</p>
<p>I&rsquo;ll write more on this tool shortly.</p>
<h4>New tool: oak-prepare-shutdown</h4>
<p>This tool makes for an orderly and faster shutdown by safely stopping replication, and flushing InnoDB pages to disk prior to shutting down (keeping server available for connections even while attempting to flush dirty pages to disk). A typical use case would be:</p>
<blockquote>
<pre>oak-prepare-shutdown &ndash;user=root &ndash;ask-pass &ndash;socket=/tmp/mysql.sock &amp;&amp; /etc/init.d/mysql stop</pre>
</blockquote>
<h4>New tool: oak-repeat query</h4>
<p><em>oak-repeat-query</em> repeats executing a given query until some condition holds. The condition can be:</p>
<ul>
<li>Number of given iterations has been reached</li>
<li>Given time has elapsed</li>
<li>No rows have been affected by query</li>
</ul>
<p>The tool comes in handy for cleanup jobs, warming up caches, etc.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/openark-kit-rev-170-new-tools-new-functionality/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mmm-for-mysql-single-reader-role/">MMM for MySQL single reader role</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Aug 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/high-availability">High availability</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The standard documentation and tutorials on <a href="http://mysql-mmm.org/">MMM for MySQL</a>, for master-master replication setup, suggest one Virtual IP for the <em>writer</em> role, and two Virtual IPs for the <em>reader</em> role. It can be desired to only have a single virtual IP for the reader role, as explained below.</p>
<h4>The two IPs for the reader role</h4>
<p>A simplified excerpt from the <strong>mmm_common.conf</strong> sample configuration file, as can be found on the project&rsquo;s site and which is most quoted:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mmm-for-mysql-single-reader-role/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/table-refactoring-application-version-upgrades-part-ii/">Table refactoring &amp; application version upgrades, Part II</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Aug 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Continuing <a href="http://code.openark.org/blog/mysql/table-refactoring-application-version-upgrades-part-i">Table refactoring &amp; application version upgrades, Part I</a>, we now discuss code &amp; database upgrades which require <strong>DROP</strong> operations. As before, we break apart the upgrade process into sequential steps, each involving either the application or the database, but not both.</p>
<p>As I&rsquo;ll show, DROP operations are significantly simpler than creation operations. Interestingly, it&rsquo;s the same as in life.</p>
<h4>DROP COLUMN</h4>
<p>A column turns to be redundant, unused. Before it is dropped from the database, we must ensure no one is using it anymore. The steps are:</p>
<ol>
<li>App: <strong>V1</strong> -&gt; <strong>V2</strong>. Remove all references to column; make sure no queries use said column.</li>
<li>DB: <strong>V1</strong> -&gt; <strong>V2</strong> (possibly failover from <strong>M1</strong> to <strong>M2</strong>), change is <strong>DROP COLUMN</strong>.</li>
</ol>
<h4>DROP INDEX</h4>
<p>A possibly simpler case here. Why would you drop an index? Is it because you found out you never use it anymore? Then all you have to do is just drop it.</p>
<p>Or perhaps you don&rsquo;t need the functionality the index supports anymore? Then first drop the functionality:</p>
<ol>
<li>(optional) App: <strong>V1</strong> -&gt; <strong>V2</strong>. Discard using functionality which relies on index.</li>
<li>DB: <strong>V1</strong> -&gt; <strong>V2</strong> (possibly failover from <strong>M1</strong> to <strong>M2</strong>), change is <strong>DROP INDEX</strong>. Check out InnoDB Plugin here.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/table-refactoring-application-version-upgrades-part-ii/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/table-refactoring-application-version-upgrades-part-i/">Table refactoring &amp; application version upgrades, Part I</a></h2>

    <div class="post-meta">

  <div>

    <time>10 Aug 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A developer&rsquo;s major concern is: <em>How do I do application &amp; database upgrades with minimal downtime? How do I synchronize between a DB&rsquo;s version upgrade and an application&rsquo;s version upgrade?<br />
</em></p>
<p>I will break down the discussion into types of database refactoring operations, and I will limit to single table refactoring. The discussion will try to understand the need for refactoring and will dictate the steps towards a successful upgrade.</p>
<h4>Reader prerequisites</h4>
<p>I will assume MySQL to be the underlying database. To take a major component out of the equation: we may need to deal with very large tables, for which an <strong>ALTER</strong> command may take long hours. I will assume familiarity with Master-Master (Active-Passive) replication, with possible use of <a href="http://mysql-mmm.org/">MMM for MySQL</a>. When I describe &ldquo;Failover from <strong>M1</strong> to <strong>M2</strong>&rdquo;, I mean &ldquo;Make the <strong>ALTER</strong> changes on <strong>M2</strong> (passive), then switch your application from <strong>M1</strong> to <strong>M2</strong> (change of IPs, VIP, etc.), promoting <strong>M2</strong> to active position, then apply same changes on <strong>M1</strong> (now passive) or completely rebuild it&rdquo;.</p>
<p>Phew, a one sentence description of M-M usage&hellip;</p>
<p>I also assume the reader&rsquo;s understanding that a table&rsquo;s schema can be different on master &amp; slave, which is the basis for the &ldquo;use replication for refactoring&rdquo; trick. But it cannot be too different, or, to be precise, the two schemata must both support the ongoing queries for the table.</p>
<p>A full discussion of the above is beyond the scope of this post.</p>
<h4>Types of refactoring needs</h4>
<p>As I limit this discussion to single table refactoring,we can look at major refactoring operations and their impact on application &amp; upgrades. We will discuss ADD/DROP COLUMN, ADD/DROP INDEX, ADD/DROP UNIQUE INDEX, ADD/DROP FOREIGN KEY, ADD/DROP TABLE.</p>
<p>We will assume the database and application are both in Version #1 (<strong>V1</strong>), and need to be upgraded to <strong>V2</strong> or greater.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/table-refactoring-application-version-upgrades-part-i/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/replication-configuration-checklist/">Replication configuration checklist</a></h2>

    <div class="post-meta">

  <div>

    <time>18 May 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post lists the essential and optional settings for a replication environment.</p>
<p>It does not explain how to create replicating slaves. See <a href="http://dev.mysql.com/doc/refman/5.1/en/replication-howto.html">How To Setup Replication</a> for that. However, not all configuration options are well understood, and their roles in varying architectures can change.</p>
<p>Here are the settings for a basic Master/Slave(s) replication architecturee.</p>
<h4>Essential</h4>
<ul>
<li><strong>log-bin</strong>: enable binary logs on the master. Replication is based on the master logging all modifying queries (<strong>INSERT</strong>/<strong>CREATE</strong>/<strong>ALTER</strong>/<strong>GRANT</strong> etc.), and the slaves being able to replicate them.</li>
<li><strong>server-id</strong>: each machine must have a <em>unique</em> <strong>server-id</strong>. A slave will not replay queries originating from a server with the same <strong>server-id</strong> as its own.</li>
<li><strong>GRANT</strong>: grant a user with <strong>REPLICATION SLAVE</strong>. The host list must include all replication slave hosts.</li>
<li><strong>expire-logs-days</strong>: automatically clean up master&rsquo;s binary logs older than given value. By default, binary logs are never removed.</li>
</ul>
<p>When working with Master/Slaves replication, one should be prepared to master failure and slave promotion to master. It may be desirable to identify a particular slave as primary candidate for promotion.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/replication-configuration-checklist/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/quick-reminder-avoid-using-binlog-do-db/">Quick reminder: avoid using binlog-do-db</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Mar 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Nothing new about this warning; but it's worth repeating: Using binlog-do-db is dangerous to your replication. It means the master will not write to binary logs any statement not in the given database. Ahem. Not exactly. It will not write to binary logs any statement which did not originate from the given database. Which is why a customer, who was using Toad for MySQL as client interface to MySQL, and by default connected to the mysql schema, did not see his queries being replicated.
  </p>

  
  <footer>
    <a href="/blog/mysql/quick-reminder-avoid-using-binlog-do-db/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/defined-your-mysql-backup-recovery-plan-recently/">Defined your MySQL backup &amp; recovery plan recently?</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Feb 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/backup">Backup</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Following up on Ronald Bradford's Checked your MySQL recovery process recently? post, I wish to add a prequel. To see whether you have a clear definition of your backup requirements, ask yourself these questions: Is there a backup/restore plan? Is there a written backup/restore plan? How fast do you need to recover a backup? What's the longest downtime you will allow from the point of failure to the point of restored, functional database?
  </p>

  
  <footer>
    <a href="/blog/mysql/defined-your-mysql-backup-recovery-plan-recently/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/replication-analysis-with-mycheckpoint/">Replication analysis with mycheckpoint</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Nov 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I would like to show how <a href="http://code.openark.org/forge/mycheckpoint">mycehckpoint</a> (see <a href="http://code.openark.org/blog/mysql/announcing-mycheckpoint-lightweight-sql-oriented-monitoring-for-mysql">announcement</a>) can be put to use for analyzing various replication metrics.</p>
<h4>Lagging slaves</h4>
<p>A slave has been monitored. Monitoring started at a time when it was way behind master (about two days lag), but it has since caught up. This can be easily verified by the following chart:</p>
<blockquote>
<pre /><img class="alignnone" title="seconds_behind_master" src="/blog/assets/chart?cht=lc&amp;chs=400x200&amp;chts=303030,12&amp;chtt=Nov+5,+10:00++-++Nov+10,+08:00+(4+days,+22+hours)&amp;chdl=seconds_behind_master&amp;chdlp=b&amp;chco=ff8c00&amp;chd=s:976431zzzywutrpnliiifdbZYXVTRRRPNLJHEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&amp;chxt=x,y&amp;chxr=1,0,169811&amp;chxl=0:||Nov+6,+09:00|Nov+7,+09:00|Nov+8,+08:00|Nov+9,+08:00|&amp;chxs=0,505050,10" alt="" width="400" height="200" />
</blockquote>
The above chart can be obtained by viewing the HTML report:
<blockquote>
<pre>SELECT <strong>html</strong> FROM sv_report_html</pre>
</blockquote>
<p>Or by directly issuing the query:</p>
<blockquote>
<pre>mysql&gt; SELECT <strong>seconds_behind_master</strong> FROM sv_report_chart_hour\G
*************************** 1. row ***************************
seconds_behind_master: <a href="http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chts=303030,12&amp;chtt=Nov+5,+10:00++-++Nov+10,+08:00+(4+days,+22+hours)&amp;chdl=seconds_behind_master&amp;chdlp=b&amp;chco=ff8c00&amp;chd=s:976431zzzywutrpnliiifdbZYXVTRRRPNLJHEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&amp;chxt=x,y&amp;chxr=1,0,169811&amp;chxl=0:||Nov+6,+09:00|Nov+7,+09:00|Nov+8,+08:00|Nov+9,+08:00|&amp;chxs=0,505050,10">http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chts=303030,12&amp;chtt=Nov+5,+10:00++-++Nov+10,+08:00+(4+days,+22+hours)&amp;chdl=seconds_behind_master&amp;chdlp=b&amp;chco=ff8c00&amp;chd=s:976431zzzywutrpnliiifdbZYXVTRRRPNLJHEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&amp;chxt=x,y&amp;chxr=1,0,169811&amp;chxl=0:||Nov+6,+09:00|Nov+7,+09:00|Nov+8,+08:00|Nov+9,+08:00|&amp;chxs=0,505050,10</a></pre>
</blockquote>
<p>This is all nice. But I&rsquo;m also interested in the <em>rate</em> at which slave lag decreased. Many ignore this important metric: just how fast does your slave replicate?</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/replication-analysis-with-mycheckpoint/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/the-importance-of-report_host-report_port/">The importance of report_host &amp; report_port</a></h2>

    <div class="post-meta">

  <div>

    <time>13 May 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The two server variables, <a href="http://dev.mysql.com/doc/refman/5.0/en/replication-options-slave.html#option_mysqld_report-host">report_host</a> and <a href="http://dev.mysql.com/doc/refman/5.0/en/replication-options-slave.html#option_mysqld_report-port">report_port</a>, are not commonly used. One of the reasons, I suspect, is that they do not appear in any of the standard <strong>.cnf</strong> files provided with a MySQL installation.</p>
<p>For a replication environment, I find these two variables to be very useful.</p>
<h4>Where are these variables used?</h4>
<p>Here&rsquo;s a slightly modified exerpt from a MySQL master node I have, and which has two slaves:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/the-importance-of-report_host-report_port/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/parameters-to-use-on-mysqldump/">Parameters to use on mysqldump</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Oct 2008</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/backup">Backup</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mysqldump">mysqldump</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>mysqldump is commonly used for making a MySQL database backup or for setting up a replication.</p>
<p>As in all mysql binaries, there are quite a few parameters to mysqldump. Some are just niceties but some flags are a must. Of course, choosing the parameters to use greatly depends on your requirements, database setup, network capacity etc.</p>
<p>Here is my usual setup for mysqldump. The parameters below apply for an InnoDB based schema (no MyISAM, Memory tables). Parameters can be specified on the command line, or under the <code>[mysqld]</code> scope in the MySQL configuration file.</p>
<blockquote>
<p style="text-align: left;"><code>mysqldump -u dump_user -p -h db_host &ndash;routines &ndash;master-data &ndash;single-transaction  &ndash;skip-add-locks &ndash;skip-lock-tables &ndash;default-character-set=utf8 &ndash;compress my_db</code></p>
</blockquote>
<p>Let&rsquo;s review these parameters and see their effect:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/parameters-to-use-on-mysqldump/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
</div>

</div>
</div>
<script src="/blog/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>
