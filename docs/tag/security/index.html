<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>Security &middot; code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="code.openark.org" href="/blog/tag/security/index.xml" />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blogimg/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
      <li class="pure-menu-item">
        <a class="pure-menu-link" href="/blog/tag/security/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link">
        Shlomi Noach
        
          <div class="avatar-container">
        	  <div class="avatar-img-border">
                <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
        	  </div>
        	</div>
        
      </a>
    </li>

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Security</h1>
</div>

<div class="content">
  
    <article>
  <header>
    <h2><a href="/blog/mysql/baffling-5-7-globalstatus-variables-issues-unclean-migration-path/">Baffling 5.7 global/status variables issues, unclean migration path</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Aug 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance_schema">performance_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>MySQL <strong>5.7</strong> introduces a change in the way we query for global variables and status variables: the <strong>INFORMATION<em>SCHEMA.(GLOBAL|SESSION)</em>(VARIABLES|STATUS)</strong> tables are now deprecated and empty. Instead, we are to use the respective <strong>performance<em>schema.(global|session)</em>(variables|status)</strong> tables.</p>
<p>But the change goes farther than that; there is also a security change. Oracle created a pitfall of <strong>2</strong> changes at the same time:</p>
<ol>
<li>Variables/status moved to a different table</li>
<li>Privileges required on said table</li>
</ol>
<p>As an example, my non-root user gets:</p>
<blockquote>
<pre>mysql&gt; show session variables like &lsquo;tx_isolation&rsquo;;
ERROR 1142 (42000): SELECT command denied to user &lsquo;normal_user&rsquo;@&lsquo;my_host&rsquo; for table &lsquo;session_variables&rsquo;</pre>
</blockquote>
<p>Who gets affected by this? Nearly <em>everyone and everything</em>.</p>
<ul>
<li>Your Nagios will not be able to read status variables</li>
<li>Your ORM will not be able to determine session variables</li>
<li>Your replication user will fail connecting (see <a href="http://datacharmer.blogspot.nl/2015/08/mysql-578-features-bugs-and-rumors.html">this post by Giuseppe</a>)</li>
<li>And most everyone else.</li>
</ul>
<p>The problem with the above is that involves two unrelated changes to your setup, which are not entirely simple to coordinate:</p>
<ol>
<li>Change your app code to choose the correct schema (information_schema vs. performance_schema)</li>
<li><strong>GRANT</strong> the permissions on your database</li>
</ol>
<p>Perhaps at this point you still do not consider this to be a problem. You may be thinking: <em>well, let&rsquo;s first prepare by creating the GRANTs, and once that is in place, we can, at our leisure, modify the code</em>.</p>
<p>Not so fast. Can you really that simply create those GRANTs?</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/baffling-5-7-globalstatus-variables-issues-unclean-migration-path/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/get-per-object-grants-via-common_schema/">Get per-object grants via common_schema</a></h2>

    <div class="post-meta">

  <div>

    <time>29 Sep 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Did you know <a href="http://code.google.com/p/common-schema">common_schema</a> supports a complete breakdown of all accounts on your database server? It can provide you with the <strong>GRANT</strong> statements required to set up an account, the <strong>REVOKE</strong> statements to undo the former, and this can be broken down on a per-object &amp; per-object-type basis. Consider the <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">sql_grants</a> view:</p>
<p><em>Find who has privileges on a table called <strong>t</strong></em>:</p>
<blockquote>
<pre>select * from <strong>common_schema.sql_grants</strong> where <strong>priv_level_name</strong>=&lsquo;table&rsquo; and <strong>object_name</strong>=&rsquo;t&rsquo;\G</p>

<p>           GRANTEE: &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
              user: power1
              host: localhost
        priv_level: <code>mytst</code>.<code>t</code>
   priv_level_name: table
     object_schema: mytst
       object_name: t
current_privileges: SELECT
      IS_GRANTABLE: NO
         sql_grant: GRANT SELECT ON <code>mytst</code>.<code>t</code> TO &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
        sql_revoke: REVOKE SELECT ON <code>mytst</code>.<code>t</code> FROM &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
     sql_drop_user: DROP USER &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;</pre>
</blockquote>
<p>or, <em>who has privileges on the <strong>test</strong> schema</em>:</p>
<blockquote>
<pre>select * from common_schema.sql_grants where priv_level_name=&lsquo;schema&rsquo; and object_name=&lsquo;test&rsquo; \G</p>

<p>           GRANTEE: &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
              user: power1
              host: localhost
        priv_level: <code>test</code>.*
   priv_level_name: schema
     object_schema: NULL
       object_name: test
current_privileges: ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE
      IS_GRANTABLE: NO
         sql_grant: GRANT ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* TO &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
        sql_revoke: REVOKE ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* FROM &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
     sql_drop_user: DROP USER &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;</p>

<p>           GRANTEE: &lsquo;test&rsquo;@&lsquo;localhost&rsquo;
              user: test
              host: localhost
        priv_level: <code>test</code>.*
   priv_level_name: schema
     object_schema: NULL
       object_name: test
current_privileges: ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE
      IS_GRANTABLE: NO
         sql_grant: GRANT ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* TO &lsquo;test&rsquo;@&lsquo;localhost&rsquo;
        sql_revoke: REVOKE ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* FROM &lsquo;test&rsquo;@&lsquo;localhost&rsquo;
     sql_drop_user: DROP USER &lsquo;test&rsquo;@&lsquo;localhost&rsquo;</p>

<p></pre>
</blockquote>
<p>In the same manner, you can easily SELECT for all grants that are defined per-table, per-schema, &hellip; <strong>priv_level_name</strong>: is any one of <strong>&lsquo;user&rsquo;</strong>, <strong>&lsquo;schema&rsquo;</strong>, <strong>&lsquo;table&rsquo;</strong>, <strong>&lsquo;column&rsquo;</strong>, <strong>&lsquo;routine&rsquo;</strong>.</p>
<p>The above is a view, which aggregates data from all relevant <strong>INFORMATION_SCHEMA</strong> tables, normalizing and de-normalizing as necessary.</p>
<p>You might also want to look at <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">sql_show_grants</a> which provides with a no-breakdown GRANT for all accounts. It&rsquo;s like a SHOW ALL GRANTS which doesn&rsquo;t exist, plus it&rsquo;s SELECTable.</p>
<p>Also, thanks to <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/eval.html">eval()</a>, the above make for executable code. Consider:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/get-per-object-grants-via-common_schema/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/some-mysql-security-tips/">Some MySQL security tips</a></h2>

    <div class="post-meta">

  <div>

    <time>28 Jul 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  This is a brief list of security tips for MySQL. It is by no means complete. Follow the sudo example. Don't let all you DBAs and Ops have the password for the root account. Have each and every one of them have their own personal super-duper account, with their own personal and private password. This makes it so easy when someone leaves the company. No need to change passwords, just to remove the employee's account.
  </p>

  
  <footer>
    <a href="/blog/mysql/some-mysql-security-tips/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/introducing-audit_login-simple-mysql-login-logfile-based-auditing/">Introducing audit_login: simple MySQL login logfile based auditing</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Sep 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/plugin">plugin</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://github.com/outbrain/audit_login">audit_login</a> is a simple MySQL login auditing plugin, logging any login or login attempt to log file in JSON format.</p>
<p>It seems that audit plugins are <a href="http://serge.frezefond.com/2013/09/news-mariadb-audit-plugin-beta-is-out/">all the rage</a> lately&hellip; We&rsquo;ve developed out simple plugin a month ago as part of our database securing efforts; by auditing any login or login attempt we could either intercept or later investigate suspicious logins.</p>
<p>However we quickly realized there is much more to be gathered by this info.</p>
<p>In very short, you install this plugin onto your MySQL server, and your server starts writing into a text file called <strong>audit_login.log</strong> entries such as follows:</p>
<blockquote>
<pre>{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:11:47&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153868&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-87.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.87&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:11:55&rdquo;,&ldquo;type&rdquo;:&ldquo;failed_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153869&rdquo;,&ldquo;user&rdquo;:&ldquo;backup_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;&rdquo;,&ldquo;host&rdquo;:&ldquo;web-32&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.32&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:11:57&rdquo;,&ldquo;type&rdquo;:&ldquo;failed_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153870&rdquo;,&ldquo;user&rdquo;:&ldquo;backup_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;&rdquo;,&ldquo;host&rdquo;:&ldquo;web-32&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.32&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:12:48&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153871&rdquo;,&ldquo;user&rdquo;:&ldquo;root&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;root&rdquo;,&ldquo;host&rdquo;:&ldquo;localhost&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.111&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:13:26&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153872&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-11.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.11&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:13:44&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153873&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-40.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.40&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:13:51&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153874&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-03.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.03&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:14:09&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153875&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-40.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.40&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 10:55:25&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153876&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-87.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.87&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 10:55:59&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153877&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-12.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.12&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 10:55:59&rdquo;,&ldquo;type&rdquo;:&ldquo;failed_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153878&rdquo;,&ldquo;user&rdquo;:&ldquo;(null)&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;(null)&rdquo;,&ldquo;host&rdquo;:&ldquo;(null)&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.1&rdquo;}</pre>
</blockquote>
<p>In the above your MySQL server is on <strong>gromit03</strong>, and is accepting connections from other hosts; some successful, some not. What kind of information can you gather from the above?</p>
<ul>
<li>You can tell how many connections are being created on your server</li>
<li>Where they came from</li>
<li>Where <strong>&lsquo;root&rsquo;</strong> connections come from</li>
<li>Port scans (see last row) can be identified by no credentials. These don&rsquo;t have to be port scans <em>per se</em>; any <strong>telnet localhost 3006</strong> followed by <strong>Ctrl+D</strong> will show the same. Typically these would be either load balancer or monitoring tools checks to see that the <strong>3306</strong> port is active.</li>
<li>You can tell which accounts connect, and how many times</li>
<li>And you can infer which accounts are stale and can be dropped &ndash; if an account does not connect within a week&rsquo;s time, it&rsquo;s probably stale (pick your own timeframe)</li>
</ul>
<p>The above is quite interesting on one host; but we have dozens. We&rsquo;ve installed this plugin on all our MySQL servers, and we use <a href="http://logstash.net/"><strong>logstash</strong></a> to aggregate them. We aggregate to two destinations:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/introducing-audit_login-simple-mysql-login-logfile-based-auditing/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mysql-security-top-wish-list/">MySQL security top wish list</a></h2>

    <div class="post-meta">

  <div>

    <time>29 Aug 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Security seems to have no boundaries. I&rsquo;ve been tightening our database security lately, and it seems like this could go on forever: from app to console to privileges to server, there are so many aspects to managing database security. Unfortunately, this is a field where MySQL is in particular weak, and with very little work done in the many years I&rsquo;ve been working with MySQL.</p>
<p>My very own top-wanted security features for MySQL follows. Surely this is but a small subset, your mileage may vary.</p>
<h4>Autherntication-only SSL</h4>
<p>By default, MySQL client API is unencrypted and <del>passwords are sent in cleartext</del>. MySQL supports SSL, but it an &ldquo;all or nothing&rdquo; deal: if you want to use SSL, then everything goes by SSL: any query, SELECT, DDL and whatnot.</p>
<p><strong>[UPDATE]</strong>: Thanks to Davi &amp; Jan for correcting me on this: passwords are <em>not</em> sent via cleartext. I&rsquo;m not sure by which constellation I saw cleartext passwords being sent &ndash; but obviously that was long time ago. Just verified via <em>tcpdump</em>, got <strong>&ldquo;mysql_native_password&rdquo;</strong> message and no cleartext password. Lesson learned!</p>
<h4>Roles</h4>
<p>Need I elaborate? This is a fundamental construct in a database grant system. The effort of maintaining multiple accounts with similar/identical privileges is overwhelming. (PS I haven&rsquo;t used <a href="http://www.securich.com/">Securich</a> to date)</p>
<h4>Host aggregation</h4>
<p>In MySQL the combination of user+host makes for a distinct account. Thus, <strong>&lsquo;gromit&rsquo;@&lsquo;192.168.%&rsquo;</strong> is a completely different account than <strong>&lsquo;gromit&rsquo;@&lsquo;10.10.%&rsquo;</strong>. I get the idea: you can have more privileges to, say, <strong>gromit@localhost</strong> than for <strong>gromit@&lsquo;192.%&rsquo;</strong>. In practice, this only makes a headache. In all my years, I have <em>never</em> encountered nor designed a privilege set where two accounts of the same user had different set of privileges. Never ever ever. It is confusing and pointless: if an account has a different set of roles, just call it by another name!</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-security-top-wish-list/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mysql-security-tasks-easily-solved-with-common_schema/">MySQL security tasks easily solved with common_schema</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Jan 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Here are three security tasks I handled, which I&rsquo;m happy to say were easily solved with <em>common_schema</em>&rsquo;s views and routines (with no prior planning). Two are so easy, that I actually now integrated them into <a href="http://code.google.com/p/common-schema">common_schema 1.3</a>:</p>
<ul>
<li>Duplicate a user (create new user with same privileges as another&rsquo;s)</li>
<li>Find users with identical set of grants (same roles)</li>
<li>Finding redundant users (users who only have privileges on non-existing objects); I was approached on this by <a href="http://sheeri.com/">Sheeri K. Cabral</a> from Mozilla.</li>
</ul>
<h4>Duplicate user</h4>
<p>How would you duplicate a grantee? That&rsquo;s easy! Just get the SHOW GRANTS output, then do text search and replace: replace the existing account (e.g. <strong>&lsquo;existing&rsquo;@&lsquo;localhost&rsquo;</strong>) with the new account (e.g. <strong>&lsquo;newcomer&rsquo;@&lsquo;localhost&rsquo;</strong>).</p>
<p>Ahem. And how would you get the output of <strong>SHOW GRANTS</strong>? That&rsquo;s right: you can&rsquo;t do this from within the server. You have to go outside the server, incoke mysql client, <em>sed</em> your way into it, then connect to MySQL again to invoke the GRANT query&hellip; Or you can do this by hand, of course, or you can use the new <a href="http://dev.mysql.com/doc/workbench/en/mysqluserclone.html">mysqluserclone</a> tool from MySQL utilities. Bottom line: you have to go outside the server. You can&rsquo;t directly do this with your favorite GUI tool unless it has this function integrated.</p>
<p>But to have a truly automated, scriptable, server-side user-duplication you don&rsquo;t need to go far, since the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">sql_show_grants</a> view simulates a <strong>SHOW GRANTS</strong> output, but using plain old SQL. It produces the <strong>GRANT</strong> statement as SQL output. Which means you can <strong>REPLACE()</strong> the grantee. It&rsquo;s actually a one liner, but is such a common operation that I created the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/duplicate_grantee.html">duplicate_grantee()</a> function for convenience. Just:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-security-tasks-easily-solved-with-common_schema/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-1-3-security-goodies-parameterized-split-json-to-xml-query-checksum/">common_schema: 1.3: security goodies, parameterized split(), json-to-xml, query checksum</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Jan 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>common_schema <strong>1.3</strong> is released and is <a href="http://code.google.com/p/common-schema">available for download</a>. New and noteworthy in this version:</p>
<ul>
<li>Parameterized <strong><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html">split()</a></strong>: take further control over huge transactions by breaking them down into smaller chunks, now manually tunable if needed</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/duplicate_grantee.html"><strong>duplicate_grantee()</strong></a>: copy+paste existing accounts along with their full set of privileges</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/similar_grants.html"><strong>similar_grants</strong></a>: find which accounts share the exact same set of privileges (i.e. have the same <em>role</em>)</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/json_to_xml.html"><strong>json_to_xml()</strong></a>: translate any valid JSON object into its equivalent XML form</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/extract_json_value.html"><strong>extract_json_value()</strong></a>: use XPath notation to extract info from JSON data, just as you would from XML</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_checksum.html"><strong>query_checksum()</strong></a>: given a query, calculate a checksum on the result set</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/random_hash.html"><strong>random_hash()</strong></a>: get a 40 hexadecimal digits random hash, using a reasonably large changing input</li>
</ul>
<p>Let&rsquo;s take a closer look at the above:</p>
<h4>Parameterized split()</h4>
<p><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split</strong></a> takes your bulk query and automagically breaks it down into smaller pieces. So instead of one huge <strong>UPDATE</strong> or <strong>DELETE</strong> or <strong>INSERT..SELECT</strong> transaction, you get many smaller transactions, each with smaller impact on I/O, locks, CPU.</p>
<p>As of <strong>1.3</strong>, <em>split()</em> gets more exposed: you can have some control on its execution, and you also get a lot of very interesting info during operation.</p>
<p>Here&rsquo;s an example of <em>split()</em> control:</p>
<blockquote>
<pre>set @script := &ldquo;
  <strong>split</strong>({<em>start</em>:7015, <em>step</em>:2000} : <span style="color: #3366ff;">UPDATE sakila.rental SET return_date = return_date + INTERVAL 1 DAY</span>)
    <strong>throttle</strong> 1;
&ldquo;;
call common_schema.run(@script);</pre>
</blockquote>
<p>In the above we choose a split size of 2,000 rows at a time; but we also choose to only start with <strong>7015</strong>, skipping all rows prior to that value. Just what is that value? It depends on the splitting key (and see next example for just that); but in this table we can safely assume this is the <strong>rental_id</strong> <strong>PRIMARY KEY</strong> of the table.</p>
<p>You don&rsquo;t <em>have to</em> use these control <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html#parameters">parameters</a>. But they can save you some time and effort.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-1-3-security-goodies-parameterized-split-json-to-xml-query-checksum/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-1-2-security-partition-management-processes-queryscript-goodies/">common_schema 1.2: security, partition management, processes, QueryScript goodies</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Nov 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/partitioning">partitioning</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="http://code.google.com/p/common-schema">common_schema</a> <strong>1.2</strong> is released! This version comes shortly after <strong>1.1</strong>, yet contains quite a few interesting goodies:</p>
<ul>
<li>Account blocking</li>
<li>Security audit</li>
<li>RANGE partition management</li>
<li>Slave status</li>
<li>Better blocking and idle transaction management</li>
<li><em>QueryScript </em>goodies:
<ul>
<li>echo, report</li>
<li>while-otherwise statement; foreach-otherwise statement</li>
<li>Better variable scope handling</li>
<li>Complete support for variable expansion</li>
<li>Transaction support within QueryScript</li>
</ul>
</li>
<li>More summary info and SQL statements in processlist-related views</li>
</ul>
<p>A closer look at these follows:</p>
<h4>Account blocking</h4>
<p>A new view called <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_accounts.html"><strong>sql_accounts</strong></a>, inspired by <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-block-account.html">oak-block-account</a> (also see <a href="http://code.openark.org/blog/mysql/blocking-user-accounts">here</a> and <a href="http://code.openark.org/blog/mysql/pop-quiz-what-is-the-most-basic-privilege-an-account-can-be-assigned-with">here</a>) provides with the means of blocking use accounts (and releasing them, of course) without revoking their privileges. It offers the SQL statements to block an account (by modifying its password in a symmetric way) and to release an account (by modifying its password back to normal). It really works like a charm. Together with <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/killall.html">killall()</a> and <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">sql_accounts</a> this gives the administrator great control over accounts.</p>
<h4>Security audit</h4>
<p>Imported from <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-security-audit.html">openark kit</a>, and implemented via <em>QueryScript</em>, the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/security_audit.html"><strong>security_audit()</strong></a> procedure will audit your accounts, passwords and general settings to find problems, pitfalls and security hazards. I will write more on this later.</p>
<h4>RANGE partition management</h4>
<p>The <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_range_partitions.html"><strong>sql_range_partitions</strong></a> view manages your <strong>RANGE</strong> and <strong>RANGE COLUMNS</strong> partitioned tables by providing with the SQL statements to drop oldest partitions and to create the next (in sequence) partitions. See my <a href="http://code.openark.org/blog/mysql/your-magical-range-partitioning-maintenance-query">earlier post</a>.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-1-2-security-partition-management-processes-queryscript-goodies/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-rev-68-eval-processlist_grantees-candidate_keys-easter_day/">common_schema rev. 68: eval(), processlist_grantees, candidate_keys, easter_day()</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Sep 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Revision <strong>68</strong> of <a rel="nofollow" href="http://code.google.com/p/common-schema/">common_schema</a> is out, and includes some interesting features:</p>
<ul>
<li><strong>eval()</strong>: Evaluates the queries generated by a given query</li>
<li><strong>match_grantee()</strong>: Match an existing account based on user+host</li>
<li><strong>processlist_grantees</strong>: Assigning of GRANTEEs for connected processes</li>
<li><strong>candidate_keys</strong>: Listing of prioritized candidate keys: keys which are UNIQUE, by order of best-use.</li>
<li><strong>easter_day()</strong>: Returns DATE of easter day in given DATETIME&rsquo;s year.</li>
</ul>
<p>Let&rsquo;s take a slightly closer look at these:</p>
<h4>eval()</h4>
<p>I&rsquo;ve dedicated this blog post on <a href="http://code.openark.org/blog/mysql/mysql-eval">MySQL eval()</a> to describe it. In simple summary: <strong>eval()</strong> takes a query which generates queries (most common use queries on <strong>INFORMATION_SCHEMA</strong>) and auto-evaluates (executes) those queries. <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/general_procedures.html#eval">Read more</a></p>
<h4>match_grantee()</h4>
<p>As presented in <a title="Link to Finding CURRENT_USER for any user" rel="bookmark" href="http://code.openark.org/blog/mysql/finding-current_user-for-any-user">Finding CURRENT_USER for any user</a>, I&rsquo;ve developed the algorithm to match a connected user+host details (as presented with <strong>PROCESSLIST</strong>) with the grantee tables (i.e. the <strong>mysql.user</strong> table), in a manner which simulates the MySQL server account matching algorithm.</p>
<p>This is now available as a stored function: given a user+host, the function returns with the best matched grantee. <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/privileges_functions.html#match_grantee">Read more</a></p>
<h4>processlist_grantees</h4>
<p>This view relies on the above, and maps the entire <strong>PROCESSLIST</strong> onto GRANTEEs. The view maps each process onto the GRANTEE (MySQL account) which is the owner of that process. Surprisingly, MySQL does not provide one with such information.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-rev-68-eval-processlist_grantees-candidate_keys-easter_day/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/finding-current_user-for-any-user/">Finding CURRENT_USER for any user</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Aug 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A MySQL account is a user/host combination. A MySQL connection is done by a user connecting from some host.</p>
<p>However, the user/host from which the connection is made are not the same as the user/host as specified in the account. For example, the account may be created thus:</p>
<blockquote>
<pre>CREATE USER &lsquo;temp&rsquo;@&lsquo;10.0.0.%&rsquo; IDENTIFIED BY &lsquo;123456&rsquo;;</pre>
</blockquote>
<p>The host as specified in the above account is a wildcard host. A connection by the <strong>&lsquo;temp&rsquo;</strong> user from <strong>&lsquo;10.0.0.3&rsquo;</strong> can map into that account. It thus happens that the connected user is <strong>&lsquo;temp&rsquo;@&lsquo;10.0.0.3&rsquo;</strong>, yet the assigned account is <strong>&lsquo;temp&rsquo;@&lsquo;10.0.0.%&rsquo;</strong>.</p>
<p>MySQL provides with the <strong>USER()</strong> and <strong>CURRENT_USER()</strong> which map to the connected user and the assigned account, respectively, and which lets the current session identify the relation between the two. Read more on this on the <a href="http://dev.mysql.com/doc/refman/5.1/en/account-activity-auditing.html">MySQL docs</a>.</p>
<h4>The problem</h4>
<p>And the trouble is: MySQL only provides this functionality for the <em>current session</em>. Surprisingly, given a user/host combination, I cannot get MySQL to tell me which account matches those details.</p>
<h4>The inconsistency</h4>
<p>And I care because there is an inconsistency. Namely, when I do <strong>SHOW PROCESSLIST</strong> MySQL tells me the user &amp; host from which the connection is made. It does <em>not</em> tell me the account for which the process is assigned.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/finding-current_user-for-any-user/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/announcing-common_schema-common-views-routines-for-mysql/">Announcing common_schema: common views &amp; routines for MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Jul 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-types">Data Types</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/schema">Schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Today I have released <a title="common_schema" href="http://code.openark.org/forge/common_schema">common_schema</a>, a utility schema for MySQL which includes many views and functions, and is aimed to be installed on any MySQL server.</p>
<h4>What does it do?</h4>
<p>There are views answering for all sorts of useful information: stuff related to schema analysis, data dimensions, monitoring, processes &amp; transactions, security, internals&hellip; There are basic functions answering for common needs.</p>
<p>Some of the views/routines simply formalize those queries we tend to write over and over again. Others take the place of external tools, answering complex questions via SQL and metadata. Still others help out with SQL generation.</p>
<p>Here are a few highlights:</p>
<ul>
<li>Did you know you can work out <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/global_status_diff_nonzero.html">simple monitoring</a> of your server with a <em>query</em>?  There&rsquo;s a view to do that for you.</li>
<li>How about showing just <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/processlist_top.html">the good parts of the processlist</a>?</li>
<li>Does your schema have <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/redundant_keys.html">redundant keys</a>?</li>
<li>Or InnoDB tables with <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/no_pk_innodb_tables.html">no PRIMARY KEY</a>?</li>
<li>Is AUTO_INCREMENT <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/auto_increment_columns.html">running out of space</a>?</li>
<li>Can I get the SQL statements to <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_foreign_keys.html">generate my FOREIGN KEYs</a>? To drop them?</li>
<li>And can we finally get <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">SHOW GRANTS for all accounts</a>, and as an <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">SQL query</a>?</li>
<li>Ever needed a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/general_functions.html#crc64">64 bit CRC function</a>?</li>
<li>And aren&rsquo;t you tired of writing the cumbersome SUBSTRING_INDEX(SUBSTRING_INDEX(str, &lsquo;,&rsquo;, 3), &lsquo;,&rsquo;, -1)? <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/string_functions.html#split_token">There&rsquo;s an alternative</a>.</li>
</ul>
<p>There&rsquo;s more. Take a look at the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/introduction.html">common_schema documentation</a> for full listing. And it&rsquo;s evolving: I&rsquo;ve got quite a few ideas already for future components.</p>
<p>Some of these views rely on heavyweight INFORMATION_SCHEMA tables. You should be aware of the impact and <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/risks.html">risks</a>.</p>
<h4>What do I need to install?</h4>
<p>There&rsquo;s no script or executable file. It&rsquo;s just a schema. The distribution in an SQL file which generates <em>common_schema</em>. Much like a dump file.</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/announcing-common_schema-common-views-routines-for-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/routine_privileges-implementation/">ROUTINE_PRIVILEGES implementation</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Jun 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/views">Views</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Following up on MySQL security: inconsistencies, and on MySQL bug #61596, I was thinking it may take a long time till the non-existent ROUTINE_PRIVILEGES view is implemented. Here's my own implementation of the view. I've followed the somewhat strange conventions used in the *_PRIVILEGES tables in INFORMATION_SCHEMA, where the IS_GRANTABLE is a separate column, although in 2nd 1st normal form. I present it here as a query, using session variables, rather than a view definition: SELECT STRAIGHT_JOIN CONCAT('\'', User, '\'@\'', Host, '\'') AS GRANTEE, NULL AS ROUTINE_CATALOG, Db AS ROUTINE_SCHEMA, Routine_name AS ROUTINE_NAME, Routine_type AS ROUTINE_TYPE, UPPER(SUBSTRING_INDEX(SUBSTRING_INDEX(Proc_priv, ',', n+1), ',', -1)) AS PRIVILEGE_TYPE, IF(grantable_procs_priv.User IS NULL, 'NO', 'YES') AS IS_GRANTABLE FROM mysql.procs_priv CROSS JOIN (SELECT @counter := -1) select_init CROSS JOIN ( SELECT @counter := @counter+1 AS n FROM INFORMATION_SCHEMA.COLLATIONS LIMIT 5 ) numbers LEFT JOIN ( SELECT DISTINCT User, Host, Db, Routine_name FROM mysql.procs_priv WHERE find_in_set('Grant', Proc_priv) &gt; 0 ) grantable_procs_priv USING (User, Host, Db, Routine_name) WHERE numbers.n BETWEEN 0 AND CHAR_LENGTH(Proc_priv) - CHAR_LENGTH(REPLACE(Proc_priv, ',', '')) AND UPPER(SUBSTRING_INDEX(SUBSTRING_INDEX(Proc_priv, ',', n+1), ',', -1)) != 'GRANT' ORDER BY GRANTEE, ROUTINE_SCHEMA, ROUTINE_NAME, ROUTINE_TYPE, n ; It takes 2 views and a table to make this a VIEW rather than a query.
  </p>

  
  <footer>
    <a href="/blog/mysql/routine_privileges-implementation/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mysql-security-inconsistencies/">MySQL security: inconsistencies</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Jun 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Doing some work with MySQL security, I&rsquo;ve noticed a few inconsistencies. They&rsquo;re mostly not-too-terrible for daily work, except they get in my way right now.</p>
<h4>The ALL PRIVILEGES inconsistency</h4>
<p>The preferred way of assigning account privileges in MySQL is by way of using <a href="http://dev.mysql.com/doc/refman/5.1/en/grant.html">GRANT</a>.</p>
<p>With <strong>GRANT</strong>, one assigns one or more privileges to an account, such as <strong>SELECT</strong>, <strong>UPDATE</strong>, <strong>ALTER</strong>, <strong>SUPER</strong> ,etc. Sometimes it makes sense for an account to have complete control over a domain. For example, the <strong>root</strong> account is typically assigned with all privileges. Or, some user may require all possible privileges on a certain schema.</p>
<p>Instead of listing the entire set of privileges, the <strong>ALL PRIVILEGES</strong> meta-privilege can be used. There is a fine issue to notice here; typically this is not a problem, but I see it as a flaw. Assume the following account:</p>
<blockquote>
<pre>root@mysql-5.1.51&gt; GRANT <strong>ALL PRIVILEGES</strong> ON world.* TO &lsquo;world_user&rsquo;@&lsquo;localhost&rsquo;;</p>

<p>root@mysql-5.1.51&gt; SHOW GRANTS FOR &lsquo;world_user&rsquo;@&lsquo;localhost&rsquo;;
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| Grants for world_user@localhost                               |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| GRANT USAGE ON <em>.</em> TO &lsquo;world_user&rsquo;@&lsquo;localhost&rsquo;                |
| GRANT <strong>ALL PRIVILEGES</strong> ON <code>world</code>.* TO &lsquo;world_user&rsquo;@&lsquo;localhost&rsquo; |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</pre>
</blockquote>
<p>This makes sense. We granted <strong>ALL PRIVILEGES</strong> and we see that the account is granted with <strong>ALL PRIVILEGES</strong>.</p>
<p>Now notice the following:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-security-inconsistencies/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/pop-quiz-what-is-the-most-basic-privilege-an-account-can-be-assigned-with/">Pop quiz: what is the most basic privilege an account can be assigned with?</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Jun 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I asked this during my presentation on the MySQL Conference this year. And I got a unanimous answer from the crowd. Take a moment to think this over, before coming up with the answer. Meanwhile, an intermezzo.</p>
<p><em><strong>Tam dam dam&hellip;</strong></em></p>
<p><em><strong>Pom pom Pom pom Pom pom&hellip;</strong></em></p>
<p>If your answer is that the most basic privilege an account can be assigned with is the USAGE privilege, you are right!</p>
<p>And then again, you&rsquo;re also <em>wrong</em>.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/pop-quiz-what-is-the-most-basic-privilege-an-account-can-be-assigned-with/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/recovering-a-mysql-root-password-the-fourth-solution/">Recovering a MySQL `root` password: the fourth solution</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Mar 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Have just read Darren Cassar's Recovering a MySQL `root` password – Three solutions. There's a fourth solution: using an init-file, which leads to just one restart of the database instead of two. It also avoids the security issue involved with using skip-grant-tables. I've written all about it before on Dangers of skip-grant-tables. Darren's 1st advice (look for password ini files, scripts, etc.) is a very good one. One password that can always be looked up in files is the replication's password.
  </p>

  
  <footer>
    <a href="/blog/mysql/recovering-a-mysql-root-password-the-fourth-solution/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/limiting-table-disk-quota-in-mysql/">Limiting table disk quota in MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Mar 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/file-system">File System</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/myisam">MyISAM</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Question asked by a student: is there a way to limit a table&rsquo;s quote on disk? Say, limit a table to 2GB, after which it will refuse to grow? Note that the requirement is that rows are never DELETEd. The table must simply refuse to be updated once it reaches a certain size.</p>
<p>There is no built-in way to limit a table&rsquo;s quota on disk. First thing to observe is that MySQL has nothing to do with this. It is entirely up to the storage engine to provide with such functionality. The storage engine is the one to handle data storage: how table and keys are stored on disk. Just consider the difference between MyISAM&rsquo;s <strong>.MYD</strong> &amp; <strong>.MYI</strong> to InnoDB&rsquo;s shared tablespace <strong>ibdata1</strong> to InnoDB&rsquo;s file-per table <strong>.ibd</strong> files.</p>
<p>The only engine I know of that has a quota is the MEMORY engine: it accepts the <strong>max_heap_table_size</strong>, which limits the size of a single table in memory. Hrmmm&hellip; In memory&hellip;</p>
<h4>Why limit?</h4>
<p>I&rsquo;m not as yet aware of the specific requirements of said company, but this is not the first time I heard this question.</p>
<p>The fact is: when MySQL runs out of disk space, it goes with a BOOM. It crashed ungracefully, with binary logs being out of sync, replication being out of sync. To date, and I&rsquo;ve seen some cases, InnoDB merely crashes and manages to recover once disk space is salvaged, but I am not certain this is guaranteed to be the case. Anyone?</p>
<p>And, with MyISAM&hellip;, who knows?</p>
<p>Rule #1 of MySQL disk usage: <em>don&rsquo;t run out of disk space.</em></p>
<h4>Workarounds</h4>
<p>I can think of two workarounds, none of which is pretty. The first involves triggers (actually, a few variations for this one), the second involves privileges.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/limiting-table-disk-quota-in-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/upgrading-passwords-from-old_passwords-to-new-passwords/">Upgrading passwords from old_passwords to &#34;new passwords&#34;</a></h2>

    <div class="post-meta">

  <div>

    <time>28 Feb 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>You have <strong>old_passwords=1</strong> in your <strong>my.cnf</strong>. I&rsquo;m guessing this is because you used one of the <strong>my-small.cnf</strong>, <strong>my-large.cnf</strong> etc. templates provided with your MySQL distribution.</p>
<p>These files can easily win the &ldquo;most outdated sample configuration file contest&rdquo;.</p>
<p>Usually it&rsquo;s no big deal: if some parameter isn&rsquo;t right, you just go and change it. Some variables, though, have a long-lasting effect, and are not easily reversed.</p>
<h4>What&rsquo;s the deal with old_passwords?</h4>
<p>No one should be using these anymore. This variable makes the password hashing algorithm compatible with that of MySQL <strong>4.0</strong>. I&rsquo;m pretty sure <strong>4.0</strong> was released <strong>9</strong> years ago. I don&rsquo;t know of anyone still using it (or <strong>4.0</strong> client libraries).</p>
<p>The deal is this: with old_passwords you get a <strong>16</strong> hexadecimal digits (<strong>64</strong> bit) hashing of your passwords. With so called <em>&ldquo;new passwords&rdquo;</em> you get <strong>40</strong> hexadecimal digits (plus extra &ldquo;<strong>*</strong>&rdquo;). So this is about better encryption of your password. Read more on the <a href="http://dev.mysql.com/doc/refman/5.1/en/password-hashing.html">manual</a>.</p>
<h4>How do I upgrade to new password format?</h4>
<p>You can&rsquo;t just put a comment on the &ldquo;<strong>old_passwords=1</strong>&rdquo; entry in the configuration file. If you do so, the next client to connect will attempt to match a <strong>41</strong> characters hashed password to your existing <strong>16</strong> characters entry in the <strong>mysql.users</strong> table. So you need to make a simultaneous change: both remove the <strong>old_passwords</strong> entry and set a new password. You must know all accounts&rsquo; passwords before you begin.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/upgrading-passwords-from-old_passwords-to-new-passwords/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/tool-of-the-day-autossh/">Tool of the day: autossh</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Sep 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Maybe I'm like an old replication server, lagging way behind, but a couple of weeks ago I found autossh, which is a wrapper around ssh, that keeps reconnecting the session if it breaks. With public key encryption, I am now able to work out pretty reliable SSH tunneling among servers, which doesn't break. It seems to be working well during these couple of weeks. And it's in my favorite distro's repository :) I suppose use cases are as many as those for SSH or SSH tunneling, and I'm putting it to an interesting use.
  </p>

  
  <footer>
    <a href="/blog/mysql/tool-of-the-day-autossh/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mylvmbackup-howto-minimal-privileges-filesystem-copy/">mylvmbackup HOWTO: minimal privileges &amp; filesystem copy</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Aug 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/backup">Backup</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/linux">Linux</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This HOWTO discusses two (unrelated) issues with <a href="http://www.lenzg.net/mylvmbackup/"><em>mylvmbackup</em></a>:</p>
<ul>
<li>The minimal privileges required to take MySQL backups with <em>mylvmbackup.</em></li>
<li>Making (non compressed) file system copy of one&rsquo;s data files.</li>
</ul>
<h4>Minimal privileges</h4>
<p>Some just give <em>mylvmbackup</em> the root account, which is far too permissive. We now consider what the minimal requirements of <em>mylvmbackup</em> are.</p>
<p>The queries <em>mylvmbackup</em> issues are:</p>
<ul>
<li><strong>FLUSH TABLES</strong></li>
<li><strong>FLUSH TABLES WITH READ LOCK</strong></li>
<li><strong>SHOW MASTER STATUS</strong></li>
<li><strong>SHOW SLAVE STATUS</strong></li>
<li><strong>UNLOCK TABLES</strong></li>
</ul>
<p>Both <strong>SHOW MASTER STATUS</strong> &amp; <strong>SHOW SLAVE STATUS</strong> require either the <strong>SUPER</strong> or <strong>REPLICATION CLIENT</strong> privilege. Since <strong>SUPER</strong> is more powerful, we choose <strong>REPLICATION CLIENT</strong>.</p>
<p>The <strong>FLUSH TABLES</strong> * and <strong>UNLOCK TABLES</strong> require the <strong>RELOAD</strong> privilege.</p>
<p>However, we are not done yet. <em>mylvmbackup</em> connects to the <strong>mysql</strong> database, which means we must also have some privilege there, too. We choose the <strong>SELECT</strong> privilege.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mylvmbackup-howto-minimal-privileges-filesystem-copy/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/passwords-which-are-bad-for-your-health/">Passwords which are bad for your health</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Dec 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;ve seen some passwords to take a few years from my life.</p>
<p>I mean, we all know about <a href="http://en.wikipedia.org/wiki/Dictionary_attack">dictionary words</a>, right? And we&rsquo;ve all seen <a href="http://www.imdb.com/title/tt0094012/">Spaceballs</a>, right? But choosing <strong>12345</strong> as your password is not the only careless option: there are many more! The more I get familiar with user&rsquo;s password, the more I see how so much alike they all are.</p>
<p>Let&rsquo;s review some of the commonly used bad password practices:</p>
<ul>
<li>Empty passwords. Need I say more? Apparently yes. So what if <em>&ldquo;there&rsquo;s only access through firewall from our company&rsquo;s IP&rdquo;</em>?</li>
<li>Dictionary passwords: real English words like &lsquo;<strong>falcon</strong>&rsquo; or &lsquo;<strong>tiger</strong>&rsquo;. Don&rsquo;t use these! These are the easiest to attack.</li>
<li>Well known words: how about &lsquo;<strong>Gandalf</strong>&rsquo;? It&rsquo;s not dictionary, but it&rsquo;s popular enough to appear in any respectable list. For that matter, look at how well filtered passwords are on RedHat: you can&rsquo;t choose a password which is a common first or last name in the US, Italy, or even Israel; which is great!</li>
<li>Common substitues: enough with &lsquo;<strong>1nsi9ht</strong>&rsquo; and &lsquo;<strong>@dm1n</strong>&rsquo;! These are almost as easy to break as dictionary words; it&rsquo;s just a matter of a few more combinations per word.</li>
<li>Keyboard clustered: say <em>No!</em> to &lsquo;<strong>1qa2ws</strong>&rsquo;. Don&rsquo;t use &lsquo;<strong>$rty&amp;*io</strong>&rsquo;. They seems to be random at first sight, but look for them on the keyboard: it&rsquo;s just your common <em>&ldquo;how shall I create a password that&rsquo;s so easy to remember I will never forget it?&rdquo;</em>. Now <strong>REPLACE(&ldquo;remember&rdquo;, &ldquo;break&rdquo;)</strong> and <strong>REPLACE(&ldquo;never forget&rdquo;, &ldquo;always regret&rdquo;)</strong>.</li>
<li>Children&rsquo;s names, birth dates, <strong>123456</strong>, your car&rsquo;s license plate number, your <em>Yahoo!</em> mail password, etc. etc. etc.</li>
</ul>
<p>There are many guidelines for <a href="http://en.wikipedia.org/wiki/Password_strength#Guidelines_for_strong_passwords">choosing strong passwords</a>. And everyone seems to know about it. But I&rsquo;m still surprised when I find out the MySQL root password is &lsquo;<strong>zxcvbn</strong>&rsquo; or &lsquo;<strong>pa55wd</strong>&rsquo;.</p>
<p>MySQL allows for any character in your password, so you may use punctuations, spaces, and other symbols. This is stronger than plain characters and digits.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/passwords-which-are-bad-for-your-health/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/even-more-on-mysql-password-security/">Even more on MySQL password security</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Jun 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post follows Ronald Bradford&rsquo;s <a href="http://ronaldbradford.com/blog/more-basic-mysql-security-2009-05-29/">More Basic MySQL Security</a>, and Lenz Grimmer&rsquo;s <a href="http://www.lenzg.net/archives/256-Basic-MySQL-Security-Providing-passwords-on-the-command-line.html">Basic MySQL Security: Providing passwords on the command line</a> and <a href="http://www.lenzg.net/archives/257-More-on-MySQL-password-security.html">More on MySQL password security</a>.</p>
<p>In Ronald&rsquo;s post I&rsquo;ve argued that passwords provided on command line are visible in plaintext on &ldquo;ps aux&rdquo;. Lenz has argued that this is incorrect, providing the source code to support that. Giuseppe commenting that this has been fixed since 2002. Later on, Lenz shows that passwords are visible in plaintext on OpenSolaris, Solaris and variants of BSD and SysV.</p>
<p>Mental note: old habits die hard; I must remember to revisit issues from time to time.</p>
<h4>Centralizing</h4>
<p>Back to the question: <em>why use a file to store your password, and not provide it on command line? </em></p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/even-more-on-mysql-password-security/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/blocking-user-accounts/">Blocking user accounts</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Mar 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A long time missing feature in MySQL is temporarily blocking accounts: denying a user to log in, without affecting any other of her privileges.</p>
<p>There is no such privilege as &lsquo;LOGIN&rsquo; in the grants table, as the ability to log in is the most basic one MySQL allows. This basic privilege is called USAGE.</p>
<p>I&rsquo;ll present a hack around this, one which <a title="openark kit: oak-block-account" href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-block-account.html">oak-block-account</a> implements. Before presenting the hack, lets lay down some requirements:</p>
<ul>
<li>A user can be blocked from logging in to MySQL.</li>
<li>Such a blocked user can later be &lsquo;released&rsquo;, re-enabling him to log in.</li>
<li>It should be possible to determine if a certain user is currently blocked or not.</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/blocking-user-accounts/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/is-a-valid-column-name/">`;`.`*`.`.` is a valid column name</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Feb 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>And the following query:</p>
<blockquote>
<pre>SELECT <code>;</code>.<code>*</code>.<code>.</code> FROM <code>;</code>.<code>*</code>;</pre>
</blockquote>
<p>is valid as well. So are the following:</p>
<blockquote>
<pre>DROP DATABASE IF EXISTS <code>;</code>;
CREATE DATABASE <code>;</code>;
CREATE TABLE <code>;</code>.<code>*</code> (<code>.</code> INT);
CREATE TABLE <code>;</code>.```<code>(</code>.<code>INT);
CREATE TABLE</code>;<code>.</code>$(ls)<code>(</code>.` INT);</pre>
</blockquote>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/is-a-valid-column-name/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mysql-security-data-integrity-issues/">MySQL security: data integrity issues</a></h2>

    <div class="post-meta">

  <div>

    <time>21 Jan 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql_mode">sql_mode</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>MySQL&rsquo;s security model is not as elaborate as other popular databases. It&rsquo;s missing quite a lot.</p>
<p>I wish to point out what I think are some very disturbing security holes, which may affect the database integrity.</p>
<p>This post is not about Roles, Kerberos, IPs and such. It&rsquo;s about simple MySQL features, which allow common, unprivileged users, to break data integrity by using unprotected session variables.</p>
<p>I will consider three such issues.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-security-data-integrity-issues/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/triggers-use-case-compilation-part-i/">Triggers Use Case Compilation, Part I</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Jan 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;ve run by quite a few triggers lately on production systems. In previous posts, I&rsquo;ve written about problems solved with triggers. So here&rsquo;s a compilation of some solutions based on triggers; and some problems which are not (yet?) solvable due to current triggers limitations.</p>
<p>Triggers can be used to:</p>
<ul>
<li>Maintain integrity</li>
<li>Enhance security</li>
<li>Enhance logging</li>
<li>Assist with archiving</li>
<li>Restrict table size</li>
<li>Manage caching</li>
<li>Manage counters</li>
</ul>
<p>Triggers are not fast. In fact, they can add quite an overhead if misused. Some of the triggers presented here are known to work on real life production systems, though, and work well. But make sure you benchmark before embarking on extensive application changes.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/triggers-use-case-compilation-part-i/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/using-triggers-to-block-malicious-code-an-example/">Using triggers to block malicious code: an example</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Jan 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Web applications face constant exploitation attempts. Those with a user base must keep their users&rsquo; private data, well&hellip; private.</p>
<p>While the MySQL security model allows restricting users access to databases, tables and even columns, it has no built in feature for restricting the rows access within the given table.</p>
<p>One cannot allow a user to only update rows 0 through 99, but restrict that user from updating rows 100 to 199. Such restrictions are usually managed in the application level, by adding a necessary &ldquo;&hellip; AND filtering_column = some_value&hellip;&rdquo;</p>
<p>Many web application have the notion of an &lsquo;admin&rsquo; account, or several such accounts, which provide greater control over the application. The &lsquo;admin&rsquo; account is one account to which many attacks are targeted. One such attack is an attempt to modify the admin&rsquo;s password, such that the attacker can later log in with and access restricted data.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/using-triggers-to-block-malicious-code-an-example/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/dangers-of-skip-grant-tables/">Dangers of skip-grant-tables</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Nov 2008</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>When MySQL&rsquo;s root password is lost and must be reset, there are two popular ways to create a new password. One of the options is far too popular, in my opinion.</p>
<p>The preferred way of setting a root&rsquo;s password is by using an init-file. The process for doing this is well explained in <a title="How to Reset the Root Password" href="http://dev.mysql.com/doc/refman/5.0/en/resetting-permissions.html">MySQL&rsquo;s manual</a>. Using this method requires creating a simple text file, in which the required</p>
<p><strong><code>GRANT ALL PRIVILEGES ON <em>.</em> TO &lsquo;root&rsquo;@&lsquo;localhost&rsquo; IDENTIFY BY &lsquo;****&rsquo; WIth GRANT OPTION;</code></strong></p>
<p>(or, alternatively,  <code><strong>SET PASSWORD &hellip;</strong></code>) statement is written.</p>
<p>An entry must be written to my.cnf, or supplied via command line parameters:</p>
<p><strong><code>init-file=/tmp/my-init-file.sql</code></strong></p>
<p>MySQL must then be restarted. Upon restart, and before opening any outside connections, the init-file is executed. Once MySQL is up and running, the init-file entry should be dropped.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/dangers-of-skip-grant-tables/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
</div>

</div>
</div>
<script src="/blog/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>
