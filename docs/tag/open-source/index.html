<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>Open Source &middot; code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="code.openark.org" href="/blog/tag/open-source/index.xml" />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blog/img/favicon.ico" type="image/x-icon" />


  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
      <li class="pure-menu-item">
        <a class="pure-menu-link" href="/blog/tag/open-source/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link">
        Shlomi Noach
        
          <div class="avatar-container">
        	  <div class="avatar-img-border">
                <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
        	  </div>
        	</div>
        
      </a>
    </li>

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Open Source</h1>
</div>

<div class="content">
  
    <article>
  <header>
    <h2><a href="/blog/mysql/gh-ost-1-0-17-hooks-sub-second-lag-control-amazon-rds-and-more">gh-ost 1.0.17: Hooks, Sub-second lag control, Amazon RDS and more</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Sep 2016</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/gh-ost">gh-ost</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://github.com/github/gh-ost">gh-ost</a> version <a href="https://github.com/github/gh-ost/releases/tag/v1.0.17">1.0.17</a> is now released, with various additions and fixes. Here are some notes of interest:</p>
<h3>Hooks</h3>
<p><code>gh-ost</code> now supports <a href="https://github.com/github/gh-ost/blob/master/doc/hooks.md">hooks</a>. These are your own executables that <code>gh-ost</code> will invoke at particular points of interest (validation pass, about to cut-over, success, failure, status, etc.)</p>
<p><code>gh-ost</code> will set various environment variables for your executables to pick up, passing along such information as migrated/<em>ghost</em> table name, elapsed time, processed rows, migrated host etc.</p>
<h3>Sub-second lag control</h3>
<p>At GitHub we&rsquo;re very strict about replication lag. We keep it well under <code>1</code> second at most times. <code>gh-ost</code> can now identify <a href="https://github.com/github/gh-ost/blob/master/doc/subsecond-lag.md">sub-second lag on replicas</a> (well, you need to supply with the right query). Our current production migrations are set by default with <code>&ndash;max-lag-millis=500</code> or less, and our most intensive migrations keep replication lag well below <code>1sec</code> or even below <code>500ms</code></p>
<h3>No SUPER</h3>
<p>The <code>SUPER</code> privilege is required to <code>set global binlog_format=&lsquo;ROW&rsquo;</code> and for <code>STOP SLAVE; START SLAVE;</code></p>
<p>If you <em>know</em> your replica has RBR, you can pass <code>&ndash;assume-rbr</code> and skips those steps.</p>
<h3>RDS</h3>
<p>Hooks + No Super = RDS, as seems to be the case. For <code>&ndash;test-on-replica</code> you will need to supply your own <code>gh-ost-on-stop-replication</code> hook, to stop your RDS replica at cut-over phase. See <a href="https://github.com/github/gh-ost/issues/163#issuecomment-244694616">this tracking issue</a></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/gh-ost-1-0-17-hooks-sub-second-lag-control-amazon-rds-and-more">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/introducing-gh-ost-triggerless-online-schema-migrations/">Introducing gh-ost: triggerless online schema migrations</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Aug 2016</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/github">GitHub</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/operations">operations</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tools">tools</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I'm thoroughly happy to introduce gh-ost: triggerless, controllable, auditable, testable, trusted online schema change tool released today by GitHub. gh-ost now powers our production schema migrations. We hit some serious limitations using pt-online-schema-change on our large volume, high traffic tables, to the effect of driving our database to a near grinding halt or even to the extent of causing outages. With gh-ost, we are now able to migrate our busiest tables at any time, peak hours and heavy workloads included, without causing impact to our service.
  </p>

  
  <footer>
    <a href="/blog/mysql/introducing-gh-ost-triggerless-online-schema-migrations/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/solving-the-non-atomic-table-swap-take-iii-making-it-atomic/">Solving the non-atomic table swap, Take III: making it atomic</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Jul 2016</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/operations">operations</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>With the unintended impression of becoming live blogging, we now follow up on <a title="Link to Solving the non-atomic table swap, Take II" href="http://code.openark.org/blog/mysql/solving-the-non-atomic-table-swap-take-ii" rel="bookmark">Solving the non-atomic table swap, Take II</a> and <a title="Link to Solving the Facebook-OSC non-atomic table swap problem" href="http://code.openark.org/blog/mysql/solving-the-facebook-osc-non-atomic-table-swap-problem" rel="bookmark">Solving the Facebook-OSC non-atomic table swap problem</a> with a safe, blocking, <em>atomic</em> solution</p>
<h3>Why yet another iteration?</h3>
<p>The solution presented in <a title="Link to Solving the non-atomic table swap, Take II" href="http://code.openark.org/blog/mysql/solving-the-non-atomic-table-swap-take-ii" rel="bookmark">Solving the non-atomic table swap, Take II</a> was good, in that it was safe. No data corruption. Optimistic: if no connection is killed throughout the process, then completely blocking.</p>
<p>Two outstanding issues remained:</p>
<ul>
<li>If something did go wrong, the solution reverted to a table-outage</li>
<li>On replicas, the table swap is non atomic, non blocking. There&rsquo;s table-outage scenario on replica.</li>
</ul>
<p>As it turns out, there&rsquo;s a simpler solution which overcomes both the above. As with math and physics, the simpler solution is often the preferred one. But it took those previous iterations to gather a few ideas together. So, anyway:</p>
<h3>Safe, locking, atomic, asynchronous table swap</h3>
<p>Do read the aforementioned previous posts; the quick-quick recap is: we want to be able to <strong>LOCK</strong> a table <strong>tbl</strong>, then do some stuff, then swap it out and put some <strong>ghost</strong> table in its place. MySQL does not allow us to <strong>rename tbl to tbl_old, ghost to tbl</strong> if we have locks on <strong>tbl</strong> in that session.</p>
<p>The solution we offer is now based on two connections only (as opposed to three, in the <em>optimistic</em> approach). &ldquo;Our&rdquo; connections will be C10, C20. The &ldquo;normal&rdquo; app connections are C1..C9, C11..C19, C21..C29.</p>
<ul>
<li>Connections C1..C9 operate on <strong>tbl</strong> with normal DML: <strong>INSERT, UPDATE, DELETE</strong></li>
<li>Connection C10: <strong>CREATE TABLE tbl_old (id int primary key) COMMENT=&lsquo;magic-be-here&rsquo;</strong></li>
<li>Connection C10: <strong>LOCK TABLES tbl WRITE, tbl_old WRITE</strong></li>
<li>Connections C11..C19, newly incoming, issue queries on <strong>tbl</strong> but are blocked due to the <strong>LOCK</strong></li>
<li>Connection C20: <strong>RENAME TABLE tbl TO tbl_old, ghost TO tbl</strong><br />
This is blocked due to the <strong>LOCK</strong>, <em>but</em> gets prioritized on top connections C11..C19 and on top C1..C9 or any other connection that attempts DML on <strong>tbl</strong></li>
<li>Connections C21..C29, newly incoming, issue queries on <strong>tbl</strong> but are blocked due to the <strong>LOCK</strong> and due to the <strong>RENAME</strong>, waiting in queue</li>
<li>Connection C10: checks that C20&rsquo;s <strong>RENAME</strong> is applied (looks for the blocked <strong>RENAME</strong> in processlist)</li>
<li>Connection 10: <strong>DROP TABLE tbl_old</strong><br />
Nothing happens yet; <strong>tbl</strong> is still locked. All other connections still blocked.</li>
<li>Connection 10: <strong>UNLOCK TABLES<br />
BAM!</strong> The <strong>RENAME</strong> is first to execute, <strong>ghost</strong> table is swapped in place of <strong>tbl</strong>, then C1..C9, C11..C19, C21..C29 all get to operate on the new and shiny <strong>tbl</strong></li>
</ul>
<p>Some notes</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/solving-the-non-atomic-table-swap-take-iii-making-it-atomic/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/solving-the-non-atomic-table-swap-take-ii/">Solving the non-atomic table swap, Take II</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Jun 2016</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/operations">operations</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Following up and improving on <a title="Link to Solving the Facebook-OSC non-atomic table swap problem" href="http://code.openark.org/blog/mysql/solving-the-facebook-osc-non-atomic-table-swap-problem" rel="bookmark">Solving the Facebook-OSC non-atomic table swap problem</a>, we present a better, safe solution.</p>
<h3>Quick, quickest recap:</h3>
<p>We are working on a triggerless online schema migration solution. It is based on an asynchronous approach, similarly to the <a href="https://www.facebook.com/notes/mysql-at-facebook/online-schema-change-for-mysql/430801045932/">FB osc</a> and as opposed to the synchronous solution as used by <a href="https://www.percona.com/doc/percona-toolkit/2.2/pt-online-schema-change.html">pt-online-schema-change</a>.</p>
<p>We asynchronously synchronize (is that even a valid statement?) between some table <strong>tbl</strong> and a ghost table <strong>ghost</strong>, and at some time we want to cut-over: swap the two; kick out <strong>tbl</strong> and put <strong>ghost</strong> in its place and under its name.</p>
<p>However, we cannot use the single statement <strong>rename tbl to tbl_old, ghost to tbl</strong>, because we use the asynchronous approach, where at the time we lock <strong>tbl</strong> for writes, we still have some events we need to process and apply onto <strong>ghost</strong> before swapping the two.</p>
<p>And MySQL does not allow a <strong>lock tables tbl write; &hellip; ; </strong><strong>rename tbl to tbl_old, ghost to tbl</strong>.</p>
<p>In <a title="Link to Solving the Facebook-OSC non-atomic table swap problem" href="http://code.openark.org/blog/mysql/solving-the-facebook-osc-non-atomic-table-swap-problem" rel="bookmark">Solving the Facebook-OSC non-atomic table swap problem</a> we suggested a way that works, unless when it doesn&rsquo;t work. Read the caveat at the end of the post. Premature death of a connection that participates in the algorithm causes a chain reaction that leads to the premature execution of the <strong>rename</strong> statement, potentially before we&rsquo;ve applied those remaining events. This leads to data inconsistency between the old table and the new table, and is unacceptable.</p>
<p>To that effect, we were more inclined to go with the Facebook solution, which makes a two-step: <strong>lock tables tbl write; alter table tbl rename to tbl_old; &hellip; ; alter table ghost rename to tbl;</strong></p>
<p>This two-step solution is guaranteed not to have data inconsistency. Alas, it also implies an outage. There&rsquo;s a brief moment, in between the two <strong>rename</strong>s, and during that time where we apply those last changes, where the table <strong>tbl</strong> is simply not there.</p>
<p>Not all applications will fail gracefully on such a scenario.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/solving-the-non-atomic-table-swap-take-ii/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/solving-the-facebook-osc-non-atomic-table-swap-problem/">Solving the Facebook-OSC non-atomic table swap problem</a></h2>

    <div class="post-meta">

  <div>

    <time>03 May 2016</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>We present a way to use an atomic, blocking table swap in the Facebook Online-Schema-Change solution, as well as in a rumored, other Online-Schema-rumored-Change solution. <strong>Update</strong>: also a caveat.</p>
<h3>Quick recap (really quick)</h3>
<p><a href="https://www.percona.com/doc/percona-toolkit/2.2/pt-online-schema-change.html">pt-online-schema-change</a> and <a href="https://www.facebook.com/notes/mysql-at-facebook/online-schema-change-for-mysql/430801045932/">facebook-osc</a> are two popular online-schema-change solutions for MySQL. They both use triggers, but in different ways. While the Percona tool uses synchronous table updates, such that any <strong>INSERT|UPDATE|DELETE</strong> on the modified table causes an <strong>INSERT|UPDATE|DELETE</strong> on a ghost table, in the Facebook tool all cause an <strong>INSERT</strong> on a changelog table, which is then iterated, read, having entries applied on the ghost table.</p>
<p>The TL;DR is that DMLs on the table propagate synchronously, within same transaction in the Percona tool, and asynchronously, with lag, in the Facebook tool.</p>
<h3>What&rsquo;s the problem with the table swap?</h3>
<p>In the Percona tool, once the logic is satisfied the copy is complete, we issue this query:</p>
<blockquote>
<pre>RENAME TABLE tbl TO tbl_old, tbl_new TO tbl;</pre>
</blockquote>
<p>This is an atomic, two table <strong>RENAME</strong> operation.</p>
<p>However with the asynchronous nature of the Facebook tool, such a <strong>RENAME</strong> would be a mistake. We must first block writes to the modified table, then make sure we have iterated the changelog table to the point of lock, apply those changes onto the ghost table, and only then do the swap.</p>
<p>The problem is: you cannot <strong>RENAME TABLES</strong> while one of them is <strong>LOCK</strong>ed.</p>
<p>This is silly, and inconsistent, because:</p>
<blockquote>
<pre>&gt; LOCK TABLES tbl WRITE;
Query OK, 0 rows affected (0.00 sec)</p>

<p>&gt; RENAME TABLE tbl TO tbl_old, tbl_new TO tbl;
ERROR 1192 (HY000): Can&rsquo;t execute the given command because you have active locked tables or an active transaction</p>

<p>&gt; ALTER TABLE tbl RENAME TO tbl_old;
Query OK, 0 rows affected (0.00 sec)</pre>
</blockquote>
<p>Why would the <strong>RENAME</strong> fail where the <strong>ALTER</strong> works?</p>
<p>Small thing, but critical to the operation of the online-schema-change. From the <a href="https://www.facebook.com/notes/mysql-at-facebook/online-schema-change-for-mysql/430801045932/">Facebook OSC documentation</a>:</p>
<blockquote>Since alter table causes an implicit commit in innodb, innodb locks get released after the first alter table. So any transaction that sneaks in after the first alter table and before the second alter table gets a &lsquo;table not found&rsquo; error. The second alter table is expected to be very fast though because copytable is not visible to other transactions and so there is no need to wait.</blockquote>
<h3>What the FB solution means</h3>
<p>It means for a very brief duration, the table is <em>not there</em>. Your app will get errors.</p>
<p>Of course, we <em>should</em> be able to handle errors anytime, aywhere. But the honest truth is: we (as in <em>the world</em>) do not. Many apps will fail ungracefully should they get a <em>table not found</em> error.</p>
<p>An atomic swap, as compared, would make for briefly blocking operations, making the app ignorant of the swap.</p>
<h3>Rumor</h3>
<p>Rumor has it that we at GitHub are developing a new, triggerless, Online Schema Change tool. It is rumored to be based off binary logs and is rumored to have lots of interesting rumored implications.</p>
<p>Such rumored implementation would have to be asynchronous by nature, or so rumors say. And as such, it would fall for the same non-atomic table swap problem.</p>
<h3>Solution</h3>
<p>Once we heard it was rumored we were working on a triggerless online schema change tool, we realized we would have to solve the non-atomic swap problem. What we did was to gossip about it in between ourselves, which led to three different rumors of a solution, eventually manifested as three different working solutions. All three solutions make for blocking queries on the app&rsquo;s side. I will present one of these solution here, based on voluntary locks.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/solving-the-facebook-osc-non-atomic-table-swap-problem/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-progress/">Orchestrator progress</a></h2>

    <div class="post-meta">

  <div>

    <time>23 Dec 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/github">GitHub</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/secondary">secondary</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  This comes mostly to reassure, having moved into GitHub: orchestrator development continues. I will have the privilege of working on this open source solution in GitHub. There are a few directions we can take orchestrator to, and we will be looking into the possibilities. We will continue to strengthen the crash recovery process, and in fact I've got a couple ideas on drastically shortening Pseudo-GTID recovery time as well as other debts.
  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-progress/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/general/joining-github/">Joining GitHub</a></h2>

    <div class="post-meta">

  <div>

    <time>30 Nov 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/general">General</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/github">GitHub</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Today was my last day at Booking.com, and shortly I will be joining the team at GitHub. I'd like to thank the many kind, friendly &amp; smart people I've worked with at Booking.com! The challenges at Booking.com are big. There is such a diversity within the technology stack; even within the database range. A solution that works on all the various Booking.com production environments is something to value. Indeed, the Booking.com Production environment it is an amazing playground for developers, offering high volume, large numbers, and differing workloads to tackle.
  </p>

  
  <footer>
    <a href="/blog/general/joining-github/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-visual-cheatsheet-tldr-the-smart-way/">Orchestrator visual cheatsheet, TL;DR the &#34;smart&#34; way</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Sep 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong> is <em>really</em> growing. And the amount of users (DBAs, sys admins) using it is growing. Which gives me a lot of immediate feedback in the form of <em>&ldquo;Look, there&rsquo;s just too many options to move slaves around! Which ones should we use?&rdquo;</em></p>
<h3>TL;DR look at the two visualized commands below</h3>
<p>They are enough</p>
<h3>The &ldquo;smart&rdquo; commands to end all commands</h3>
<p>So all relocation commands are important, and give you fine-grained, pin-pointed control of the method of topology refactoring. However, most of the time you <em>just want to move those servers around</em>. Which is why there&rsquo;s a new &ldquo;smart&rdquo; mode which support these two commands, which you should be happy using:</p>
<ul>
<li><strong>relocate</strong>: move a single slave to another position</li>
<li><strong>relocate-slaves</strong>: move all/some slaves of some server to another position.</li>
</ul>
<p>What makes these commands Smart? You can move slaves around from <em>anywhere</em> to <em>anywhere</em>. And <em>orchestrator</em> figures out the bast execution path. If possible, it uses GTID. Not possible? Is Pseudo-GTID available? Great, using Pseudo-GTID. Oh, are there binlog servers involved? Really simple, use them. None of the above? <em>Orchestrator</em> will use &ldquo;standard&rdquo; binlog file:pos math (with limitations). <em>Orchestrator</em> will even figure out if multiple steps are necessary and will combine any of the above.</p>
<p>So you don&rsquo;t have to remember all the possible ways and options. The visual cheatsheet now boils down to these two:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2015/08/orchestrator-cheatsheet-visualized-relocate.png"><img class="alignnone size-full wp-image-7357" src="/blog/assets/orchestrator-cheatsheet-visualized-relocate.png" alt="orchestrator-cheatsheet-visualized-relocate" width="720" height="405" /></a></p>
<p><a href="http://code.openark.org/blog/wp-content/uploads/2015/08/orchestrator-cheatsheet-visualized-relocate-slaves.png"><img class="alignnone size-full wp-image-7350" src="/blog/assets/orchestrator-cheatsheet-visualized-relocate-slaves.png" alt="orchestrator-cheatsheet-visualized-relocate-slaves" width="720" height="405" /></a></blockquote>
<p>Let&rsquo;s take a slightly deeper look</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-visual-cheatsheet-tldr-the-smart-way/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-1-4-340-gtid-binlog-servers-smart-mode-failovers-and-lots-of-goodies/">Orchestrator 1.4.340: GTID, binlog servers, Smart Mode, failovers and lots of goodies</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Sep 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://github.com/outbrain/orchestrator/releases"><strong>Orchestrator</strong> 1.4.340 is released</a>. Not quite competing with the MySQL latest changelog, and as I haven&rsquo;t blogged about <em>orchestrator</em> featureset in a while, this is a quick listing of <em>orchestrator</em> features available since my last publication:</p>
<ul>
<li>Supports <strong>GTID</strong> (Oracle &amp; MariaDB)
<ul>
<li>GTID still not being used in automated recovery &ndash; in progress.</li>
<li><strong>enable-gtid</strong>, <strong>disable-gtid</strong>, <strong>skip-query</strong> for GTID commands</li>
</ul>
</li>
<li>Supports <strong>binlog servers</strong> (MaxScale)
<ul>
<li>Discovery &amp; operations on binlog servers</li>
<li>Understanding slave repositioning in a binlog-server architecture</li>
</ul>
</li>
<li><strong>Smart mode</strong>: relocate &amp; relocate-below commands (or Web/GUI drag-n-drop) let <em>orchestrator</em> figure out the best way of slave repositioning. <em>Orchestrator</em> picks from GTID, Pseudo GTID, binlog servers, binlog file:pos math (and more) options, or combinations of the above. Fine grained commands still there, but mostly you won&rsquo;t need them.</li>
<li><strong>Crash recoveries</strong> (did you know <em>orchestrator</em> does that?):
<ul>
<li>For intermediate master recovery: improved logic in picking the best recovery plan (prefer in-DC, prefer promoting local slave, supporting binlog server topologies, &hellip;)</li>
<li>For master recovery: even better slave promotion; supports <em>candidate slaves </em>(prefer promoting such slaves); supports binlog server shared topologies</li>
<li>Better auditing and logging of recovery cases</li>
<li>Better analysis of crash scenarios, also in the event of lost VIPs, hanging connections; emergent checks in crash suspected scenarios</li>
<li>recover-lite: do all topology-only recovery steps, without invoking external processes</li>
</ul>
</li>
<li><strong>Better browser support</strong>: used to only work on Firefox and Chrome (and the latter has had issues), the Web UI should now work well on all browsers, at the cost of reduced <strong>d3</strong> animation. More work still in progress.</li>
<li><strong>Faster</strong>, more parallel, less blocking operations on all counts; removed a lots of serialized code; less locks.</li>
<li><strong>Web enhancements</strong>
<ul>
<li>More verbose drag-n-drop (operation hint; color hints)</li>
<li>Drag-n-drop for <em>slaves-of-a-server</em></li>
<li>Replication/crash analysis dashboard</li>
</ul>
</li>
<li><strong>Pools</strong>: <em>orchestrator</em> can be <em>told</em> about instance-to-pool association (<strong>submit-pool-instances</strong> command)
<ul>
<li>And can then present pool status (web)</li>
<li>Or pool hints within topologies (web)</li>
<li>Or queried for all pools (<strong>cluster-pool-instances</strong> command)</li>
</ul>
</li>
<li>Other:
<ul>
<li>Supports MySQL <strong>5.7</strong> (tested with <strong>5.7.8</strong>)</li>
<li>Configurable graphite path for metrics</li>
<li><strong>&ndash;noop</strong> flag; does all the work except for actually changing master on slaves. Shows intentions.</li>
<li>Web (or cli <strong>which-cluster-osc-slaves</strong> command) provide list of control slaves to use in <strong>pt-osc</strong> operation</li>
<li><strong>hostname-unresolve</strong>: force <em>orchestrator</em> to unresolve a fqdn into VIP/CNAME/&hellip; when issuing a CHANGE MASTER TO</li>
</ul>
</li>
<li>3rd party contributions (hey, thanks!) include:
<ul>
<li>More &amp; better SSL support</li>
<li>Vagrant templates</li>
</ul>
</li>
<li>For developers:
<ul>
<li><em>Orchestrator</em> now go-gettable. Just <strong>go get github.com/outbrain/orchestrator</strong></li>
<li>Improved build script; supports more architectures</li>
</ul>
</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-4-340-gtid-binlog-servers-smart-mode-failovers-and-lots-of-goodies/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/awesome-mysql-curated-list-created-open-for-pull-requests/">&#34;awesome-mysql&#34; curated list created, open for pull requests</a></h2>

    <div class="post-meta">

  <div>

    <time>28 Apr 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tools">tools</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Following up on popular "awesome-*" lists (e.g. awesome-python, awesome-golang etc.), I've created the awesome-mysql curated list. This is a list of technologies (and resources) in and around MySQL, and means to serve as a place to find reliable software and info. I recently happened to notice there are some tools I'm familiar with that are unknown to others; tools unknown to me that are in good use. The list is naturally and intentionally incomplete.
  </p>

  
  <footer>
    <a href="/blog/mysql/awesome-mysql-curated-list-created-open-for-pull-requests/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/percona-live-2015-reflections-the-apache-ccla-offer/">Percona Live 2015: Reflections; the Apache CCLA offer</a></h2>

    <div class="post-meta">

  <div>

    <time>18 Apr 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/secondary">secondary</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Facebook, Google, Twitter, LinkedIn, Alibaba, MariaDB, Percona team up and offer Oracle all public changes under the Apache CCLA Read again please. My one word summary of this is: Romantic. In the most positive sense. Disclaimer: I am not a lawyer; this is my understanding of the current status and of the offer. Summarizing the deal: the teams participating with WebScaleSQL would like to push code upstream. Current legal issues limit their options.
  </p>

  
  <footer>
    <a href="/blog/mysql/percona-live-2015-reflections-the-apache-ccla-offer/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/speaking-at-percona-live-pseudo-gtid-and-easy-replication-topology-management/">Speaking at Percona Live: Pseudo GTID and Easy Replication Topology Management</a></h2>

    <div class="post-meta">

  <div>

    <time>31 Mar 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/secondary">secondary</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In two weeks time I will be presenting <a href="https://www.percona.com/live/mysql-conference-2015/sessions/pseudo-gtid-and-easy-replication-management">Pseudo GTID and Easy Replication Topology Management</a> at Percona Live. From the time I submitted the proposal a LOT has been developed, experimented, deployed and used with both <a href="http://code.openark.org/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a> and with <a href="https://github.com/outbrain/orchestrator">orchestrator</a>. In my talk I will:</p>
<ul>
<li>Suggest that you skip the &ldquo;to GTID or not to GTID&rdquo; question and go for the lightweight Pseudo GTID</li>
<li>Show how Pseudo GTID is used in production to recover from various replication failures and server crashes</li>
<li>Do an outrageous demonstration</li>
<li>Tell you about 50,000 successful experiments and tests done in production</li>
<li>Show off orchestrator and its support for Pseudo GTID, including automated crash analysis and recovery mechanism.</li>
</ul>
<p>I will further show how the orchestrator tooling makes for a less restrictive, more performant, less locking, non-intrusive, trusted and lightweight replication topology management solution.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-at-percona-live-pseudo-gtid-and-easy-replication-topology-management/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-1-2-9-ga-released/">Orchestrator 1.2.9 GA released</a></h2>

    <div class="post-meta">

  <div>

    <time>18 Dec 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Orchestrator 1.2.9 GA has been released. Noteworthy: Added "ReadOnly" (true/false) configuration param. You can have orchestrator completely read-only Added "AuthenticationMethod": "multi": works like BasicAuth (your normal HTTP user+password) only it also accepts the special user called "readonly", which, surprise, can only view and not modify Centralized/serialized most backend database writes (with hundreds/thousands monitored servers it was possible or probable that high concurrency led to too-many-connections openned on the backend database). Fixed evil evil bug that would skip some checks if binary logs were not enabled Better hostname resolve (now also asking MySQL server to resolve hostname; resolving is cached) Pseudo-GTID (read here, here, here) support now considered stable (apart from being tested it has already been put to practice multiple times in production at Outbrain, in different planned and unplanned crash scenarios) I continue developing orchestrator as free and open source at my new employer, Booking.com.
  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-2-9-ga-released/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure/">Orchestrator 1.2.1 BETA: Pseudo GTID support, reconnect slaves even after master failure</a></h2>

    <div class="post-meta">

  <div>

    <time>27 Oct 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><em>orchestrator</em> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.2.1-beta">1.2.1 BETA is released</a>. This version supports <a href="http://code.openark.org/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a>, and provides one with powerful refactoring of one&rsquo;s replication topologies, even across failed instances.</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag.png"><img class="alignnone size-large wp-image-7101" src="/blog/assets/orchestrator-pseudo-gtid-dead-relay-master-begin-drag-1024x292.png" alt="orchestrator-pseudo-gtid-dead-relay-master-begin-drag" width="1024" height="292" /></a></p>
<p>Depicted: moving a slave up the topology even though its local master is inaccessible</blockquote>
<h4>Enabling Pseudo-GTID</h4>
<p>You will need to:</p>
<ol>
<li>Inject a periodic unique entry onto your binary logs</li>
<li>Configure <em>orchestrator</em> to recognize said entry.</li>
</ol>
<h4>Pseudo GTID injection example</h4>
<p>We will use the <a href="http://dev.mysql.com/doc/refman/5.5/en/events.html">event scheduler</a> (must be enabled) to inject an entry every <strong>10</strong> seconds, recognized both in statement-based and row-based replication.</p>
<blockquote>
<pre>create database if not exists meta;</p>

<p>drop event if exists meta.create_pseudo_gtid_view_event;</p>

<p>delimiter ;;
create event if not exists
  meta.create_pseudo_gtid_view_event
  on schedule every 10 second starts current_timestamp
  on completion preserve
  enable
  do
    begin
      set @pseudo_gtid := uuid();
      set @_create_statement := concat(&lsquo;create or replace view meta.pseudo_gtid_view as select
</blockquote>
Make sure to enable <em>event_scheduler</em> in your <strong>my.cnf</strong> config file.
An entry in the binary logs would look like this:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-1-1-18-new-features-support-for-orchestrator-agent/">orchestrator 1.1.18: new features, support for orchestrator-agent</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Oct 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://github.com/outbrain">Outbrain</a>&rsquo;s <a href="https://github.com/outbrain/orchestrator"><strong>orchestrator 1.1.18</strong></a> is released:</p>
<ul>
<li>Support for <a href="https://github.com/outbrain/orchestrator-agent"><strong>orchestrator-agent</strong></a> (see <a href="http://code.openark.org/blog/mysql/announcing-orchestrator-agent">announcement</a>): agent pages, support for agent actions, initiation of seeds (provisioning of new/corrupted servers), auditing of seeds.</li>
<li>Clusters dashboard</li>
<li>Support for long query auditing</li>
<li>SSL</li>
<li>Proxy authentication (e.g. apache2 serving as reverse-proxy with LDAP)</li>
<li>User control</li>
<li>Better slave moving rules.</li>
</ul>
<p>Quick links:</p>
<ul>
<li>Get <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.1.18"><strong>orchestrator 1.1.18</strong></a></li>
<li>Read the <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">orchestrator manual</a></strong></li>
<li>Check out <strong><a href="https://github.com/outbrain/orchestrator-agent">orchestrator-agent</a></strong></li>
</ul>
<p><em>orchestrator</em> now allows for seeding/provisioning of servers via <em>orchestrator-agent</em>. It communicates with agents executing on the MySQL hosts and coordinate transfer of data between them. orchestrator now supports invocation and auditing of seeding operations, and protects you from breaking your seeds. The <em>orchestrator-agent</em> is a solution to Outbrain&rsquo;s specific use case, and may not appeal to the greater crowd. Nonetheless it is extendible and is released as open source.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-1-18-new-features-support-for-orchestrator-agent/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/announcing-orchestrator-agent/">Announcing orchestrator-agent</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Oct 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/backup">Backup</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong><a href="https://github.com/outbrain/orchestrator-agent">orchestrator-agent</a></strong> is a side-kick, complementary project of <strong><a href="https://github.com/outbrain/orchestrator">orchestrator</a></strong>, implementing a daemon service on one&rsquo;s MySQL hosts which communicates with and accepts commands from <em>orchestrator</em>, built with the original purpose of providing an automated solution for provisioning new or corrupted slaves.</p>
<p>It was built by <a href="https://github.com/outbrain">Outbrain</a>, with Outbrain&rsquo;s specific use case in mind. While we release it as open source, only a small part of its functionality will appeal to the public (this is why it&rsquo;s not strictly part of the <em>orchestrator</em> project, which is a general purpose, wide-audience solution). Nevertheless, it is a simple implementation of a daemon, such that can be easily extended by the community. The project is open for pull-requests!</p>
<p>A quick breakdown of <em>orchestrator-agent</em> is as follows:</p>
<ul>
<li>Executes as a daemon on linux hosts</li>
<li>Interacts and invokes OS commands (via <em>bash</em>)</li>
<li>Does not directly interact with a MySQL server running on that host (does not connect via mysql credentials)</li>
<li>Expects a single MySQL service on host</li>
<li>Can control the MySQL service (e.g. stop, start)</li>
<li>Is familiar with LVM layer on host</li>
<li>Can take LVM snapshots, mount snapshots, remove snapshots</li>
<li>Is familiar with the MySQL data directory, disk usage, file system</li>
<li>Can send snapshot data from a mounted snapshot on a running MySQL host</li>
<li>Can prepare data directory and receive snapshot data from another host</li>
<li>Recognizes local/remote datacenters</li>
<li>Controlled by <em>orchestrator,</em> two <em>orchestrator-agents</em> implement an automated and audited solution for seeding a new/corrupted MySQL host based on a running server.</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/announcing-orchestrator-agent/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/linux/zookeepercli-lightweight-powerful-controlled-command-line-client-for-zookeeper/">zookeepercli: lightweight, powerful, controlled command line client for ZooKeeper</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Sep 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/linux">Linux</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/command-line">command line</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/go">go</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/zookeeper">ZooKeeper</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I'm happy to announce the availability of zookeepercli: a lightweight, simple, fast and controlled command line client for ZooKeeper. zookeepercli allows for: Basic CRUD-like operations: create, set, delete, exists, get, ls (aka children). Extended operations: lsr (ls recursive), creater (create recursively) Well formatted and controlled output: supporting either txt or json format Single, no-dependencies binary file, based on a native Go ZooKeeper library by github.com/samuel/go-zookeeper (LICENSE) I was dissatisfied with existing command line access to ZooKeeper.
  </p>

  
  <footer>
    <a href="/blog/linux/zookeepercli-lightweight-powerful-controlled-command-line-client-for-zookeeper/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-1-0-5-refactoring-masters-multi-master-replication/">Orchestrator 1.0.5: refactoring masters, multi-master replication</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Aug 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Outbrain&rsquo;s <em>orchestrator</em> Version <strong>1.0.5</strong> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.0.5">is released</a>.</p>
<blockquote>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></blockquote>
<p><em>Orchestrator</em> now supports refactoring of masters via master-master topologies. It now allows promoting slaves as co-masters and detachment of instances from a co-master topology, effectively allowing for replacing an active master.</p>
<h4>Like this</h4>
<p>Drag a master:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/08/orchestator-cm-simple-drag-master-01.png"><img class="alignnone size-full wp-image-6965" src="/blog/assets/orchestator-cm-simple-drag-master-01.png" alt="orchestator-cm-simple-drag-master-01" width="804" height="340" /></a></blockquote>
<p>Onto one of its slaves:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-0-5-refactoring-masters-multi-master-replication/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-1-0-4-released/">Orchestrator 1.0.4 released</a></h2>

    <div class="post-meta">

  <div>

    <time>29 Jul 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Outbrain&rsquo;s <em>orchestrator</em> Version <strong>1.0.4</strong> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.0.4">is released</a>.</p>
<blockquote>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></blockquote>
<p>What&rsquo;s new?</p>
<h4>Co-masters</h4>
<p>orchestrator now does a much better visualization of Master-Master replication:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/07/orchestrator-co-masters.png"><img class="alignnone size-full wp-image-6946" src="/blog/assets/orchestrator-co-masters.png" alt="orchestrator-co-masters" width="783" height="357" /></a></blockquote>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-0-4-released/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/introducing-orchestrator-manage-and-visualize-your-mysql-replication-topologies-and-get-home-for-dinner/">Introducing Orchestrator: manage and visualize your MySQL replication topologies and get home for dinner</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Jun 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tools">tools</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m happy to announce the availability of <a href="http://www.outbrain.com/">Outbrain</a>&rsquo;s <strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong>: MySQL replication management &amp; visualization tool.</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/05/orchestrator-simple.png"><img class="alignnone size-full wp-image-6898" src="/blog/assets/orchestrator-simple.png" alt="orchestrator - simple topology" width="785" height="353" /></a></blockquote>
<ul>
<li>Orchestrator reads your replication topologies (give it one server - be it master or slave - in each topology, and it will reveal the rest).</li>
<li>It keeps a state of this topology.</li>
<li>It can continuously poll your servers to get an up to date topology map.</li>
<li>It visualizes the topology in a clear and slick D3 tree.</li>
<li>It allows you to <em>modify your topology;</em> move slaves around. You can use the command line variation, the JSON API, or you can use the web interface.</li>
</ul>
<p>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></p>
<h4>Nothing like nice screenshots</h4>
<p>To move slaves around the topology (repoint a slave to a different master) through <em>orchestrator</em>&rsquo;s web interface, we use <em>Drag and Drop</em>,</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/introducing-orchestrator-manage-and-visualize-your-mysql-replication-topologies-and-get-home-for-dinner/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/anemomaster-dml-visibility-your-must-do-for-tomorrow/">&#34;Anemomaster&#34;: DML visibility. Your must-do for tomorrow</a></h2>

    <div class="post-meta">

  <div>

    <time>18 Apr 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/anemometer">Anemometer</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/devops">DevOps</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Here&rsquo;s our take of master DML query monitoring at <a href="http://www.outbrain.com/">Outbrain</a> (<a href="https://www.percona.com/live/mysql-conference-2014/sessions/mysql-devops-outbrain">presented April 2014</a>). It took a half-day to code, implement, automate and deploy, and within the first hour of work we managed to catch multiple ill-doing services and scripts. You might want to try this out for yourself.</p>
<h4>What&rsquo;s this about?</h4>
<p>What queries do you monitor on your MySQL servers? Many don&rsquo;t monitor queries at all, and only look up slow queries on occasion, using <a href="http://www.percona.com/doc/percona-toolkit/2.2/pt-query-digest.html">pt-query-digest</a>. Some monitor slow queries, where <a href="https://github.com/box/Anemometer/wiki">Anemometer</a> (relying on pt-query-digest) is a very good tool. To the extreme, some monitor TCP traffic on all MySQL servers &ndash; good for you! In between, there&rsquo;s a particular type of queries that are of special interest: DML (<strong>INSERT/UPDATE/DELETE</strong>) queries issued against the master.</p>
<p>They are of particular interest because they are only issued once against the master, yet propagate through replication topology to execute on all slaves. These queries have a direct impact on your slave lag and on your overall replication capacity. I suggest you should be familiar with your DMLs just as you are with your slow queries.</p>
<p>In particular, we had multiple occasions in the past where all or most slaves started lagging. Frantically we would go to our metrics; yes! We would see a spike in <strong>com_insert</strong>. Someone (some service) was obviously generating more <strong>INSERT</strong>s than usual, at a high rate that the slaves could not keep up with. But, <em>which</em> <strong>INSERT</strong> was that? Blindly, we would look at the binary logs. Well, erm, what are we looking for, exactly?</p>
<p>Two such occasions convinced us that there should be a solution, but it took some time till it hit us. We were already using <em>Anemometer</em> for monitoring our slow logs. We can do the same for monitoring our binary logs. Thus was born <em>&ldquo;Anemomaster&rdquo;</em>.</p>
<p>Quick recap on how Anemometer works: you issue <em>pt-query-digest</em> on your slow logs on all MySQL hosts (we actually first ship the slow logs to a central place where we analyse them; same thing). This is done periodically, and slow logs are then rotated. You throw the output of <em>pt-query-digest</em> to a central database (this is built in with <em>pt-query-digest</em>; it doesn&rsquo;t necessarily produce human readable reports). <em>Anemometer</em> would read this central database and visualize the slow queries.</p>
<h4>Analysing DMLs</h4>
<p>But then, <em>pt-query-digest</em> doesn&rsquo;t only parse slow logs. It can parse binary logs. Instead of asking for total query time, we ask for query count, and on we go to establish the same mechanism, using same <em>pt-query-digest</em> and same <em>Anemometer</em> to store and visualize the DMLs issued on our masters.</p>
<p>When analysing DMLs we&rsquo;re interested in parsing binary logs &ndash; and it makes no sense to do the same on all slaves. All slaves just have same copy of binlog entries as the master produces. It only takes <em>one</em> server to get an accurate picture of the DMLs on your replication topology.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/anemomaster-dml-visibility-your-must-do-for-tomorrow/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/speaking-at-perconalive-common_schema-mysql-devops/">Speaking at Percona Live: common_schema, MySQL DevOps</a></h2>

    <div class="post-meta">

  <div>

    <time>10 Mar 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/devops">DevOps</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  In less than a month I'll be giving these two talks at Percona Live: common_schema: DBA's framework for MySQL If you are still unfamiliar with common_schema, this will make for a good introduction. I'll give you multiple reasons why you would want to use it, and how it would come to immediate use at your company. I do mean immediate, as in previous common_schema presentations I happened to get feedback emails from attendees within the same or next day letting me know how common_schema solved an insistent problem of theirs or how it exposed an unknown status.
  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-at-perconalive-common_schema-mysql-devops/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/introducing-audit_login-simple-mysql-login-logfile-based-auditing/">Introducing audit_login: simple MySQL login logfile based auditing</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Sep 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/plugin">plugin</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://github.com/outbrain/audit_login">audit_login</a> is a simple MySQL login auditing plugin, logging any login or login attempt to log file in JSON format.</p>
<p>It seems that audit plugins are <a href="http://serge.frezefond.com/2013/09/news-mariadb-audit-plugin-beta-is-out/">all the rage</a> lately&hellip; We&rsquo;ve developed out simple plugin a month ago as part of our database securing efforts; by auditing any login or login attempt we could either intercept or later investigate suspicious logins.</p>
<p>However we quickly realized there is much more to be gathered by this info.</p>
<p>In very short, you install this plugin onto your MySQL server, and your server starts writing into a text file called <strong>audit_login.log</strong> entries such as follows:</p>
<blockquote>
<pre>{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:11:47&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153868&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-87.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.87&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:11:55&rdquo;,&ldquo;type&rdquo;:&ldquo;failed_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153869&rdquo;,&ldquo;user&rdquo;:&ldquo;backup_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;&rdquo;,&ldquo;host&rdquo;:&ldquo;web-32&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.32&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:11:57&rdquo;,&ldquo;type&rdquo;:&ldquo;failed_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153870&rdquo;,&ldquo;user&rdquo;:&ldquo;backup_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;&rdquo;,&ldquo;host&rdquo;:&ldquo;web-32&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.32&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:12:48&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153871&rdquo;,&ldquo;user&rdquo;:&ldquo;root&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;root&rdquo;,&ldquo;host&rdquo;:&ldquo;localhost&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.111&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:13:26&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153872&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-11.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.11&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:13:44&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153873&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-40.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.40&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:13:51&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153874&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-03.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.03&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 09:14:09&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153875&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-40.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.40&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 10:55:25&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153876&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-87.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.87&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 10:55:59&rdquo;,&ldquo;type&rdquo;:&ldquo;successful_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153877&rdquo;,&ldquo;user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;web_user&rdquo;,&ldquo;host&rdquo;:&ldquo;web-12.localdomain&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.12&rdquo;}
{&ldquo;ts&rdquo;:&ldquo;2013-09-11 10:55:59&rdquo;,&ldquo;type&rdquo;:&ldquo;failed_login&rdquo;,&ldquo;myhost&rdquo;:&ldquo;gromit03&rdquo;,&ldquo;thread&rdquo;:&ldquo;74153878&rdquo;,&ldquo;user&rdquo;:&ldquo;(null)&rdquo;,&ldquo;priv_user&rdquo;:&ldquo;(null)&rdquo;,&ldquo;host&rdquo;:&ldquo;(null)&rdquo;,&ldquo;ip&rdquo;:&ldquo;10.0.0.1&rdquo;}</pre>
</blockquote>
<p>In the above your MySQL server is on <strong>gromit03</strong>, and is accepting connections from other hosts; some successful, some not. What kind of information can you gather from the above?</p>
<ul>
<li>You can tell how many connections are being created on your server</li>
<li>Where they came from</li>
<li>Where <strong>&lsquo;root&rsquo;</strong> connections come from</li>
<li>Port scans (see last row) can be identified by no credentials. These don&rsquo;t have to be port scans <em>per se</em>; any <strong>telnet localhost 3006</strong> followed by <strong>Ctrl+D</strong> will show the same. Typically these would be either load balancer or monitoring tools checks to see that the <strong>3306</strong> port is active.</li>
<li>You can tell which accounts connect, and how many times</li>
<li>And you can infer which accounts are stale and can be dropped &ndash; if an account does not connect within a week&rsquo;s time, it&rsquo;s probably stale (pick your own timeframe)</li>
</ul>
<p>The above is quite interesting on one host; but we have dozens. We&rsquo;ve installed this plugin on all our MySQL servers, and we use <a href="http://logstash.net/"><strong>logstash</strong></a> to aggregate them. We aggregate to two destinations:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/introducing-audit_login-simple-mysql-login-logfile-based-auditing/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/converting-an-olap-database-to-tokudb-part-1/">Converting an OLAP database to TokuDB, part 1</a></h2>

    <div class="post-meta">

  <div>

    <time>03 Sep 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/compression">compression</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tokudb">TokuDB</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This is the first in a series of posts describing my impressions of converting a large OLAP server to TokuDB. There&rsquo;s a lot to tell, and the experiment is not yet complete, so this is an ongoing blogging. In this post I will describe the case at hand and out initial reasons for looking at TokuDB.</p>
<p>Disclosure: I have no personal interests and no company interests; we did get friendly, useful and free advice from Tokutek engineers. TokuDB is open source and free to use, though commercial license is also available.</p>
<h4>The case at hand</h4>
<p>We have a large and fast growing DWH MySQL setup. This data warehouse is but one component in a larger data setup, which includes Hadoop, Cassandra and more. For online dashboards and most reports, MySQL is our service. We populate this warehouse mainly via Hive/Hadoop. Thus, we have an hourly load of data from Hive, as well as a larger daily load.</p>
<p>There are some updates on the data, but the majority of writes are just <strong>mysqlimport</strong>s of Hive queries.</p>
<p>Usage of this database is OLAP: no concurrency issues here; we have some should-be-fast-running queries issued by our dashboards, as well as ok-to-run-longer queries issued for reports.</p>
<p>Our initial and most burning trouble is with size. Today we use <strong>COMPRESSED</strong> InnoDB tables (<strong>KEY_BLOCK_SIZE</strong> is default, i.e. <strong>8</strong>). Our data volume sums right now at about <strong>2TB</strong>. I happen to know this translates as <strong>4TB</strong> of uncompressed data.</p>
<p>However growth of data is accelerating. A year ago we would capture a dozen GB per month. Today it is a <strong>100GB</strong> per month, and by the end of this year it may climb to <strong>150GB</strong> per month or more.</p>
<p>Our data is not sharded. We have a simple replication topology of some <strong>6</strong> servers. Machines are quite generous as detailed following. And yet, we will be running out of resources shortly: disk space (total <strong>2.7TB</strong>) is now running low and is expected to run out in about six months. One of my first tasks in Outbrain is to find a solution to our DWH growth problem. The solution could be sharding; it could be a commercial DWH product; anything that works.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/converting-an-olap-database-to-tokudb-part-1/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-2-2-better-queryscript-isolation-tokudb-table_rotate-split-params/">common_schema 2.2: better QueryScript isolation &amp; cleanup; TokuDB; table_rotate, split params</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Aug 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://code.google.com/p/common-schema/"><strong>common_schema 2.2</strong></a> is released. This is shortly after the 2.1 release; it was only meant as bug fixes release but some interesting things came up, leading to new functionality.</p>
<p>Highlights of the <strong>2.2</strong> release:</p>
<ul>
<li>Better QueryScript isolation &amp; cleanup: isolation improved across replication topology, cleanup done even on error</li>
<li>Added <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/tokudb_views.html">TokuDB related views</a></li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split</strong></a> with &ldquo;index&rdquo; hint (Ike, this is for you)</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/table_rotate.html"><strong>table_rotate()</strong></a>: a <em>logrotate</em>-like mechanism for tables</li>
<li>better throw()</li>
</ul>
<p>Drill down:</p>
<h4>Better QueryScript isolation &amp; cleanup</h4>
<p><em>common_schema</em> <strong>2.1</strong> introduced persistent tables for QueryScript. This also introduced the problem of isolating concurrent scripts, all reading from and writing to shared tables. In <strong>2.1</strong> isolation was based on session id. However although unique per machine, collisions were possible across replication topology: a script could be issued on master, another on slave (I have such use cases) and both use same (local) session id.</p>
<p>With 2.2 isolation is based on server_id &amp; session id combination; this is unique across a replication topology.</p>
<p>Until <strong>2.1</strong>, QueryScript used temporary tables. This meant any error would just break the script, and the tables were left (isolated as they were, and auto-destroyed in time). With persistent tables a script throwing an error meant legacy code piling up. With <em>common_schema</em> <strong>2.2</strong> and on MySQL &gt;= <strong>5.5</strong> all exceptions are caught, cleanup is made, leaving exceptions to be <strong>RESIGNAL</strong>led.</p>
<h4>TokuDB views</h4>
<p>A couple TokuDB related views help out in converting to TokuDB and in figuring out tables status on disk:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-2-2-better-queryscript-isolation-tokudb-table_rotate-split-params/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/tool-of-the-day-q/">Tool of the day: q</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Aug 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/linux">Linux</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/command-line">command line</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tools">tools</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  If you work with command line and know your SQL, q is a great tool to use: q allows you to query your text files or standard input with SQL. You can: SELECT c1, COUNT(*) FROM /home/shlomi/tmp/my_file.csv GROUP BY c1 And you can: SELECT all.c2 FROM /tmp/all_engines.txt AS all LEFT JOIN /tmp/innodb_engines.txt AS inno USING (c1, c2) WHERE inno.c3 IS NULL And you can also combine with your favourite shell commands and tools: grep "my_term" /tmp/my_file.txt | q "SELECT c4 FROM - JOIN /home/shlomi/static.txt USING (c1)" | xargs touch Some of q's functionality (and indeed, SQL functionality) can be found in command line tools.
  </p>

  
  <footer>
    <a href="/blog/mysql/tool-of-the-day-q/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-roadmap-thoughts/">common_schema roadmap thoughts</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Jul 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m happy with <strong><a href="https://code.google.com/p/common-schema/">common_schema</a></strong>; it is in fact a tool I use myself on an almost daily basis. I&rsquo;m also happy to see that it gains traction; which is why I&rsquo;m exposing a little bit of my thoughts on general future development. I&rsquo;d love to get feedback.</p>
<h4>Supported versions</h4>
<p>At this moment, <em>common_schema</em> supports MySQL &gt;= <strong>5.1</strong>, all variants. This includes <strong>5.5</strong>, <strong>5.6</strong>, MySQL, Percona Server &amp; MariaDB.</p>
<p><strong>5.1</strong> is today past end of line, and I&rsquo;m really missing the <strong>SIGNAL</strong>/<strong>RESIGNAL</strong> syntax that I would like to use; I can do in the meanwhile with version-specific code such as <strong>/*!50500 &hellip; */</strong>. Nevertheless, I&rsquo;m wondering whether I will eventually have to:</p>
<ul>
<li>Support different branches of <em>common_schema</em> (one that supports <strong>5.1</strong>, one that supports &gt;= <strong>5.5</strong>)</li>
<li>Stop support for <strong>5.1</strong></li>
</ul>
<p>Of course community-wise, the former is preferred; but I have limited resources, so I would like to make a quick poll here:</p>
<p>[poll id=&ldquo;3&rdquo;]</p>
<p>I&rsquo;ll use the poll&rsquo;s results as a <em>vague idea of what people use and want</em>. Or please use comments below to sound your voice!</p>
<h4>rdebug</h4>
<p>This was a crazy jump at providing a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html">stored routine debugger and debugging API</a>. From some talk I made I don&rsquo;t see this getting traction. For the time being, I don&rsquo;t see that I will concentrate my efforts on this. Actually it is almost complete. You can step-into, step-out, step-over, set breakpoints, read variables, modify variables &ndash; it&rsquo;s pretty cool.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-roadmap-thoughts/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-2-1-released-advanced-improved-split-persistent-script-tables-more-schema-analysis-and-ahem-charts/">common_schema 2.1 released: advanced &amp; improved split(), persistent script tables, more schema analysis, and (ahem) charts!</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Jul 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/charts">charts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://code.google.com/p/common-schema/"><strong>common_schema 2.1</strong></a> is released! <em>common_schema</em> is your free &amp; open source companion schema within your MySQL server, providing with a function library, scripting capabilities, powerful routines and ready-to-apply information and recommendations.</p>
<p>New and noteworthy in version <strong>2.1</strong>:</p>
<ul>
<li>Better <em>QueryScript&rsquo;</em>s <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split()</strong></a> functionality</li>
<li>Persistent tables for QueryScript: no long held temporary tables</li>
<li>Index creation analysis, further range partition analysis</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/grant_access.html"><strong>grant_access()</strong></a>: allow everyone to use <em>common_schema</em></li>
<li>Ascii charts, google charts</li>
<li><strong>debugged_routines</strong>: show routines with debug code</li>
</ul>
<p>Other minor enhancements and bugfixes not listed.</p>
<p>Here&rsquo;s a breakdown of the above:</p>
<h4>split() enhancements</h4>
<p><strong><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html">split</a></strong> is one of those parts of <em>common_schema</em> that (should) appeal to every DBA. Break a huge transaction automagically into smaller chunks, and don&rsquo;t worry about how it&rsquo;s done. If you like, throttle execution, or print progress, or&hellip;</p>
<p><em>split</em> enhancements include:</p>
<ul>
<li>A much better auto-detection-and-selection of the chunking index. <em>split</em> now consults all columns covered by the index, and uses realistic heuristics to decide which <strong>UNIQUE KEY</strong> on your table is best for the chunking process. A couple bugs are solved on the way; <em>split</em> is much smarter now.</li>
<li>Better support for multi-column chunking keys. You may now utilize the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html#parameters"><strong>start</strong>/<strong>stop</strong> parameters</a> even on multi column keys, passing a comma delimited of values for the <em>split</em> operation to start/end with, respectively. Also fixed issue for nonexistent <strong>start/stop</strong> values, which are now valid: <em>split</em> will just keep to the given range.</li>
<li>split no longer requires a temporary table open through the duration of its operation. See next section.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-2-1-released-advanced-improved-split-persistent-script-tables-more-schema-analysis-and-ahem-charts/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mycheckpoint-revision-released/">mycheckpoint revision 231 released</a></h2>

    <div class="post-meta">

  <div>

    <time>23 May 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  A new release for mycheckpoint: lightweight, SQL oriented MySQL monitoring solution. If you're unfamiliar with mycheckpoint, well, the one minute sales pitch is: it's a free and open source monitoring tool for MySQL, which is extremely easy to install and execute, and which includes custom queries, alerts (via emails), and out of the box HTTP server and charting. This is mostly a maintenance release, with some long-time requested features, and of course solved bugs.
  </p>

  
  <footer>
    <a href="/blog/mysql/mycheckpoint-revision-released/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/opeark-kit-revision-196-released/">opeark-kit revision 196 released</a></h2>

    <div class="post-meta">

  <div>

    <time>07 May 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This is a long due maintenance release of <a href="http://code.google.com/p/openarkkit/"><strong>openark-kit</strong>.</a> This release includes bugfixes and some enhancements, mainly to <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-online-alter-table.html">oak-online-alter-table</a>.</p>
<p><em>oak-online-alter-table</em> Changes / bug fixes include:</p>
<ul>
<li>Support for keyword-named columns</li>
<li>Use of FORCE INDEX due to lack of MySQL&rsquo;s ability for figure out the chunking key at all times</li>
<li><strong>&ndash;sleep-ratio</strong> option added; allows for sleep time proportional to execution time (as opposed to constant sleep time with <strong>&ndash;sleep</strong>)</li>
<li>Support for chunk-retry (in case of deadlock) via <strong>&ndash;max-lock-retries</strong>)</li>
<li>Fixed order of cleanup</li>
<li>Fixed bug with verbose messages with non-integer chunking key</li>
<li>Fixed bug with single-row tables (people, no need for this tool for single row tables :))</li>
<li>Friendly verbose messages to remind you what&rsquo;s being executed</li>
</ul>
<p><em>oak-chunk-update</em> changes includes:</p>
<ul>
<li>Verbosing query comment if exists (friendly printing of what&rsquo;s being executed)</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/opeark-kit-revision-196-released/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-2-0-0-alpha-rdebug-gpl/">common_schema 2.0.0-alpha: rdebug, GPL</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Apr 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/rdebug">rdebug</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tools">tools</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A new release for <a href="https://code.google.com/p/common-schema/">common_schema</a>: an alpha version of <strong><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html">rdebug</a>: MySQL Debugger and Debugging API</strong> is now included with <em>common_schema</em>.</p>
<p>With a different license in mind for <em>rdebug</em>, <em>common_schema</em> changes license to GPL (2 or above).</p>
<p><em>common_schema 2.0</em> is ready for <a href="http://code.google.com/p/common-schema/downloads/list">download</a>. All things <strong>rdebug</strong>, it is alpha &ndash; otherwise it&rsquo;s a stable release.</p>
<h4>rdebug</h4>
<p>I&rsquo;m very happy to release this alpha version of <em>rdebug</em>, and urge everyone to try it out.</p>
<p>The idea is to have an open, free, server side debugger and debugging API for MySQL stored routines. To elaborate:</p>
<ul>
<li>It&rsquo;s server side by that it&rsquo;s implemented by stored routines. Not by a connector; not an emulator; not a GUI tool hack. The entire functionality lies within common_schema, a schema in your server.</li>
<li>It&rsquo;s a debugger: you can debug your own stored routines (with limitations)</li>
<li>It&rsquo;s a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug_api.html"><strong>debugging API</strong></a>: there&rsquo;s a distinct specification and a set of calls which makes for a debugging process</li>
<li>It&rsquo;s open since the source code is yours to browse.</li>
<li>It&rsquo;s free as in free beer.</li>
<li>It&rsquo;s free as it makes you independent of a specific debugger. It provides an API that anyone can use. You can run the API yourself from the command line; or plugins for your favorite GUI editor can be developed to use this API.</li>
</ul>
<p>On a separate blog post I will take you to a <em>rdebug</em> test drive.</p>
<p>As always, nothing is released before extensive <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html">documentation</a> is in place.</p>
<p>I&rsquo;d love to get input on this.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-2-0-0-alpha-rdebug-gpl/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/assistance-wanted-dotorg-pavilion-on-percona-live-2013/">Assistance wanted: DotOrg Pavilion on Percona Live 2013</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Apr 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I'm looking for assistance in manning a DotOrg Pavilion on the upcoming Percona Live conference in Santa Clara. As you may or may not know, free and open source projects are eligible to ask for a free booth on the Expo hall. This is a good chance to promote one's project. Of course, someone must stand behind the counter and answer [technical] questions. I should like to have a booth for common_schema &amp; openark-kit, but am limited in resources -- namely the number of bodies I can occupy simultaneously, just one at this time.
  </p>

  
  <footer>
    <a href="/blog/mysql/assistance-wanted-dotorg-pavilion-on-percona-live-2013/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/re-mysql-5-1-vs-mysql-5-5-floats-doubles-and-scientific-notation/">Re: MySQL 5.1 vs. MySQL 5.5: Floats, Doubles, and Scientific Notation</a></h2>

    <div class="post-meta">

  <div>

    <time>24 Jan 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-types">Data Types</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/percona-toolkit">Percona Toolkit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Reading Sheeri&rsquo;s <a href="http://blog.mozilla.org/it/2013/01/17/mysql-5-1-vs-mysql-5-5-floats-doubles-and-scientific-notation/">MySQL 5.1 vs. MySQL 5.5: Floats, Doubles, and Scientific Notation</a>, I was baffled at this change of floating point number notation.</p>
<p>However, I was also concerned about the final action taken: using <strong>&rdquo;&ndash;ignore-columns&rdquo;</strong> to avoid comparing the <strong>FLOAT</strong>/<strong>DOUBLE</strong> types.</p>
<p>The <a href="http://www.percona.com/doc/percona-toolkit/2.0/pt-table-checksum.html#cmdoption-pt-table-checksum--float-precision">&ndash;float-precision</a> option for <em>pt-table-checksum</em> currently only uses <strong>ROUND()</strong> so as to disregard minor rounding issues. But it can very easily extend to handle the difference in floating point notation. Consider again the problem:</p>
<blockquote>
<pre>mysql&gt; create table tf(f float);
Query OK, 0 rows affected (0.11 sec)</p>

<p>mysql&gt; insert into tf values(0.0000958084);
Query OK, 1 row affected (0.04 sec)</p>

<p>mysql-<strong>5.1</strong>&gt; select * from tf;
+&mdash;&mdash;&mdash;&mdash;-+
| f           |
+&mdash;&mdash;&mdash;&mdash;-+
| 9.58084e-05 |
+&mdash;&mdash;&mdash;&mdash;-+</p>

<p>mysql-<strong>5.5</strong>&gt; select * from tf;
+&mdash;&mdash;&mdash;&mdash;&ndash;+
| f            |
+&mdash;&mdash;&mdash;&mdash;&ndash;+
| 0.0000958084 |
+&mdash;&mdash;&mdash;&mdash;&ndash;+</pre>
</blockquote>
<p>How can we normalize the notation?</p>
<p>Easily: <strong>CAST</strong> it as <strong>DECIMAL</strong>. Consider:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/re-mysql-5-1-vs-mysql-5-5-floats-doubles-and-scientific-notation/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-1-3-security-goodies-parameterized-split-json-to-xml-query-checksum/">common_schema: 1.3: security goodies, parameterized split(), json-to-xml, query checksum</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Jan 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>common_schema <strong>1.3</strong> is released and is <a href="http://code.google.com/p/common-schema">available for download</a>. New and noteworthy in this version:</p>
<ul>
<li>Parameterized <strong><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html">split()</a></strong>: take further control over huge transactions by breaking them down into smaller chunks, now manually tunable if needed</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/duplicate_grantee.html"><strong>duplicate_grantee()</strong></a>: copy+paste existing accounts along with their full set of privileges</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/similar_grants.html"><strong>similar_grants</strong></a>: find which accounts share the exact same set of privileges (i.e. have the same <em>role</em>)</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/json_to_xml.html"><strong>json_to_xml()</strong></a>: translate any valid JSON object into its equivalent XML form</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/extract_json_value.html"><strong>extract_json_value()</strong></a>: use XPath notation to extract info from JSON data, just as you would from XML</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_checksum.html"><strong>query_checksum()</strong></a>: given a query, calculate a checksum on the result set</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/random_hash.html"><strong>random_hash()</strong></a>: get a 40 hexadecimal digits random hash, using a reasonably large changing input</li>
</ul>
<p>Let&rsquo;s take a closer look at the above:</p>
<h4>Parameterized split()</h4>
<p><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split</strong></a> takes your bulk query and automagically breaks it down into smaller pieces. So instead of one huge <strong>UPDATE</strong> or <strong>DELETE</strong> or <strong>INSERT..SELECT</strong> transaction, you get many smaller transactions, each with smaller impact on I/O, locks, CPU.</p>
<p>As of <strong>1.3</strong>, <em>split()</em> gets more exposed: you can have some control on its execution, and you also get a lot of very interesting info during operation.</p>
<p>Here&rsquo;s an example of <em>split()</em> control:</p>
<blockquote>
<pre>set @script := &ldquo;
  <strong>split</strong>({<em>start</em>:7015, <em>step</em>:2000} : <span style="color: #3366ff;">UPDATE sakila.rental SET return_date = return_date + INTERVAL 1 DAY</span>)
    <strong>throttle</strong> 1;
&ldquo;;
call common_schema.run(@script);</pre>
</blockquote>
<p>In the above we choose a split size of 2,000 rows at a time; but we also choose to only start with <strong>7015</strong>, skipping all rows prior to that value. Just what is that value? It depends on the splitting key (and see next example for just that); but in this table we can safely assume this is the <strong>rental_id</strong> <strong>PRIMARY KEY</strong> of the table.</p>
<p>You don&rsquo;t <em>have to</em> use these control <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html#parameters">parameters</a>. But they can save you some time and effort.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-1-3-security-goodies-parameterized-split-json-to-xml-query-checksum/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-1-2-security-partition-management-processes-queryscript-goodies/">common_schema 1.2: security, partition management, processes, QueryScript goodies</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Nov 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/partitioning">partitioning</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="http://code.google.com/p/common-schema">common_schema</a> <strong>1.2</strong> is released! This version comes shortly after <strong>1.1</strong>, yet contains quite a few interesting goodies:</p>
<ul>
<li>Account blocking</li>
<li>Security audit</li>
<li>RANGE partition management</li>
<li>Slave status</li>
<li>Better blocking and idle transaction management</li>
<li><em>QueryScript </em>goodies:
<ul>
<li>echo, report</li>
<li>while-otherwise statement; foreach-otherwise statement</li>
<li>Better variable scope handling</li>
<li>Complete support for variable expansion</li>
<li>Transaction support within QueryScript</li>
</ul>
</li>
<li>More summary info and SQL statements in processlist-related views</li>
</ul>
<p>A closer look at these follows:</p>
<h4>Account blocking</h4>
<p>A new view called <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_accounts.html"><strong>sql_accounts</strong></a>, inspired by <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-block-account.html">oak-block-account</a> (also see <a href="http://code.openark.org/blog/mysql/blocking-user-accounts">here</a> and <a href="http://code.openark.org/blog/mysql/pop-quiz-what-is-the-most-basic-privilege-an-account-can-be-assigned-with">here</a>) provides with the means of blocking use accounts (and releasing them, of course) without revoking their privileges. It offers the SQL statements to block an account (by modifying its password in a symmetric way) and to release an account (by modifying its password back to normal). It really works like a charm. Together with <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/killall.html">killall()</a> and <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">sql_accounts</a> this gives the administrator great control over accounts.</p>
<h4>Security audit</h4>
<p>Imported from <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-security-audit.html">openark kit</a>, and implemented via <em>QueryScript</em>, the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/security_audit.html"><strong>security_audit()</strong></a> procedure will audit your accounts, passwords and general settings to find problems, pitfalls and security hazards. I will write more on this later.</p>
<h4>RANGE partition management</h4>
<p>The <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_range_partitions.html"><strong>sql_range_partitions</strong></a> view manages your <strong>RANGE</strong> and <strong>RANGE COLUMNS</strong> partitioned tables by providing with the SQL statements to drop oldest partitions and to create the next (in sequence) partitions. See my <a href="http://code.openark.org/blog/mysql/your-magical-range-partitioning-maintenance-query">earlier post</a>.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-1-2-security-partition-management-processes-queryscript-goodies/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-1-1-released-split-try-catch-killall-profiling/">common_schema 1.1 released: split(), try-catch, killall(), profiling</a></h2>

    <div class="post-meta">

  <div>

    <time>04 Sep 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m very happy to announce the release of <a href="http://code.google.com/p/common-schema/">common_schema</a>, version <strong>1.1</strong> (revision <strong>300</strong>).</p>
<p>This version boasts with compelling new features: innovative QueryScript syntax, libraries, views which add to your skills as a DBA, making some maintenance and management tasks a breeze.</p>
<ul>
<li>QueryScript, <strong>split</strong> statement: automagically break long queries into smaller chunks, avoid long locks and reduce query/transaction overhead</li>
<li>QueryScript, <strong>try-catch</strong> statement: just <strong>try { something; } catch { act_on_error; }</strong>.</li>
<li><strong>killall()</strong>: quickly kill connections based on grantee/user/host information.</li>
<li><strong>profiling</strong>/<strong>profiling_last</strong>: utility views to assist in query profiling diagnostics</li>
<li><strong>1 size fits all</strong>: a single installer which auto-recognizes available server features and enables respective <em>common_schema</em> features accordingly.</li>
<li>QueryScript performance boost</li>
<li>much much more&hellip;</li>
</ul>
<p>Not familiar with <em>common_schema</em>? It allows you to do stuff on server side, by selecting from views, calling upon useful routines or writing <em>easy-to-manage</em> scripts.</p>
<p>I&rsquo;m suggesting that <em>common_schema</em> should be a <em>really-should-have</em> tool to accompany your MySQL install. Did I say &ldquo;tool&rdquo;? It&rsquo;s merely a <em>schema</em>. But it makes for a great framework:</p>
<p>In <a href="http://www.amazon.com/High-Performance-MySQL-Optimization-Replication/dp/1449314287/ref=dp_ob_title_bk">High Performance MySQL, 3rd edition</a>, Baron Schwartz describes <em>common_schema</em>:</p>
<blockquote>The <em>common_schema</em> is to MySQL as jQuery is to javaScript</blockquote>
<p>Reviewing highlights for version <strong>1.1</strong>:</p>
<h4>QueryScript</h4>
<p><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">QueryScript</a> is a scripting language. It sees some major improvements here. I&rsquo;ve made some speed boosts by <a href="http://code.openark.org/blog/mysql/on-stored-routines-and-dynamic-statements">avoiding using temporary tables</a>, and by using string parsing instead.</p>
<p>Without doubt the two most handy statements added to <em>QueryScript</em> are:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-1-1-released-split-try-catch-killall-profiling/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/sphinx-sphinx_snippets-mysql-5-5/">sphinx, sphinx_snippets() &amp; MySQL 5.5</a></h2>

    <div class="post-meta">

  <div>

    <time>21 Mar 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sphinx">Sphinx</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;ve written a patch which completes Sphinx&rsquo;s integration with MySQL <strong>5.5</strong>.</p>
<p>Up until a couple months ago, Sphinx would not compile with MySQL <strong>5.5</strong> at all. This is, thankfully, resolved as of Sphinx <strong>2.0.3</strong>.</p>
<p>However, to my disdain, I&rsquo;ve found out that it only partially work: the <a href="http://sphinxsearch.com/docs/manual-2.0.4.html#sphinxse-snippets">sphinx_snippets()</a> user defined function is not included within the plugin library. After some quick poking I discovered that it was not added to the build, and when added, would not compile.</p>
<p>I rely on <strong>sphinx_snippets()</strong> quite a lot, and like it. Eventually I wrote the fix to the <strong>snippets_udf.cc</strong> which allows it to run in a MySQL <strong>5.5</strong> server.</p>
<p>Here are the changes for the <strong>2.0.4</strong> version of Sphinx:</p>
<ul>
<li><a href="http://code.openark.org/blog/wp-content/uploads/2012/03/snippets_udf.cc">snippets_udf.cc</a></li>
<li><a href="http://code.openark.org/blog/wp-content/uploads/2012/03/CMakeLists.txt">CMakeLists.txt</a></li>
</ul>
<p>Replace your <strong>2.0.4</strong> files with these two and get on compiling your MySQL server.</p>
<h4>Compilation guide</h4>
<p>For completeness, here&rsquo;s how to compile Percona Server <strong>5.5</strong> with Sphinx <strong>2.0.4</strong> including the above patches:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sphinx-sphinx_snippets-mysql-5-5/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-rev-218-queryscript-throttling-processes-documentation/">common_schema rev. 218: QueryScript, throttling, processes, documentation</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Feb 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/administration">Administration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="http://code.google.com/p/common-schema/">common_schema</a>, revision <strong>218</strong> is released, with major new features, top one being <em>server side scripting</em>. Here are the highlights:</p>
<ul>
<li><a href="http://www.queryscript.com/"><strong>QueryScript</strong></a>: server side scripting is now supported by <em>common_schema</em>, which acts as an interpreter for QueryScript code.</li>
<li>Throttling for queries is now made available via the <strong>throttle()</strong> function.</li>
<li>Enhancements to processlist-related views, including the new <strong>slave_hosts</strong> view.</li>
<li>Inline documentation/help is available via the <strong>help()</strong> routine.</li>
<li>more&hellip;</li>
</ul>
<h4>QueryScript</h4>
<p><em>common_schema</em> makes for a QueryScript implementation for MySQL. You can run server side scripts, interpreted by <em>common_schema</em>, which allow for easy syntax and greater power than was otherwise previously available on the MySQL server. For example:</p>
<blockquote>
<pre>foreach($table, $schema, $engine: table like &lsquo;%&rsquo;)
  if ($engine = &lsquo;ndbcluster&rsquo;)
    ALTER ONLINE TABLE :$schema.:$table REORGANIZE PARTITION;</pre>
</blockquote>
<p>QueryScript includes flow control, conditional branching, variables &amp; variable expansion, script throttling and more.</p>
<p>Read more on <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">common_schema&rsquo;s QueryScript implementation</a>.</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-rev-218-queryscript-throttling-processes-documentation/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/queryscript-sql-scripting-language/">QueryScript: SQL scripting language</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Feb 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/administration">Administration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Introducing <strong><a href="http://www.queryscript.com/">QueryScript</a></strong>: a programming language aimed for SQL scripting, seamlessly combining scripting power such as flow control &amp; variables with standard SQL statements or RDBMS-specific commands.</p>
<p>QueryScript is available fro MySQL via <a href="http://code.google.com/p/common-schema">common_schema</a>, which adds MySQL-specific usage.</p>
<p><em>What does QueryScript look like?</em> Here are a few code samples:</p>
<p>Turn a bulk DELETE operation into smaller tasks. Throttle in between.</p>
<blockquote>
<pre>while (DELETE FROM archive.events WHERE ts &lt; CURDATE() LIMIT 1000)
{
  throttle 2;
}</pre>
</blockquote>
<p>Convert all InnoDB tables in the &lsquo;sakila&rsquo; database to compressed format:</p>
<blockquote>
<pre>foreach ($table, $schema, $engine: table in sakila)
{
  if ($engine = &lsquo;InnoDB&rsquo;)
    ALTER TABLE :$schema.:$table ENGINE=InnoDB ROW_FORMAT=COMPRESSED KEY_BLOCK<em>SIZE=8;
}</pre>
</blockquote>
<p>Shard your data across multiple schemata:</p>
<blockquote>
<pre>foreach($shard: {USA, GBR, JAP, FRA})
{
  CREATE DATABASE db</em>:$shard;
  CREATE TABLE db<em>:$shard.city LIKE world.City;
  INSERT INTO db</em>:$shard.city SELECT * FROM world.City WHERE CountryCode = $shard;
}</pre>
</blockquote>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/queryscript-sql-scripting-language/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/documentation-in-sql-call-for-help/">Documentation in SQL: CALL for help()</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Jan 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/documentation">documentation</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Documentation is an important part of any project. On the projects I maintain I put a lot of effort on documentation, and, frankly, the majority of time spent on my projects is on documentation.</p>
<p>The matter of keeping the documentation faithful is a topic of interest. I&rsquo;d like to outline a few documentation bundling possibilities, and the present the coming new documentation method for <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>. I&rsquo;ll talk about any bundling that is NOT <em>man pages</em>.</p>
<h4>High level: web docs</h4>
<p>This is the initial method of documentation I used for <a title="openark kit" href="../../forge/openark-kit">openark kit</a> and <a title="mycheckpoint" href="../../forge/mycheckpoint">mycheckpoint</a>. It&rsquo;s still valid for <em>mycheckpoint</em>. Documentation is web-based. You need Internet access to read it. It&rsquo;s in HTML format.</p>
<p>Well, not exactly HTML format: I wrote it in WordPress. Yes, it&rsquo;s HTML, but there&rsquo;s a lot of noise around (theme, menus, etc.) which is not strictly part of the documentation.</p>
<p>While this is perhaps the easiest way to go, here&rsquo;s a few drawbacks:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/documentation-in-sql-call-for-help/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/oracle-technologist-of-the-year-developer-award/">Oracle &#34;Technologist of the Year: Developer&#34; Award</a></h2>

    <div class="post-meta">

  <div>

    <time>21 Dec 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/award">award</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I am honored to receive <a href="http://www.oracle.com/technetwork/issue-archive/2012/12-jan/o12awards-tech-1403083.html">Oracle&rsquo;s Technologist of the Year: Developer</a> award, formerly <em>Oracle Magazine</em> Editors’ Choice Awards.</p>
<p>Technologist of the Year Award is given for individuals for their technical achievements with regard to Oracle products.</p>
<p>As opposed to <a href="http://code.openark.org/blog/mysql/mysql-conference-2009-community-awards">community</a> based <a href="http://code.openark.org/blog/mysql/oracle-ace">awards</a>, to win this award one must be <a href="http://www.oracle.com/us/corporate/awards/technologist/index.html">nominated</a> by himself or his company. There are several award categories: Developer, DBA, IT Manager etc., and many nominations per category. I have been nominated by my company and am happy to have won the award in the Developer category.</p>
<p>Allow me to take the pleasant opportunity to make some acknowledgements.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/oracle-technologist-of-the-year-developer-award/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/more-mysql-foreach/">More MySQL foreach()</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Dec 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In my <a href="http://code.openark.org/blog/mysql/mysql-foreach">previous post</a> I&rsquo;ve shown several generic use cases for <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/foreach.html"><em>foreach()</em></a>, a new scripting functionality introduced in <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>.</p>
<p>In this part I present DBA&rsquo;s handy syntax for schema and table operations and maintenance.</p>
<p>Confession: while I love <strong>INFORMATION_SCHEMA</strong>&rsquo;s power, I just <em>hate</em> writing queries against it. It&rsquo;s just so much typing! Just getting the list of tables in a schema makes for this heavy duty query:</p>
<blockquote>
<pre>SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA=&lsquo;sakila&rsquo; AND TABLE_TYPE=&lsquo;BASE TABLE&rsquo;;</pre>
</blockquote>
<p>When a join is involved this really becomes a nightmare. I think it&rsquo;s cumbersome, and as result, many do not remember the names and meaning of columns, making for <em>&ldquo;oh, I need to read the manual all over again just to get that query right&rdquo;</em>. Anyway, that&rsquo;s my opinion.</p>
<p>A <strong>SHOW TABLES</strong> statement is easier to type, but cannot be integrated into a <strong>SELECT</strong> query (though <a href="http://code.openark.org/blog/mysql/reading-results-of-show-statements-on-server-side">we have a partial solution</a> for that, too), and besides, when filtering out the views, the <strong>SHOW</strong> statement becomes almost as cumbersome as the one on <strong>INFORMATION_SCHEMA</strong>.</p>
<p>Which is why <em>foreach()</em> offers handy shortcuts to common iterations on schemata and tables, as follows:</p>
<h4>Use case: iterate all databases</h4>
<blockquote>
<pre>call foreach(<span style="color: #808000;">&lsquo;schema&rsquo;</span>, <span style="color: #003366;">&lsquo;CREATE TABLE ${schema}.event(event<em>id INT, msg VARCHAR(128))&rsquo;</span>);</pre>
</blockquote>
<p>In the above we execute a query on each database. Hmmm, maybe not such a good idea to perform this operation on all databases? Let&rsquo;s filter them:</p>
<h4>Use case: iterate databases by name match</h4>
<blockquote>
<pre>call foreach(<span style="color: #808000;">&lsquo;schema like wordpress</em>%&rsquo;</span>, <span style="color: #003366;">&lsquo;ALTER TABLE ${schema}.wp_posts MODIFY COLUMN comment_author VARCHAR(96) NOT NULL&rsquo;</span>);</pre>
</blockquote>
<p>The above will only iterate my WordPress databases (I have several of these), performing an <strong>ALTER</strong> on <strong>wp_posts</strong> for each of those databases.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/more-mysql-foreach/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-rev-178-foreach-repeat_exec-roland-bouman-query-analysis/">common_schema, rev. 178: foreach(), repeat_exec(), Roland Bouman, query analysis</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Dec 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>, revision <strong>178</strong> is now released, with major additions. This revision turns <em>common_schema</em> into a <em>framework</em>, rather than a set of views and functions.</p>
<p><em>common_schema</em> provides with query scripting, analysis &amp; informational views, and a function library, allowing for easier administration and diagnostics for MySQL. It introduces SQL based tools which simplify otherwise complex shell and client scripts, allowing the DBA to be independent of operating system, installed packages and dependencies.</p>
<p>There&rsquo;s no Perl nor Python, and no dependencies to install. It&rsquo;s just a <em>schema</em>.</p>
<p>Some highlights for the new revision:</p>
<ul>
<li><strong>foreach()</strong>, aka <strong>$()</strong>: loop through a collection, execute callback commands per element.</li>
<li><strong>repeat_exec()</strong>: a repeat-until device: execute queries until some condition holds.</li>
<li><strong>exec_file()</strong>: execute files a-la SOURCE, but on server side</li>
<li><strong>Query analysis</strong>: analyze query text, view or routine definitions to detect dependency objects.</li>
<li>Improvements to views and routines, new routines introduced.</li>
</ul>
<p>Let&rsquo;s take a closer look:</p>
<h4>rpbouman</h4>
<p>I&rsquo;m very happy to have <a href="http://rpbouman.blogspot.com/">Roland Bouman</a> working on this project. He introduced some sophisticated code without which some functionality could not take place. I&rsquo;m sure I don&rsquo;t need to introduce his great capabilities; I&rsquo;ll just pass the note that it is very good working with him!</p>
<h4>foreach()</h4>
<p>Introducing a looping device which can iterate a collection and execute callback commands.</p>
<p>What&rsquo;s a collection? A range of numbers; a set of constants; the result set of a <strong>SELECT</strong> query; tables in your database and more.</p>
<p>What is a callback? A query or set of queries to invoke on the specific elements in the collection. For example:</p>
<blockquote>
<pre>call <strong>foreach</strong>(<span style="color: #808000;">&lsquo;table in sakila&rsquo;</span>, <span style="color: #000080;">&lsquo;ALTER TABLE ${schema}.${table} ENGINE=InnoDB ROW_FORMAT=COMPRESSED&rsquo;</span>);</pre>
</blockquote>
<p>I&rsquo;ll publish dedicated posts on <em>foreach()</em>, aka <em>$()</em>, following this post. Official documentation is <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/foreach.html">here</a>.</p>
<h4>repeat_exec()</h4>
<p>Repeat executing queries in a given interval, until some condition holds.</p>
<p>What kind of condition? You can loop forever, or until a given time has passed, a given number of iteration has passed.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-rev-178-foreach-repeat_exec-roland-bouman-query-analysis/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/oracle-ace/">Oracle ACE</a></h2>

    <div class="post-meta">

  <div>

    <time>04 Nov 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/award">award</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I am honored to have been nominated for, and to have received the Oracle ACE award. Nomination for this award is made by Oracle community members, and in this case those being Oracle employees Keith Larson and Dave Stokes. The award is given by Oracle for my involvement in the Oracle/MySQL community and for my contributions. While open source involvement is generally done in the mere purpose of sharing knowledge and solutions, recognition plays a role in it.
  </p>

  
  <footer>
    <a href="/blog/mysql/oracle-ace/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-rev-68-eval-processlist_grantees-candidate_keys-easter_day/">common_schema rev. 68: eval(), processlist_grantees, candidate_keys, easter_day()</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Sep 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Revision <strong>68</strong> of <a rel="nofollow" href="http://code.google.com/p/common-schema/">common_schema</a> is out, and includes some interesting features:</p>
<ul>
<li><strong>eval()</strong>: Evaluates the queries generated by a given query</li>
<li><strong>match_grantee()</strong>: Match an existing account based on user+host</li>
<li><strong>processlist_grantees</strong>: Assigning of GRANTEEs for connected processes</li>
<li><strong>candidate_keys</strong>: Listing of prioritized candidate keys: keys which are UNIQUE, by order of best-use.</li>
<li><strong>easter_day()</strong>: Returns DATE of easter day in given DATETIME&rsquo;s year.</li>
</ul>
<p>Let&rsquo;s take a slightly closer look at these:</p>
<h4>eval()</h4>
<p>I&rsquo;ve dedicated this blog post on <a href="http://code.openark.org/blog/mysql/mysql-eval">MySQL eval()</a> to describe it. In simple summary: <strong>eval()</strong> takes a query which generates queries (most common use queries on <strong>INFORMATION_SCHEMA</strong>) and auto-evaluates (executes) those queries. <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/general_procedures.html#eval">Read more</a></p>
<h4>match_grantee()</h4>
<p>As presented in <a title="Link to Finding CURRENT_USER for any user" rel="bookmark" href="http://code.openark.org/blog/mysql/finding-current_user-for-any-user">Finding CURRENT_USER for any user</a>, I&rsquo;ve developed the algorithm to match a connected user+host details (as presented with <strong>PROCESSLIST</strong>) with the grantee tables (i.e. the <strong>mysql.user</strong> table), in a manner which simulates the MySQL server account matching algorithm.</p>
<p>This is now available as a stored function: given a user+host, the function returns with the best matched grantee. <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/privileges_functions.html#match_grantee">Read more</a></p>
<h4>processlist_grantees</h4>
<p>This view relies on the above, and maps the entire <strong>PROCESSLIST</strong> onto GRANTEEs. The view maps each process onto the GRANTEE (MySQL account) which is the owner of that process. Surprisingly, MySQL does not provide one with such information.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-rev-68-eval-processlist_grantees-candidate_keys-easter_day/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/speaking-at-august-penguin-2011/">Speaking at &#34;August Penguin 2011&#34;</a></h2>

    <div class="post-meta">

  <div>

    <time>03 Aug 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I will be speaking at August Penguin 2011 (אוגוסט פינגווין), on August 12th in Ramat-Gan, Israel. August Penguin is the annual meeting of Hamakor society: an Israeli society for Free Software and Open-Source Code (read more here). I'll be holding a non-technical talk about MySQL, titled "MySQL and the Open Source Sphere". In this talk I will be presenting my impressions of the nature of open source development of MySQL and surroundings: the core server, the various forks, patches, 3rd party tools, companies involved, etc.
  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-at-august-penguin-2011/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/common_schema-looking-for-contributions/">common_schema: looking for contributions</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Jul 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  In my announcement for common_schema I have failed to deliver the following message: I will be happy to receive contributions to common_schema, and I will be happy to have contributors on this project What kind of contributions are wanted? So, I'm mostly interested right now in: Views: providing more insight on metadata (data types, schemata, volumes, transactions, locks, connections, etc.) Views: SQL code generation (e.g. generate my FOREIGN KEYs) Functions: DETERMINISTIC, NO SQL, preferably no control flow inside, making for simple calls what is usually a typical, repeating function combination.
  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-looking-for-contributions/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/announcing-common_schema-common-views-routines-for-mysql/">Announcing common_schema: common views &amp; routines for MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Jul 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-types">Data Types</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/schema">Schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Today I have released <a title="common_schema" href="http://code.openark.org/forge/common_schema">common_schema</a>, a utility schema for MySQL which includes many views and functions, and is aimed to be installed on any MySQL server.</p>
<h4>What does it do?</h4>
<p>There are views answering for all sorts of useful information: stuff related to schema analysis, data dimensions, monitoring, processes &amp; transactions, security, internals&hellip; There are basic functions answering for common needs.</p>
<p>Some of the views/routines simply formalize those queries we tend to write over and over again. Others take the place of external tools, answering complex questions via SQL and metadata. Still others help out with SQL generation.</p>
<p>Here are a few highlights:</p>
<ul>
<li>Did you know you can work out <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/global_status_diff_nonzero.html">simple monitoring</a> of your server with a <em>query</em>?  There&rsquo;s a view to do that for you.</li>
<li>How about showing just <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/processlist_top.html">the good parts of the processlist</a>?</li>
<li>Does your schema have <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/redundant_keys.html">redundant keys</a>?</li>
<li>Or InnoDB tables with <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/no_pk_innodb_tables.html">no PRIMARY KEY</a>?</li>
<li>Is AUTO_INCREMENT <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/auto_increment_columns.html">running out of space</a>?</li>
<li>Can I get the SQL statements to <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_foreign_keys.html">generate my FOREIGN KEYs</a>? To drop them?</li>
<li>And can we finally get <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">SHOW GRANTS for all accounts</a>, and as an <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">SQL query</a>?</li>
<li>Ever needed a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/general_functions.html#crc64">64 bit CRC function</a>?</li>
<li>And aren&rsquo;t you tired of writing the cumbersome SUBSTRING_INDEX(SUBSTRING_INDEX(str, &lsquo;,&rsquo;, 3), &lsquo;,&rsquo;, -1)? <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/string_functions.html#split_token">There&rsquo;s an alternative</a>.</li>
</ul>
<p>There&rsquo;s more. Take a look at the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/introduction.html">common_schema documentation</a> for full listing. And it&rsquo;s evolving: I&rsquo;ve got quite a few ideas already for future components.</p>
<p>Some of these views rely on heavyweight INFORMATION_SCHEMA tables. You should be aware of the impact and <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/risks.html">risks</a>.</p>
<h4>What do I need to install?</h4>
<p>There&rsquo;s no script or executable file. It&rsquo;s just a schema. The distribution in an SQL file which generates <em>common_schema</em>. Much like a dump file.</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/announcing-common_schema-common-views-routines-for-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/routine_privileges-implementation/">ROUTINE_PRIVILEGES implementation</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Jun 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/views">Views</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Following up on MySQL security: inconsistencies, and on MySQL bug #61596, I was thinking it may take a long time till the non-existent ROUTINE_PRIVILEGES view is implemented. Here's my own implementation of the view. I've followed the somewhat strange conventions used in the *_PRIVILEGES tables in INFORMATION_SCHEMA, where the IS_GRANTABLE is a separate column, although in 2nd 1st normal form. I present it here as a query, using session variables, rather than a view definition: SELECT STRAIGHT_JOIN CONCAT('\'', User, '\'@\'', Host, '\'') AS GRANTEE, NULL AS ROUTINE_CATALOG, Db AS ROUTINE_SCHEMA, Routine_name AS ROUTINE_NAME, Routine_type AS ROUTINE_TYPE, UPPER(SUBSTRING_INDEX(SUBSTRING_INDEX(Proc_priv, ',', n+1), ',', -1)) AS PRIVILEGE_TYPE, IF(grantable_procs_priv.User IS NULL, 'NO', 'YES') AS IS_GRANTABLE FROM mysql.procs_priv CROSS JOIN (SELECT @counter := -1) select_init CROSS JOIN ( SELECT @counter := @counter+1 AS n FROM INFORMATION_SCHEMA.COLLATIONS LIMIT 5 ) numbers LEFT JOIN ( SELECT DISTINCT User, Host, Db, Routine_name FROM mysql.procs_priv WHERE find_in_set('Grant', Proc_priv) &gt; 0 ) grantable_procs_priv USING (User, Host, Db, Routine_name) WHERE numbers.n BETWEEN 0 AND CHAR_LENGTH(Proc_priv) - CHAR_LENGTH(REPLACE(Proc_priv, ',', '')) AND UPPER(SUBSTRING_INDEX(SUBSTRING_INDEX(Proc_priv, ',', n+1), ',', -1)) != 'GRANT' ORDER BY GRANTEE, ROUTINE_SCHEMA, ROUTINE_NAME, ROUTINE_TYPE, n ; It takes 2 views and a table to make this a VIEW rather than a query.
  </p>

  
  <footer>
    <a href="/blog/mysql/routine_privileges-implementation/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/slides-for-openark-kit-mysql-utilities-for-everyday-use/">Slides for &#34;openark-kit: MySQL utilities for everyday use&#34;</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Apr 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/mysqlconf">mysqlconf</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Today I have delivered my talk, openark-kit: MySQL utilities for everyday use, at the O'REILLY MySQL Conference 2011. The slides are uploaded to the O'Reilly site, and I'm attaching them here as well. Feel free to download the PDF: openark-kit-mysqlconf11.pdf I wish to thank all who attended my talk! &nbsp;
  </p>

  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/oak-hook-general-log-your-poor-mans-query-analyzer/">oak-hook-general-log: your poor man&#39;s Query Analyzer</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Dec 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/logs">logs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The latest release of <a href="http://code.openark.org/forge/openark-kit">openark kit</a> introduces <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-hook-general-log.html">oak-hook-general-log</a>, a handy tool which allows for some analysis of executing queries.</p>
<p>Initially I just intended for the tool to be able to dump the general log to standard output, from any machine capable to connect to MySQL. Quick enough, I realized the power it brings.</p>
<p>With this tool, one can dump to standard output all queries using temporary tables; or using a specific index; or doing a full index scan; or just follow up on connections; or&hellip; For example, the following execution will only log queries which make for filesort:</p>
<blockquote>
<pre>oak-hook-general-log &ndash;user=root &ndash;host=localhost &ndash;password=123456 &ndash;filter-explain-filesort</pre>
</blockquote>
<h4>The problem with using the standard logs</h4>
<p>So you have the <em>general log</em>, which you don&rsquo;t often enable, since it tends to grow huge within moments. You then have the <em>slow log</em>. Slow log is great, and is among the top tools for MySQL diagnosis.</p>
<p>The slow log allows for <strong>log-queries-not-using-indexes</strong>, which is yet another nice feature. Not only should you log any query running for over <strong>X</strong> seconds, but also log any query which does not use an index.</p>
<p>Wait. This logs all single-row tables (no single row table will use an index), as well as very small tables (a common <strong>20</strong> rows lookup table will most often be scanned). These are OK scans. This makes for some noise in the slow log.</p>
<p>And how about queries which do use an index, but do so poorly? They use an index, but retrieve some <strong>12,500,000</strong> rows, <em>using temporary</em> table &amp; <em>filesort</em>?</p>
<h4>What oak-hook-general-log does for you</h4>
<p>This tool streams out the general log, and filters out queries based on their <em>role</em> or on their <em>execution plan</em>.</p>
<p>To work at all, it must enable the general log. Moreover, it directs the general log to log table. Mind that this makes for a performance impact, which is why the tool auto-terminates and restores original log settings (default is <strong>1</strong> minute, configurable). It&rsquo;s really not a tool you should keep running for days. But during the few moments it runs, it will:</p>
<ul>
<li>Routinely rotate the <strong>mysql.general_log</strong> table so that it doesn&rsquo;t fill up</li>
<li>Examine entries found in the general log</li>
<li>Cross reference entries to the PROCESSLIST so as to deduce database context (<a href="http://bugs.mysql.com/bug.php?id=52554">bug #52554</a>)</li>
<li>If required and appropriate, evaluate a query&rsquo;s execution plan</li>
<li>Decide whether to dump each entry based on filtering rules</li>
</ul>
<h4>Filtering rules</h4>
<p>Filtering rules are passed as command line options. At current, only one filtering rule applies (if more than one specified only one is used, so no point in passing more than one). Some of the rules are:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/oak-hook-general-log-your-poor-mans-query-analyzer/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/openark-kit-rev-170-new-tools-new-functionality/">openark-kit (rev. 170): new tools, new functionality</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Dec 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m pleased to announce a new release of the <a href="http://code.openark.org/forge/openark-kit">openark kit</a>. There&rsquo;s a lot of new functionality inside; following is a brief overview.</p>
<p>The <em>openark kit</em> is a set of utilities for MySQL. They  solve everyday maintenance tasks, which may be complicated or time  consuming to work by hand.</p>
<p>It&rsquo;s been a while since the last announced release. Most of my attention was on <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a>, building new features, writing documentation etc. However my own use of <em>openark kit</em> has only increased in the past few months, and there&rsquo;s new useful solutions to common problems that have been developed.</p>
<p>I&rsquo;ve used and improved many tools over this time, but doing the final cut, along with proper documentation, took some time. Anyway, here are the highlights:</p>
<h4>New tool: oak-hook-general-log</h4>
<p><em>oak-hook-general-log</em> hooks up a MySQL server and dumps the general log based on filtering rules, applying to query role or execution plan. It is possible to only dump connect/disconnect entries, queries which make a full table scan, or use temporary tables, or scan more than X number of rows, or&hellip;</p>
<p>I&rsquo;ll write more on this tool shortly.</p>
<h4>New tool: oak-prepare-shutdown</h4>
<p>This tool makes for an orderly and faster shutdown by safely stopping replication, and flushing InnoDB pages to disk prior to shutting down (keeping server available for connections even while attempting to flush dirty pages to disk). A typical use case would be:</p>
<blockquote>
<pre>oak-prepare-shutdown &ndash;user=root &ndash;ask-pass &ndash;socket=/tmp/mysql.sock &amp;&amp; /etc/init.d/mysql stop</pre>
</blockquote>
<h4>New tool: oak-repeat query</h4>
<p><em>oak-repeat-query</em> repeats executing a given query until some condition holds. The condition can be:</p>
<ul>
<li>Number of given iterations has been reached</li>
<li>Given time has elapsed</li>
<li>No rows have been affected by query</li>
</ul>
<p>The tool comes in handy for cleanup jobs, warming up caches, etc.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/openark-kit-rev-170-new-tools-new-functionality/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mycheckpoint-rev-208-aggregation-tables-enhanced-charting-rpm-distribution/">mycheckpoint (rev 208): aggregation tables, enhanced charting, RPM distribution</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Nov 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/web">Web</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Revision <strong>208</strong> of <a href="../../forge/mycheckpoint">mycheckpoint</a>, a MySQL monitoring solution, has  been released. New and updated in this revision:</p>
<ul>
<li><strong>Aggregation tables</strong>: aggregated data makes for fast reports on previously slow queries.</li>
<li><strong>Enhanced charting</strong>: interactive charts now present time stamps dynamically (see <a href="http://mycheckpoint.googlecode.com/svn/trunk/doc/html/sample/http/mcp_sql00/sv_report_html_brief"><strong>demo</strong></a>); &ldquo;Zoom in&rdquo; charts are available (see <a href="http://mycheckpoint.googlecode.com/svn/trunk/doc/html/sample/http/mcp_sql00/zoom/questions"><strong>demo</strong></a>) on <em>mycheckpoint</em>&rsquo;s HTTP server.</li>
<li><strong>RPM distribution</strong>: a &ldquo;noarch&rdquo; RPM <em>mycheckpoint</em> build is now available.</li>
<li>Initial work on formalizing test environment</li>
</ul>
<p><em>mycheckpoint</em> celebrates one year of existence!</p>
<h4>Aggregation tables</h4>
<p>I really wanted to avoid using these: everything was so more beautiful with one single dataset and dozens of supporting views (OK, the views themselves are hardly &ldquo;beautiful&rdquo;).</p>
<p>However it was impossible (for my level of expertise) to optimize query performance what with all those views on per-hour and per-day aggregation. The GROUP BYs and the JOINs did not make it possible for condition pushdown (i.e. using MERGE algorithm) where desired.</p>
<p>As result, mycheckpoint now manages aggregation tables: per-hour and per-day. The impact on sample taking is neglect able (making for two additional fast queries), but the impact on reading aggregated data is overwhelming. Generating a HTML full report could take a few minutes to complete. It now returns in no time. This makes charting more attractive, and allows for enhanced charting, such as zooming in on charts, as described following.</p>
<p>Aggregation tables will automatically be created and retroactively populated upon using revision 208. There&rsquo;s nothing special to do; be advised that for one single execution of <em>mycheckpoint</em>, many INSERT queries are going to be executed. Shouldn&rsquo;t take more than a couple minutes on commodity hardware and a few months of history.</p>
<p>It is possible to disable aggregation tables, or make for a complete rebuild of tables; by default, though, aggregation is ON.</p>
<h4>Enhanced charting</h4>
<p>Two enhancements here:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mycheckpoint-rev-208-aggregation-tables-enhanced-charting-rpm-distribution/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/thoughts-and-ideas-for-online-schema-change/">Thoughts and ideas for Online Schema Change</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Oct 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/schema">Schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Here&rsquo;s a few thoughts on current status and further possibilities for Facebook&rsquo;s <a href="http://www.facebook.com/note.php?note_id=430801045932">Online Schema Change</a> (OSC) tool. I&rsquo;ve had these thoughts for months now, pondering over improving <a href="../../forge/openark-kit/oak-online-alter-table">oak-online-alter-table</a> but haven&rsquo;t got around to implement them nor even write them down. Better late than never.</p>
<p>The tool has some limitations. Some cannot be lifted, some could. Quoting from the <a href="http://www.facebook.com/notes/mysql-at-facebook/online-schema-change-for-mysql/430801045932">announcement</a> and looking at the code, I add a few comments. I conclude with a general opinion on the tool&rsquo;s abilities.</p>
<h4>&ldquo;The original table must have PK. Otherwise an error is returned.&rdquo;</h4>
<p>This restriction could be lifted: it&rsquo;s enough that the table has a UNIQUE KEY. My original <em>oak-online-alter-table</em> handled that particular case. As far as I see from their code, the Facebook code would work just as well with any unique key.</p>
<p>However, this restriction is of no real interest. As we&rsquo;re mostly interested in InnoDB tables, and since any InnoDB table <em>should have</em> a PRIMARY KEY, we shouldn&rsquo;t care too much.</p>
<h4>&ldquo;No foreign keys should exist. Otherwise an error is returned.&rdquo;</h4>
<p>Tricky stuff. With <em>oak-online-alter-table</em>, changes to the original table were immediately reflected in the <em>ghost</em> table. With InnoDB tables, that meant same transaction. And although I never got to update the text and code, there shouldn&rsquo;t be a reason for not using child-side foreign keys (the child-side is the table on which the FK constraint is defined).</p>
<p>The Facebook patch works differently: it captures changes and writes them to a <strong>delta</strong> table,  to be later (asynchronously) analyzed and make for a <em>replay</em> of actions on the <em>ghost</em> table.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/thoughts-and-ideas-for-online-schema-change/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/openark-kit-facebook-online-schema-change-and-thoughts-on-open-source-licenses/">openark-kit, Facebook Online Schema Change, and thoughts on open source licenses</a></h2>

    <div class="post-meta">

  <div>

    <time>16 Sep 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  MySQL@Facebook team have recently published an Online Schema Change code for non blocking ALTER TABLE operations. Thumbs Up! The code is derived from oak-online-alter-table, part of openark-kit, a toolkit I'm authoring. Looking at the documentation I can see many ideas were incorporated as well. And of course many things are different, a lot of work has been put to it by MySQL@Facebook. openark-kit is currently released under the new BSD license, and, as far as I can tell (I'm not a lawyer), Facebook's work has followed the license to the letter.
  </p>

  
  <footer>
    <a href="/blog/mysql/openark-kit-facebook-online-schema-change-and-thoughts-on-open-source-licenses/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mycheckpoint-rev-190-http-server-interactive-charts/">mycheckpoint (rev. 190): HTTP server; interactive charts</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Sep 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/web">Web</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Revision <strong>190</strong> of <a href="../../forge/mycheckpoint">mycheckpoint</a>, a MySQL monitoring solution, has  been released. New and updated in this revision:</p>
<ul>
<li><strong>HTTP server</strong>: <em>mycheckpoint</em> can now act as a web server. Point your browser and start browsing through HTML reports. See mock up <a href="http://code.openark.org/forge/wp-content/uploads/2010/09/r190/mcp_sql00/sv_report_html_brief.html"><strong>demo</strong></a>.</li>
<li><strong>Interactive charts</strong>: HTML line charts are now interactive, presenting with accurate data as you move over them. See <a href="http://code.openark.org/forge/wp-content/uploads/2010/09/r190/mcp_sql00_samples/sv_report_html_brief.html"><strong>sample</strong></a>.</li>
<li><strong>Enhanced auto-deploy</strong>: now auto-recognizing failed upgrades.</li>
<li><strong>Reduced footprint</strong>: much code taken out of the views, leading to faster loading times.</li>
<li><strong>Better configuration file use</strong>: now supporting all command line options in config file.</li>
<li><strong>Remote host monitoring accessibility</strong>: now supporting complete configurable accessibility details.</li>
<li><strong>Bug fixes</strong>: thanks to the bug reporters!</li>
</ul>
<p><em>mycheckpoint</em> is free, simple, easy to use (now easier with HTTP server) and <strong>useful</strong>. I encourage you to try it out: even compared with other existing and emerging monitoring tools, I believe you will find it a breeze; it&rsquo;s low impact and lightness appealing; it&rsquo;s alerts mechanism assuring; its geeky SQL-based nature with ability to drill down to fine details &ndash; geeky-kind-of-attractive.</p>
<p>&lt;/encouragement&gt;</p>
<h4>HTTP server</h4>
<p>You can now run <em>mycheckpoint</em> in <em>http</em> mode:</p>
<blockquote>
<pre>bash$ <strong>mycheckpoint http</strong></pre>
</blockquote>
<p><em>mycheckpoint</em> will listen on port <strong>12306</strong>, and will present you with easy browsing through the reports of your <em>mycheckpoint</em> databases.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mycheckpoint-rev-190-http-server-interactive-charts/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/sphinx-mysql-facts-and-misconceptions/">Sphinx &amp; MySQL: facts and misconceptions</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Sep 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sphinx">Sphinx</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="http://www.sphinxsearch.com/">Sphinx search</a> is a full text search engine, commonly used with MySQL.</p>
<p>There are some misconceptions about Sphinx and its usage. Following is a list of some of Sphinx&rsquo; properties, hoping to answer some common questions.</p>
<ul>
<li>Sphinx is not part of MySQL/Oracle.</li>
<li>It is a standalone server; an external application to MySQL.</li>
<li>Actually, it is not MySQL specific. It can work with other RDBMS: PostgreSQL, MS SQL Server.</li>
<li>And, although described as &ldquo;free open-source SQL full-text search engine&rdquo;, it is not SQL-specific: Sphinx can read documents from XML.</li>
<li>It is often described as &ldquo;full text search for InnoDB&rdquo;. This description  is misleading. Sphinx indexes text; be it from any storage engine or  external source. It solves, in a way, the issue of &ldquo;FULLTEXT is only  supported by MyISAM&rdquo;. Essentially, it provided full-text indexing for InnoDB tables, but in a <em>very</em> different way than the way MyISAM&rsquo;s <strong>FULLTEXT</strong> index works.</li>
</ul>
<p>Sphinx works by reading documents, usually from databases. Considering the case of MySQL, Sphinx issues a SQL query which retrieves relevant data (mostly the text you want to index, but other properties allowed).</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sphinx-mysql-facts-and-misconceptions/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mylvmbackup-howto-minimal-privileges-filesystem-copy/">mylvmbackup HOWTO: minimal privileges &amp; filesystem copy</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Aug 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/backup">Backup</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/linux">Linux</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This HOWTO discusses two (unrelated) issues with <a href="http://www.lenzg.net/mylvmbackup/"><em>mylvmbackup</em></a>:</p>
<ul>
<li>The minimal privileges required to take MySQL backups with <em>mylvmbackup.</em></li>
<li>Making (non compressed) file system copy of one&rsquo;s data files.</li>
</ul>
<h4>Minimal privileges</h4>
<p>Some just give <em>mylvmbackup</em> the root account, which is far too permissive. We now consider what the minimal requirements of <em>mylvmbackup</em> are.</p>
<p>The queries <em>mylvmbackup</em> issues are:</p>
<ul>
<li><strong>FLUSH TABLES</strong></li>
<li><strong>FLUSH TABLES WITH READ LOCK</strong></li>
<li><strong>SHOW MASTER STATUS</strong></li>
<li><strong>SHOW SLAVE STATUS</strong></li>
<li><strong>UNLOCK TABLES</strong></li>
</ul>
<p>Both <strong>SHOW MASTER STATUS</strong> &amp; <strong>SHOW SLAVE STATUS</strong> require either the <strong>SUPER</strong> or <strong>REPLICATION CLIENT</strong> privilege. Since <strong>SUPER</strong> is more powerful, we choose <strong>REPLICATION CLIENT</strong>.</p>
<p>The <strong>FLUSH TABLES</strong> * and <strong>UNLOCK TABLES</strong> require the <strong>RELOAD</strong> privilege.</p>
<p>However, we are not done yet. <em>mylvmbackup</em> connects to the <strong>mysql</strong> database, which means we must also have some privilege there, too. We choose the <strong>SELECT</strong> privilege.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mylvmbackup-howto-minimal-privileges-filesystem-copy/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mmm-for-mysql-single-reader-role/">MMM for MySQL single reader role</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Aug 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/high-availability">High availability</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The standard documentation and tutorials on <a href="http://mysql-mmm.org/">MMM for MySQL</a>, for master-master replication setup, suggest one Virtual IP for the <em>writer</em> role, and two Virtual IPs for the <em>reader</em> role. It can be desired to only have a single virtual IP for the reader role, as explained below.</p>
<h4>The two IPs for the reader role</h4>
<p>A simplified excerpt from the <strong>mmm_common.conf</strong> sample configuration file, as can be found on the project&rsquo;s site and which is most quoted:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mmm-for-mysql-single-reader-role/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/another-python-mysql-template/">Another Python MySQL template</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Aug 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Following up on Matt Reid's simple python, mysql connection and iteration, I would like to share one of my own, which is the base for mycheckpoint &amp; openark kit scripts. It is oriented to provide with clean access to the data: the user is not expected to handle cursors and connections. Result sets are returned as python lists and dictionaries. It is also config file aware and comes with built in command line options.
  </p>

  
  <footer>
    <a href="/blog/mysql/another-python-mysql-template/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/mycheckpoint-rev-170-improved-custom-queries-local-charting-pageswap-io-monitoring-improved-html-reports/">mycheckpoint (rev. 170): improved custom queries; local charting; page/swap I/O monitoring; improved HTML reports</a></h2>

    <div class="post-meta">

  <div>

    <time>16 Jul 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/graphs">Graphs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/linux">Linux</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Revision <strong>170</strong> of <a href="../../forge/mycheckpoint">mycheckpoint</a>, a MySQL monitoring solution, has  been released. New and updated in this revision:</p>
<ul>
<li><strong>Improved custom queries</strong>: lifting of limitations from previous, introductory revision; better HTML presentation</li>
<li><strong>Local, inline charting</strong>: no rendering of Google Charts, unless explicitly requested. All charts are now rendered locally using JavaScript. No data is now sent over the network.</li>
<li><strong>Page/Swap I/O monitoring</strong>: now monitoring for page ins and outs, swap ins and outs (Linux only).</li>
<li><strong>Improved HTML reports</strong>: several improvements on presentation (see <a href="http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-brief-169.html">sample</a>, more follow).</li>
</ul>
<h4>Improved custom queries</h4>
<p>Some limitations, introduced in revision <strong>132</strong>, are now lifted. New features are introduced.</p>
<ul>
<li>There is now no limit to the number of custom queries (well, an INT limit).</li>
<li>In fact, the data tables adjust themselves to the existing custom queries in the form of auto-deploy: once a new <a href="http://code.openark.org/forge/mycheckpoint/documentation/custom-monitoring">custom query is added</a> or an old one removed, mycheckpoint will add or remove the relevant columns from the data tables.</li>
<li>The <strong>chart_order</strong> column is now utilized: HTML reports which include custom query charts now order those charts according to <strong>chart_order</strong> values. This makes for nicer reports.</li>
<li>The standard <a href="http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-brief-169.html">HTML brief report</a> (<strong>SELECT html FROM sv_report_html_brief</strong>) now automatically includes all custom charts. The HTML brief report is the report one usually wants to look at: it provides with the latest 24 hours metrics for selected values. It now becomes a centralized place for all that is interesting in the past 24 hours.</li>
<li>Custom queries are now allowed to return <strong>NULL</strong>, treated as a missing value. This is a bugfix from previous revisions.</li>
</ul>
<h4>Local charting</h4>
<p>Motivation for local charting is clear: no one likes having their data being sent over the network. And no one likes Google to know about their DML values.</p>
<p>I&rsquo;ve been playing around with quite a few charting solutions, and have gone into depths with two of them, adding and rewriting quite a lot of code. Eventually, I settled on my very own rendering. Here&rsquo;s what I&rsquo;ve seen &amp; tested:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mycheckpoint-rev-170-improved-custom-queries-local-charting-pageswap-io-monitoring-improved-html-reports/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/poll-what-minor-versions-of-mysql-should-be-supported-by-an-open-source-mysql-related-project/">Poll: what (minor) versions of MySQL should be supported by an open source MySQL related project?</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Apr 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I would like to get the community&rsquo;s opinion about supporting older (minor) versions of MySQL in open source projects.</p>
<p>If I were to develop some open source project, and a bug report came which only applied to MySQL <strong>5.0.51</strong> (but more recent versions worked fine), would I need to fix the code so as to support this older version?</p>
<p>How about supporting <strong>5.0.22</strong> (released almost 4 years ago, with almost 70 revisions since)? Would you expect an open source project to support this MySQL version because, say, this is the <a href="http://code.openark.org/blog/mysql/to-not-yum-or-to-not-apt-get">default version in your yum repository</a>?</p>
<p>I would like to concentrate on the currently stable MySQL versions: <strong>5.0</strong> and <strong>5.1</strong>. Versions <strong>4.x</strong> are out of the question for me, and <strong>5.5</strong> is not yet GA.</p>
<p>Sure, it would be great to support <em>everything</em>. But also time and effort consuming. So, I would greatly appreciate <em>your feedback</em>!<br /></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/poll-what-minor-versions-of-mysql-should-be-supported-by-an-open-source-mysql-related-project/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
</div>

</div>
</div>
<script src="/blog/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>
