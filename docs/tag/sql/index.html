<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>Sql &middot; code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="code.openark.org" href="/blog/tag/sql/index.xml" />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blog/img/favicon.ico" type="image/x-icon" />


  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
      <li class="pure-menu-item">
        <a class="pure-menu-link" href="/blog/tag/sql/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link">
        Shlomi Noach
        
          <div class="avatar-container">
        	  <div class="avatar-img-border">
                <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
        	  </div>
        	</div>
        
      </a>
    </li>

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Sql</h1>
</div>

<div class="content">
  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/three-wishes-for-a-new-year-4">Three wishes for a new year</a></h2>

    <div class="post-meta">

  <div>

    <time>28 Sep 2016</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/gh-ost">gh-ost</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/gtid">GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/operations">operations</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  (Almost) another new year by Jewish calendar. What do I wish for the following year? World peace Good health to all Relaxed GTID constraints I'm still not using GTID, and still see operational issues with working with GTID. As a latest example, our new schema migration solution, gh-ost, allows us to test migrations in production, on replicas. The GTID catch? gh-ost&nbsp;has to write something to the binary log. Thus, it "corrupts" the replica with a bogus GTID entry that will never be met in another server, thus making said replica unsafe to promote.
  </p>

  
  <footer>
    <a href="/blog/mysql/three-wishes-for-a-new-year-4">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-mini-hack-of-the-day-inverted-in-clause/">SQL mini hack of the day, inverted IN clause</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Nov 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>We are used to issue queries with an <strong>IN</strong> clause of the form:</p>
<blockquote>
<p><pre>&hellip; where state in (&lsquo;started&rsquo;, &lsquo;completed&rsquo;, &lsquo;failed&rsquo;) &hellip;</pre></p>
</blockquote>
<p>However I&rsquo;ve had a few cases where I used an inverted format. Here&rsquo;s one use case followed by an inverted <strong>IN</strong> clause.</p>
<h3>Dynamic query building</h3>
<p>Say we have this function:</p>
<blockquote>
<p>[code lang=&ldquo;golang&rdquo;]GetLaggingSlaves(clusterName string)</pre>
</blockquote>
<p>Which, based on whether given <strong>clusterName</strong> is empty or not, would return list of all lagging slaves, or only those in the given cluster, respectively:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-mini-hack-of-the-day-inverted-in-clause/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/leader-election-using-mysql/">Leader election using MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Oct 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Being a stateful, centralized datastore, MySQL can serve in negotiating leadership: a mechanism to elect a single service out of multiple services; moreover, a mechanism to promote a new leader should the existing leader cease to function.</p>
<h3>What of Zookeeper?</h3>
<p>Zookeeper makes for an excellent leader election mechanism. This is one of the most recognized uses for Zookeeper. It has HA via multiple nodes &amp; quorum,  ephemeral nodes, all you need. To achieve similar benefits with MySQL you&rsquo;d need to use Galera or NDB Cluster; so why not use Zk?</p>
<p>The use case at hand is <strong><a href="https://github.com/outbrain/orchestrator">orchestrator</a></strong>, a multi-node, mostly stateless service that happens to use MySQL as backend datastore. Ir relies on MySQL to exist in backend. It already <em>expects it to be there</em>. If the MySQL server is down, so is the service, effectively. In such case it doesn&rsquo;t hurt adding another dependency on MySQL; this does not reduce HA. You need to take care of MySQL HA anyhow so there&rsquo;s no additional cost. In fact, going to Zookeeper makes the additional cost as you introduce a new component to the system that can be avoided.</p>
<h3>Terms of the solution</h3>
<p>Our proposed solution offers:</p>
<ul>
<li>Single leader election out of multiple nodes</li>
<li>Leader actively reaffirms its leadership periodically</li>
<li>Timeout based re-election: decision to re-elect new leader based on the fact current leader has not reaffirmed its leadership over X seconds</li>
<li>A way to forcibly assume leadership for a specific node</li>
<li>A way to forcibly call for re-elections by demoting existing leader</li>
<li>A node/service can easily tell whether it&rsquo;s the leader or not</li>
<li>Anyone can tell who the leader is</li>
</ul>
<h3>SQL solution</h3>
<p>The solution is composed of a single table and a set of queries which implement the above offers. We assume a service can uniquely identify itself; this is easy to achieve:</p>
<ul>
<li>If services are running from different hosts (as should be the case, this is service HA), use hostname for ID
<ul>
<li>But what if the service restarts? Are you good with calling this &ldquo;the same service&rdquo; or is this now a new service running on the same host?</li>
</ul>
</li>
<li>In such case use combination of hostname &amp; OS process ID
<ul>
<li>Or generate a random token upon startup</li>
<li>Or use startup timestamp</li>
</ul>
</li>
</ul>
<p>Whichever solution you pick, make sure it is human readable, such that it is easy to tell <em>which service is the leader</em>. This helps operations. We note this as <strong>service_id</strong></p>
<h4>Table</h4>
<p>The following table will have a single row; the <strong>service_id</strong> in that row is the active leader.</p>
<blockquote>
<pre>
CREATE TABLE service_election (
  anchor tinyint(3) unsigned NOT NULL,
  service_id varchar(128) NOT NULL,
  last_seen_active timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (anchor)
) ENGINE=InnoDB
</pre>
</blockquote>
<h4>Attempt election</h4>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/leader-election-using-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/tool-of-the-day-q/">Tool of the day: q</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Aug 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/linux">Linux</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/command-line">command line</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tools">tools</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  If you work with command line and know your SQL, q is a great tool to use: q allows you to query your text files or standard input with SQL. You can: SELECT c1, COUNT(*) FROM /home/shlomi/tmp/my_file.csv GROUP BY c1 And you can: SELECT all.c2 FROM /tmp/all_engines.txt AS all LEFT JOIN /tmp/innodb_engines.txt AS inno USING (c1, c2) WHERE inno.c3 IS NULL And you can also combine with your favourite shell commands and tools: grep "my_term" /tmp/my_file.txt | q "SELECT c4 FROM - JOIN /home/shlomi/static.txt USING (c1)" | xargs touch Some of q's functionality (and indeed, SQL functionality) can be found in command line tools.
  </p>

  
  <footer>
    <a href="/blog/mysql/tool-of-the-day-q/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/merging-tables-with-insert-on-duplicate-key-update/">Merging tables with INSERT...ON DUPLICATE KEY UPDATE</a></h2>

    <div class="post-meta">

  <div>

    <time>21 Feb 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Had a case recently where I had to merge data from two identically structured tables containing nearly identical data.</p>
<p>&ldquo;Nearly identical&rdquo; meaning most table data is identical in both; sometimes a row is missing from one of the tables; sometimes same row (according to PK) appears in both, but some columns are NULL is one tables (while others can be NULL in the second).</p>
<p>Otherwise no contradicting data: it was not possible for some data to be &ldquo;3&rdquo; in one table and &ldquo;4&rdquo; in the other.</p>
<h4>How do you create a merge of the tables, such that all missing rows are completed, and NULLs replaced by actual values when possible?</h4>
<p><a href="http://www.percona.com/doc/percona-toolkit/2.1/pt-table-sync.html">pt-table-sync</a> comes to mind: one can do a bidirectional syncing of two tables, and actually stating how to resolve ambiguities (like &ldquo;greater value wins&rdquo;). Very powerful! An example would be:</p>
<blockquote>
<pre>pt-table-sync &ndash;bidirectional &ndash;conflict-column=a &ndash;conflict-comparison=greatest &ndash;tables &hellip;</pre>
</blockquote>
<p>However I didn&rsquo;t actually have any problem with the tables themselves. The two tables were just fine as they were; missing or NULL data does not indicate an error on their part. I wanted to get their merge. <em>pt-table-sync</em> is still up for the job: we can duplicate them, merge on the copy&hellip; But I prefer a query over an external script when possible.</p>
<h4>INSERT&hellip;ON DUPLICATE KEY UPDATE</h4>
<p>This <a href="http://dev.mysql.com/doc/refman/5.5/en/insert-on-duplicate.html">MySQL-specific syntax</a> is actually quite powerful. It basically says &ldquo;if the insert fails due to unique constraint, you get a chance to update the row causing the failure&rdquo;. But it also allows for smart setting of the column via the <strong>VALUES()</strong> clause. Let&rsquo;s present some sample data and then see the solution.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/merging-tables-with-insert-on-duplicate-key-update/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/hierarchical-data-in-information_schema-and-derivatives/">Hierarchical data in INFORMATION_SCHEMA and derivatives</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Jan 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Just how often do you encounter hierarchical data? Consider a table with some parent-child relation, like the this classic <strong>employee</strong> table:</p>
<blockquote>
<pre>CREATE TABLE employee (
  employee_id INT UNSIGNED PRIMARY KEY,
  employee_name VARCHAR(100),
  manager_id INT UNSIGNED,
  CONSTRAINT <code>employee_manager_fk</code> FOREIGN KEY (manager_id) REFERENCES employee (employee_id)
) engine=innodb
;
+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;+
| employee_id | employee_name | manager_id |
+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;+
|           1 | Rachel        |       NULL |
|           2 | John          |          1 |
|           3 | Stan          |          1 |
|           4 | Naomi         |          2 |
+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;+</pre>
</blockquote>
<p>Questions like <em>&ldquo;What is the (nested) list of employees managed by Rachel?&rdquo;</em> or <em>&ldquo;Get Naomi&rsquo;s managers chain of command&rdquo;</em> are classical questions. There are sometimes dependencies: if John leaves, does that mean Naomi loses her job, or does she get promoted, or something else? If John and Stan are on sick leave, does Rachel have any reason to come to work?</p>
<p>Hierarchical data is not limited to a single-table structure. Sometimes it takes a combination of a few tables (it&rsquo;s just a <strong>JOIN</strong>) to make out the parent-child relation.</p>
<p>Hierarchical data is difficult to manage with SQL. This is especially true for MySQL, which does not support the <strong>WITH</strong> recursive query syntax.</p>
<h4>Where can you find hierarchical data?</h4>
<p>Even if you do not provide it by yourself, MySQL&rsquo;s <strong>INFORMATION_SCHEMA</strong> has some for you. Partly obvious, partly implicit, here are some examples:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/hierarchical-data-in-information_schema-and-derivatives/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/pop-quiz-funny-syntax/">Pop quiz: funny syntax</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Nov 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The following questions are of little importance, yet I find them entertaining. I stumbled upon these while developing QueryScript.</p>
<p>Can you guess the results of the following statements?</p>
<h4>Pop quiz 1</h4>
<blockquote>
<pre>SET @x := 7;
SELECT ++@x;</pre>
</blockquote>
<p>What is the computation result? What will be the value of <strong>@x</strong>?</p>
<h4>Pop quiz 2</h4>
<blockquote>
<pre>SET @ := 4;
SELECT @ + @&rdquo; + @`<code>&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;What is the computation result?&lt;/p&gt;
&lt;h4&gt;Pop quiz 3&lt;/h4&gt;
&lt;blockquote&gt;
&lt;pre&gt;SET @a := 2;
SELECT @a = @'a' = @</code>a`</pre>
</blockquote>
<p>Do we get <strong>TRUE</strong> or <strong>FALSE</strong>? When?</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/pop-quiz-funny-syntax/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/three-wishes-for-a-new-year-201/">Three wishes for a new year</a></h2>

    <div class="post-meta">

  <div>

    <time>16 Sep 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Another new year by Jewish calendar. What do I wish for the following year? World peace Good health to all Get a decent, long waited for, implementation of Window Functions (aka Analytic Functions) for MySQL. I mean, I like GROUP_CONCAT, and the many hacks it provides: [1], [2], [3], [4], [5], [6], [7], [8], [9], [10], [11], [12]. But it makes for a poor substitution to Window Functions, and only solves a subset of issues.
  </p>

  
  <footer>
    <a href="/blog/mysql/three-wishes-for-a-new-year-201/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-selecting-top-n-records-per-group-another-solution/">SQL: selecting top N records per group, another solution</a></h2>

    <div class="post-meta">

  <div>

    <time>21 Aug 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A while back I presented <a title="Permanent Link to SQL: selecting top N records per group" href="http://code.openark.org/blog/mysql/sql-selecting-top-n-records-per-group" rel="bookmark">SQL: selecting top N records per group</a>, a &ldquo;give me the top <strong>5</strong> countries in each continent&rdquo; type of query, and which used an external <em>numbers</em> table and a lot of tedious casting.</p>
<p>Here&rsquo;s another solution I came up with (<a href="#update">*</a>). Still using <strong>GROUP_CONCAT</strong> (how else?), but no external table and no casting. The query outputs the largest <strong>5</strong> countries (by surface area) per continent.</p>
<blockquote>
<pre>SELECT
  Continent,
  Name,
  SurfaceArea,
  Population
FROM
  world.Country,
  (
    SELECT
      GROUP_CONCAT(top_codes_per_group) AS top_codes
    FROM
      (
        SELECT
          SUBSTRING_INDEX(GROUP_CONCAT(<strong>Code ORDER BY SurfaceArea DESC</strong>), &lsquo;,&rsquo;, <strong>5</strong>) AS top_codes_per_group
        FROM
          world.Country
        GROUP BY
          Continent
      ) s_top_codes_per_group
  ) s_top_codes
WHERE
  FIND_IN_SET(Code, top_codes)
ORDER BY
  Continent,
  SurfaceArea DESC
;</p>

<p>+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;+
| Continent     | Name                                         | SurfaceArea | Population |
+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;+
| Asia          | China                                        |  9572900.00 | 1277558000 |
| Asia          | India                                        |  3287263.00 | 1013662000 |
| Asia          | Kazakstan                                    |  2724900.00 |   16223000 |
| Asia          | Saudi Arabia                                 |  2149690.00 |   21607000 |
| Asia          | Indonesia                                    |  1904569.00 |  212107000 |
| Europe        | Russian Federation                           | 17075400.00 |  146934000 |
| Europe        | Ukraine                                      |   603700.00 |   50456000 |
| Europe        | France                                       |   551500.00 |   59225700 |
| Europe        | Spain                                        |   505992.00 |   39441700 |
| Europe        | Sweden                                       |   449964.00 |    8861400 |
| North America | Canada                                       |  9970610.00 |   31147000 |
| North America | United States                                |  9363520.00 |  278357000 |
| North America | Greenland                                    |  2166090.00 |      56000 |
| North America | Mexico                                       |  1958201.00 |   98881000 |
| North America | Nicaragua                                    |   130000.00 |    5074000 |
| Africa        | Sudan                                        |  2505813.00 |   29490000 |
| Africa        | Algeria                                      |  2381741.00 |   31471000 |
| Africa        | Congo, The Democratic Republic of the        |  2344858.00 |   51654000 |
| Africa        | Libyan Arab Jamahiriya                       |  1759540.00 |    5605000 |
| Africa        | Chad                                         |  1284000.00 |    7651000 |
| Oceania       | Australia                                    |  7741220.00 |   18886000 |
| Oceania       | Papua New Guinea                             |   462840.00 |    4807000 |
| Oceania       | New Zealand                                  |   270534.00 |    3862000 |
| Oceania       | Solomon Islands                              |    28896.00 |     444000 |
| Oceania       | New Caledonia                                |    18575.00 |     214000 |
| Antarctica    | Antarctica                                   | 13120000.00 |          0 |
| Antarctica    | French Southern territories                  |     7780.00 |          0 |
| Antarctica    | South Georgia and the South Sandwich Islands |     3903.00 |          0 |
| Antarctica    | Heard Island and McDonald Islands            |      359.00 |          0 |
| Antarctica    | Bouvet Island                                |       59.00 |          0 |
| South America | Brazil                                       |  8547403.00 |  170115000 |
| South America | Argentina                                    |  2780400.00 |   37032000 |
| South America | Peru                                         |  1285216.00 |   25662000 |
| South America | Colombia                                     |  1138914.00 |   42321000 |
| South America | Bolivia                                      |  1098581.00 |    8329000 |
+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;+
</pre>
</blockquote>
<p>In bold are the conditions by which we nominate our selected rows (condition is <strong>SurfaceArea DESC</strong>, number of rows is <strong>5</strong>, so 5 largest countries).</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-selecting-top-n-records-per-group-another-solution/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-joins-on-vs-using-vs-theta-style/">MySQL joins: ON vs. USING vs. Theta-style</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Jul 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>What is the difference between the following three syntaxes?</p>
<blockquote>
<pre>SELECT * FROM film JOIN film_actor ON (film.film_id = film_actor.film_id)
SELECT * FROM film JOIN film_actor USING (film_id)
SELECT * FROM film, film_actor WHERE film.film_id = film_actor.film_id</pre>
</blockquote>
<p>The difference is mostly syntactic sugar, but with a couple interesting notes.</p>
<p>To put names, the first two are called <strong>&ldquo;ANSI-style&rdquo;</strong> while the third is called <strong>&ldquo;Theta-style&rdquo;</strong>.</p>
<h4>Theta style</h4>
<p>On the <strong>FROM</strong> clause, tables are listed as if with Cartesian products, and the <strong>WHERE</strong> clause specifies how the join should take place.</p>
<p>This is considered to be the &ldquo;old&rdquo; style. It is somewhat confusing to read. Consider the following query:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-joins-on-vs-using-vs-theta-style/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/auto-caching-tables/">Auto caching tables</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Mar 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/myisam">MyISAM</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/views">Views</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Is there a way to create a caching table, some sort of a materialized view, such that <em>upon selecting</em> from that table, its data is validated/invalidated?</p>
<p><em>Hint</em>: yes.</p>
<p>But to elaborate the point: say I have some table <strong>data_table</strong>. Can I rewrite all my queries which access <strong>data_table</strong> to read from some <strong>autocache_data_table</strong>, but have nothing changed in the query itself? No caveats, no additional <strong>WHERE</strong>s, and still have that <strong>autocache_data_table</strong> provide with the correct data, dynamically updated by some rule <em>of our choice</em>?</p>
<p>And: no <em>crontab</em>, no <em>event scheduler</em>, and no funny triggers on <strong>data_table</strong>? In such way that invalidation/revalidation occurs <em>upon <strong>SELECT</strong></em>?</p>
<p>Well, yes.</p>
<p>This post is long, but I suggest you read it through to understand the mechanism, it will be worthwhile.</p>
<h4>Background</h4>
<p>The following derives from my long research on how to provide better, faster and <em>safer</em> access to <strong>INFORMATION_SCHEMA</strong> tables. It is however not limited to this exact scenario, and in this post I provide with a simple, general purpose example. I&rsquo;ll have more to share about <strong>INFORMATION_SCHEMA</strong> specific solutions shortly.</p>
<p>I was looking for a server side solution which would not require query changes, apart from directing the query to other tables. Solution has to be supported by all standard MySQL installs; so: no plugins, no special rebuilds.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/auto-caching-tables/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysqlqueryscript-use-case-delete-all-but-top-n-records-per-group/">MySQL/QueryScript use case: DELETE all but top N records per group</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Feb 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Some administrative tasks can be simplified by using <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">common_schema/QueryScript</a>. I&rsquo;m collecting a bunch of these for documentation. Here&rsquo;s one for example:</p>
<p>The DBA/developer has the task of retaining only top <strong>3</strong> most populated countries per continent. That is, she has to <strong>DELETE 4th, 5th, 6th</strong>, &hellip; most populated counties in each continent.</p>
<p>Is it possible to work out with a single query? Yes. But the query is not pretty. In fact, it is quite complicated, and either involves unintuitive subqueries, or <a href="http://code.openark.org/blog/mysql/sql-selecting-top-n-records-per-group">unintuitive hacks</a>. A normal DBA would not want to write, neither maintain this kind of query, unless top-notch-geek, which is fine.</p>
<p>Since this is a one time job, we just need to get it done. And <em>common_schema</em>/QueryScript provide with the intuitive solution: if we read our demand aloud, we realize we want to <strong>delete</strong> <strong>4th, 5th, 6th</strong>, &hellip; populated countries <strong>for each</strong> continent.</p>
<p>I present a solution made available by QueryScript, and discuss the ways in which the code overcomes limitations, or simplifies complexity:</p>
<blockquote>
<pre>var $num_countries_to_delete;
foreach($continent, $num_countries: SELECT continent, COUNT(*) FROM world.Country GROUP BY continent)
{
  if ($num_countries &gt; 3)
  {
    set $num_countries_to_delete := $num_countries - 3;
    DELETE FROM world.Country WHERE Continent = $continent ORDER BY Population ASC LIMIT :$num_countries_to_delete;
  }
}</pre>
</blockquote>
<h4>Discussion</h4>
<p>The first thing that should be apparent from the above is that this is a <em>programmatic</em> solution. Queries are declarative, which is why complex ones sometimes look incomprehensible. The above is more straightforward.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysqlqueryscript-use-case-delete-all-but-top-n-records-per-group/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/syntax-of-the-day-is-true-and-is-false/">Syntax of the day: IS TRUE and IS FALSE</a></h2>

    <div class="post-meta">

  <div>

    <time>26 Jan 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>What makes for a <em>true</em> statement?</p>
<p>We usually test statements using a WHERE clause:</p>
<blockquote>
<pre>SELECT * FROM world.City WHERE Population &gt; 1000000</pre>
</blockquote>
<p>The <strong>&ldquo;Population &gt; 1000000&rdquo;</strong> statement makes for a boolean expression. Using <strong>WHERE</strong> is just one way of evaluating it. One can also test with <a href="http://dev.mysql.com/doc/refman/5.1/en/control-flow-functions.html#function_if"><strong>IF()</strong></a>:</p>
<blockquote>
<pre>SET @val := 7;
SELECT IF(@val &gt; 2, &lsquo;Yes&rsquo;, &lsquo;No&rsquo;)</pre>
</blockquote>
<h4>TRUE and FALSE</h4>
<p>The two are keywords. They also map for the numerals <strong>1</strong> and <strong>0</strong>, as follows:</p>
<blockquote>
<pre>mysql&gt; SELECT TRUE, FALSE;
+&mdash;&mdash;+&mdash;&mdash;-+
| TRUE | FALSE |
+&mdash;&mdash;+&mdash;&mdash;-+
|    1 |     0 |
+&mdash;&mdash;+&mdash;&mdash;-+</pre>
</blockquote>
<p>Like in the <strong>C</strong> programming language, a nonzero value evaluates to a <em>true</em> value. A zero evaluates to <em>false</em>. A NULL evaluates to&hellip; well, NULL. But aside from 3-valued logic, what&rsquo;s important in our case is that it is <em>not true</em>.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/syntax-of-the-day-is-true-and-is-false/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/more-mysql-foreach/">More MySQL foreach()</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Dec 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In my <a href="http://code.openark.org/blog/mysql/mysql-foreach">previous post</a> I&rsquo;ve shown several generic use cases for <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/foreach.html"><em>foreach()</em></a>, a new scripting functionality introduced in <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>.</p>
<p>In this part I present DBA&rsquo;s handy syntax for schema and table operations and maintenance.</p>
<p>Confession: while I love <strong>INFORMATION_SCHEMA</strong>&rsquo;s power, I just <em>hate</em> writing queries against it. It&rsquo;s just so much typing! Just getting the list of tables in a schema makes for this heavy duty query:</p>
<blockquote>
<pre>SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA=&lsquo;sakila&rsquo; AND TABLE_TYPE=&lsquo;BASE TABLE&rsquo;;</pre>
</blockquote>
<p>When a join is involved this really becomes a nightmare. I think it&rsquo;s cumbersome, and as result, many do not remember the names and meaning of columns, making for <em>&ldquo;oh, I need to read the manual all over again just to get that query right&rdquo;</em>. Anyway, that&rsquo;s my opinion.</p>
<p>A <strong>SHOW TABLES</strong> statement is easier to type, but cannot be integrated into a <strong>SELECT</strong> query (though <a href="http://code.openark.org/blog/mysql/reading-results-of-show-statements-on-server-side">we have a partial solution</a> for that, too), and besides, when filtering out the views, the <strong>SHOW</strong> statement becomes almost as cumbersome as the one on <strong>INFORMATION_SCHEMA</strong>.</p>
<p>Which is why <em>foreach()</em> offers handy shortcuts to common iterations on schemata and tables, as follows:</p>
<h4>Use case: iterate all databases</h4>
<blockquote>
<pre>call foreach(<span style="color: #808000;">&lsquo;schema&rsquo;</span>, <span style="color: #003366;">&lsquo;CREATE TABLE ${schema}.event(event<em>id INT, msg VARCHAR(128))&rsquo;</span>);</pre>
</blockquote>
<p>In the above we execute a query on each database. Hmmm, maybe not such a good idea to perform this operation on all databases? Let&rsquo;s filter them:</p>
<h4>Use case: iterate databases by name match</h4>
<blockquote>
<pre>call foreach(<span style="color: #808000;">&lsquo;schema like wordpress</em>%&rsquo;</span>, <span style="color: #003366;">&lsquo;ALTER TABLE ${schema}.wp_posts MODIFY COLUMN comment_author VARCHAR(96) NOT NULL&rsquo;</span>);</pre>
</blockquote>
<p>The above will only iterate my WordPress databases (I have several of these), performing an <strong>ALTER</strong> on <strong>wp_posts</strong> for each of those databases.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/more-mysql-foreach/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-foreach/">MySQL foreach()</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Dec 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  A new routine is now available in common_schema, which makes for an easier execution syntax for some operations: foreach(collection_to_iterate_over, queries_to_execute_per_iteration_step); To illustrate what it can do, consider: call foreach('table in sakila', 'ALTER TABLE ${schema}.${table} ENGINE=InnoDB ROW_FORMAT=COMPACT'); call $('schema like shard_%', 'CREATE TABLE ${schema}.messages (id INT)'); call $('2000:2009', 'INSERT IGNORE INTO report (report_year) VALUES (${1})'); $() stands as a synonym to foreach(). I suspect it should look familiar to web programmers. The idea for foreach() was introduced by Giuseppe Maxia during a correspondence.
  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-foreach/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/reading-results-of-show-statements-on-server-side/">Reading results of SHOW statements, on server side</a></h2>

    <div class="post-meta">

  <div>

    <time>25 Nov 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/hacks">Hacks</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong>SHOW</strong> statements are show stoppers on server side. While clients can get a <a href="http://dev.mysql.com/doc/refman/5.1/en/show.html">SHOW statement</a> as a result set just as any normal <strong>SELECT</strong>, things are not as such on server side.</p>
<p>On server side, that is, from within MySQL itself, one <em>cannot</em>:</p>
<blockquote>
<pre>SELECT <code>Database</code> FROM (SHOW DATABASES);</pre>
</blockquote>
<p>One <em>cannot</em>:</p>
<blockquote>
<pre>DECLARE show_cursor CURSOR FOR SHOW TABLES;</pre>
</blockquote>
<p>One <em>cannot</em>:</p>
<blockquote>
<pre>SHOW TABLES INTO OUTFILE &lsquo;/tmp/my_file.txt&rsquo;;</pre>
</blockquote>
<p>So it is impossible to get the results with a query; impossible to get the results from a stored routine; impossible to get the results by file reading&hellip;</p>
<h4>Bwahaha! A hack!</h4>
<p>For some <strong>SHOW</strong> statements, there is a way around this. I&rsquo;ve been banging my head against the wall for weeks now on this. Now I have a partial solution: I&rsquo;m able to read <strong>SHOW</strong> output for several <strong>SHOW</strong> statements. Namely, those <strong>SHOW</strong> statements <a href="http://dev.mysql.com/doc/refman/5.1/en/extended-show.html">which allow a LIKE or a WHERE</a> clause.</p>
<p>For example, most are familiar with the following syntax:</p>
<blockquote>
<pre>USE mysql;
SHOW TABLE STATUS LIKE &lsquo;user&rsquo;;</pre>
</blockquote>
<p>However not so many know that any <strong>SHOW</strong> statement which accepts <strong>LIKE</strong>, can also accept <strong>WHERE</strong>:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/reading-results-of-show-statements-on-server-side/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/quoting-text-javascriptpython-style/">Quoting text JavaScript/Python style</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Nov 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Unless your MySQL is configured to use ANSI_QUOTES in sql_mode, you are able to quote your text in one of two forms: using single quotes or double quotes: UPDATE world.Country SET HeadOfState = 'Willy Wonka' WHERE Code='USA' UPDATE world.Country SET HeadOfState = "Willy Wonka" WHERE Code="USA" This makes for JavaScript- or Python-style quoting: you quote by your needs. Say you have a text which includes single quotes: It is what you read when you don't have to that determines what you will be when you can't help it.
  </p>

  
  <footer>
    <a href="/blog/mysql/quoting-text-javascriptpython-style/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/self-throttling-mysql-queries/">Self throttling MySQL queries</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Nov 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/myisam">MyISAM</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Recap on the problem:</p>
<ul>
<li>A query takes a long time to complete.</li>
<li>During this time it makes for a lot of I/O.</li>
<li>Query&rsquo;s I/O overloads the db, making for other queries run slow.</li>
</ul>
<p>I introduce the notion of self-throttling queries: queries that go to sleep, by themselves, throughout the runtime. The sleep period means the query does not perform I/O at that time, which then means other queries can have their chance to execute.</p>
<p>I present two approaches:</p>
<ul>
<li>The naive approach: for every <strong>1,000</strong> rows, the query sleep for <strong>1</strong> second</li>
<li>The factor approach: for every <strong>1,000</strong> rows, the query sleeps for the amount of time it took to iterate those <strong>1,000</strong> rows (effectively doubling the total runtime of the query).</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/self-throttling-mysql-queries/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/">Contest for Glory: write a self throttling MySQL query</a></h2>

    <div class="post-meta">

  <div>

    <time>27 Oct 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>What&rsquo;s all this about?</p>
<p>I&rsquo;ve you&rsquo;ve <a href="http://code.openark.org/blog/mysql/slides-from-my-talk-programmatic-queries-things-you-can-code-with-sql">been to my talk</a> in London, then you&rsquo;ve already got this as homework. If not, allow me to fill in the details:</p>
<p>I was speaking about MySQL&rsquo;s programmatic nature in many aspects (best if you read the slides!). We discussed user defined variables, derived tables, ordering constructs, order of evaluation, time suspension and time calculation.</p>
<p>An issue I presented was that of a very long running query. Say it runs for <strong>20</strong> minutes. It kills your I/O. Do you <strong>KILL</strong> the query or wait? It <em>could</em> terminate in <strong>5</strong> seconds from now, and if you kill it now, you lose everything. But it may yet run for <strong>3</strong> more hours!</p>
<p>We discussed a futuristic feature where the query would gracefully terminate after some designated time. However, futuristic wishes do not help us.</p>
<h4>A self throttling query</h4>
<p>I suggested the idea for a self throttling query. We know how to throttle writing queries, such as <strong>DELETE</strong> queries: we break them into small chunks, then work each chunk at a time, setting ourselves to sleep in between chunks. This is how <strong>&ndash;sleep</strong> and <strong>&ndash;sleep-ratio</strong> work in <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-chunk-update.html">oak-chunk-update</a>. It is how <strong>&ndash;sleep</strong> and<strong> &ndash;sleep-coef</strong> work in <a href="http://www.percona.com/doc/percona-toolkit/pt-archiver.html">pt-archiver</a>.</p>
<p>But can the same be done for <strong>SELECT</strong> queries?</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/slides-from-my-talk-programmatic-queries-things-you-can-code-with-sql/">Slides from my talk: &#34;Programmatic Queries: things you can code with SQL&#34;</a></h2>

    <div class="post-meta">

  <div>

    <time>27 Oct 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Here are the slides from my talk Programmatic Queries: things you can code with SQL held on October 25th on the Percona Live event, London. Programmatic Queries: PDF I wish to thank those who attended my talk. The topic of the talk was irregular and, to some extent, controversial. Should one really rely on internal implementation for optimizing her queries? Sergei Golubchik was quick to suggest that even in current and coming versions of MariaDB, some things I spoke about may not hold true.
  </p>

  
  <footer>
    <a href="/blog/mysql/slides-from-my-talk-programmatic-queries-things-you-can-code-with-sql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/speaking-on-percona-live-london-programmatic-queries-things-you-can-code-with-sql/">Speaking on Percona Live, London: &#34;Programmatic Queries: things you can code with SQL&#34;</a></h2>

    <div class="post-meta">

  <div>

    <time>10 Oct 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/execution-plan">Execution plan</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I'll be speaking at the Percona Live event, held in London, October 24, 25, 2011. My session is called Programmatic Queries: things you can code with SQL. It's a short 30 minute talk, in which I present underlying knowledge of the programmatic nature of SQL queries within MySQL, and how to take advantage of such knowledge so as to build faster, shorter, and sometimes unexpected queries. This is not about stored routine programming, a classic programmatic aspect of MySQL, but rather about expected order of execution: of row evaluation, of control flow statements, of table inference, of time issues.
  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-on-percona-live-london-programmatic-queries-things-you-can-code-with-sql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/three-wishes-for-a-new-year-2/">Three wishes for a new year</a></h2>

    <div class="post-meta">

  <div>

    <time>27 Sep 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  It's another new year by Jewish calendar. And what do I wish for in the following year? World peace Good health to all Have some way to turn SHOW commands into SELECT statements, server side. I'm fervently trying to hack around this. Stored routines, export/import from file, text manipulation, I don't care! I want to SELECT seconds_behind_master somehow. Without plugins. PS, none of my last year's wishes came true. I'll settle for two out of three.
  </p>

  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-eval/">MySQL eval()</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Sep 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I've just implemented an eval() call for MySQL. It is implemented with SQL, using a stored procedure. So this is not some plugin: you can use it from within your normal database server. Just what is an eval() call? In some programming languages it would mean: get some text, and execute it as though it were complied code. So, dynamic coding. In SQL: get the text of query which generates SQL statements in itself (either DML or DDL), and invoke those implied SQL statements.
  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-eval/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/you-know-youve-been-doing-too-much-sql-when/">You know you&#39;ve been doing too much SQL when...</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Sep 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/humor">Humor</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  ...you're traveling on family holiday, and each time you wish to suggest you should check up on the tourist information center, you repeatedly come up with: "Let's ask at the INFORMATION_SCHEMA and see what we can get". Also, doing so while wearing an OpenSQL Camp T-shirt doesn't help.
  </p>

  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-global-status-difference-using-single-query/">MySQL Global status difference using single query</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Aug 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Have just read <a href="http://karlssonondatabases.blogspot.com/2011/08/mysql-global-status-difference-using_12.html">MySQL Global status difference using MySQL procedures / functions</a>, by Andres Karlsson. Have commented, but realized I did not provide with a direct answer. In the comment, I suggested checking out <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/global_status_diff.html">a solution based on views</a>, found in <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>. But the solution in <em>common_schema</em> is split into two views, due to the fact views cannot handle derived tables subqueries.</p>
<p>Well, here&rsquo;s a single query to do that: it checks <strong>GLOBAL_STATUS</strong> twice, <strong>10</strong> seconds apart in the following sample. It uses <strong>SLEEP()</strong> to actually wait between the two reads. Yes, you can do that with a query.</p>
<p>The following query shows all <strong>GLOBAL_STATUS</strong> values that have changed during the sample period.</p>
<p><strong>[UPDATE]</strong> query updated to work with MySQL <strong>5.6</strong> optimizer</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-global-status-difference-using-single-query/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/finding-current_user-for-any-user/">Finding CURRENT_USER for any user</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Aug 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A MySQL account is a user/host combination. A MySQL connection is done by a user connecting from some host.</p>
<p>However, the user/host from which the connection is made are not the same as the user/host as specified in the account. For example, the account may be created thus:</p>
<blockquote>
<pre>CREATE USER &lsquo;temp&rsquo;@&lsquo;10.0.0.%&rsquo; IDENTIFIED BY &lsquo;123456&rsquo;;</pre>
</blockquote>
<p>The host as specified in the above account is a wildcard host. A connection by the <strong>&lsquo;temp&rsquo;</strong> user from <strong>&lsquo;10.0.0.3&rsquo;</strong> can map into that account. It thus happens that the connected user is <strong>&lsquo;temp&rsquo;@&lsquo;10.0.0.3&rsquo;</strong>, yet the assigned account is <strong>&lsquo;temp&rsquo;@&lsquo;10.0.0.%&rsquo;</strong>.</p>
<p>MySQL provides with the <strong>USER()</strong> and <strong>CURRENT_USER()</strong> which map to the connected user and the assigned account, respectively, and which lets the current session identify the relation between the two. Read more on this on the <a href="http://dev.mysql.com/doc/refman/5.1/en/account-activity-auditing.html">MySQL docs</a>.</p>
<h4>The problem</h4>
<p>And the trouble is: MySQL only provides this functionality for the <em>current session</em>. Surprisingly, given a user/host combination, I cannot get MySQL to tell me which account matches those details.</p>
<h4>The inconsistency</h4>
<p>And I care because there is an inconsistency. Namely, when I do <strong>SHOW PROCESSLIST</strong> MySQL tells me the user &amp; host from which the connection is made. It does <em>not</em> tell me the account for which the process is assigned.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/finding-current_user-for-any-user/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/announcing-common_schema-common-views-routines-for-mysql/">Announcing common_schema: common views &amp; routines for MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Jul 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-types">Data Types</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/schema">Schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Today I have released <a title="common_schema" href="http://code.openark.org/forge/common_schema">common_schema</a>, a utility schema for MySQL which includes many views and functions, and is aimed to be installed on any MySQL server.</p>
<h4>What does it do?</h4>
<p>There are views answering for all sorts of useful information: stuff related to schema analysis, data dimensions, monitoring, processes &amp; transactions, security, internals&hellip; There are basic functions answering for common needs.</p>
<p>Some of the views/routines simply formalize those queries we tend to write over and over again. Others take the place of external tools, answering complex questions via SQL and metadata. Still others help out with SQL generation.</p>
<p>Here are a few highlights:</p>
<ul>
<li>Did you know you can work out <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/global_status_diff_nonzero.html">simple monitoring</a> of your server with a <em>query</em>?  There&rsquo;s a view to do that for you.</li>
<li>How about showing just <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/processlist_top.html">the good parts of the processlist</a>?</li>
<li>Does your schema have <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/redundant_keys.html">redundant keys</a>?</li>
<li>Or InnoDB tables with <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/no_pk_innodb_tables.html">no PRIMARY KEY</a>?</li>
<li>Is AUTO_INCREMENT <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/auto_increment_columns.html">running out of space</a>?</li>
<li>Can I get the SQL statements to <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_foreign_keys.html">generate my FOREIGN KEYs</a>? To drop them?</li>
<li>And can we finally get <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">SHOW GRANTS for all accounts</a>, and as an <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">SQL query</a>?</li>
<li>Ever needed a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/general_functions.html#crc64">64 bit CRC function</a>?</li>
<li>And aren&rsquo;t you tired of writing the cumbersome SUBSTRING_INDEX(SUBSTRING_INDEX(str, &lsquo;,&rsquo;, 3), &lsquo;,&rsquo;, -1)? <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/string_functions.html#split_token">There&rsquo;s an alternative</a>.</li>
</ul>
<p>There&rsquo;s more. Take a look at the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/introduction.html">common_schema documentation</a> for full listing. And it&rsquo;s evolving: I&rsquo;ve got quite a few ideas already for future components.</p>
<p>Some of these views rely on heavyweight INFORMATION_SCHEMA tables. You should be aware of the impact and <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/risks.html">risks</a>.</p>
<h4>What do I need to install?</h4>
<p>There&rsquo;s no script or executable file. It&rsquo;s just a schema. The distribution in an SQL file which generates <em>common_schema</em>. Much like a dump file.</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/announcing-common_schema-common-views-routines-for-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/pop-quiz-answered-what-would-be-the-results-of-the-following-queries/">Pop quiz answered: &#34;what would be the results of the following queries?&#34;</a></h2>

    <div class="post-meta">

  <div>

    <time>12 May 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The quiz presented poses with an uncommon, though valid SQL syntax: <em>one is allowed to use quoted name aliases</em>. Thus, it is valid to write:</p>
<blockquote>
<pre>SELECT Name AS &lsquo;n&rsquo;, Continent AS &lsquo;c&rsquo; FROM countries</pre>
</blockquote>
<p>But what does the above mean? Let&rsquo;s see the results of our three questions:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/pop-quiz-answered-what-would-be-the-results-of-the-following-queries/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/pop-quiz-what-would-be-the-results-of-the-following-queries/">Pop quiz: what would be the results of the following queries?</a></h2>

    <div class="post-meta">

  <div>

    <time>12 May 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Here&rsquo;s a quiz for you. The real query I witnessed was very complicated. I&rsquo;ve simplified it, but kept a confusing alias. Can you answer the following three questions? Are they even valid?</p>
<p>Given the following <strong>countries</strong> table data:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/pop-quiz-what-would-be-the-results-of-the-following-queries/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/generating-google-line-charts-with-sql-part-ii/">Generating Google line charts with SQL, part II</a></h2>

    <div class="post-meta">

  <div>

    <time>03 Mar 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/graphs">Graphs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post continues <a href="http://code.openark.org/blog/mysql/generating-google-line-charts-with-sql-part-i">Generating Google line charts with SQL, part I</a>, in pursue of generating time series based image charts.</p>
<p>We ended last post with the following chart:</p>
<blockquote>
<pre /><img class="alignnone" title="Sample SQL Google Chart" src="/blog/assets/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,-4716.6,5340.0&amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL" alt="" width="400" height="200" />
<a href="http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,-4716.6,5340.0&amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL">http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,-4716.6,5340.0&amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL</a></p>

<p></blockquote>
which has a nice curve, and a proper y-legend, but incorrect x-legend and no ticks nor grids.</p>

<p>To date, Google Image Charts do not support time-series charts. We can&rsquo;t just throw timestamp values and expect the chart to properly position them. We need to work these by hand.</p>

<p>This is not easily done; if our input consists of evenly spread timestamp values, we are in a reasonable position. If not, what do we do?</p>

<p>There are several solutions to this:
<ul>
    <li>We can present whatever points we have on the chart, making sure to position them properly. This makes for an uneven distribution of ticks on the x-axis, and is not pleasant to watch.</li>
    <li>We can extrapolate values for round hours (or otherwise round timestamp resolutions), and so show evenly spread timestamps. I don&rsquo;t like this solution one bit, since we&rsquo;re essentially inventing values here. Extrapolation is nice when you know you have nice curves, but not when you&rsquo;re doing database monitoring, for example. You must have the precise values.</li>
    <li>We can do <a href="http://en.wikipedia.org/wiki/Oversampling">oversampling</a>, then group together several measurements within round timestamp resolutions. For example, we can make a measurement every <strong>2</strong> minutes, yet present only <strong>6</strong> measurements per hour, each averaging up <strong>10</strong> round minutes. This is the approach I take with <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a>.</li>
</ul>
The latest approach goes even beyond that: what if we missed 30 minutes of sampling? Say the server was down. We then need to &ldquo;invent&rdquo; the missing timestamps. Note that we invent the timestamps, we do not invent values. We must present the chart with missing values on our invented timestamps.</p>

<p>I may show how to do this in a future post. Meanwhile, let&rsquo;s simplify and assume our values <em>are</em> evenly spread.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/generating-google-line-charts-with-sql-part-ii/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/generating-google-line-charts-with-sql-part-i/">Generating Google line charts with SQL, part I</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Feb 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/graphs">Graphs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In this series of posts I wish to show how <a href="http://code.google.com/apis/chart/image_charts.html">Google Charts</a> can be generated via SQL. We discuss the Google Charts limitations which must be challenged, and work towards a simple chart.</p>
<p>I&rsquo;m going to present the algorithm I use in <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a>, a MySQL monitoring utility, which generates Google charts by raw data using views. An example of such chart follows:</p>
<blockquote>
<pre /><img class="alignnone" title="Sample Google Chart" src="/blog/assets/chart?cht=lc&amp;chs=370x180&amp;chts=303030,12&amp;chtt=Latest+24+hours:+Nov+9,+05:50++-++Nov+10,+05:50&amp;chf=c,s,ffffff&amp;chdl=Rentals+rate:+custom_1_psec&amp;chdlp=b&amp;chco=ff8c00&amp;chd=s:GDGKGFLFGMJHRLMPPNULJRPLTOPRUMYPPVRNbQUSUSbSNWUOfSWTObVSUVWSVYVPbTPjfTbRTdXReUWhcTQRQZbTWYVYPaVZXdYYWPTabYUTbW99QLgLNIOIRNNMIKRJEHGFHGJGGFIFDFGDK&amp;chxt=x,y&amp;chxr=1,0,8.720000&amp;chxl=0:|+||08:00||+||12:00||+||16:00||+||20:00||+||00:00||+||04:00||&amp;chxs=0,505050,10,0,lt&amp;chg=4.17,25,1,2,0.69,0&amp;chxp=0,0.69,4.86,9.03,13.20,17.37,21.54,25.71,29.88,34.05,38.22,42.39,46.56,50.73,54.90,59.07,63.24,67.41,71.58,75.75,79.92,84.09,88.26,92.43,96.60&amp;tsstart=2010-11-09+05:50:00&amp;tsstep=600" alt="" width="370" height="180" />
<a href="http://chart.apis.google.com/chart?cht=lc&amp;chs=370x180&amp;chts=303030,12&amp;chtt=Latest+24+hours:+Nov+9,+05:50++-++Nov+10,+05:50&amp;chf=c,s,ffffff&amp;chdl=Rentals+rate:+custom_1_psec&amp;chdlp=b&amp;chco=ff8c00&amp;chd=s:GDGKGFLFGMJHRLMPPNULJRPLTOPRUMYPPVRNbQUSUSbSNWUOfSWTObVSUVWSVYVPbTPjfTbRTdXReUWhcTQRQZbTWYVYPaVZXdYYWPTabYUTbW99QLgLNIOIRNNMIKRJEHGFHGJGGFIFDFGDK&amp;chxt=x,y&amp;chxr=1,0,8.720000&amp;chxl=0:|+||08:00||+||12:00||+||16:00||+||20:00||+||00:00||+||04:00||&amp;chxs=0,505050,10,0,lt&amp;chg=4.17,25,1,2,0.69,0&amp;chxp=0,0.69,4.86,9.03,13.20,17.37,21.54,25.71,29.88,34.05,38.22,42.39,46.56,50.73,54.90,59.07,63.24,67.41,71.58,75.75,79.92,84.09,88.26,92.43,96.60&amp;tsstart=2010-11-09+05:50:00&amp;tsstep=600">http://chart.apis.google.com/chart?cht=lc&amp;chs=370x180&amp;chts=303030,12&amp;chtt=Latest+24+hours:+Nov+9,+05:50++-++Nov+10,+05:50&amp;chf=c,s,ffffff&amp;chdl=Rentals+rate:+custom_1_psec&amp;chdlp=b&amp;chco=ff8c00&amp;chd=s:GDGKGFLFGMJHRLMPPNULJRPLTOPRUMYPPVRNbQUSUSbSNWUOfSWTObVSUVWSVYVPbTPjfTbRTdXReUWhcTQRQZbTWYVYPaVZXdYYWPTabYUTbW99QLgLNIOIRNNMIKRJEHGFHGJGGFIFDFGDK&amp;chxt=x,y&amp;chxr=1,0,8.720000&amp;chxl=0:|+||08:00||+||12:00||+||16:00||+||20:00||+||00:00||+||04:00||&amp;chxs=0,505050,10,0,lt&amp;chg=4.17,25,1,2,0.69,0&amp;chxp=0,0.69,4.86,9.03,13.20,17.37,21.54,25.71,29.88,34.05,38.22,42.39,46.56,50.73,54.90,59.07,63.24,67.41,71.58,75.75,79.92,84.09,88.26,92.43,96.60&amp;tsstart=2010-11-09+05:50:00&amp;tsstep=600</a>
</blockquote>
<em>mycheckpoint</em> does not actually call on Google to do the chart rendering, but invokes its own JavaScript code to visualize the URL locally.</p>

<p>Here are some downsides for using Google charts:
<ul>
    <li>The URL cannot be as long as you like. 2048 characters is an upper bound you&rsquo;ll want to keep behind. <em>[Google charts POST method calls are available, which leads to 16K equivalent of URL length &ndash; this is still not too helpful due to the nature of POST calls]</em></li>
    <li>Features are inconsistent. To specify label or tick positions, one must specify exact positions. To specify grid positions, one must supply with step, offset, etc. There are more such inconsistencies.</li>
    <li>Google charts are not too friendly. Taking the ticks and grids example from above, there really shouldn&rsquo;t be a reason why grids would not be automatically generated according to ticks definitions. But we are required to specify positions for the ticks as well as for the grids.</li>
    <li>There is no support for time-series. One must translate time as x-axis values.</li>
    <li>Perhaps most intimidating to many people: to generate a Google chart, once must send data to Google. Which is the main reason I used local JavaScript rendering.</li>
</ul>
Anyway, let&rsquo;s build a very simple chart. Since I will not cover everything in this post, we make for some relaxed conditions.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/generating-google-line-charts-with-sql-part-i/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/multi-condition-update-query/">Multi condition UPDATE query</a></h2>

    <div class="post-meta">

  <div>

    <time>27 Jan 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A simple question I&rsquo;ve been asked:</p>
<p>Is it possible to merge two <strong>UPDATE</strong> queries, each on different <strong>WHERE</strong> conditions, into a single query?</p>
<p>For example, is it possible to merge the following two <strong>UPDATE</strong> statements into one?</p>
<blockquote>
<pre>mysql&gt; <strong>UPDATE</strong> film <strong>SET</strong> rental_duration=rental_duration+1 <strong>WHERE</strong> rating = &lsquo;G&rsquo;;
Query OK, 178 rows affected (0.01 sec)</p>

<p>mysql&gt; <strong>UPDATE</strong> film <strong>SET</strong> rental_rate=rental_rate-0.5 <strong>WHERE</strong> length &lt; 90;
Query OK, 320 rows affected (0.01 sec)
</pre>
</blockquote>
<p>To verify our tests, we take a checksum:</p>
<blockquote>
<pre>mysql&gt; pager md5sum
PAGER set to &lsquo;md5sum&rsquo;
mysql&gt; <strong>SELECT</strong> film_id, title, rental_duration, rental_rate <strong>FROM</strong> film <strong>ORDER BY</strong> film_id;
c2d253c3919efaa6d11487b1fd5061f3  -
</pre>
</blockquote>
<p>Obviously, the following query is <strong>incorrect</strong>:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/multi-condition-update-query/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/another-use-for-top-n-records-per-group-query/">Another use for &#34;top N records per group&#34; query</a></h2>

    <div class="post-meta">

  <div>

    <time>10 Jan 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A few days ago I published <a href="http://code.openark.org/blog/mysql/sql-selecting-top-n-records-per-group">SQL: selecting top N records per group</a>. It just dawned on me that the very same query solved another type of problem I was having a couple years ago.</p>
<blockquote>BTW, for reference, Baron Schwartz posted <a href="http://www.xaprb.com/blog/2006/12/07/how-to-select-the-firstleastmax-row-per-group-in-sql/">this</a> 4 years ago. There are very interesting approaches in text and in comments. Good to see the ancients already knew of such problems, I should study my history better.</p>
<p>(Kidding, kidding! This is self criticism of course)</blockquote>
<p>In this case I present now I have a table with recurring data, which, to some extent, represents revision of data. For the sake of simplicity let&rsquo;s describe it as a simple simulation of a revision system:</p>
<ul>
<li>I have text files, whose content I store within a row</li>
<li>Each text file uses at least one row in the table</li>
<li>Text files can be edited, whereas an edited file is written in a new row (never UPDATEd).</li>
</ul>
<p>Hold your horses: I&rsquo;m not really implementing a revision system, I just can&rsquo;t get into the actual details here.</p>
<p>The table becomes large quickly, and it&rsquo;s desired to purge rows from the table. The rule is: we must obtain the most recent two versions for each file (if there are indeed more than one). All others can be purged. So the question is:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/another-use-for-top-n-records-per-group-query/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-selecting-top-n-records-per-group/">SQL: selecting top N records per group</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Jan 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A while back I <a href="http://code.openark.org/blog/mysql/selecting-a-specific-non-aggregated-column-data-in-group-by">presented</a>(*) an SQL trick to present with non-aggregated column on a GROUP BY query, without use of subquery or derived tables.</p>
<p>Based on a similar concept, combined with string walking, I now present a query which selects top-n records for each group, ordered by <em>some condition</em>. It will require no subqueries. It executes faster than its more conventional alternatives.</p>
<p>[UPDATE: this is MySQL only. Others can use Window Functions where available]</p>
<p>Using the simple <a href="http://dev.mysql.com/doc/index-other.html">world database</a>, we answer the following question:</p>
<blockquote>What are the top 5 largest (by area) countries for each continent? What are their names, surface area and population?</blockquote>
<p>Similar questions would be:</p>
<blockquote>What were the latest 5 films rented by each customer?</p>
<p>What were the most presented advertisements for each user?</blockquote>
<p>etc.</p>
<h4>Step 1: getting the top</h4>
<p>We already know how to get a single column&rsquo;s value for the top country, as presented in the aforementioned post:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-selecting-top-n-records-per-group/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/three-wishes-for-a-new-year/">Three wishes for a new year</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Sep 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  It's a new year by Jewish calendar (and, incidently, today is the first day of the next 365 days). And what do I wish for in the following year? World peace Good health to all Support for ORDER BY &amp; LIMIT in MySQL multi-table UPDATE and DELETE statements, This is sometimes a real show stopper! Have a good year / next 12 months everyone!
  </p>

  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-trick-overcoming-group_concat-limitation-in-special-cases/">SQL trick: overcoming GROUP_CONCAT limitation in special cases</a></h2>

    <div class="post-meta">

  <div>

    <time>21 Jul 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In <a title="Link to Verifying GROUP_CONCAT limit without  using variables" rel="bookmark" href="http://code.openark.org/blog/mysql/verifying-group_concat-limit-without-using-variables">Verifying GROUP_CONCAT limit without using variables</a>, I have presented a test to verify if <strong>group_concat_max_len</strong> is sufficient for known limitations. I will follow the path where I assume I cannot control <strong>group_concat_max_len</strong>, not even in session scope, and show an SQL solution, dirty as it is, to overcome the <strong>GROUP_CONCAT</strong> limitation, under certain conditions.</p>
<p>Sheeri rightfully <a href="http://code.openark.org/blog/mysql/verifying-group_concat-limit-without-using-variables#comment-14617">asks</a> why I wouldn&rsquo;t just set <strong>group_concat_max_len </strong>in session scope. The particular case I have is that I&rsquo;m providing a VIEW definition. I&rsquo;d like users to &ldquo;install&rdquo; that view, i.e. to <strong>CREATE</strong> it on their database. The VIEW does some logic, and uses <strong>GROUP_CONCAT</strong> to implement that logic.</p>
<p>Now, I have no control on the DBA or developer who created the view. The creation of the view has nothing to do with the <strong>group_concat_max_len</strong> setting on her database instance.</p>
<h4>An example</h4>
<p>OK, apologies aside. Using the <a href="http://dev.mysql.com/doc/sakila/en/sakila.html">sakila</a> database, I execute:</p>
<blockquote>
<pre>mysql&gt; SELECT GROUP_CONCAT(last_name) FROM actor \G
*************************** 1. row ***************************
GROUP_CONCAT(last_name): AKROYD,AKROYD,AKROYD,ALLEN,ALLEN,ALLEN,ASTAIRE,BACALL,BAILEY,BAILEY,BALE,BALL,BARRYMORE,BASINGER,BENING,BENING,BERGEN,BERGMAN,BERRY,BERRY,BERRY,BIRCH,BLOOM,BOLGER,BOLGER,BRIDGES,BRODY,BRODY,BULLOCK,CAGE,CAGE,CARREY,CHAPLIN,CHASE,CHASE,CLOSE,COSTNER,CRAWFORD,CRAWFORD,CRONYN,CRONYN,CROWE,CRUISE,CRUZ,DAMON,DAVIS,DAVIS,DAVIS,DAY-LEWIS,DEAN,DEAN,DEE,DEE,DEGENERES,DEGENERES,DEGENERES,DENCH,DENCH,DEPP,DEPP,DERN,DREYFUSS,DUKAKIS,DUKAKIS,DUNST,FAWCETT,FAWCETT,GABLE,GARLAND,GARLAND,GARLAND,GIBSON,GOLDBERG,GOODING,GOODING,GRANT,GUINESS,GUINESS,GUINESS,HACKMAN,HACKMAN,HARRIS,HARRIS,HARRIS,HAWKE,HESTON,HOFFMAN,HOFFMAN,HOFFMAN,HOPE,HOPKINS,HOPKINS,HOPKINS,HOPPER,HOPPER,HUDSON,HUNT,HURT,JACKMAN,JACKMAN,JOHANSSON,JOHANSSON,JOHANSSON,JOLIE,JOVOVICH,KEITEL,KEITEL,KEITEL,KILMER,KILMER,KILMER,KILMER,KILMER,LEIGH,LOLLOBRIGIDA,MALDEN,MANSFIELD,MARX,MCCONAUGHEY,MCCONAUGHEY,MCDORMAND,MCKELLEN,MCKELLEN,MCQUEEN,MCQUEEN,MIRANDA,MONROE,MONROE,MOSTEL,MOSTEL,NEESON,NEESON,NICHOLSON,NOLTE,NOLTE,NOLTE,NOLTE,OLIVIER,OLIVIER,PALTROW,PALTROW,P
1 row in set, 1 warning (0.00 sec)</p>

<p>mysql&gt; SHOW WARNINGS;
+&mdash;&mdash;&mdash;+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
| Level   | Code | Message                              |
+&mdash;&mdash;&mdash;+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
| Warning | 1260 | 1 line(s) were cut by GROUP_CONCAT() |
+&mdash;&mdash;&mdash;+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
1 row in set (0.00 sec)
</pre>
</blockquote>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-trick-overcoming-group_concat-limitation-in-special-cases/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/implicit-casting-you-dont-want-to-see-around/">Implicit casting you don&#39;t want to see around</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Jul 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-types">Data Types</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In <a href="http://code.openark.org/blog/mysql/beware-of-implicit-casting">Beware of implicit casting</a>, I have outlined the dangers of implicit casting. Here&rsquo;s a few more real-world examples I have tackled:</p>
<h4>Number-String comparisons</h4>
<p>Much like in programming languages, implicit casting is made to numbers when at least one of the arguments is a number. Thus:</p>
<blockquote><pre>
mysql&gt; SELECT 3 = &lsquo;3.0&rsquo;;
+&mdash;&mdash;&mdash;&ndash;+
| 3 = &lsquo;3.0&rsquo; |
+&mdash;&mdash;&mdash;&ndash;+
|         1 |
+&mdash;&mdash;&mdash;&ndash;+
1 row in set (0.00 sec)
mysql&gt; SELECT &lsquo;3&rsquo; = &lsquo;3.0&rsquo;;
+&mdash;&mdash;&mdash;&mdash;-+
| &lsquo;3&rsquo; = &lsquo;3.0&rsquo; |
+&mdash;&mdash;&mdash;&mdash;-+
|           0 |
+&mdash;&mdash;&mdash;&mdash;-+
</pre></blockquote>
<p>The second query consists of pure strings comparison. It has no way to determine that number comparison should be made.</p>
<h4>Direct DATE arithmetics</h4>
<p>The first query <em>seems</em> to work, but is completely incorrect. The second explains why. The third is a total mess.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/implicit-casting-you-dont-want-to-see-around/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-good-comments-conventions/">SQL: good comments conventions</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Jul 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/coding">Coding</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I happened upon a customer who left me in awe and admiration. The reason: excellent comments for their SQL code.</p>
<p>I list four major places where SQL comments are helpful. I&rsquo;ll use the <a href="http://dev.mysql.com/doc/sakila/en/sakila.html">sakila</a> database. It is originally scarcely commented; I&rsquo;ll present it now enhanced with comments, to illustrate.</p>
<h4>Table definitions</h4>
<p>The <strong>CREATE TABLE</strong> statement allows for a comment, intended to describe the nature of the table:</p>
<blockquote>
<pre>CREATE TABLE <code>film_text</code> (
 <code>film_id</code> smallint(6) NOT NULL,
 <code>title</code> varchar(255) NOT NULL,
 <code>description</code> text,
 PRIMARY KEY (<code>film_id</code>),
 FULLTEXT KEY <code>idx_title_description</code> (<code>title</code>,<code>description</code>)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 <strong>COMMENT=&lsquo;Reflection of <code>film</code>, used for FULLTEXT search.&rsquo;</strong>
</pre>
</blockquote>
<p>It&rsquo;s too bad the comment&rsquo;s max length is 60 characters, though. However, it&rsquo;s a very powerful field.</p>
<h4>Column definitions</h4>
<p>One may comment particular columns:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-good-comments-conventions/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-forcing-single-row-tables-integrity/">SQL: forcing single row tables integrity</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Jun 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Single row tables are used in various cases. Such tables can be used for &ldquo;preferences&rdquo; or &ldquo;settings&rdquo;; for managing counters (e.g. summary tables), for general-purpose administration tasks (e.g. heartbeat table) etc.</p>
<p>The problem with single row tables is that, well, they must have s single row. And the question is: <em>how can you force them to have just one row?</em></p>
<h4>The half-baked solution</h4>
<p>The common solution is to create a <strong>PRIMARY KEY</strong> and always use the same value for that key. In addition, using <strong>REPLACE</strong> or <strong>INSERT INTO ON DUPLICATE KEY UPDATE</strong> helps out in updating the row. For example:</p>
<blockquote><pre>
CREATE TABLE heartbeat (
 id int NOT NULL PRIMARY KEY,
 ts datetime NOT NULL
 );
</pre></blockquote>
<p>The above table definition is taken from <a href="http://www.maatkit.org/doc/mk-heartbeat.html">mk-heartbeat</a>. It should be noted that <em>mk-heartbeat</em> in itself does not require that the table has a single row, so it is not the target of this post. I&rsquo;m taking the above table definition as a very simple example.</p>
<p>So, we assume we want this table to have a single row, for whatever reasons we have. We would usually do:</p>
<blockquote><pre>
REPLACE INTO heartbeat (id, ts) VALUES (1, NOW());
</pre></blockquote>
<p>or</p>
<blockquote><pre>
INSERT INTO heartbeat (id, ts) VALUES (1, NOW()) ON DUPLICATE KEY UPDATE ts = NOW();
</pre></blockquote>
<p>Why is the above a <em>&ldquo;half baked solution&rdquo;</em>? Because it is up to the application to make sure it reuses the same <strong>PRIMARY KEY</strong> value. There is nothing in the database to prevent the following:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-forcing-single-row-tables-integrity/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/verifying-group_concat-limit-without-using-variables/">Verifying GROUP_CONCAT limit without using variables</a></h2>

    <div class="post-meta">

  <div>

    <time>10 Jun 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I have a case where I must know if <strong>group_concat_max_len</strong> is at its default value (<strong>1024</strong>), which means there are some operation I cannot work out. I&rsquo;ve ranted on this <a href="http://code.openark.org/blog/mysql/those-oversized-undersized-variables-defaults">here</a>.</p>
<p>Normally, I would simply:</p>
<blockquote><pre>
SELECT @@group_concat_max_len
</pre></blockquote>
<p>However, I am using views, where session variables are not allowed. Using a stored function can <a href="http://code.openark.org/blog/mysql/views-better-performance-with-condition-pushdown">do the trick</a>, but I wanted to avoid stored routines. So here&rsquo;s a very simple test case: is the current <strong>group_concat_max_len</strong> long enough or not? I&rsquo;ll present the long version and the short version.</p>
<h4>The long version</h4>
<blockquote><pre>
SELECT
  CHAR_LENGTH(
    GROUP_CONCAT(
      COLLATION_NAME SEPARATOR &ldquo;
    )
  )
FROM
  INFORMATION_SCHEMA.COLLATIONS;
</pre></blockquote>
<p>If the result is <strong>1024</strong>, we are in a bad shape. I happen to know that the total length of collation names is above <strong>1800</strong>, and so it is trimmed down. Another variance of the above query would be:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/verifying-group_concat-limit-without-using-variables/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/choosing-mysql-boolean-data-types/">Choosing MySQL boolean data types</a></h2>

    <div class="post-meta">

  <div>

    <time>03 Jun 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-types">Data Types</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>How do you implement <strong>True</strong>/<strong>False</strong> columns?</p>
<p>There are many ways to do it, each with its own pros and cons.</p>
<h4>ENUM</h4>
<p>Create you column as <strong>ENUM(&lsquo;F&rsquo;, &rsquo;T&rsquo;)</strong>, or <strong>ENUM(&lsquo;N&rsquo;,&lsquo;Y&rsquo;)</strong> or <strong>ENUM(&lsquo;0&rsquo;, &lsquo;1&rsquo;)</strong>.</p>
<p>This is the method used in the <strong>mysql</strong> tables (e.g. <strong>mysql.user</strong> privileges table). It&rsquo;s very simple and intuitive. It truly restricts the values to just two options, which serves well. It&rsquo;s compact (just one byte).</p>
<p>A couple disadvantages to this method:</p>
<ol>
<li>Enums are represented by numerical values (which is good) and start with <strong>1</strong> instead of <strong>0</strong>. This means <strong>&lsquo;F&rsquo;</strong> is <strong>1</strong>, and <strong>&rsquo;T&rsquo;</strong> is <strong>2</strong>, and they both translate to <strong>True</strong> when directly used in a booleanic expression (e.g. <strong>IF(val, &lsquo;True&rsquo;, &lsquo;False&rsquo;)</strong> always yields <strong>&lsquo;True&rsquo;</strong>)</li>
<li>There&rsquo;s no real convention. Is it <strong>&lsquo;Y&rsquo;/&lsquo;N&rsquo;</strong>? <strong>&rsquo;T&rsquo;/&lsquo;F&rsquo;</strong>? <strong>&lsquo;P&rsquo;/&lsquo;N&rsquo;</strong>? <strong>&lsquo;1&rsquo;/&lsquo;0&rsquo;</strong>?</li>
</ol>
<h4>CHAR(1)</h4>
<p>Simple again. Proposed values are, as before, <strong>&lsquo;F&rsquo;</strong>, <strong>&rsquo;T&rsquo;</strong> etc. This time there&rsquo;s no way to limit the range of values. You cannot (in MySQL, unless using triggers) prevent an &lsquo;X&rsquo;.</p>
<p>Watch out for the charset! If it&rsquo;s <strong>utf8</strong> you pay with 3 bytes instead of just 1. And, again, <strong>&rsquo;T&rsquo;</strong>, <strong>&lsquo;F&rsquo;</strong>, <strong>&lsquo;Y&rsquo;</strong>, <strong>&lsquo;N&rsquo;</strong> values all evaluate as <strong>True</strong>. It is possible to use the zero-valued character, but it defeats the purpose of using <strong>CHAR</strong>.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/choosing-mysql-boolean-data-types/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/views-better-performance-with-condition-pushdown/">Views: better performance with condition pushdown</a></h2>

    <div class="post-meta">

  <div>

    <time>20 May 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/execution-plan">Execution plan</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Justin&rsquo;s <a href="http://www.mysqlperformanceblog.com/2010/05/19/a-workaround-for-the-performance-problems-of-temptable-views/">A workaround for the performance problems of TEMPTABLE views</a> post on <a href="http://www.mysqlperformanceblog.com/">mysqlperformanceblog.com</a> reminded me of a solution I once saw on a customer&rsquo;s site.</p>
<p>The customer was using nested views structure, up to depth of some 8-9 views. There were a lot of aggregations along the way, and even the simplest query resulted with a LOT of subqueries, temporary tables, and vast amounts of data, even if only to return with a couple of rows.</p>
<p>While we worked to solve this, a developer showed me his own trick. His trick is now impossible to implement, but there&rsquo;s a hack around this.</p>
<p>Let&rsquo;s use the world database to illustrate. Look at the following view definition:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/views-better-performance-with-condition-pushdown/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/discovery-of-the-day-group-by-desc/">Discovery of the day: GROUP BY ... DESC</a></h2>

    <div class="post-meta">

  <div>

    <time>04 May 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I happened on a query where, by mistake, an SELECT ... ORDER BY x DESC LIMIT 1 was written as SELECT ... GROUP BY x DESC LIMIT 1 And it took me by surprise to realize GROUP BY x DESC is a valid statement. I looked it up: yep! It's documented. In MySQL, GROUP BY results are sorted according to the group statement. You can override this by adding ORDER BY NULL (see past post).
  </p>

  
  <footer>
    <a href="/blog/mysql/discovery-of-the-day-group-by-desc/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/proper-sql-table-alias-use-conventions/">Proper SQL table alias use conventions</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Mar 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/java">Java</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>After seeing quite some SQL statements over the years, something is bugging me: there is no consistent convention as for how to write an SQL query.</p>
<p>I&rsquo;m going to leave formatting, upper/lower-case issues aside, and discuss a small part of the SQL syntax: table aliases. Looking at three different queries, I will describe what I find to be problematic table alias use.</p>
<p>Using the <a href="http://dev.mysql.com/doc/sakila/en/sakila.html">sakila</a> database, take a look at the following queries:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/proper-sql-table-alias-use-conventions/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/tip-faster-than-truncate/">Tip: faster than TRUNCATE</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Mar 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="http://dev.mysql.com/doc/refman/5.0/en/truncate-table.html"><strong>TRUNCATE</strong></a> is usually a fast operation (much faster than <strong>DELETE FROM</strong>). But sometimes it just hangs; I&rsquo;ve has several such uncheerful events with InnoDB (Plugin) tables which were extensively written to. The <strong>TRUNCATE</strong> hanged; nothing else would work; minutes pass.</p>
<p><strong>TRUNCATE</strong> on tables with no <strong>FOREIGN KEY</strong>s <em>should</em> act fast: it translate to dropping the table and creating a new one (and it all depends on the MySQL version, see the manual).</p>
<p>What&rsquo;s faster than <strong>TRUNCATE</strong>, then? If you don&rsquo;t have triggers nor <strong>FOREIGN KEY</strong>s, a <a href="http://dev.mysql.com/doc/refman/5.0/en/rename-table.html"><strong>RENAME TABLE</strong></a> can come to the rescue. Instead of:</p>
<blockquote>
<pre>TRUNCATE log_table</pre>
</blockquote>
<p>Do:</p>
<blockquote>
<pre>CREATE TABLE log_table_new LIKE log_table;
<strong>RENAME TABLE</strong> log_table TO log_table_old, log_table_new TO log_table;
DROP TABLE log_table_old;</pre>
</blockquote>
<p>I found this to work well for me. Do note that <strong>AUTO_INCREMENT</strong> values can be tricky here: the &ldquo;new&rdquo; table is created with an <strong>AUTO_INCREMENT</strong> value which is immediately taken in the &ldquo;working&rdquo; table. If you care about not using same <strong>AUTO_INCREMENT</strong> values, you can:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/tip-faster-than-truncate/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/monotonic-functions-sql-and-mysql/">Monotonic functions, SQL and MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Feb 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/math">Math</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><blockquote>In mathematics, a <strong>monotonic function</strong> (or <strong>monotone function</strong>) is a function which preserves the given order. [<a href="http://en.wikipedia.org/wiki/Monotonic_function">Wikipedia</a>]</blockquote>
<p>To be more precise, a function <em>f</em> is monotonic increasing, if for every <em>x ≤ y</em> it holds that <em>f(x) ≤ f(y)</em>. <em>f</em> is said to be strictly monotonic increasing is for every <em>x &lt; y</em> it holds that <em>f(x) &lt; f(y)</em>.</p>
<p>So, if we follow values in some order, we say that <em>f</em> is monotonic increasing if <em>f</em>&rsquo;s value never decreases (it either increases or stays the same), and we say that <em>f</em> is strictly increasing if <em>f</em>&rsquo;s value is always changes &ldquo;upwards&rdquo;.</p>
<p>Monotonic functions play an important role in SQL. To discuss monotonic functions in SQL we must first determine what the <em>order</em> is, and then, what the <em>function</em> is.</p>
<p>Well, they both change according to our point of view. Let&rsquo;s look at some examples. Take a look at the following table:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/monotonic-functions-sql-and-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/beware-of-implicit-casting/">Beware of implicit casting</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Feb 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Ever so often a query provides a &ldquo;bad&rdquo; execution plan. Adding a missing index can many times solve the problem. However, not everything can be solved with an index. I wish to highlight the point of having an <em>implicit cast</em>, which negates the use of an index on MySQL.</p>
<p>I see this happening a lot on customers&rsquo; databases, and this begs for a short introduction.</p>
<h4>MySQL doesn&rsquo;t support index functions</h4>
<p>Let&rsquo;s assume the following table:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/beware-of-implicit-casting/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/checking-for-string-permutation/">Checking for string permutation</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Jan 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/math">Math</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A permutation is a change of places. Thus, <strong>&lsquo;lolhe&rsquo;</strong> is a permuted <strong>&lsquo;hello&rsquo;</strong> (commonly referred to as &lsquo;scrambled text&rsquo;).</p>
<p>I wish to present an SQL solution for checking if two strings are permutations of the same text.</p>
<h4>About permutations</h4>
<p>So, if <strong>&lsquo;lolhe&rsquo;</strong> is a permutation of <strong>&lsquo;hello&rsquo;</strong>, then <strong>&lsquo;hello&rsquo;</strong> is a permutation of <strong>&lsquo;lolhe&rsquo;</strong>, as well; and both are permutations of <strong>&lsquo;elloh&rsquo;</strong>. The <strong>REVERSE()</strong> of a text is an example of permutation. Mathematically, string permutation is an equivalence relation, and divides all strings to equivalence classes.</p>
<h4>Use cases</h4>
<ul>
<li>We may be interested in permutations when a user chooses a password. We may disallow a password which is identical to the login name; but we may also disallow upper-lower-case-only transformations of the text. We may still disallow a <em>permutation</em> of the text.</li>
<li>On a slightly different scale, the two queries: <strong>SELECT * FROM City WHERE id IN (5, 21, 13)</strong> and <strong>SELECT * FROM City WHERE id IN (13, 5, 21)</strong> are identical. Here, the permutation is not with string characters, but with string tokens. While the solution discussed is targeted at string characters, it can be easily converted to work with string tokens.</li>
</ul>
<h4>Checking for permutation</h4>
<p>The solution I&rsquo;m suggesting checks for permutation between 2 strings by permuting both to a third, <strong>normal form</strong>. The two string are permutations of each other if both have <em>the same normal form</em>.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/checking-for-string-permutation/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/misimproving-performance-problems-with-insert-delayed/">Misimproving performance problems with INSERT DELAYED</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Jan 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  INSERT DELAYED may come in handy when using MyISAM tables. It may in particular be useful for log tables, where one is required to issue frequent INSERTs on one hand, but does not usually want or need to wait for DB response on the other hand. It may even offer some performance boost, by aggregating such frequent INSERTs in a single thread. But it is NOT a performance solution. That is, in a case I've seen, database performance was poor.
  </p>

  
  <footer>
    <a href="/blog/mysql/misimproving-performance-problems-with-insert-delayed/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/useful-temporal-functions-queries/">Useful temporal functions &amp; queries</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Dec 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-types">Data Types</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Here&rsquo;s a complication of some common and useful time &amp; date calculations and equations. Some, though very simple, are often misunderstood, leading to inefficient or incorrect implementations.</p>
<p>There are many ways to solve such problems. I&rsquo;ll present my favorites.</p>
<h4>Querying for time difference</h4>
<p>Given two timestamps: <em>ts1</em> (older) and <em>ts2</em> (newer), how much time has passed between them?</p>
<p>One can use <strong>TIMEDIFF()</strong> &amp; <strong>DATEDIFF()</strong>, or compare two <strong>UNIX_TIMESTAMP()</strong> values. My personal favorite is to use <strong>TIMESTAMPDIFF()</strong>. Reason being that I&rsquo;m usually interested in a specific metric, like the number of hours which have passed, or the number of days, disregarding the smaller minute/second resolution. Which allows one to:</p>
<blockquote>
<pre>SELECT TIMESTAMPDIFF(HOUR, ts1, ts2)</pre>
</blockquote>
<p>Take, for example:</p>
<blockquote>
<pre>SELECT TIMESTAMPDIFF(MONTH, &lsquo;2008-10-07 00:00:00&rsquo;, &lsquo;2009-12-06 00:00:00&rsquo;)</pre>
</blockquote>
<p>The function correctly identifies the number of days per month, and provides with <strong>13</strong>, being the truncated number of full months.</p>
<h4>Doing arithmetics</h4>
<p>One can use <strong>TIMESTAMPADD()</strong>, or <strong>DATE_SUB()</strong>, but, again, when dealing with specific resolutions, I find &ldquo;<strong>+ INTERVAL</strong>&rdquo; to be the most convenient:</p>
<blockquote>
<pre>SELECT ts1 + INTERVAL 10 HOUR</pre>
</blockquote>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/useful-temporal-functions-queries/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-multi-line-chart/">SQL multi line chart</a></h2>

    <div class="post-meta">

  <div>

    <time>03 Nov 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/graphs">Graphs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Time for another charting SQL query. I wish to present a single-query generated multi-line/area chart. I&rsquo;ll walk through some of the steps towards making this happen. By the end of this post I&rsquo;ll present some real-data charts, area charts and colored charts.</p>
<blockquote>
<pre>+&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
| y_scale | chart                                                                             |
+&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
| 1       | *<strong><em>&mdash;&mdash;&mdash;#######&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-</em></strong>*<strong><em>&mdash;&mdash;&ndash;###### |
| 0.88    | &mdash;-</em></strong>&mdash;###&mdash;&mdash;-##&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<strong><em>&mdash;&mdash;-</em></strong>&mdash;##&mdash;&mdash; |
| 0.75    | &mdash;&mdash;-<strong>#&mdash;&mdash;&mdash;&mdash;##&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-</strong>&mdash;&mdash;&mdash;&mdash;-<em>##&mdash;&mdash;&ndash; |
| 0.63    | &mdash;&mdash;##-</em>&mdash;&mdash;&mdash;&mdash;&ndash;##&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-*&mdash;&mdash;&mdash;&mdash;&ndash;##<strong>&mdash;&mdash;&ndash; |
| 0.5     | -@@@@@@@@@@@@@@@&mdash;&mdash;&mdash;-#&mdash;&ndash;@@@@@@@@@@@@@@@@&mdash;-</strong>&mdash;&mdash;&mdash;@@@@@@@@@@@@@@@@&ndash; |
| 0.38    | &mdash;-#&mdash;&mdash;-<em>&mdash;&mdash;&mdash;&mdash;&ndash;##&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-</em>&mdash;&mdash;&mdash;&mdash;&mdash;#&mdash;&mdash;-<em>&mdash;&ndash; |
| 0.25    | &ndash;##&mdash;&mdash;&mdash;</em>&mdash;&mdash;&mdash;&mdash;&mdash;#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<em>&mdash;&mdash;&mdash;&mdash;&ndash;##&mdash;&mdash;&mdash;</em>&mdash;- |
| 0.13    | -#&mdash;&mdash;&mdash;&mdash;<strong>&mdash;&mdash;&mdash;&mdash;&ndash;#&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</strong>&mdash;&mdash;&mdash;&mdash;&ndash;#&mdash;&mdash;&mdash;&mdash;<em>&mdash; |
| 0       | @&mdash;&mdash;&mdash;&mdash;&mdash;</em>&mdash;&mdash;&mdash;&mdash;&ndash;##&mdash;&mdash;&mdash;&mdash;&ndash;*&mdash;&mdash;&mdash;&mdash;&mdash;#&mdash;&mdash;&mdash;&mdash;&ndash;<strong>- |
| -0.12   | &mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<em>&mdash;&mdash;&mdash;&mdash;&mdash;#&mdash;&mdash;&mdash;&mdash;</em>&mdash;&mdash;&mdash;&mdash;&ndash;##&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;* |
| -0.25   | &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;*&mdash;&mdash;&mdash;&mdash;&mdash;#&mdash;&mdash;&mdash;</strong>&mdash;&mdash;&mdash;&mdash;&ndash;#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash; |
| -0.37   | &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-<strong>&mdash;&mdash;&mdash;&mdash;&ndash;#&mdash;&mdash;-<em>&mdash;&mdash;&mdash;&mdash;&mdash;#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash; |
| -0.5    | &mdash;&mdash;&mdash;&mdash;&mdash;-@@@@@@@@@@@@@@@@&mdash;-##&mdash;-</em>&mdash;&ndash;@@@@@@@@@@@@@@@&mdash;&mdash;&mdash;&mdash;&mdash;-@@ |
| -0.62   | &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-</strong>&mdash;&mdash;&mdash;&mdash;&ndash;#-<strong>&mdash;&mdash;&mdash;&mdash;&ndash;#&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash; |
| -0.75   | &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</strong>&mdash;&mdash;&mdash;&mdash;<strong>#&mdash;&mdash;&mdash;&mdash;-##&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;- |
| -0.87   | &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</strong>&mdash;&mdash;-<strong><em>&mdash;###&mdash;&mdash;-###&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash; |
| -1      | &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-</em></strong>****&mdash;&mdash;&mdash;#######&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash; |
|         | v:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 0                                                                               8 |
|         |     # sin(x)                                                                      |
|         |     * cos(x)                                                                      |
|         |     @ sign(tan(x))/2                                                              |
+&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+</pre>
</blockquote>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-multi-line-chart/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/how-to-calculate-a-good-innodb-log-file-size-recap/">How to calculate a good InnoDB log file size - recap</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Oct 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Following Baron Schwartz&rsquo; post: <a href="http://www.mysqlperformanceblog.com/2008/11/21/how-to-calculate-a-good-innodb-log-file-size/">How to calculate a good InnoDB log file size</a>, which shows how to make an estimate for the InnoDB log file size, and based on <a href="http://code.openark.org/blog/mysql/sql-querying-for-status-difference-over-time">SQL: querying for status difference over time</a>, I&rsquo;ve written a query to run on MySQL 5.1, which, upon sampling 60 seconds of status, estimates the InnoDB transaction log bytes that are expected to be written in the period of 1 hour.</p>
<p><em>Recap</em>: this information can be useful if you&rsquo;re looking for a good <strong>innodb_log_file_size</strong> value, such that will not pose too much I/O (smaller values will make for more frequent flushes), not will make for a too long recovery time (larger values mean more transactions to recover upon crash).</p>
<p>It is assumed that the 60 seconds period represents an average system load, not some activity spike period. Edit the sleep time and factors as you will to sample longer or shorter periods.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/how-to-calculate-a-good-innodb-log-file-size-recap/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-querying-for-status-difference-over-time/">SQL: querying for status difference over time</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Oct 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The InnoDB plugin has a nice <strong>INFORMATION_SCHEMA</strong> concept: resetting tables. For example, the <strong>INNODB_CMP</strong> table lists information about compression operation. A similar table, <strong>INNODB_CMP_RESET</strong>, provides the same information, but resets the values. The latter can be used to measure, for example, number of compression operations over time.</p>
<p>I wish to present a SQL trick which does the same, without need for resetting tables. Suppose you have some status table, and you wish to measure the change in status per second, per minute etc. The trick is to query for the value twice in the same query, with some pause in between, and make the difference calculation.</p>
<p>For sake of simplicity, I&rsquo;ll demonstrate using 5.1&rsquo;s <strong>INFORMATION_SCHEMA.GLOBAL_STATUS</strong>. Please refer to <a href="http://code.openark.org/blog/mysql/information_schema-global_status-watch-out">INFORMATION_SCHEMA.GLOBAL_STATUS: watch out</a> for some discussion on this.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-querying-for-status-difference-over-time/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-ranking-without-self-join-revisited/">SQL: ranking without self join, revisited</a></h2>

    <div class="post-meta">

  <div>

    <time>25 Sep 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post follows <a title="Link to SQL: Ranking without self join" rel="bookmark" href="http://code.openark.org/blog/mysql/sql-ranking-without-self-join">SQL: Ranking without self join</a> and <a title="Link to On user variables evaluation order" rel="bookmark" href="http://code.openark.org/blog/mysql/on-user-variables-evaluation-order">On user variables evaluation order</a>. I wish to share some insights with regard to user variables evaluation, as well as provide <em>yet another</em> ranking solution, which attempts to overcome the uncertainty factor with user variables.</p>
<p>There will be hand waving in this post (albeit empirical hand waving). Stop here if you don&rsquo;t like hand waving. Continue if you feel curious or wish to contradict my assumptions.</p>
<h4>Recap</h4>
<p>The order of evaluation of user variables is undefined. The documentation has some contradicting example (bug <a href="http://bugs.mysql.com/bug.php?id=47514">47514</a>), but states that variables should not be read and assigned in different parts of the same statement (just <em>what is</em> a different part? Bug <a href="http://bugs.mysql.com/bug.php?id=47516">47516</a>).</p>
<h4>Looking for a solution</h4>
<p>There doesn&rsquo;t seem to be a problem with reading and assigning variables in the very same part of the statement. For example, <strong>SELECT @a := @a+1</strong>&hellip; is exactly such a case.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-ranking-without-self-join-revisited/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-ranking-without-self-join/">SQL: Ranking without self join</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Sep 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/execution-plan">Execution plan</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The common way of solving the classic SQL problem of ranking, involves a  self join. I wish to present a different solution, which only iterates the table once, and provides the same output.</p>
<h4>The ranking problem</h4>
<p>Given a table with names and scores (e.g. students exams scores), add rank for each row, such that the rank identifies her position among other rows. Rows with identical scores should receive the same rank (e.g. both contenders got the silver medal).</p>
<p>Consider the following table (download <a href="http://code.openark.org/blog/wp-content/uploads/2009/09/score.sql">score.sql</a>):</p>
<blockquote>
<pre>mysql&gt; select * from score;
+&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;-+
| score_id | student_name | score |
+&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;-+
|        1 | Wallace      |    95 |
|        2 | Gromit       |    97 |
|        3 | Shaun        |    85 |
|        4 | McGraw       |    92 |
|        5 | Preston      |    92 |
+&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;-+
5 rows in set (0.00 sec)</pre>
</blockquote>
<p>We wish to present ranks in some way similar to:</p>
<blockquote>
<pre>+&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;-+&mdash;&mdash;+
| score_id | student_name | score | rank |
+&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;-+&mdash;&mdash;+
|        2 | Gromit       |    97 |    1 |
|        1 | Wallace      |    95 |    2 |
|        4 | McGraw       |    92 |    3 |
|        5 | Preston      |    92 |    3 |
|        3 | Shaun        |    85 |    4 |
+&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;-+&mdash;&mdash;+</pre>
</blockquote>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-ranking-without-self-join/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/generating-numbers-out-of-seemingly-thin-air/">Generating numbers out of seemingly thin air</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Sep 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In some of my previous posts I&rsquo;ve used a <strong>numbers</strong> table, like one holding values <strong>1, 2, 3, &hellip;, 255</strong>. Such table can be used for string walking, joining with other tables, performing iterations.</p>
<p>The existence of number tables has always been a little pain. Yes, they&rsquo;re very, <em>very</em> simple, but they <em>need to be there</em>. So if you just need to script some SQL query, you may find that you need to create such tables. Ummm&hellip; this means you need to have privileges (at least <strong>CREATE TEMPORARY</strong> and <strong>INSERT</strong>, if not <strong>CREATE</strong>).</p>
<p>The other day, Baron Schwartz posted <a href="http://www.xaprb.com/blog/2009/08/09/how-to-round-to-the-nearest-whole-multiple-or-fraction-in-sql/">How to round to the nearest whole multiple or fraction in SQL</a>. In an offhand way, he generated some random numbers using the <strong>mysql.help_topic</strong> table. I then realized that post solved something I&rsquo;ve been looking for: using a sure-to-exist table on any MySQL installation.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/generating-numbers-out-of-seemingly-thin-air/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-pie-chart/">SQL pie chart</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Aug 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/graphs">Graphs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>My other half says I&rsquo;m losing it. But I think that as an enthusiast kernel developer she doesn&rsquo;t have the right to criticize people. (&ldquo;I like user space better!&rdquo; - she exclaims upon reading this).</p>
<p>Shown below is a (single query) SQL-generated pie chart. I will walk through the steps towards making this happen, and conclude with what, I hope you&rsquo;ll agree, are real-world, useful usage samples.</p>
<blockquote>
<pre>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
| pie_chart                                                            |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
|                                                                      |
|                         ;;;;;;;;;;;;;;;;;;;;;                        |
|                  oooooooo;;;;;;;;;;;;;;;;;;;;;;;;;;;                 |
|             oooooooooooooo;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;            |
|          ooooooooooooooooo                 ;;;;;;;;;;;;#####         |
|        oooooooooooooo                           ;#############       |
|       oooooooooooo                                 ############      |
|      oooooooooooo                                   ############     |
|      ooooooooooo                                     ###########     |
|      oooooooooooo                                   ::::::::::::     |
|       oooooooooooo                                 ::::::::::::      |
|        ooooooooo:::::                           ::::::::::::::       |
|          o::::::::::::::::                 :::::::::::::::::         |
|             :::::::::::::::::::::::::::::::::::::::::::::            |
|                  :::::::::::::::::::::::::::::::::::                 |
|                         :::::::::::::::::::::                        |
|                                                                      |
| ##  red: 1 (10%)                                                     |
| ;;  blue: 2 (20%)                                                    |
| oo  orange: 3 (30%)                                                  |
| ::  white: 4 (40%)                                                   |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+</pre>
</blockquote>
<h4>Requirements</h4>
<p>We need a generic query, which returns at least these two columns: <strong>name_column</strong> and <strong>value_column</strong>. For example, the following query will do:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-pie-chart/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-graphics/">SQL graphics</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Aug 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>SQL is not meant to generate graphics, for sure; but I see some cases where generating non-tabular output can be desirable, as I will show in future posts.</p>
<p>I&rsquo;d like to explain the basics of working SQL graphics: it is actually possible to do whatever you like. How?</p>
<h4>Coordinates system</h4>
<p>We&rsquo;ll now develop a coordinates system using SQL. By producing this, I will have proven my point that anything is possible, and will provide an additional proof of concept.</p>
<p>To start with generating coordinates, I&rsquo;ll need a helper table: a numbers table (<a href="http://code.openark.org/blog/wp-content/uploads/2009/08/tinyint_asc.sql">tinyint_asc</a>, example, with numbers ranging 0..255).</p>
<p>We&rsquo;ll strive to produce a 10x10 coordinate matrix. To do this, we&rsquo;ll self-join the numbers table against itself, and use a helper variable to set the size of the matrix.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-graphics/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/auto-scaling-scaled-sql-graphs-concluded/">Auto scaling, scaled SQL graphs concluded</a></h2>

    <div class="post-meta">

  <div>

    <time>28 Jul 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/graphs">Graphs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I wasn&rsquo;t sure I was to go this far. After catching breath the following have been added to <a href="http://code.openark.org/blog/mysql/generic-auto-scaling-scaled-sql-graphs">Generic, auto scaling, scaled SQL graphs</a>, and these will conclude my current hacks:</p>
<ul>
<li>Displaying X-axis min/max values.</li>
<li>Support for Y-axis values precision.</li>
<li>Support for pre-defined scale range.</li>
</ul>
<p>The addition of the above makes for presentable, usable graphs. See also sample graphs at the end of this post.</p>
<h4>Step 8: adding X-axis values</h4>
<p>I add minimum/maximum X-scale values to the graph. What was just <strong>ordering_column</strong> before, now turns to be the <strong>x</strong> in the <strong>y = f(x)</strong> function.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/auto-scaling-scaled-sql-graphs-concluded/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/generic-auto-scaling-scaled-sql-graphs/">Generic, auto scaling, scaled SQL graphs</a></h2>

    <div class="post-meta">

  <div>

    <time>27 Jul 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/graphs">Graphs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In <a href="http://code.openark.org/blog/mysql/rotating-sql-graphs-horizontally">Rotating SQL graphs horizontally</a>, I have shown how to rotate an ASCII SQL graph into horizontal position.</p>
<p>I was dissatisfied with some parts of the solution, which I will show now how to fix:</p>
<ul>
<li>I had to manually scale the graph values so as to fit nicely into screen.</li>
<li>I had to rely on hard coded scaling schemes.</li>
<li>I had to rely on hard coded column names.</li>
<li>I had no y-axis legend.</li>
</ul>
<p>I will now present an SQL query which allows for <em>pluggable queries</em>, which creates self, <em>auto scaling graphs</em>, along with <em>y-axis scales</em>.</p>
<p>Using deeply nested subqueries, we will evolve a simple SELECT query into an elaborate graph. I will present the many steps required, followed by explanations and sample results. But in the end - the steps are unimportant. I&rsquo;ll present a <em>generic query</em>, into which your own SELECT can be embedded, and which will provide you with the graph.</p>
<p>We&rsquo;ll use the same example, found in <a href="http://code.openark.org/blog/wp-content/uploads/2009/07/graph2.sql">graph.sql</a>.</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/generic-auto-scaling-scaled-sql-graphs/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/rotating-sql-graphs-horizontally/">Rotating SQL graphs horizontally</a></h2>

    <div class="post-meta">

  <div>

    <time>24 Jul 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/graphs">Graphs</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>We all love graphs. We all love SQL hacks. We all know the SQL hack which displays a character-based graph (example follows for those unfamiliar).</p>
<p>But we all love <em>horizontal</em> graphs, not vertical ones. We are used to the X axis being horizontal, Y being vertical. Not vice versa.</p>
<p>In this post I&rsquo;ll present a SQL hack which rotates a vertical graph to horizontal. In fact, the technique shown will rotate any &lsquo;textual image&rsquo;; but graphs are a nice example.</p>
<h4>A vertical graph example</h4>
<p>What&rsquo;s prettier than a sinus curve? I have prepared a simple table that will serve nicely, and can be found in <a href="http://code.openark.org/blog/wp-content/uploads/2009/07/graph.sql">graph_tables.sql</a>.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/rotating-sql-graphs-horizontally/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/unwalking-a-string-with-group_concat/">Unwalking a string with GROUP_CONCAT</a></h2>

    <div class="post-meta">

  <div>

    <time>16 Jun 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/books">Books</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>&ldquo;Walking a string&rdquo; is an SQL technique to convert a single value into multiple rows result set. For example, walking the string <strong>&lsquo;hello&rsquo;</strong> results with 5 rows, each of which contains a single character from the text.</p>
<p>I&rsquo;ll present a brief example of walking a string, and then show how to &ldquo;unwalk&rdquo; the string: do the reverse operation.</p>
<p>To walk a string, an integers table is required (or this could be a good use for <a href="http://www.mysqlconf.com/mysql2009/public/schedule/detail/6891">SeqEngine</a>):</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/unwalking-a-string-with-group_concat/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/sql-finding-a-users-countryregion-based-on-ip/">SQL: finding a user&#39;s country/region based on IP</a></h2>

    <div class="post-meta">

  <div>

    <time>26 May 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;ve encountered the same problem twice for different customers, so I guess it&rsquo;s worth a discussion.</p>
<p>A common task for web applications is to find out the country/region of a user, based on her IP address, as can be detected in the HTTP request. Depending on the country of origin, the website can translate dates for different time zones, can change locale settings, and, perhaps most commonly, show advertisements in her native language.</p>
<p>To start with, there&rsquo;s a table which lists the IP ranges per country/region. Let&rsquo;s assume we&rsquo;re only dealing with IPv4:</p>
<blockquote>
<pre>CREATE TABLE regions_ip_range (
  regions_ip_range_id INT UNSIGNED AUTO_INCREMENT,
  country VARCHAR(64) CHARSET utf8,
  region VARCHAR(64) CHARSET utf8,
  start_ip INT UNSIGNED,
  end_ip INT UNSIGNED,
  …
  PRIMARY KEY(regions_ip_range_id),
  &hellip;
);</pre>
</blockquote>
<p>The table is fixed, and is populated. Now the question arises: how do we query this table, and which indexes should be created?</p>
<h4>The wrong way</h4>
<p>The form I&rsquo;ve encountered is as follows: an index is declared on regions_ip_range:</p>
<blockquote>
<pre>KEY ip_range_idx (start_ip, end_ip)</pre>
</blockquote>
<p>And the query goes like this:</p>
<blockquote>
<pre>SELECT * FROM regions_ip_range
WHERE my_ip BETWEEN start_ip AND end_ip</pre>
</blockquote>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/sql-finding-a-users-countryregion-based-on-ip/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/7-ways-to-convince-mysql-to-use-the-right-index/">7 ways to convince MySQL to use the right index</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Apr 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/books">Books</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/execution-plan">Execution plan</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Sometimes MySQL gets it wrong. It doesn&rsquo;t use the right index.</p>
<p>It happens that MySQL generates a query plan which is really bad (EXPLAIN says it&rsquo;s going to explore some 10,000,000 rows), when another plan (soon to show how was generated) says: &ldquo;Sure, I can do that with 100 rows using a key&rdquo;.</p>
<h4>A true story</h4>
<p>A customer had issues with his database. Queries were taking 15 minutes to complete, and the db in general was not responsive. Looking at the slow query log, I found the criminal query. Allow me to bring you up to speed:</p>
<p>A table is defined like this:</p>
<blockquote>
<pre>CREATE TABLE t (
  id INT UNSIGNED AUTO_INCREMENT,
  type INT UNSIGNED,
  level TINYINT unsigned,
  &hellip;
  PRIMARY KEY(id),
  KEY <code>type</code> (type)
) ENGINE=InnoDB;</pre>
</blockquote>
<p>The offending query was this:</p>
<blockquote>
<pre>SELECT id FROM data
WHERE type=12345 AND level &gt; 3
ORDER BY id</pre>
</blockquote>
<p>The facts were:</p>
<ul>
<li><code>t</code> has about 10,000,000 rows.</li>
<li>The index on <code>type</code> is selective: about 100 rows per value on average.</li>
<li>The query took a long time to complete.</li>
<li>EXPLAIN has shown that MySQL uses the PRIMARY KEY, hence searches 10,000,000 rows, filtered &ldquo;using where&rdquo;.</li>
<li>The <em>other</em> EXPLAIN has shown that by using the <code>type</code> key, only 110 rows are expected, to be filtered &ldquo;using where&rdquo;, then sorted &ldquo;using filesort&rdquo;</li>
</ul>
<p>So MySQL acknowledged it was generating the wrong plan. The <em>other</em> plan was better by its own standards.</p>
<h4>Solving the problem</h4>
<p>Let&rsquo;s walk through 7 ways to solve the problem, starting with the more aggressive solutions, refining to achieve desired behavior through subtle changes.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/7-ways-to-convince-mysql-to-use-the-right-index/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/using-triggers-to-block-malicious-code-an-example/">Using triggers to block malicious code: an example</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Jan 2009</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/triggers">Triggers</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Web applications face constant exploitation attempts. Those with a user base must keep their users&rsquo; private data, well&hellip; private.</p>
<p>While the MySQL security model allows restricting users access to databases, tables and even columns, it has no built in feature for restricting the rows access within the given table.</p>
<p>One cannot allow a user to only update rows 0 through 99, but restrict that user from updating rows 100 to 199. Such restrictions are usually managed in the application level, by adding a necessary &ldquo;&hellip; AND filtering_column = some_value&hellip;&rdquo;</p>
<p>Many web application have the notion of an &lsquo;admin&rsquo; account, or several such accounts, which provide greater control over the application. The &lsquo;admin&rsquo; account is one account to which many attacks are targeted. One such attack is an attempt to modify the admin&rsquo;s password, such that the attacker can later log in with and access restricted data.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/using-triggers-to-block-malicious-code-an-example/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysqls-character-sets-and-collations-demystified/">MySQL&#39;s character sets and collations demystified</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Dec 2008</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-types">Data Types</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>MySQL&rsquo;s character sets and collations are often considered as a mystery, and many users either completely disregard them and keep with the defaults, or set everything to UTF8.</p>
<p>This post will attempt to shed some light on the mystery, and provide with some best practices for use with text columns with regard to character sets.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysqls-character-sets-and-collations-demystified/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/dynamic-sequencing-with-a-single-query/">Dynamic sequencing with a single query</a></h2>

    <div class="post-meta">

  <div>

    <time>03 Dec 2008</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>It is a known trick to use a session variables for dynamically counting/sequencing rows. The way to go is to SET a variable to zero, then use arithmetic within assignment to increment its value for each row in the SELECTed rows.</p>
<p>For example, the following query lists the top 10 populated countries, using <a title="MySQL's world database setup" href="http://dev.mysql.com/doc/world-setup/en/world-setup.html">MySQL&rsquo;s world database</a>:</p>
<blockquote>
<pre>SELECT Code, Name, Population
FROM Country ORDER BY Population DESC LIMIT 10;</p>

<p>+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;+
| Code | Name               | Population |
+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;+
| CHN  | China              | 1277558000 |
| IND  | India              | 1013662000 |
| USA  | United States      |  278357000 |
| IDN  | Indonesia          |  212107000 |
| BRA  | Brazil             |  170115000 |
| PAK  | Pakistan           |  156483000 |
| RUS  | Russian Federation |  146934000 |
| BGD  | Bangladesh         |  129155000 |
| JPN  | Japan              |  126714000 |
| NGA  | Nigeria            |  111506000 |
+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;+</pre>
</blockquote>
<p>The results do not provide any sequence number. Nor does the table have an AUTO_INCREMENT or otherwise unique row number. If I were to rate the countries by population, the common trick is:</p>
<blockquote>
<pre>SET @rank := 0;
SELECT
  @rank := @rank+1 AS rank,
  Code, Name, Population
FROM Country ORDER BY Population DESC LIMIT 10;</p>

<p>+&mdash;&mdash;+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;+
| rank | Code | Name               | Population |
+&mdash;&mdash;+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;+
|    1 | CHN  | China              | 1277558000 |
|    2 | IND  | India              | 1013662000 |
|    3 | USA  | United States      |  278357000 |
|    4 | IDN  | Indonesia          |  212107000 |
|    5 | BRA  | Brazil             |  170115000 |
|    6 | PAK  | Pakistan           |  156483000 |
|    7 | RUS  | Russian Federation |  146934000 |
|    8 | BGD  | Bangladesh         |  129155000 |
|    9 | JPN  | Japan              |  126714000 |
|   10 | NGA  | Nigeria            |  111506000 |
+&mdash;&mdash;+&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;+</pre>
</blockquote>
<p>The first query sets the @rank to zero, so that it is not NULL (since no arithmetic can be done with NULL).  The second query relies on its success.</p>
<p><strong>Can the same be achieved with one query only? </strong>That&rsquo;s more of a problem.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/dynamic-sequencing-with-a-single-query/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/selecting-a-specific-non-aggregated-column-data-in-group-by/">Selecting a specific non aggregated column data in GROUP BY</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Dec 2008</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In a GROUP BY query, MySQL may allow specifying non aggregated columns. For example, using <a title="Setting up the world database" href="http://dev.mysql.com/doc/world-setup/en/world-setup.html">MySQL&rsquo;s world database</a>, I wish to get the number of countries per continent, along with a &ldquo;sample&rdquo; country:</p>
<blockquote>
<pre><strong>SELECT </strong>Continent, <strong>COUNT</strong>(*), Name
<strong>FROM </strong><code>Country</code> <strong>GROUP BY </strong>Continent</p>

<p>+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;-+
| Continent     | COUNT(*) | Name           |
+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;-+
| Asia          |       51 | Afghanistan    |
| Europe        |       46 | Albania        |
| North America |       37 | Aruba          |
| Africa        |       58 | Angola         |
| Oceania       |       28 | American Samoa |
| Antarctica    |        5 | Antarctica     |
| South America |       14 | Argentina      |
+&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;-+</pre>
</blockquote>
<p>What if I want to choose that &ldquo;sample&rdquo; country? For example, for each continent, I wish to show the country with the largest population. To simply see the largest population, I would use MAX(Population). But which country is referred? I wish to provide a solution which does not involve sub-queries, HAVING or JOINs.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/selecting-a-specific-non-aggregated-column-data-in-group-by/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/useful-database-analysis-queries-with-information_schema/">Useful database analysis queries with INFORMATION_SCHEMA</a></h2>

    <div class="post-meta">

  <div>

    <time>26 Nov 2008</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A set of useful queries on INFORMATION_SCHEMA follows. These queries can be used when approaching a new database, to learn about some of its properties, or they can be regularly used on an existing schema, so as to verify its integrity.</p>
<p>I will present queries for:</p>
<ul>
<li>Checking on database engines and size</li>
<li>Locating duplicate and redundant indexes</li>
<li>Checking on character sets for columns and tables, looking for variances</li>
<li>Checking on processes and long queries (only with MySQL 5.1)</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/useful-database-analysis-queries-with-information_schema/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/less-known-sql-syntax-and-functions-in-mysql/">Less known SQL syntax and functions in MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>23 Nov 2008</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/myisam">MyISAM</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/syntax">Syntax</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>&ldquo;Standard SQL&rdquo; is something you read about. All popular databases have modified version of SQL. Each database adds its own flavor and features to the standard. MySQL is no different.</p>
<p>Some deviations are storage engine dependent. Others are more general. Many, such as <strong><code>INSERT IGNORE</code></strong>, are commonly used. Here&rsquo;s a list of some MySQL deviations to SQL, which are not so well known.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/less-known-sql-syntax-and-functions-in-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
</div>

</div>
</div>
<script src="/blog/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>
