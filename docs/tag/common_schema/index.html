<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>Common_schema &middot; code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="code.openark.org" href="/blog/tag/common_schema/index.xml" />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blog/img/favicon.ico" type="image/x-icon" />


  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
      <li class="pure-menu-item">
        <a class="pure-menu-link" href="/blog/tag/common_schema/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link">
        Shlomi Noach
        
          <div class="avatar-container">
        	  <div class="avatar-img-border">
                <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
        	  </div>
        	</div>
        
      </a>
    </li>

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Common_schema</h1>
</div>

<div class="content">
  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/get-per-object-grants-via-common_schema/">Get per-object grants via common_schema</a></h2>

    <div class="post-meta">

  <div>

    <time>29 Sep 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Did you know <a href="http://code.google.com/p/common-schema">common_schema</a> supports a complete breakdown of all accounts on your database server? It can provide you with the <strong>GRANT</strong> statements required to set up an account, the <strong>REVOKE</strong> statements to undo the former, and this can be broken down on a per-object &amp; per-object-type basis. Consider the <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">sql_grants</a> view:</p>
<p><em>Find who has privileges on a table called <strong>t</strong></em>:</p>
<blockquote>
<pre>select * from <strong>common_schema.sql_grants</strong> where <strong>priv_level_name</strong>=&lsquo;table&rsquo; and <strong>object_name</strong>=&rsquo;t&rsquo;\G</p>

<p>           GRANTEE: &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
              user: power1
              host: localhost
        priv_level: <code>mytst</code>.<code>t</code>
   priv_level_name: table
     object_schema: mytst
       object_name: t
current_privileges: SELECT
      IS_GRANTABLE: NO
         sql_grant: GRANT SELECT ON <code>mytst</code>.<code>t</code> TO &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
        sql_revoke: REVOKE SELECT ON <code>mytst</code>.<code>t</code> FROM &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
     sql_drop_user: DROP USER &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;</pre>
</blockquote>
<p>or, <em>who has privileges on the <strong>test</strong> schema</em>:</p>
<blockquote>
<pre>select * from common_schema.sql_grants where priv_level_name=&lsquo;schema&rsquo; and object_name=&lsquo;test&rsquo; \G</p>

<p>           GRANTEE: &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
              user: power1
              host: localhost
        priv_level: <code>test</code>.*
   priv_level_name: schema
     object_schema: NULL
       object_name: test
current_privileges: ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE
      IS_GRANTABLE: NO
         sql_grant: GRANT ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* TO &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
        sql_revoke: REVOKE ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* FROM &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
     sql_drop_user: DROP USER &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;</p>

<p>           GRANTEE: &lsquo;test&rsquo;@&lsquo;localhost&rsquo;
              user: test
              host: localhost
        priv_level: <code>test</code>.*
   priv_level_name: schema
     object_schema: NULL
       object_name: test
current_privileges: ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE
      IS_GRANTABLE: NO
         sql_grant: GRANT ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* TO &lsquo;test&rsquo;@&lsquo;localhost&rsquo;
        sql_revoke: REVOKE ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* FROM &lsquo;test&rsquo;@&lsquo;localhost&rsquo;
     sql_drop_user: DROP USER &lsquo;test&rsquo;@&lsquo;localhost&rsquo;</p>

<p></pre>
</blockquote>
<p>In the same manner, you can easily SELECT for all grants that are defined per-table, per-schema, &hellip; <strong>priv_level_name</strong>: is any one of <strong>&lsquo;user&rsquo;</strong>, <strong>&lsquo;schema&rsquo;</strong>, <strong>&lsquo;table&rsquo;</strong>, <strong>&lsquo;column&rsquo;</strong>, <strong>&lsquo;routine&rsquo;</strong>.</p>
<p>The above is a view, which aggregates data from all relevant <strong>INFORMATION_SCHEMA</strong> tables, normalizing and de-normalizing as necessary.</p>
<p>You might also want to look at <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">sql_show_grants</a> which provides with a no-breakdown GRANT for all accounts. It&rsquo;s like a SHOW ALL GRANTS which doesn&rsquo;t exist, plus it&rsquo;s SELECTable.</p>
<p>Also, thanks to <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/eval.html">eval()</a>, the above make for executable code. Consider:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/get-per-object-grants-via-common_schema/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/speaking-at-perconalive-common_schema-mysql-devops/">Speaking at Percona Live: common_schema, MySQL DevOps</a></h2>

    <div class="post-meta">

  <div>

    <time>10 Mar 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/devops">DevOps</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  In less than a month I'll be giving these two talks at Percona Live: common_schema: DBA's framework for MySQL If you are still unfamiliar with common_schema, this will make for a good introduction. I'll give you multiple reasons why you would want to use it, and how it would come to immediate use at your company. I do mean immediate, as in previous common_schema presentations I happened to get feedback emails from attendees within the same or next day letting me know how common_schema solved an insistent problem of theirs or how it exposed an unknown status.
  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-at-perconalive-common_schema-mysql-devops/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/why-delegating-code-to-mysql-stored-routines-is-poor-engineering-practice/">Why delegating code to MySQL Stored Routines is poor engineering practice</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Feb 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I happen to use stored routines with MySQL. In fact, my open source project <a href="http://code.google.com/p/common-schema/">common_schema</a> heavily utilizes them. DBA-wise, I think they provide with a lot of power (alas, the ANSI:SQL 2003 syntax feels more like COBOL than a sane programming language, which is why I use <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">QueryScript</a> instead).</p>
<p>However I wish to discuss the use of stored routines as integral part of your application code, which I discourage.</p>
<p>The common discussion on whether to user or not use stored routines typically revolves around data transfer (with stored routines you transfer less data since it&rsquo;s being processed on server side), security (with stored routines you can obfuscate/hide internal datasets, and provide with limited and expected API) and performance (with MySQL this is not what you would expect, as routines are interpreted &amp; their queries re-evaluated, as opposed to other RDBMS you may be used to).</p>
<p>But I wish to discuss the use of stored routines from an engineering standpoint. The first couple of points I raise are cultural/behavioural.</p>
<h4>2nd grade citizens</h4>
<p>Your stored routines are not likely to integrate well with your IDE. While your Java/Scala/PHP/Ruby/whatnot code comfortably lies within your home directory, the stored routines live in their own space: a database container. They&rsquo;re not as visible to you as your standard code. Your IDE is unaware of their existence and is unlikely to have the necessary plugin/state of mind to be able to view these.</p>
<p>This leads to difficulty in maintaining the code. People typically resort to using some SQL-oriented GUI tool such as MySQL Workbench, SequelPro or other, commercial tools. But these tools, while make it easy to edit your routine code, do not integrate (well?) with your source control. I can&rsquo;t say I&rsquo;ve used all GUI tools; but how many of them will have Git/SVN/Mercurial connectors? How many of them will keep local history changes once you edit a routine? I&rsquo;m happy to get introduced to such a tool.</p>
<p>Even with such integration, you&rsquo;re split between two IDEs. And if you&rsquo;re the command line enthusiast, well, you can&rsquo;t just <strong>svn ci -m &ldquo;fixed my stored procedure bug&rdquo;</strong>. Your code is simply not in your trunk directory.</p>
<p>It <em>can</em> be done. You <em>could</em> maintain the entire routine code from within your source tree, and hats off to all those who do it. Most will not. See later on about deployments for more on this.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/why-delegating-code-to-mysql-stored-routines-is-poor-engineering-practice/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-speaking-at-percona-live-london-nov-2013/">common_schema: speaking at Percona Live London, Nov. 2013</a></h2>

    <div class="post-meta">

  <div>

    <time>04 Nov 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In one week&rsquo;s time I&rsquo;ll be presenting <a href="http://www.percona.com/live/london-2013/sessions/commonschema-dbas-framework-mysql">common_schema: DBA&rsquo;s framework for MySQL</a> at Percona Live, London.</p>
<p>This talk introduces the rich toolset known as <a href="http://code.google.com/p/common-schema/">common_schema</a>. It is free, open source, extremely useful in solving DBA &amp; developer tasks, and is the next best thing ever invented next to SQL pie charts.</p>
<p>I&rsquo;ll introduce:</p>
<ul>
<li>Views, with which you can detect and terminate idle transactions, blocking transactions; roll your range partitions; find duplicate keys; block/unblock accounts; get fine grained privileges per account; find AUTO_ICNREMENT free space; &hellip;</li>
<li>Routines: do meta executions such as eval(); get query checksums; duplicating accounts; killing suspicious connections; security auditing; parsing JSON data; &hellip;</li>
<li>QueryScript: if you&rsquo;re not using it, you&rsquo;re missing on a powerful scripting language tightly integrated with SQL/MySQL. We&rsquo;ll see the basic constructs, variables, loops; the more sophisticated MySQL/locks/overhead/danger aware constructs such as foreach &amp; split; throttling, exceptions, it&rsquo;s all in there. I&rsquo;ll present real scripts that saved the day and challenge you to implement them in another scripting language.</li>
<li>Briefly introducing rdebug: stored routine debugger and debugging API</li>
<li>Roadmap (some cool things coming along)</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-speaking-at-percona-live-london-nov-2013/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/converting-an-olap-database-to-tokudb-part-3-operational-stuff/">Converting an OLAP database to TokuDB, part 3: operational stuff</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Oct 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tokudb">TokuDB</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This is the third post in a series of posts describing our experience in migrating a large DWH server to TokuDB (see <a href="http://code.openark.org/blog/mysql/converting-an-olap-database-to-tokudb-part-1">1st</a> and <a href="http://code.openark.org/blog/mysql/converting-an-olap-database-to-tokudb-part-2-the-process-of-migration">2nd</a> parts). This post discusses operations; namely ALTER TABLE operations in TokuDB. We ran into quite a few use cases by this time that we can shed light on.</p>
<p>Quick recap: we&rsquo;ve altered one of out DWH slaves to TokuDB, with the goal of migrating most of out servers, including the master, to TokuDB.</p>
<h4>Adding an index</h4>
<p>Shortly after migrating our server to TokuDB we noticed an unreasonably disproportionate slave lag on our TokuDB slave (red line in chart below) as compared to other slaves.</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2013/09/tokudb-slave-lag.png"><img alt="tokudb-slave-lag" src="/blog/assets/tokudb-slave-lag.png" width="700" height="329" /></a></blockquote>
<p>Quick investigation led to the fact that, coincidentally, a manual heavy-duty operation was just taking place, which updated some year&rsquo;s worth of data retroactively. OK, but why so slow on TokuDB? Another quick investigation led to an apples vs. oranges problem: as depicted in <a href="http://code.openark.org/blog/mysql/converting-an-olap-database-to-tokudb-part-1">part 1</a>, our original setup included MONTHly partitioning on our larger tables, whereas we could not do the same in TokuDB, where we settled for YEARly partitioning.</p>
<p>The heavy-duty operation included a query that was relying on the MONTHly partitioning to do reasonable pruning: a <strong>WHERE</strong> condition on a date column did the right partition pruning; but where on InnoDB that would filter <strong>1</strong> month&rsquo;s worth of data, on TokuDB it would filter <strong>1</strong> <em>year</em>.</p>
<p>Wasn&rsquo;t it suggested that TokuDB has online table operations? I decided to give it a shot, and add a proper index on our date column (I actually created a compound index, but irrelevant).</p>
<p>It took <strong>13</strong> minutes to add an index on a <strong>1GB</strong> TokuDB table (approx. <strong>20GB</strong> InnoDB uncompressed equivalent):</p>
<ul>
<li>The <strong>ALTER</strong> was non blocking: table was unlocked at that duration</li>
<li>The client issuing the <strong>ALTER</strong> <em>was</em> blocked (I thought it would happen completely in the background) &ndash; but who cares?</li>
<li>I would say <strong>13</strong> minutes is fast</li>
</ul>
<p>Not surprisingly adding the index eliminated the problem altogether.</p>
<h4>Modifying a PRIMARY KEY</h4>
<p>It was suggested by our DBA that there was a long time standing need to modify our <strong>PRIMARY KEY</strong>. It was impossible to achieve with our InnoDB setup (not enough disk space for the operation, would take weeks to complete if we did have the disk space). Would it be possible to modify our TokuDB tables? On some of our medium-sized tables we issued an <strong>ALTER</strong> of the form:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/converting-an-olap-database-to-tokudb-part-3-operational-stuff/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/converting-an-olap-database-to-tokudb-part-2-the-process-of-migration/">Converting an OLAP database to TokuDB, part 2: the process of migration</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Sep 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/percona-toolkit">Percona Toolkit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tokudb">TokuDB</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This is a second in a series of posts describing our experience in migrating a large DWH server to TokuDB. This post discusses the process of migration itself.</p>
<p>As a quick recap (<a href="http://code.openark.org/blog/mysql/converting-an-olap-database-to-tokudb-part-1">read part 1 here</a>), we have a <strong>2TB</strong> compressed InnoDB (<strong>4TB</strong> uncompressed) based DWH server. Space is running low, and we&rsquo;re looking at TokuDB for answers. Early experiments show that TokuDB&rsquo;s compression could make a good impact on disk space usage. I&rsquo;m still not discussing performance &ndash; keeping this till later post.</p>
<p>Those with weak hearts can skip right to the end, where we finally have a complete conversion. You can also peek at the very end to find out how much <strong>4TB</strong> uncompressed InnoDB data is worth in TokuDB. But you might want to read through. The process was not smooth, and not as expected (it&rsquo;s a war story thing). Throughout the migration we got a lot of insight on TokuDB&rsquo;s behaviour, limitations, conveniences, inconveniences and more.</p>
<p>Disclosure: I have no personal interests and no company interests; throughout the process we were in touch with Tokutek engineers, getting free, friendly &amp; professional advice and providing with input of our own. Most of this content has already been presented to Tokutek throughout the process. TokuDB is open source and free to use, though commercial license is also available.</p>
<h4>How do you convert 4TB worth of data to TokuDB?</h4>
<p>Obviously one table at a time. But we had another restriction: you may recall I took a live slave for the migration process. And we wanted to end the process with a live slave. So the restriction was: keep it replicating!</p>
<p>How easy would that be? Based on our initial tests, I extrapolated over <strong>20</strong> days of conversion from InnoDB to TokuDB. Even with one table at a time, our largest table was expected to convert in some <strong>12-14</strong> days. Can we retain <strong>14</strong> days of binary logs on a server already running low on disk space? If only I knew then what I know today :)</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/converting-an-olap-database-to-tokudb-part-2-the-process-of-migration/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/converting-an-olap-database-to-tokudb-part-1/">Converting an OLAP database to TokuDB, part 1</a></h2>

    <div class="post-meta">

  <div>

    <time>03 Sep 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/compression">compression</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tokudb">TokuDB</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This is the first in a series of posts describing my impressions of converting a large OLAP server to TokuDB. There&rsquo;s a lot to tell, and the experiment is not yet complete, so this is an ongoing blogging. In this post I will describe the case at hand and out initial reasons for looking at TokuDB.</p>
<p>Disclosure: I have no personal interests and no company interests; we did get friendly, useful and free advice from Tokutek engineers. TokuDB is open source and free to use, though commercial license is also available.</p>
<h4>The case at hand</h4>
<p>We have a large and fast growing DWH MySQL setup. This data warehouse is but one component in a larger data setup, which includes Hadoop, Cassandra and more. For online dashboards and most reports, MySQL is our service. We populate this warehouse mainly via Hive/Hadoop. Thus, we have an hourly load of data from Hive, as well as a larger daily load.</p>
<p>There are some updates on the data, but the majority of writes are just <strong>mysqlimport</strong>s of Hive queries.</p>
<p>Usage of this database is OLAP: no concurrency issues here; we have some should-be-fast-running queries issued by our dashboards, as well as ok-to-run-longer queries issued for reports.</p>
<p>Our initial and most burning trouble is with size. Today we use <strong>COMPRESSED</strong> InnoDB tables (<strong>KEY_BLOCK_SIZE</strong> is default, i.e. <strong>8</strong>). Our data volume sums right now at about <strong>2TB</strong>. I happen to know this translates as <strong>4TB</strong> of uncompressed data.</p>
<p>However growth of data is accelerating. A year ago we would capture a dozen GB per month. Today it is a <strong>100GB</strong> per month, and by the end of this year it may climb to <strong>150GB</strong> per month or more.</p>
<p>Our data is not sharded. We have a simple replication topology of some <strong>6</strong> servers. Machines are quite generous as detailed following. And yet, we will be running out of resources shortly: disk space (total <strong>2.7TB</strong>) is now running low and is expected to run out in about six months. One of my first tasks in Outbrain is to find a solution to our DWH growth problem. The solution could be sharding; it could be a commercial DWH product; anything that works.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/converting-an-olap-database-to-tokudb-part-1/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-2-2-better-queryscript-isolation-tokudb-table_rotate-split-params/">common_schema 2.2: better QueryScript isolation &amp; cleanup; TokuDB; table_rotate, split params</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Aug 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://code.google.com/p/common-schema/"><strong>common_schema 2.2</strong></a> is released. This is shortly after the 2.1 release; it was only meant as bug fixes release but some interesting things came up, leading to new functionality.</p>
<p>Highlights of the <strong>2.2</strong> release:</p>
<ul>
<li>Better QueryScript isolation &amp; cleanup: isolation improved across replication topology, cleanup done even on error</li>
<li>Added <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/tokudb_views.html">TokuDB related views</a></li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split</strong></a> with &ldquo;index&rdquo; hint (Ike, this is for you)</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/table_rotate.html"><strong>table_rotate()</strong></a>: a <em>logrotate</em>-like mechanism for tables</li>
<li>better throw()</li>
</ul>
<p>Drill down:</p>
<h4>Better QueryScript isolation &amp; cleanup</h4>
<p><em>common_schema</em> <strong>2.1</strong> introduced persistent tables for QueryScript. This also introduced the problem of isolating concurrent scripts, all reading from and writing to shared tables. In <strong>2.1</strong> isolation was based on session id. However although unique per machine, collisions were possible across replication topology: a script could be issued on master, another on slave (I have such use cases) and both use same (local) session id.</p>
<p>With 2.2 isolation is based on server_id &amp; session id combination; this is unique across a replication topology.</p>
<p>Until <strong>2.1</strong>, QueryScript used temporary tables. This meant any error would just break the script, and the tables were left (isolated as they were, and auto-destroyed in time). With persistent tables a script throwing an error meant legacy code piling up. With <em>common_schema</em> <strong>2.2</strong> and on MySQL &gt;= <strong>5.5</strong> all exceptions are caught, cleanup is made, leaving exceptions to be <strong>RESIGNAL</strong>led.</p>
<h4>TokuDB views</h4>
<p>A couple TokuDB related views help out in converting to TokuDB and in figuring out tables status on disk:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-2-2-better-queryscript-isolation-tokudb-table_rotate-split-params/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-roadmap-thoughts/">common_schema roadmap thoughts</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Jul 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m happy with <strong><a href="https://code.google.com/p/common-schema/">common_schema</a></strong>; it is in fact a tool I use myself on an almost daily basis. I&rsquo;m also happy to see that it gains traction; which is why I&rsquo;m exposing a little bit of my thoughts on general future development. I&rsquo;d love to get feedback.</p>
<h4>Supported versions</h4>
<p>At this moment, <em>common_schema</em> supports MySQL &gt;= <strong>5.1</strong>, all variants. This includes <strong>5.5</strong>, <strong>5.6</strong>, MySQL, Percona Server &amp; MariaDB.</p>
<p><strong>5.1</strong> is today past end of line, and I&rsquo;m really missing the <strong>SIGNAL</strong>/<strong>RESIGNAL</strong> syntax that I would like to use; I can do in the meanwhile with version-specific code such as <strong>/*!50500 &hellip; */</strong>. Nevertheless, I&rsquo;m wondering whether I will eventually have to:</p>
<ul>
<li>Support different branches of <em>common_schema</em> (one that supports <strong>5.1</strong>, one that supports &gt;= <strong>5.5</strong>)</li>
<li>Stop support for <strong>5.1</strong></li>
</ul>
<p>Of course community-wise, the former is preferred; but I have limited resources, so I would like to make a quick poll here:</p>
<p>[poll id=&ldquo;3&rdquo;]</p>
<p>I&rsquo;ll use the poll&rsquo;s results as a <em>vague idea of what people use and want</em>. Or please use comments below to sound your voice!</p>
<h4>rdebug</h4>
<p>This was a crazy jump at providing a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html">stored routine debugger and debugging API</a>. From some talk I made I don&rsquo;t see this getting traction. For the time being, I don&rsquo;t see that I will concentrate my efforts on this. Actually it is almost complete. You can step-into, step-out, step-over, set breakpoints, read variables, modify variables &ndash; it&rsquo;s pretty cool.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-roadmap-thoughts/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-2-1-released-advanced-improved-split-persistent-script-tables-more-schema-analysis-and-ahem-charts/">common_schema 2.1 released: advanced &amp; improved split(), persistent script tables, more schema analysis, and (ahem) charts!</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Jul 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/charts">charts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://code.google.com/p/common-schema/"><strong>common_schema 2.1</strong></a> is released! <em>common_schema</em> is your free &amp; open source companion schema within your MySQL server, providing with a function library, scripting capabilities, powerful routines and ready-to-apply information and recommendations.</p>
<p>New and noteworthy in version <strong>2.1</strong>:</p>
<ul>
<li>Better <em>QueryScript&rsquo;</em>s <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split()</strong></a> functionality</li>
<li>Persistent tables for QueryScript: no long held temporary tables</li>
<li>Index creation analysis, further range partition analysis</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/grant_access.html"><strong>grant_access()</strong></a>: allow everyone to use <em>common_schema</em></li>
<li>Ascii charts, google charts</li>
<li><strong>debugged_routines</strong>: show routines with debug code</li>
</ul>
<p>Other minor enhancements and bugfixes not listed.</p>
<p>Here&rsquo;s a breakdown of the above:</p>
<h4>split() enhancements</h4>
<p><strong><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html">split</a></strong> is one of those parts of <em>common_schema</em> that (should) appeal to every DBA. Break a huge transaction automagically into smaller chunks, and don&rsquo;t worry about how it&rsquo;s done. If you like, throttle execution, or print progress, or&hellip;</p>
<p><em>split</em> enhancements include:</p>
<ul>
<li>A much better auto-detection-and-selection of the chunking index. <em>split</em> now consults all columns covered by the index, and uses realistic heuristics to decide which <strong>UNIQUE KEY</strong> on your table is best for the chunking process. A couple bugs are solved on the way; <em>split</em> is much smarter now.</li>
<li>Better support for multi-column chunking keys. You may now utilize the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html#parameters"><strong>start</strong>/<strong>stop</strong> parameters</a> even on multi column keys, passing a comma delimited of values for the <em>split</em> operation to start/end with, respectively. Also fixed issue for nonexistent <strong>start/stop</strong> values, which are now valid: <em>split</em> will just keep to the given range.</li>
<li>split no longer requires a temporary table open through the duration of its operation. See next section.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-2-1-released-advanced-improved-split-persistent-script-tables-more-schema-analysis-and-ahem-charts/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-openark-kit-in-the-media-dbhangops-oursql/">common_schema &amp; openark-kit in the media: #DBHangOps, OurSQL</a></h2>

    <div class="post-meta">

  <div>

    <time>26 Jun 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  #DBHangOps I had the pleasure of joining into @DBHangOps today, and speak about common_schema and openark-kit. What was meant to be a 15 minute session turned to be 50 -- sorry, people, I don't talk as much at home, but when it comes to my pet projects... I also realized I was missing on a great event: DBHangOps is a hangout where you can chat and discuss MySQL &amp; related technologies with friends and colleagues, with whom you typically only meet at conferences.
  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-openark-kit-in-the-media-dbhangops-oursql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/easy-select-count-with-split/">Easy SELECT COUNT(*) with split()</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Jun 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The two conservative ways of getting the number of rows in an InnoDB table are:</p>
<ul>
<li><strong>SELECT COUNT(*) FROM my_table</strong>:<br />
provides with an accurate number, but makes for a long running transaction which take ages on large tables. Long transactions make for locks</li>
<li><strong>SELECT TABLE_ROWS FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA=&lsquo;my_schema&rsquo; AND TABLE_NAME=&lsquo;my_table&rsquo;</strong>, or get same info via <strong>SHOW TABLE STATUS</strong>.<br />
Gives immediate response, but the value can be <em>way off</em>; it can be two times as large as real value, or half the value. For query execution plans this may be a &ldquo;good enough&rdquo; estimation, but typically you just can&rsquo;t trust it for your own purposes.</li>
</ul>
<h4>Get a good estimate using chunks</h4>
<p>You can get a good estimate by calculating the total number of rows in steps. Walk the table 1,000 rows at a time, and keep a counter. Each chunk is its own transaction, so, if the table is modified while counting, the final value does not make for an accurate account at any point in time. Typically this should be a far better estimate than <strong>TABLE_ROWS</strong>.</p>
<p><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html">QueryScript&rsquo;s split()</a> construct provides you with the means to work this out. Consider this script:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/easy-select-count-with-split/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/slides-from-my-talk-common_schema-dbas-framework-for-mysql-2/">Slides from my talk: common_schema, DBA&#39;s Framework for MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>26 Apr 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I've just uploaded the slides from my talk: common_schema: DBA's framework for MySQL My talk was well attended, and I was fortunate to have a warm and engaged audience. Thank you to all those who attended, and thank you for those who provided feedback! Was happy to be able to present my work a great group of people. You can find my slide either on Percona Live's website, or on Slideshare, as well as embedded right here.
  </p>

  
  <footer>
    <a href="/blog/mysql/slides-from-my-talk-common_schema-dbas-framework-for-mysql-2/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/speaking-at-percona-live-2013-common_schema-lightning-talks/">Speaking at Percona Live 2013: common_schema, lightning talks</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Apr 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  In two weeks time I will be giving these talks at Percona Live: common_schema: DBA's framework for MySQL: an introduction to common_schema, my evolving server side solutions project. This will be a revised version of the talk I gave at Percona Live London; I have felt some weaknesses during that talk, which I've thrown out, letting room for cool stuff. I will discuss common_schema's various views, interesting and useful routines, the power of QueryScript, and a brief intro to the newcomer rdebug, debugger and debugging API for MySQL.
  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-at-percona-live-2013-common_schema-lightning-talks/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/taking-common_schemas-rdebug-to-a-test-drive/">Taking common_schema&#39;s rdebug to a test-drive</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Apr 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/rdebug">rdebug</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This is a simple step-by-step introduction to <strong><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html">rdebug</a>: Debugger and Debugging API for MySQL Stored Routines</strong>, as part of <a href="https://code.google.com/p/common-schema/">common_schema</a>.</p>
<p>In other words: let me take you through the steps for debugging your stored routines on your own server. We will step into, step over, step out, modify variables, set a breakpoint, run to breakpoint&hellip;</p>
<p>Command line geeks, this one&rsquo;s for you. GUI lovers, this is actually an API; I am hoping for someone wrap it up with a plugin for your favorite GUI editor.</p>
<h4>Requirements:</h4>
<ul>
<li>Install <a href="https://code.google.com/p/common-schema/"><em>common_schema</em> 2.0</a> or above (at this time of writing <a href="http://code.openark.org/blog/mysql/common_schema-2-0-0-alpha-rdebug-gpl">2.0.0-alpha is released</a>).</li>
<li>Get sample data &amp; routine file [download id=&ldquo;4&rdquo; format=&ldquo;1&rdquo;]</li>
<li>mysql&gt; <strong>SOURCE rdebug<em>demo.sql</em>.txt</strong>
<ul>
<li>You should now have a table called <strong>color_count</strong> in the test database, along with two routines: <strong>review_colors()</strong> and <strong>review_single_color()</strong>.</li>
</ul>
</li>
<li>Open two sessions. We call them the <em>debugger</em> session and the <em>worker</em> session. The <em>worker</em> session will execute the routine; the <em>debugger</em> session will control it.</li>
</ul>
<h4>Walk-through: preparation</h4>
<p>Walk this thing with me. We will alternate between the <em>debugger</em> and the <em>worker</em>.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/taking-common_schemas-rdebug-to-a-test-drive/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-2-0-0-alpha-rdebug-gpl/">common_schema 2.0.0-alpha: rdebug, GPL</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Apr 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/rdebug">rdebug</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tools">tools</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A new release for <a href="https://code.google.com/p/common-schema/">common_schema</a>: an alpha version of <strong><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html">rdebug</a>: MySQL Debugger and Debugging API</strong> is now included with <em>common_schema</em>.</p>
<p>With a different license in mind for <em>rdebug</em>, <em>common_schema</em> changes license to GPL (2 or above).</p>
<p><em>common_schema 2.0</em> is ready for <a href="http://code.google.com/p/common-schema/downloads/list">download</a>. All things <strong>rdebug</strong>, it is alpha &ndash; otherwise it&rsquo;s a stable release.</p>
<h4>rdebug</h4>
<p>I&rsquo;m very happy to release this alpha version of <em>rdebug</em>, and urge everyone to try it out.</p>
<p>The idea is to have an open, free, server side debugger and debugging API for MySQL stored routines. To elaborate:</p>
<ul>
<li>It&rsquo;s server side by that it&rsquo;s implemented by stored routines. Not by a connector; not an emulator; not a GUI tool hack. The entire functionality lies within common_schema, a schema in your server.</li>
<li>It&rsquo;s a debugger: you can debug your own stored routines (with limitations)</li>
<li>It&rsquo;s a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug_api.html"><strong>debugging API</strong></a>: there&rsquo;s a distinct specification and a set of calls which makes for a debugging process</li>
<li>It&rsquo;s open since the source code is yours to browse.</li>
<li>It&rsquo;s free as in free beer.</li>
<li>It&rsquo;s free as it makes you independent of a specific debugger. It provides an API that anyone can use. You can run the API yourself from the command line; or plugins for your favorite GUI editor can be developed to use this API.</li>
</ul>
<p>On a separate blog post I will take you to a <em>rdebug</em> test drive.</p>
<p>As always, nothing is released before extensive <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/rdebug.html">documentation</a> is in place.</p>
<p>I&rsquo;d love to get input on this.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-2-0-0-alpha-rdebug-gpl/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-stored-routines-debugger-debugging-api-sneak-preview-ii-video/">MySQL Stored Routines Debugger &amp; Debugging API: sneak preview II, video</a></h2>

    <div class="post-meta">

  <div>

    <time>21 Mar 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/debug">debug</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/rdebug">rdebug</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This is the <strong>2nd</strong> sneak preview of <a href="http://code.google.com/p/common-schema">common_schema</a>&rsquo;s <strong>rdebug</strong>: debugger &amp; debugging API for MySQL stored routines (<a href="http://code.openark.org/blog/mysql/mysql-stored-routines-debugger-debugging-api-sneak-preview-video">see <strong>1st</strong> preview here</a>).</p>
<p><em>rdebug</em> will be released as part of <em>common_schema</em>, free and open sourced.</p>
<p>In this sneak preview I present:</p>
<ul>
<li>Compiling multiple routines with debug info</li>
<li>Starting/stopping a debug session</li>
<li>Step-over, step-in, step-out</li>
<li>Showing stack trace</li>
<li>Showing the next-statement to execute</li>
<li>Viewing and manipulating local routine variables</li>
<li>Misc. meta routines</li>
</ul>
<h4>The quick technical overview</h4>
<p><em>rdebug</em> is a server-side mechanism, itself written in MySQL stored routines. It manipulates your routines by injecting debug code (easily removed afterwards).</p>
<p>To debug a routine you will need two connections: one is the debugging connection, and the other is the worker connection. The debugger connection attaches itself to the worker connection, where your routines execute.</p>
<p><em>rdebug</em> is controlled by an <strong>API</strong> of stored routines. This means any GUI tool may choose to use <em>rdebug</em> as its routine debugging mechanism. Your are not bound to a specific tool, a specific OS or framework. You may choose to invoke the API via command line, if you like; it&rsquo;s all in your server.</p>
<h4>A video is worth a thousand blogs</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-stored-routines-debugger-debugging-api-sneak-preview-ii-video/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-stored-routines-debugger-debugging-api-sneak-preview-video/">MySQL Stored Routines Debugger &amp; Debugging API: sneak preview video</a></h2>

    <div class="post-meta">

  <div>

    <time>19 Feb 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/debug">debug</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/video">video</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This is a sneak peek video introduction/preview of an in-development free and open source server side debugger &amp; debugging API for MySQL stored routines.</p>
<p>MySQL does not provide server side debugging capabilities for stored routines. Some tools exist, including MySQL&rsquo;s own, that assist in stored routine debugging. These are all GUI based and, to the best of my knowledge, MS Windows based. There is one solution in alpha stage that is developed for Java/eclipse; I did not look at the code. See discussion <a href="http://www.xaprb.com/blog/2012/11/01/stored-procedure-debugging-in-mysql/">here</a> and <a href="http://blog.webyog.com/2011/12/06/debugging-stored-programs-in-mysql/">here</a>.</p>
<p>An ideal solution would be to have debugging API in the server itself - independently of your client, programming language or operating system. To the best of my knowledge, nothing like that is being developed.</p>
<p>I&rsquo;m now presenting a <strong>rdebug</strong>: a stored routines server-side debugger, Pure-SQL, based on stored routines. <em>rdebug</em> is developed as part of <a href="http://code.google.com/p/common-schema">common_schema,</a> and actually relies on some of its power.</p>
<p>Like some other tools, it uses code injection and manipulation: it injects debugging info into your stored routine. You need to &ldquo;compile&rdquo; your routine with debugging info.</p>
<p>Unlike some other tools, it actually runs your stored routines. It does not mimic or simulate them on client side. It does not break them into smaller routines, attempting to assemble the original behavior from lego bricks.</p>
<p><strong>The quick technical overview</strong> is that you use two processes (MySQL threads): the worker process running the routine (your natural <strong>call my_routine()</strong>), and the debugger process. The debugger process attaches itself to the worker process; it controls the worker by commands like <em>&ldquo;step over&rdquo;</em>; it gets data from the worker: what&rsquo;s the current stack trace? What variables are now available and what are their values?; it manipulates the worker&rsquo;s data: it can utilize breakpoints to modify worker&rsquo;s local &amp; session variables.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-stored-routines-debugger-debugging-api-sneak-preview-video/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-security-tasks-easily-solved-with-common_schema/">MySQL security tasks easily solved with common_schema</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Jan 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Here are three security tasks I handled, which I&rsquo;m happy to say were easily solved with <em>common_schema</em>&rsquo;s views and routines (with no prior planning). Two are so easy, that I actually now integrated them into <a href="http://code.google.com/p/common-schema">common_schema 1.3</a>:</p>
<ul>
<li>Duplicate a user (create new user with same privileges as another&rsquo;s)</li>
<li>Find users with identical set of grants (same roles)</li>
<li>Finding redundant users (users who only have privileges on non-existing objects); I was approached on this by <a href="http://sheeri.com/">Sheeri K. Cabral</a> from Mozilla.</li>
</ul>
<h4>Duplicate user</h4>
<p>How would you duplicate a grantee? That&rsquo;s easy! Just get the SHOW GRANTS output, then do text search and replace: replace the existing account (e.g. <strong>&lsquo;existing&rsquo;@&lsquo;localhost&rsquo;</strong>) with the new account (e.g. <strong>&lsquo;newcomer&rsquo;@&lsquo;localhost&rsquo;</strong>).</p>
<p>Ahem. And how would you get the output of <strong>SHOW GRANTS</strong>? That&rsquo;s right: you can&rsquo;t do this from within the server. You have to go outside the server, incoke mysql client, <em>sed</em> your way into it, then connect to MySQL again to invoke the GRANT query&hellip; Or you can do this by hand, of course, or you can use the new <a href="http://dev.mysql.com/doc/workbench/en/mysqluserclone.html">mysqluserclone</a> tool from MySQL utilities. Bottom line: you have to go outside the server. You can&rsquo;t directly do this with your favorite GUI tool unless it has this function integrated.</p>
<p>But to have a truly automated, scriptable, server-side user-duplication you don&rsquo;t need to go far, since the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">sql_show_grants</a> view simulates a <strong>SHOW GRANTS</strong> output, but using plain old SQL. It produces the <strong>GRANT</strong> statement as SQL output. Which means you can <strong>REPLACE()</strong> the grantee. It&rsquo;s actually a one liner, but is such a common operation that I created the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/duplicate_grantee.html">duplicate_grantee()</a> function for convenience. Just:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-security-tasks-easily-solved-with-common_schema/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-1-3-security-goodies-parameterized-split-json-to-xml-query-checksum/">common_schema: 1.3: security goodies, parameterized split(), json-to-xml, query checksum</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Jan 2013</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>common_schema <strong>1.3</strong> is released and is <a href="http://code.google.com/p/common-schema">available for download</a>. New and noteworthy in this version:</p>
<ul>
<li>Parameterized <strong><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html">split()</a></strong>: take further control over huge transactions by breaking them down into smaller chunks, now manually tunable if needed</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/duplicate_grantee.html"><strong>duplicate_grantee()</strong></a>: copy+paste existing accounts along with their full set of privileges</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/similar_grants.html"><strong>similar_grants</strong></a>: find which accounts share the exact same set of privileges (i.e. have the same <em>role</em>)</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/json_to_xml.html"><strong>json_to_xml()</strong></a>: translate any valid JSON object into its equivalent XML form</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/extract_json_value.html"><strong>extract_json_value()</strong></a>: use XPath notation to extract info from JSON data, just as you would from XML</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_checksum.html"><strong>query_checksum()</strong></a>: given a query, calculate a checksum on the result set</li>
<li><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/random_hash.html"><strong>random_hash()</strong></a>: get a 40 hexadecimal digits random hash, using a reasonably large changing input</li>
</ul>
<p>Let&rsquo;s take a closer look at the above:</p>
<h4>Parameterized split()</h4>
<p><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split</strong></a> takes your bulk query and automagically breaks it down into smaller pieces. So instead of one huge <strong>UPDATE</strong> or <strong>DELETE</strong> or <strong>INSERT..SELECT</strong> transaction, you get many smaller transactions, each with smaller impact on I/O, locks, CPU.</p>
<p>As of <strong>1.3</strong>, <em>split()</em> gets more exposed: you can have some control on its execution, and you also get a lot of very interesting info during operation.</p>
<p>Here&rsquo;s an example of <em>split()</em> control:</p>
<blockquote>
<pre>set @script := &ldquo;
  <strong>split</strong>({<em>start</em>:7015, <em>step</em>:2000} : <span style="color: #3366ff;">UPDATE sakila.rental SET return_date = return_date + INTERVAL 1 DAY</span>)
    <strong>throttle</strong> 1;
&ldquo;;
call common_schema.run(@script);</pre>
</blockquote>
<p>In the above we choose a split size of 2,000 rows at a time; but we also choose to only start with <strong>7015</strong>, skipping all rows prior to that value. Just what is that value? It depends on the splitting key (and see next example for just that); but in this table we can safely assume this is the <strong>rental_id</strong> <strong>PRIMARY KEY</strong> of the table.</p>
<p>You don&rsquo;t <em>have to</em> use these control <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html#parameters">parameters</a>. But they can save you some time and effort.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-1-3-security-goodies-parameterized-split-json-to-xml-query-checksum/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-over-traditional-scripts/">common_schema over traditional scripts</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Dec 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/python">python</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>If you are familiar with both <a href="http://code.openark.org/forge/openark-kit">openark kit</a> and <a href="http://code.google.com/p/common-schema">common_schema</a>, you&rsquo;ll notice I&rsquo;ve incorporated some functionality already working in <em>openark kit</em> into <em>common_schema</em>, essentially rewriting what used to be a Python script into SQL/<a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">QueryScript</a>.</p>
<p>What was my reasoning for rewriting good code? I wish to explain that, and provide with a couple examples.</p>
<p>I&rsquo;m generally interested in pushing as much functionality into the MySQL server. When using an external script, one:</p>
<ul>
<li>Needs the right dependencies (OS, Perl/Python version, Perl/Python modules).</li>
<li>Needs to provide with connection params,</li>
<li>Needs to get acquainted with a lot of command line options,</li>
<li>Is limited by whatever command line options are provided.</li>
<li>Has to invoke that script (duh!) to get the work done.</li>
</ul>
<p>This last bullet is not so trivial: it means you can&rsquo;t work some operation with your favorite GUI client, because it has no notion of your Perl script; does not run on the same machine where your Python code resides; simply can&rsquo;t run those scripts for you.</p>
<p>With server-side code, functionality is accessible via any client. You run your operation via a query (e.g. <strong>CALL some_procedure</strong>). That can be done from your GUI client, your command line client, your event scheduler, your cronjob, all equally. You only need access to your MySQL server, which is trivial.</p>
<p>Of course, server side scripting is <a href="http://code.openark.org/blog/mysql/things-that-cant-and-some-that-can-be-done-from-within-a-mysql-stored-routine">limited</a>. Some stuff simply can&rsquo;t be written solely on server side. If you want to consult your replicating slave; gracefully take action on user&rsquo;s <strong>Ctrl+C</strong>, send data over the web, you&rsquo;ll have to do it with an external tool. There are actually a lot of surprising limitations to things one would assume <em>are</em> possible on server side. You may already know how frustrated I am by the fact one can <a href="http://code.openark.org/blog/mysql/reading-results-of-show-statements-on-server-side">hardly</a> get info from <strong>SHOW</strong> commands.</p>
<h4>But, when it works, it shines</h4>
<p>Let&rsquo;s review a couple examples. The first one is nearly trivial. The second less so.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-over-traditional-scripts/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/slides-from-my-talk-common_schema-dbas-framework-for-mysql/">Slides from my talk: common_schema, DBA&#39;s framework for MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>04 Dec 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Thank you to all who attended my talk at Percona Live London! The slides from my talk are now made available, following: [download id="2" format="1"]. Also available on slideshare. They should also be on the Percona Live site within a few days.
  </p>

  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/killing-innodb-idle-transactions/">Killing InnoDB idle transactions</a></h2>

    <div class="post-meta">

  <div>

    <time>04 Dec 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>The issue of terminating long-time idle open InnoDB transaction has been discussed recently by many. I wish to add my share, by proposing a quick and clean solution via <a href="http://code.google.com/p/common-schema/">common_schema</a>.</p>
<p><em>common_schema <strong>1.2</strong></em> provides with the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/innodb_transactions.html"><strong>innodb_transactions</strong></a> view, which relies on <strong>INNODB_TRX</strong> - one of the InnoDB Plugin views in <strong>INFORMATION_SCHEMA</strong> - as well as on <strong>PROCESSLIST</strong>, and so is able to determine with certainty that a transaction has been idle for a long time.</p>
<p><strong>innodb_transactions</strong> offers us with a <strong>sql_kill_query</strong> column, which produces a <strong>&lsquo;KILL QUERY 12345&rsquo;</strong> type of value. So we can:</p>
<blockquote>
<pre>SELECT <strong>sql_kill_query</strong> FROM <strong>innodb_transactions</strong> WHERE <strong>trx_idle_seconds &gt;= 10;
</strong>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
| sql_kill_query    |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
| KILL QUERY 292509 |
| KILL QUERY 292475 |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+<strong> </strong></pre>
</blockquote>
<p><em>common_schema</em>&rsquo;s useful <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/eval.html"><strong>eval()</strong></a> routine allows us to actually invoke those <strong>KILL</strong> statements, all in a one-liner:</p>
<blockquote>
<pre>call <strong>eval</strong>(<span style="color: #003366;">&lsquo;SELECT <strong>sql_kill_query</strong> FROM innodb_transactions WHERE <strong>trx_idle_seconds &gt;= 10</strong>&lsquo;</span>);</pre>
</blockquote>
<h4>Technical details</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/killing-innodb-idle-transactions/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/speaking-in-london-common_schema-dbas-framework-for-mysql/">Speaking in London: common_schema, DBA&#39;s framework for MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>22 Nov 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I'm happy to be speaking about common_schema at Percona Live London, Dec 4th, 2012. This will be the first chance for me to speak about common_schema, what I believe to be an extremely useful companion to your MySQL server. I will show you how common_schema can leverage your SQL skills and give you new powers. Stuff you had to be SQL-Perl-super-expert to work through is easily attainable with common_schema and QueryScript.
  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-in-london-common_schema-dbas-framework-for-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/purging-old-rows-with-queryscript-three-use-cases/">Purging old rows with QueryScript: three use cases</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Nov 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/bulk-operations">Bulk operations</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Problem: you need to purge old rows from a table. This may be your weekly/monthly cleanup task. The table is large, the amount of rows to be deleted is large, and doing so in one big <strong>DELETE</strong> is too heavy.</p>
<p>You can use <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-chunk-update.html">oak-chunk-update</a> or <a href="http://www.percona.com/doc/percona-toolkit/2.1/pt-archiver.html">pt-archiver</a> to accomplish the task. You can also use server side scripting with <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">QueryScript</a>, offering a very simple syntax with no external scripting, dependencies and command line options.</p>
<p>I wish to present three cases of row deletion, with three different solutions. In all cases we assume some <strong>TIMESTAMP</strong> column exists in table, by which we choose to purge the row. In all cases we assume we wish to purge rows older than <strong>1</strong> month.</p>
<p>We assume the naive query is this:</p>
<blockquote>
<pre>DELETE FROM my_schema.my_table WHERE row_timestamp &lt; CURDATE() - INTERVAL 1 MONTH</pre>
</blockquote>
<h4>Case 1: TIMESTAMP column is indexed</h4>
<p>I almost always index a timestamp column, if only for being able to quickly purge data (but usually also to slice data by date). In this case where the column is indexed, it&rsquo;s very easy to figure out which rows are older than <strong>1</strong> month.</p>
<p>We break the naive query into smaller parts, and execute these in sequence:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/purging-old-rows-with-queryscript-three-use-cases/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-1-2-security-partition-management-processes-queryscript-goodies/">common_schema 1.2: security, partition management, processes, QueryScript goodies</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Nov 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/partitioning">partitioning</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="http://code.google.com/p/common-schema">common_schema</a> <strong>1.2</strong> is released! This version comes shortly after <strong>1.1</strong>, yet contains quite a few interesting goodies:</p>
<ul>
<li>Account blocking</li>
<li>Security audit</li>
<li>RANGE partition management</li>
<li>Slave status</li>
<li>Better blocking and idle transaction management</li>
<li><em>QueryScript </em>goodies:
<ul>
<li>echo, report</li>
<li>while-otherwise statement; foreach-otherwise statement</li>
<li>Better variable scope handling</li>
<li>Complete support for variable expansion</li>
<li>Transaction support within QueryScript</li>
</ul>
</li>
<li>More summary info and SQL statements in processlist-related views</li>
</ul>
<p>A closer look at these follows:</p>
<h4>Account blocking</h4>
<p>A new view called <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_accounts.html"><strong>sql_accounts</strong></a>, inspired by <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-block-account.html">oak-block-account</a> (also see <a href="http://code.openark.org/blog/mysql/blocking-user-accounts">here</a> and <a href="http://code.openark.org/blog/mysql/pop-quiz-what-is-the-most-basic-privilege-an-account-can-be-assigned-with">here</a>) provides with the means of blocking use accounts (and releasing them, of course) without revoking their privileges. It offers the SQL statements to block an account (by modifying its password in a symmetric way) and to release an account (by modifying its password back to normal). It really works like a charm. Together with <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/killall.html">killall()</a> and <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">sql_accounts</a> this gives the administrator great control over accounts.</p>
<h4>Security audit</h4>
<p>Imported from <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-security-audit.html">openark kit</a>, and implemented via <em>QueryScript</em>, the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/security_audit.html"><strong>security_audit()</strong></a> procedure will audit your accounts, passwords and general settings to find problems, pitfalls and security hazards. I will write more on this later.</p>
<h4>RANGE partition management</h4>
<p>The <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_range_partitions.html"><strong>sql_range_partitions</strong></a> view manages your <strong>RANGE</strong> and <strong>RANGE COLUMNS</strong> partitioned tables by providing with the SQL statements to drop oldest partitions and to create the next (in sequence) partitions. See my <a href="http://code.openark.org/blog/mysql/your-magical-range-partitioning-maintenance-query">earlier post</a>.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-1-2-security-partition-management-processes-queryscript-goodies/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/your-magical-range-partitioning-maintenance-query/">Your magical RANGE partitioning maintenance query</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Oct 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/partitioning">partitioning</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>If you use <strong>RANGE</strong> (or <strong>RANGE COLUMNS</strong>) partitioning, and in particular when partitioning by date/time, then your are subject to the following questions: how and when do you create the &ldquo;next&rdquo; partition? How and when do you drop your older partitions?</p>
<p>Many people use in-house scripting to do that, and Giuseppe Maxia wrote <a href="http://datacharmer.blogspot.co.il/2008/12/partition-helper-improving-usability.html">Partition Helper</a>. But I would like to take you one step forward, and provide with a <em>query</em> (based on views) which automagically understands which new partition you want to create, and provides you with the statement to do so. It looks somewhat like this (a demo follows later on):</p>
<blockquote>
<pre>mysql&gt; SELECT * FROM <strong>sql_range_partitions</strong> \G
*************************** 1. row ***************************
            table_schema: test
              table_name: city
<strong>sql_drop_first_partition</strong>: alter table <code>test</code>.<code>city</code> drop partition <code>p3</code>
  <strong>sql_add_next_partition</strong>: alter table <code>test</code>.<code>city</code> add partition (partition <code>p_20160101000000</code> values less than (736329) /* 2016-01-01 00:00:00 */ )
*************************** 2. row ***************************
            table_schema: test
              table_name: quarterly_report_status
<strong>sql_drop_first_partition</strong>: alter table <code>test</code>.<code>quarterly_report_status</code> drop partition <code>p3</code>
  <strong>sql_add_next_partition</strong>: alter table <code>test</code>.<code>quarterly_report_status</code> reorganize partition <code>p_maxvalue</code> into (partition <code>p_20110401000000</code> values less than (1301608800) /* 2011-04-01 00:00:00 */ , partition p_maxvalue values less than MAXVALUE)</pre>
</blockquote>
<h4>A closer look at why this is magic</h4>
<p>This query just gave you the <strong>DROP PARTITION</strong> and <strong>ADD PARTITION</strong> for all tables in your databases that use a <strong>RANGE</strong> partitioning scheme. But, consider:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/your-magical-range-partitioning-maintenance-query/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/how-common_schema-installs-itself/">How common_schema installs itself</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Sep 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/installation">Installation</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Up till <a href="http://code.google.com/p/common-schema/">common_schema</a> version <strong>1.1</strong>, the user would need to choose from distinct distribution files: an install compatible with MySQL <strong>5.1</strong>, one compatible with InnoDB Plugin enabled servers, and one compatible with Percona Server. The difference between the three is the availability of certain <strong>INFORMATION_SCHEMA</strong> tables.</p>
<p>With <strong>1.1</strong>, this is no longer the case: <em>common_schema</em> auto-detects the server and available feature set, and installs accordingly.</p>
<h4>Wait, isn&rsquo;t common_schema just a SQL file?</h4>
<p>Yes. It&rsquo;s not like there&rsquo;s an installer like <em>InstallShield</em> or anything. Nevertheless, <em>common</em><em>_schema</em> offers a smart way of conditional handling, which is uses in itself. It&rsquo;s called <a href="http://www.queryscript.com/">QueryScript</a>.</p>
<p><em>common_schema</em> is installed by importing the SQL file (via <strong>SOURCE</strong> command; the <em>mysql</em> client; your favorite GUI). This creates your usual tables, views and routines. But some of these routines make for an interpreter for <em>QueryScript</em>. Somewhere along the installation process (remember - it&rsquo;s just a SQL import), <em>common_schema</em> switches over to executing scripts to manage the installation. In particular, there are a few views which depend on optional tables, such as InnoDB Plugin&rsquo;s tables for <strong>INFORMATION_SCHEMA</strong>.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/how-common_schema-installs-itself/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/how-common_schema-splits-tables-internals/">How common_schema split()s tables - internals</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Sep 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>This post exposes some of the internals, and the SQL behind QueryScript&rsquo;s <em>split</em>. <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">common_schema/QueryScript</a> <strong>1.1</strong> introduces the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split</strong></a> statement, which auto-breaks a &ldquo;large&rdquo; query (one which operates on large tables as a whole or without keys) into smaller queries, and executes them in sequence.</p>
<p>This makes for easier transactions, less locks held, potentially (depending on the user) more idle time released back to the database. <em>split<strong></strong></em> has similar concepts to <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-chunk-update.html">oak-chunk-update</a> and <a href="http://www.percona.com/doc/percona-toolkit/2.1/pt-archiver.html">pt-archiver</a>, but works differently, and implemented entirely in SQL on server side.</p>
<p>Take the following statement as example:</p>
<blockquote>
<pre><strong>split</strong> (<strong>UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR</strong>)
  pass;</pre>
</blockquote>
<p>It yields with (roughly) the following statements:</p>
<blockquote>
<pre>UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;1&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;1&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;1000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;1000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;1000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;2000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;2000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;2000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;3000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;3000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;3000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;4000&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;4000&rsquo;))));
UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR <strong>WHERE</strong> ((((<code>inventory</code>.<code>inventory_id</code> &gt; &lsquo;4000&rsquo;))) AND (((<code>inventory</code>.<code>inventory_id</code> &lt; &lsquo;4581&rsquo;)) OR ((<code>inventory</code>.<code>inventory_id</code> = &lsquo;4581&rsquo;))));</pre>
</blockquote>
<p>(I say &ldquo;roughly&rdquo; because internally there are user defined variables at play, but for convenience, I verbose the actual values as constants.)</p>
<h4>How does that work?</h4>
<p><em>common_schema</em> works on server side. There is no Perl script or anything. It must therefore use server-side operations to:</p>
<ul>
<li>Identify table to be split</li>
<li>Analyze the table in the first place, deciding how to split it</li>
<li>Analyze the query, deciding on how to rewrite it</li>
<li>Split the table (logically) into unique and distinct chunks</li>
<li>Work out the query on each such chunk</li>
</ul>
<p>Following is an internal look at how <em>common_schema</em> does all the above.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/how-common_schema-splits-tables-internals/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/table-split-for-the-masses/">Table split(...) for the masses</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Sep 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>(pun intended)</p>
<p><em>common_schema</em>&rsquo;s new <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_split.html"><strong>split</strong></a> statement (see <a href="http://code.openark.org/blog/mysql/common_schema-1-1-released-split-try-catch-killall-profiling">release announcement</a>) auto-splits complex queries over large tables into smaller ones: instead of issuing one huge query, <em>split</em> breaks one&rsquo;s query into smaller queries, each working on a different set of rows (a chunk).</p>
<p>Thus, it is possible to avoid holding locks for long times, allowing for smaller transactions. It also makes for breathing space for the RDBMS, at times boosting operation speed, and at times prolonging operation speed at will.</p>
<p>In this post I show how <em>split</em> exposes itself to the user, should the user wish so.</p>
<p><em>split</em> can manage queries of the following forms:</p>
<ul>
<li>DELETE FROM table_name [WHERE]&hellip;</li>
<li>DELETE FROM table_name USING &lt;multi table syntax&gt; [WHERE]&hellip;</li>
<li>UPDATE table_name SET &hellip; [WHERE]&hellip;</li>
<li>UPDATE &lt;multiple tables&gt; SET &hellip; [WHERE]&hellip;</li>
<li>INSERT INTO some_table SELECT &hellip; FROM &lt;single or multiple tables&gt; [WHERE]&hellip;</li>
<li>REPLACE INTO some_table SELECT &hellip; FROM &lt;single or multiple tables&gt; [WHERE]&hellip;</li>
<li>SELECT &hellip; FROM &lt;multiple tables&gt; [WHERE]&hellip;</li>
</ul>
<p>The latter being a non-obvious one at first sight.</p>
<h4>Basically, it&rsquo; automatic</h4>
<p>You just say:</p>
<blockquote>
<pre><strong>split</strong> (UPDATE sakila.inventory SET last_update = last_update + INTERVAL 6 HOUR)
  throttle 2;</pre>
</blockquote>
<p>And <em>split</em> identifies <strong>sakila.inventory</strong> as the table which needs to be split, and injects appropriate conditions so as to work on a subset of the rows, in multiple steps.</p>
<p>By the way, here&rsquo;s <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_execution.html">how to execute a QueryScript code</a> like the above.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/table-split-for-the-masses/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-1-1-released-split-try-catch-killall-profiling/">common_schema 1.1 released: split(), try-catch, killall(), profiling</a></h2>

    <div class="post-meta">

  <div>

    <time>04 Sep 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m very happy to announce the release of <a href="http://code.google.com/p/common-schema/">common_schema</a>, version <strong>1.1</strong> (revision <strong>300</strong>).</p>
<p>This version boasts with compelling new features: innovative QueryScript syntax, libraries, views which add to your skills as a DBA, making some maintenance and management tasks a breeze.</p>
<ul>
<li>QueryScript, <strong>split</strong> statement: automagically break long queries into smaller chunks, avoid long locks and reduce query/transaction overhead</li>
<li>QueryScript, <strong>try-catch</strong> statement: just <strong>try { something; } catch { act_on_error; }</strong>.</li>
<li><strong>killall()</strong>: quickly kill connections based on grantee/user/host information.</li>
<li><strong>profiling</strong>/<strong>profiling_last</strong>: utility views to assist in query profiling diagnostics</li>
<li><strong>1 size fits all</strong>: a single installer which auto-recognizes available server features and enables respective <em>common_schema</em> features accordingly.</li>
<li>QueryScript performance boost</li>
<li>much much more&hellip;</li>
</ul>
<p>Not familiar with <em>common_schema</em>? It allows you to do stuff on server side, by selecting from views, calling upon useful routines or writing <em>easy-to-manage</em> scripts.</p>
<p>I&rsquo;m suggesting that <em>common_schema</em> should be a <em>really-should-have</em> tool to accompany your MySQL install. Did I say &ldquo;tool&rdquo;? It&rsquo;s merely a <em>schema</em>. But it makes for a great framework:</p>
<p>In <a href="http://www.amazon.com/High-Performance-MySQL-Optimization-Replication/dp/1449314287/ref=dp_ob_title_bk">High Performance MySQL, 3rd edition</a>, Baron Schwartz describes <em>common_schema</em>:</p>
<blockquote>The <em>common_schema</em> is to MySQL as jQuery is to javaScript</blockquote>
<p>Reviewing highlights for version <strong>1.1</strong>:</p>
<h4>QueryScript</h4>
<p><a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">QueryScript</a> is a scripting language. It sees some major improvements here. I&rsquo;ve made some speed boosts by <a href="http://code.openark.org/blog/mysql/on-stored-routines-and-dynamic-statements">avoiding using temporary tables</a>, and by using string parsing instead.</p>
<p>Without doubt the two most handy statements added to <em>QueryScript</em> are:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-1-1-released-split-try-catch-killall-profiling/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-error-handling-on-server-side-a-no-go/">MySQL error handling on server side: a NO GO!</a></h2>

    <div class="post-meta">

  <div>

    <time>18 Jul 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/errors">Errors</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information">information</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>There is no reasonable way to catch and diagnose errors on server side. It is nearly impossible to know exactly <em>what went wrong</em>.</p>
<p>To illustrate, consider the following query:</p>
<blockquote>
<pre>INSERT INTO my_table (my_column) VALUES (300);</pre>
</blockquote>
<p>What could go wrong with this query?</p>
<ul>
<li>We might hit a <strong>UNIQUE KEY</strong> violation</li>
<li>Or a <strong>FOREIGN KEY</strong> violation</li>
<li>my_column could be <strong>TINYINT UNSIGNED</strong>, and with strict <strong>sql_mode</strong> this makes for out-of-range</li>
<li>Or, similarly, it could be an <strong>ENUM (2,3,5,8)</strong></li>
</ul>
<p>Is that it? Not remotely:</p>
<ul>
<li>This could be a read-only <strong>MyISAM</strong> table</li>
<li>We may have issued a <strong>LOCK TABLES my_table READ</strong> &ndash; this violates our lock</li>
<li>Or this could be an <strong>InnoDB</strong> table, and this <strong>INSERT</strong> would make for a deadlock</li>
<li>Or we have <strong>read_only=1</strong> configuration</li>
<li>Or the user is not allowed access to this table</li>
<li>Or the table does not exist</li>
<li>Or the column does not exist</li>
</ul>
<p>Or&hellip; I&rsquo;m pretty sure there could be many other issues.</p>
<p>Now, if I write a Java program, perhaps using Hibernate, I get the error nicely wrapped up in a SQLException object, with easy access to error code and error message.</p>
<p>But can I have the same on server side? <em>No</em>.</p>
<p>Take a look at the following code:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-error-handling-on-server-side-a-no-go/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/delete-dont-insert/">DELETE, don&#39;t INSERT</a></h2>

    <div class="post-meta">

  <div>

    <time>27 Jun 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance">Performance</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Have just read <a href="http://blog.9minutesnooze.com/insert-delete/">INSERT, Don’t DELETE</a> by Aaron Brown, and have some lengthy response, which is why I write this post instead of commenting on said post.</p>
<p>I wish to offer my counter thought and suggest that <strong>DELETE</strong>s are probably the better choice.</p>
<p>Aaron suggests that, when one wishes to purge rows from some table, a trick can be used: instead of <strong>DELETE</strong>ing unwanted rows, one can <strong>INSERT</strong> &ldquo;good&rdquo; rows into a new table, then switch over with <strong>RENAME</strong> (but please read referenced post for complete details).</p>
<p>I respectfully disagree on several points discussed.</p>
<h4>Lockdown</h4>
<p>The fact one needs to block writes during the time of creation of new table is problematic: you need to essentially turn off parts of your application. The posts suggests one could use a slave - but this solution is far from being trivial as well. To switch over, you yet again need to turn off access to DB, even if for a short while.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/delete-dont-insert/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/who-is-hogging-my-mysql-connections/">Who is hogging my MySQL connections?</a></h2>

    <div class="post-meta">

  <div>

    <time>21 Jun 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Got <em>&ldquo;too many connections&rdquo;</em> this morning. New attempts continuously abort. Every once in a while some slipped through, but overall behavior was unacceptable.</p>
<p><strong>max_connections</strong> is set to <strong>500</strong>, well above normal requirements.</p>
<p>Immediate move: raise <strong>max_connections</strong> to <strong>600</strong>, some urgent connections must take place. But, this is no solution: if <strong>500</strong> got hogged, so will the extra <strong>100</strong> I&rsquo;ve just made available.</p>
<p>So, who&rsquo;s to blame? <strong>SHOW PROCESSLIST</strong> is so unfriendly at that. Wait. Didn&rsquo;t I create that view in <em>common_schema</em>, called <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/processlist_per_userhost.html">processlist_per_userhost</a>? I wonder what it says&hellip;</p>
<blockquote>
<pre>SELECT * FROM <strong>common_schema.processlist_per_userhost</strong>;
+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| user        | host             | count_processes | active_processes | average_active_time |
+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+
| maatkit     | sqlhost02.myweb  |               1 |                0 |                NULL |
| rango       | webhost04.myweb  |               2 |                0 |                NULL |
| rango       | webhost07.myweb  |               8 |                0 |                NULL |
| rango       | sqlhost02.myweb  |              38 |                0 |                NULL |
| rango       | management.myweb |              35 |                0 |                NULL |
| rango       | webhost03.myweb  |              10 |                0 |                NULL |
| rango       | local01.myweb    |               8 |                0 |                NULL |
| rango       | analytic02.myweb |              11 |                0 |                NULL |
| mytop       | localhost        |               2 |                0 |                NULL |
| buttercup   | sqlhost02.myweb  |             451 |                5 |              0.0000 |
| replc_user  | sqlhost00.myweb  |               1 |                1 |         392713.0000 |
| replc_user  | sqlhost02.myweb  |               1 |                1 |          38028.0000 |
| root        | localhost        |               2 |                0 |                NULL |
| system user |                  |               2 |                2 |         196311.5000 |
+&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+</pre>
</blockquote>
<p>Ah! It&rsquo;s <strong>buttercup</strong> connecting from <strong>sqlhost02.myweb</strong> who is making a fuss. I knew that view was created for a reason.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/who-is-hogging-my-mysql-connections/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/on-stored-routines-and-dynamic-statements/">On stored routines and dynamic statements</a></h2>

    <div class="post-meta">

  <div>

    <time>18 Jun 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/prepared-statements">Prepared Statements</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I very much enjoyed reading <a href="http://blog.mclaughlinsoftware.com/2012/06/16/overloading-procedures/" rel="bookmark">Overloading Procedures</a> by Michael McLaughlin: good stuff!</p>
<p>I&rsquo;m dealing with similar issues in <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">common_schema/QueryScript</a>, where I implement a whole new scripting language within MySQL, interpreted by stored routines. I am now finalizing the next version of <em>common_schema/QueryScript</em>, with a major addition to the scripting language to put yet even more power at the hands of the programmer/DBA using simple, clean syntax.</p>
<p>Still hush hush, the development of that feature touched at the very same issues described in Michael&rsquo;s post. Present in current release, these issues are intensified by the use and complexity of the new development. Here are a few insights of mine:</p>
<h4>Internal array implementation</h4>
<p>Like Michael, I started by implementing arrays through tables. That is, create a (temporary, in my case) table, wrap it up with a lot of stored routine code, and simulate an array. This array is not yet provided to the user, but is used internally for QueryScript&rsquo;s own code.</p>
<p>Well, disappointment here: during load tests on intense structures, such as a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_foreach.html">foreach</a> loop, where each iteration of the loop requires the creation of an array, I found that the current solution does not hold well on busy servers.</p>
<p>Seemingly, there&rsquo;s nothing wrong with the creation of a new table every once in a while &ndash; and in particular a temporary table. However, I quickly found out that a busy server thrashes the table cache with such intense rate of creation/dropping of tables. The competition over the table cache mutex becomes intolerable and hogs not only the script&rsquo;s execution but the entire server&rsquo;s.</p>
<p>There&rsquo;s also the issue of the type of array values &ndash; no going around using textual columns, of course, but &ndash; how long? A <strong>VARCHAR(32767)</strong> should be enough for any reasonable implementation, but &ndash; how much memory would that consume? Both <strong>MEMORY</strong> and standard temporary tables (<em>Percona Server</em> has that partially <a href="http://www.mysqlperformanceblog.com/2011/09/06/dynamic-row-format-for-memory-tables/">resolved</a>) use a fixed row format, which means a 32K text is actually allocated in memory even when your value is &lsquo;x&rsquo;.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/on-stored-routines-and-dynamic-statements/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/impact-of-foreign-keys-absence-on-replicating-slaves/">Impact of foreign keys absence on replicating slaves</a></h2>

    <div class="post-meta">

  <div>

    <time>14 May 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-integrity">data integrity</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In this post I describe what happens when a slave&rsquo;s Foreign Key setup is different from that of the master. I&rsquo;m in particular interested in a setup where the slave has a subset of the master&rsquo;s foreign keys, or no foreign keys at all. I wish to observe whether integrity holds.</p>
<h4>Making the changes</h4>
<p>Which foreign keys do we have and how do we drop them? If you want to do this by hand, well, good luck! Fortunately, <a href="http://code.google.com/p/common-schema/">common_schema</a> provides with quite a few handy views and routines to assist us. Consider viewing the existing foreign keys on <strong>sakila</strong>:</p>
<blockquote>
<pre>master&gt; SELECT <strong>create_statement</strong> FROM <strong>common_schema.sql_foreign_keys</strong> WHERE TABLE_SCHEMA=&lsquo;sakila&rsquo;;
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
| create_statement                                                                                                                                                                                |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
| ALTER TABLE <code>sakila</code>.<code>address</code> ADD CONSTRAINT <code>fk_address_city</code> FOREIGN KEY (<code>city_id</code>) REFERENCES <code>sakila</code>.<code>city</code> (<code>city_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                             |
| ALTER TABLE <code>sakila</code>.<code>city</code> ADD CONSTRAINT <code>fk_city_country</code> FOREIGN KEY (<code>country_id</code>) REFERENCES <code>sakila</code>.<code>country</code> (<code>country_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                       |
| ALTER TABLE <code>sakila</code>.<code>customer</code> ADD CONSTRAINT <code>fk_customer_address</code> FOREIGN KEY (<code>address_id</code>) REFERENCES <code>sakila</code>.<code>address</code> (<code>address_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE               |
| ALTER TABLE <code>sakila</code>.<code>customer</code> ADD CONSTRAINT <code>fk_customer_store</code> FOREIGN KEY (<code>store_id</code>) REFERENCES <code>sakila</code>.<code>store</code> (<code>store_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                       |
| ALTER TABLE <code>sakila</code>.<code>film</code> ADD CONSTRAINT <code>fk_film_language</code> FOREIGN KEY (<code>language_id</code>) REFERENCES <code>sakila</code>.<code>language</code> (<code>language_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                   |
| ALTER TABLE <code>sakila</code>.<code>film</code> ADD CONSTRAINT <code>fk_film_language_original</code> FOREIGN KEY (<code>original_language_id</code>) REFERENCES <code>sakila</code>.<code>language</code> (<code>language_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE |
| ALTER TABLE <code>sakila</code>.<code>film_actor</code> ADD CONSTRAINT <code>fk_film_actor_actor</code> FOREIGN KEY (<code>actor_id</code>) REFERENCES <code>sakila</code>.<code>actor</code> (<code>actor_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                   |
| ALTER TABLE <code>sakila</code>.<code>film_actor</code> ADD CONSTRAINT <code>fk_film_actor_film</code> FOREIGN KEY (<code>film_id</code>) REFERENCES <code>sakila</code>.<code>film</code> (<code>film_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                       |
| ALTER TABLE <code>sakila</code>.<code>film_category</code> ADD CONSTRAINT <code>fk_film_category_category</code> FOREIGN KEY (<code>category_id</code>) REFERENCES <code>sakila</code>.<code>category</code> (<code>category_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE |
| ALTER TABLE <code>sakila</code>.<code>film_category</code> ADD CONSTRAINT <code>fk_film_category_film</code> FOREIGN KEY (<code>film_id</code>) REFERENCES <code>sakila</code>.<code>film</code> (<code>film_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                 |
| ALTER TABLE <code>sakila</code>.<code>inventory</code> ADD CONSTRAINT <code>fk_inventory_film</code> FOREIGN KEY (<code>film_id</code>) REFERENCES <code>sakila</code>.<code>film</code> (<code>film_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                         |
| ALTER TABLE <code>sakila</code>.<code>inventory</code> ADD CONSTRAINT <code>fk_inventory_store</code> FOREIGN KEY (<code>store_id</code>) REFERENCES <code>sakila</code>.<code>store</code> (<code>store_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                     |
| ALTER TABLE <code>sakila</code>.<code>payment</code> ADD CONSTRAINT <code>fk_payment_customer</code> FOREIGN KEY (<code>customer_id</code>) REFERENCES <code>sakila</code>.<code>customer</code> (<code>customer_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE             |
| ALTER TABLE <code>sakila</code>.<code>payment</code> ADD CONSTRAINT <code>fk_payment_rental</code> FOREIGN KEY (<code>rental_id</code>) REFERENCES <code>sakila</code>.<code>rental</code> (<code>rental_id</code>) ON DELETE SET NULL ON UPDATE CASCADE                     |
| ALTER TABLE <code>sakila</code>.<code>payment</code> ADD CONSTRAINT <code>fk_payment_staff</code> FOREIGN KEY (<code>staff_id</code>) REFERENCES <code>sakila</code>.<code>staff</code> (<code>staff_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                         |
| ALTER TABLE <code>sakila</code>.<code>rental</code> ADD CONSTRAINT <code>fk_rental_customer</code> FOREIGN KEY (<code>customer_id</code>) REFERENCES <code>sakila</code>.<code>customer</code> (<code>customer_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE               |
| ALTER TABLE <code>sakila</code>.<code>rental</code> ADD CONSTRAINT <code>fk_rental_inventory</code> FOREIGN KEY (<code>inventory_id</code>) REFERENCES <code>sakila</code>.<code>inventory</code> (<code>inventory_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE           |
| ALTER TABLE <code>sakila</code>.<code>rental</code> ADD CONSTRAINT <code>fk_rental_staff</code> FOREIGN KEY (<code>staff_id</code>) REFERENCES <code>sakila</code>.<code>staff</code> (<code>staff_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                           |
| ALTER TABLE <code>sakila</code>.<code>staff</code> ADD CONSTRAINT <code>fk_staff_address</code> FOREIGN KEY (<code>address_id</code>) REFERENCES <code>sakila</code>.<code>address</code> (<code>address_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                     |
| ALTER TABLE <code>sakila</code>.<code>staff</code> ADD CONSTRAINT <code>fk_staff_store</code> FOREIGN KEY (<code>store_id</code>) REFERENCES <code>sakila</code>.<code>store</code> (<code>store_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                             |
| ALTER TABLE <code>sakila</code>.<code>store</code> ADD CONSTRAINT <code>fk_store_address</code> FOREIGN KEY (<code>address_id</code>) REFERENCES <code>sakila</code>.<code>address</code> (<code>address_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                     |
| ALTER TABLE <code>sakila</code>.<code>store</code> ADD CONSTRAINT <code>fk_store_staff</code> FOREIGN KEY (<code>manager_staff_id</code>) REFERENCES <code>sakila</code>.<code>staff</code> (<code>staff_id</code>) ON DELETE RESTRICT ON UPDATE CASCADE                     |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+</pre>
</blockquote>
<p>Most of the foreign key constraints use <strong>RESTRICT</strong> for <strong>DELETE</strong> (meaning you are not allowed to delete a parent row when children exist), and <strong>CASCADE</strong> for <strong>UPDATE</strong> (meaning changes to parent will propagate to children). This is good, since I want to test behavior of both <strong>RESTRICT</strong> and <strong>CASCADE</strong>.</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/impact-of-foreign-keys-absence-on-replicating-slaves/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-talk-at-percona-live/">common_schema talk at Percona Live</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Apr 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mysqlconf">mysqlconf</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/speaking">Speaking</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Are you attending PerconaLive? Allow me to suggest you attend the Common Schema: a framework for MySQL server administration session on April 12, 14:00 - 14:50 @ Ballroom F. This talk is by none other than Roland Bouman. Roland co-authored parts of common_schema, and is a great speaker. I have a personal interest, of course, being the author of most of the components in common_schema. I would like to convert you to a supporter of this project.
  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-talk-at-percona-live/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysqlqueryscript-use-case-delete-all-but-top-n-records-per-group/">MySQL/QueryScript use case: DELETE all but top N records per group</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Feb 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Some administrative tasks can be simplified by using <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">common_schema/QueryScript</a>. I&rsquo;m collecting a bunch of these for documentation. Here&rsquo;s one for example:</p>
<p>The DBA/developer has the task of retaining only top <strong>3</strong> most populated countries per continent. That is, she has to <strong>DELETE 4th, 5th, 6th</strong>, &hellip; most populated counties in each continent.</p>
<p>Is it possible to work out with a single query? Yes. But the query is not pretty. In fact, it is quite complicated, and either involves unintuitive subqueries, or <a href="http://code.openark.org/blog/mysql/sql-selecting-top-n-records-per-group">unintuitive hacks</a>. A normal DBA would not want to write, neither maintain this kind of query, unless top-notch-geek, which is fine.</p>
<p>Since this is a one time job, we just need to get it done. And <em>common_schema</em>/QueryScript provide with the intuitive solution: if we read our demand aloud, we realize we want to <strong>delete</strong> <strong>4th, 5th, 6th</strong>, &hellip; populated countries <strong>for each</strong> continent.</p>
<p>I present a solution made available by QueryScript, and discuss the ways in which the code overcomes limitations, or simplifies complexity:</p>
<blockquote>
<pre>var $num_countries_to_delete;
foreach($continent, $num_countries: SELECT continent, COUNT(*) FROM world.Country GROUP BY continent)
{
  if ($num_countries &gt; 3)
  {
    set $num_countries_to_delete := $num_countries - 3;
    DELETE FROM world.Country WHERE Continent = $continent ORDER BY Population ASC LIMIT :$num_countries_to_delete;
  }
}</pre>
</blockquote>
<h4>Discussion</h4>
<p>The first thing that should be apparent from the above is that this is a <em>programmatic</em> solution. Queries are declarative, which is why complex ones sometimes look incomprehensible. The above is more straightforward.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysqlqueryscript-use-case-delete-all-but-top-n-records-per-group/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-rev-218-queryscript-throttling-processes-documentation/">common_schema rev. 218: QueryScript, throttling, processes, documentation</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Feb 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/administration">Administration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="http://code.google.com/p/common-schema/">common_schema</a>, revision <strong>218</strong> is released, with major new features, top one being <em>server side scripting</em>. Here are the highlights:</p>
<ul>
<li><a href="http://www.queryscript.com/"><strong>QueryScript</strong></a>: server side scripting is now supported by <em>common_schema</em>, which acts as an interpreter for QueryScript code.</li>
<li>Throttling for queries is now made available via the <strong>throttle()</strong> function.</li>
<li>Enhancements to processlist-related views, including the new <strong>slave_hosts</strong> view.</li>
<li>Inline documentation/help is available via the <strong>help()</strong> routine.</li>
<li>more&hellip;</li>
</ul>
<h4>QueryScript</h4>
<p><em>common_schema</em> makes for a QueryScript implementation for MySQL. You can run server side scripts, interpreted by <em>common_schema</em>, which allow for easy syntax and greater power than was otherwise previously available on the MySQL server. For example:</p>
<blockquote>
<pre>foreach($table, $schema, $engine: table like &lsquo;%&rsquo;)
  if ($engine = &lsquo;ndbcluster&rsquo;)
    ALTER ONLINE TABLE :$schema.:$table REORGANIZE PARTITION;</pre>
</blockquote>
<p>QueryScript includes flow control, conditional branching, variables &amp; variable expansion, script throttling and more.</p>
<p>Read more on <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">common_schema&rsquo;s QueryScript implementation</a>.</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-rev-218-queryscript-throttling-processes-documentation/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/queryscript-sql-scripting-language/">QueryScript: SQL scripting language</a></h2>

    <div class="post-meta">

  <div>

    <time>08 Feb 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/administration">Administration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/queryscript">QueryScript</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Introducing <strong><a href="http://www.queryscript.com/">QueryScript</a></strong>: a programming language aimed for SQL scripting, seamlessly combining scripting power such as flow control &amp; variables with standard SQL statements or RDBMS-specific commands.</p>
<p>QueryScript is available fro MySQL via <a href="http://code.google.com/p/common-schema">common_schema</a>, which adds MySQL-specific usage.</p>
<p><em>What does QueryScript look like?</em> Here are a few code samples:</p>
<p>Turn a bulk DELETE operation into smaller tasks. Throttle in between.</p>
<blockquote>
<pre>while (DELETE FROM archive.events WHERE ts &lt; CURDATE() LIMIT 1000)
{
  throttle 2;
}</pre>
</blockquote>
<p>Convert all InnoDB tables in the &lsquo;sakila&rsquo; database to compressed format:</p>
<blockquote>
<pre>foreach ($table, $schema, $engine: table in sakila)
{
  if ($engine = &lsquo;InnoDB&rsquo;)
    ALTER TABLE :$schema.:$table ENGINE=InnoDB ROW_FORMAT=COMPRESSED KEY_BLOCK<em>SIZE=8;
}</pre>
</blockquote>
<p>Shard your data across multiple schemata:</p>
<blockquote>
<pre>foreach($shard: {USA, GBR, JAP, FRA})
{
  CREATE DATABASE db</em>:$shard;
  CREATE TABLE db<em>:$shard.city LIKE world.City;
  INSERT INTO db</em>:$shard.city SELECT * FROM world.City WHERE CountryCode = $shard;
}</pre>
</blockquote>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/queryscript-sql-scripting-language/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/documentation-in-sql-call-for-help/">Documentation in SQL: CALL for help()</a></h2>

    <div class="post-meta">

  <div>

    <time>11 Jan 2012</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/documentation">documentation</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/mycheckpoint">mycheckpoint</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/openark-kit">openark kit</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Documentation is an important part of any project. On the projects I maintain I put a lot of effort on documentation, and, frankly, the majority of time spent on my projects is on documentation.</p>
<p>The matter of keeping the documentation faithful is a topic of interest. I&rsquo;d like to outline a few documentation bundling possibilities, and the present the coming new documentation method for <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>. I&rsquo;ll talk about any bundling that is NOT <em>man pages</em>.</p>
<h4>High level: web docs</h4>
<p>This is the initial method of documentation I used for <a title="openark kit" href="../../forge/openark-kit">openark kit</a> and <a title="mycheckpoint" href="../../forge/mycheckpoint">mycheckpoint</a>. It&rsquo;s still valid for <em>mycheckpoint</em>. Documentation is web-based. You need Internet access to read it. It&rsquo;s in HTML format.</p>
<p>Well, not exactly HTML format: I wrote it in WordPress. Yes, it&rsquo;s HTML, but there&rsquo;s a lot of noise around (theme, menus, etc.) which is not strictly part of the documentation.</p>
<p>While this is perhaps the easiest way to go, here&rsquo;s a few drawbacks:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/documentation-in-sql-call-for-help/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/more-mysql-foreach/">More MySQL foreach()</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Dec 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In my <a href="http://code.openark.org/blog/mysql/mysql-foreach">previous post</a> I&rsquo;ve shown several generic use cases for <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/foreach.html"><em>foreach()</em></a>, a new scripting functionality introduced in <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>.</p>
<p>In this part I present DBA&rsquo;s handy syntax for schema and table operations and maintenance.</p>
<p>Confession: while I love <strong>INFORMATION_SCHEMA</strong>&rsquo;s power, I just <em>hate</em> writing queries against it. It&rsquo;s just so much typing! Just getting the list of tables in a schema makes for this heavy duty query:</p>
<blockquote>
<pre>SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA=&lsquo;sakila&rsquo; AND TABLE_TYPE=&lsquo;BASE TABLE&rsquo;;</pre>
</blockquote>
<p>When a join is involved this really becomes a nightmare. I think it&rsquo;s cumbersome, and as result, many do not remember the names and meaning of columns, making for <em>&ldquo;oh, I need to read the manual all over again just to get that query right&rdquo;</em>. Anyway, that&rsquo;s my opinion.</p>
<p>A <strong>SHOW TABLES</strong> statement is easier to type, but cannot be integrated into a <strong>SELECT</strong> query (though <a href="http://code.openark.org/blog/mysql/reading-results-of-show-statements-on-server-side">we have a partial solution</a> for that, too), and besides, when filtering out the views, the <strong>SHOW</strong> statement becomes almost as cumbersome as the one on <strong>INFORMATION_SCHEMA</strong>.</p>
<p>Which is why <em>foreach()</em> offers handy shortcuts to common iterations on schemata and tables, as follows:</p>
<h4>Use case: iterate all databases</h4>
<blockquote>
<pre>call foreach(<span style="color: #808000;">&lsquo;schema&rsquo;</span>, <span style="color: #003366;">&lsquo;CREATE TABLE ${schema}.event(event<em>id INT, msg VARCHAR(128))&rsquo;</span>);</pre>
</blockquote>
<p>In the above we execute a query on each database. Hmmm, maybe not such a good idea to perform this operation on all databases? Let&rsquo;s filter them:</p>
<h4>Use case: iterate databases by name match</h4>
<blockquote>
<pre>call foreach(<span style="color: #808000;">&lsquo;schema like wordpress</em>%&rsquo;</span>, <span style="color: #003366;">&lsquo;ALTER TABLE ${schema}.wp_posts MODIFY COLUMN comment_author VARCHAR(96) NOT NULL&rsquo;</span>);</pre>
</blockquote>
<p>The above will only iterate my WordPress databases (I have several of these), performing an <strong>ALTER</strong> on <strong>wp_posts</strong> for each of those databases.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/more-mysql-foreach/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-foreach/">MySQL foreach()</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Dec 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/hack">Hack</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  A new routine is now available in common_schema, which makes for an easier execution syntax for some operations: foreach(collection_to_iterate_over, queries_to_execute_per_iteration_step); To illustrate what it can do, consider: call foreach('table in sakila', 'ALTER TABLE ${schema}.${table} ENGINE=InnoDB ROW_FORMAT=COMPACT'); call $('schema like shard_%', 'CREATE TABLE ${schema}.messages (id INT)'); call $('2000:2009', 'INSERT IGNORE INTO report (report_year) VALUES (${1})'); $() stands as a synonym to foreach(). I suspect it should look familiar to web programmers. The idea for foreach() was introduced by Giuseppe Maxia during a correspondence.
  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-foreach/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-rev-178-foreach-repeat_exec-roland-bouman-query-analysis/">common_schema, rev. 178: foreach(), repeat_exec(), Roland Bouman, query analysis</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Dec 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>, revision <strong>178</strong> is now released, with major additions. This revision turns <em>common_schema</em> into a <em>framework</em>, rather than a set of views and functions.</p>
<p><em>common_schema</em> provides with query scripting, analysis &amp; informational views, and a function library, allowing for easier administration and diagnostics for MySQL. It introduces SQL based tools which simplify otherwise complex shell and client scripts, allowing the DBA to be independent of operating system, installed packages and dependencies.</p>
<p>There&rsquo;s no Perl nor Python, and no dependencies to install. It&rsquo;s just a <em>schema</em>.</p>
<p>Some highlights for the new revision:</p>
<ul>
<li><strong>foreach()</strong>, aka <strong>$()</strong>: loop through a collection, execute callback commands per element.</li>
<li><strong>repeat_exec()</strong>: a repeat-until device: execute queries until some condition holds.</li>
<li><strong>exec_file()</strong>: execute files a-la SOURCE, but on server side</li>
<li><strong>Query analysis</strong>: analyze query text, view or routine definitions to detect dependency objects.</li>
<li>Improvements to views and routines, new routines introduced.</li>
</ul>
<p>Let&rsquo;s take a closer look:</p>
<h4>rpbouman</h4>
<p>I&rsquo;m very happy to have <a href="http://rpbouman.blogspot.com/">Roland Bouman</a> working on this project. He introduced some sophisticated code without which some functionality could not take place. I&rsquo;m sure I don&rsquo;t need to introduce his great capabilities; I&rsquo;ll just pass the note that it is very good working with him!</p>
<h4>foreach()</h4>
<p>Introducing a looping device which can iterate a collection and execute callback commands.</p>
<p>What&rsquo;s a collection? A range of numbers; a set of constants; the result set of a <strong>SELECT</strong> query; tables in your database and more.</p>
<p>What is a callback? A query or set of queries to invoke on the specific elements in the collection. For example:</p>
<blockquote>
<pre>call <strong>foreach</strong>(<span style="color: #808000;">&lsquo;table in sakila&rsquo;</span>, <span style="color: #000080;">&lsquo;ALTER TABLE ${schema}.${table} ENGINE=InnoDB ROW_FORMAT=COMPRESSED&rsquo;</span>);</pre>
</blockquote>
<p>I&rsquo;ll publish dedicated posts on <em>foreach()</em>, aka <em>$()</em>, following this post. Official documentation is <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/foreach.html">here</a>.</p>
<h4>repeat_exec()</h4>
<p>Repeat executing queries in a given interval, until some condition holds.</p>
<p>What kind of condition? You can loop forever, or until a given time has passed, a given number of iteration has passed.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-rev-178-foreach-repeat_exec-roland-bouman-query-analysis/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/reading-results-of-show-statements-on-server-side/">Reading results of SHOW statements, on server side</a></h2>

    <div class="post-meta">

  <div>

    <time>25 Nov 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/hacks">Hacks</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong>SHOW</strong> statements are show stoppers on server side. While clients can get a <a href="http://dev.mysql.com/doc/refman/5.1/en/show.html">SHOW statement</a> as a result set just as any normal <strong>SELECT</strong>, things are not as such on server side.</p>
<p>On server side, that is, from within MySQL itself, one <em>cannot</em>:</p>
<blockquote>
<pre>SELECT <code>Database</code> FROM (SHOW DATABASES);</pre>
</blockquote>
<p>One <em>cannot</em>:</p>
<blockquote>
<pre>DECLARE show_cursor CURSOR FOR SHOW TABLES;</pre>
</blockquote>
<p>One <em>cannot</em>:</p>
<blockquote>
<pre>SHOW TABLES INTO OUTFILE &lsquo;/tmp/my_file.txt&rsquo;;</pre>
</blockquote>
<p>So it is impossible to get the results with a query; impossible to get the results from a stored routine; impossible to get the results by file reading&hellip;</p>
<h4>Bwahaha! A hack!</h4>
<p>For some <strong>SHOW</strong> statements, there is a way around this. I&rsquo;ve been banging my head against the wall for weeks now on this. Now I have a partial solution: I&rsquo;m able to read <strong>SHOW</strong> output for several <strong>SHOW</strong> statements. Namely, those <strong>SHOW</strong> statements <a href="http://dev.mysql.com/doc/refman/5.1/en/extended-show.html">which allow a LIKE or a WHERE</a> clause.</p>
<p>For example, most are familiar with the following syntax:</p>
<blockquote>
<pre>USE mysql;
SHOW TABLE STATUS LIKE &lsquo;user&rsquo;;</pre>
</blockquote>
<p>However not so many know that any <strong>SHOW</strong> statement which accepts <strong>LIKE</strong>, can also accept <strong>WHERE</strong>:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/reading-results-of-show-statements-on-server-side/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/test-driven-sql-development/">Test-driven SQL development</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Oct 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/ant">Ant</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/linux">Linux</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/scripts">scripts</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m having a lot of fun writing <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>, an SQL project which includes views, tables and stored routines.</p>
<p>As the project grows (and it&rsquo;s taking some interesting directions, in my opinion) more dependencies are being introduced, and a change to one routine or view may affect many others. This is why I&rsquo;ve turned the development on <em>common_schema</em> to be <em>test driven</em>.</p>
<p>Now, just how do you test drive an SQL project?</p>
<p>Well, much like the way you test any other project in your favorite programming language. If its functions you&rsquo;re testing, that&rsquo;s all too familiar: functions get some input and provide some output. Hmmm, they might be changing SQL data during that time. With procedures it&rsquo;s slightly more complex, since they do not directly return output but result sets.</p>
<p>Here&rsquo;s the testing scheme I use:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/test-driven-sql-development/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-rev-68-eval-processlist_grantees-candidate_keys-easter_day/">common_schema rev. 68: eval(), processlist_grantees, candidate_keys, easter_day()</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Sep 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Revision <strong>68</strong> of <a rel="nofollow" href="http://code.google.com/p/common-schema/">common_schema</a> is out, and includes some interesting features:</p>
<ul>
<li><strong>eval()</strong>: Evaluates the queries generated by a given query</li>
<li><strong>match_grantee()</strong>: Match an existing account based on user+host</li>
<li><strong>processlist_grantees</strong>: Assigning of GRANTEEs for connected processes</li>
<li><strong>candidate_keys</strong>: Listing of prioritized candidate keys: keys which are UNIQUE, by order of best-use.</li>
<li><strong>easter_day()</strong>: Returns DATE of easter day in given DATETIME&rsquo;s year.</li>
</ul>
<p>Let&rsquo;s take a slightly closer look at these:</p>
<h4>eval()</h4>
<p>I&rsquo;ve dedicated this blog post on <a href="http://code.openark.org/blog/mysql/mysql-eval">MySQL eval()</a> to describe it. In simple summary: <strong>eval()</strong> takes a query which generates queries (most common use queries on <strong>INFORMATION_SCHEMA</strong>) and auto-evaluates (executes) those queries. <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/general_procedures.html#eval">Read more</a></p>
<h4>match_grantee()</h4>
<p>As presented in <a title="Link to Finding CURRENT_USER for any user" rel="bookmark" href="http://code.openark.org/blog/mysql/finding-current_user-for-any-user">Finding CURRENT_USER for any user</a>, I&rsquo;ve developed the algorithm to match a connected user+host details (as presented with <strong>PROCESSLIST</strong>) with the grantee tables (i.e. the <strong>mysql.user</strong> table), in a manner which simulates the MySQL server account matching algorithm.</p>
<p>This is now available as a stored function: given a user+host, the function returns with the best matched grantee. <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/privileges_functions.html#match_grantee">Read more</a></p>
<h4>processlist_grantees</h4>
<p>This view relies on the above, and maps the entire <strong>PROCESSLIST</strong> onto GRANTEEs. The view maps each process onto the GRANTEE (MySQL account) which is the owner of that process. Surprisingly, MySQL does not provide one with such information.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-rev-68-eval-processlist_grantees-candidate_keys-easter_day/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-eval/">MySQL eval()</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Sep 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I've just implemented an eval() call for MySQL. It is implemented with SQL, using a stored procedure. So this is not some plugin: you can use it from within your normal database server. Just what is an eval() call? In some programming languages it would mean: get some text, and execute it as though it were complied code. So, dynamic coding. In SQL: get the text of query which generates SQL statements in itself (either DML or DDL), and invoke those implied SQL statements.
  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-eval/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/mysql-global-status-difference-using-single-query/">MySQL Global status difference using single query</a></h2>

    <div class="post-meta">

  <div>

    <time>12 Aug 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Have just read <a href="http://karlssonondatabases.blogspot.com/2011/08/mysql-global-status-difference-using_12.html">MySQL Global status difference using MySQL procedures / functions</a>, by Andres Karlsson. Have commented, but realized I did not provide with a direct answer. In the comment, I suggested checking out <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/global_status_diff.html">a solution based on views</a>, found in <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>. But the solution in <em>common_schema</em> is split into two views, due to the fact views cannot handle derived tables subqueries.</p>
<p>Well, here&rsquo;s a single query to do that: it checks <strong>GLOBAL_STATUS</strong> twice, <strong>10</strong> seconds apart in the following sample. It uses <strong>SLEEP()</strong> to actually wait between the two reads. Yes, you can do that with a query.</p>
<p>The following query shows all <strong>GLOBAL_STATUS</strong> values that have changed during the sample period.</p>
<p><strong>[UPDATE]</strong> query updated to work with MySQL <strong>5.6</strong> optimizer</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/mysql-global-status-difference-using-single-query/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/finding-current_user-for-any-user/">Finding CURRENT_USER for any user</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Aug 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>A MySQL account is a user/host combination. A MySQL connection is done by a user connecting from some host.</p>
<p>However, the user/host from which the connection is made are not the same as the user/host as specified in the account. For example, the account may be created thus:</p>
<blockquote>
<pre>CREATE USER &lsquo;temp&rsquo;@&lsquo;10.0.0.%&rsquo; IDENTIFIED BY &lsquo;123456&rsquo;;</pre>
</blockquote>
<p>The host as specified in the above account is a wildcard host. A connection by the <strong>&lsquo;temp&rsquo;</strong> user from <strong>&lsquo;10.0.0.3&rsquo;</strong> can map into that account. It thus happens that the connected user is <strong>&lsquo;temp&rsquo;@&lsquo;10.0.0.3&rsquo;</strong>, yet the assigned account is <strong>&lsquo;temp&rsquo;@&lsquo;10.0.0.%&rsquo;</strong>.</p>
<p>MySQL provides with the <strong>USER()</strong> and <strong>CURRENT_USER()</strong> which map to the connected user and the assigned account, respectively, and which lets the current session identify the relation between the two. Read more on this on the <a href="http://dev.mysql.com/doc/refman/5.1/en/account-activity-auditing.html">MySQL docs</a>.</p>
<h4>The problem</h4>
<p>And the trouble is: MySQL only provides this functionality for the <em>current session</em>. Surprisingly, given a user/host combination, I cannot get MySQL to tell me which account matches those details.</p>
<h4>The inconsistency</h4>
<p>And I care because there is an inconsistency. Namely, when I do <strong>SHOW PROCESSLIST</strong> MySQL tells me the user &amp; host from which the connection is made. It does <em>not</em> tell me the account for which the process is assigned.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/finding-current_user-for-any-user/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/common_schema-looking-for-contributions/">common_schema: looking for contributions</a></h2>

    <div class="post-meta">

  <div>

    <time>20 Jul 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  In my announcement for common_schema I have failed to deliver the following message: I will be happy to receive contributions to common_schema, and I will be happy to have contributors on this project What kind of contributions are wanted? So, I'm mostly interested right now in: Views: providing more insight on metadata (data types, schemata, volumes, transactions, locks, connections, etc.) Views: SQL code generation (e.g. generate my FOREIGN KEYs) Functions: DETERMINISTIC, NO SQL, preferably no control flow inside, making for simple calls what is usually a typical, repeating function combination.
  </p>

  
  <footer>
    <a href="/blog/mysql/common_schema-looking-for-contributions/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/announcing-common_schema-common-views-routines-for-mysql/">Announcing common_schema: common views &amp; routines for MySQL</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Jul 2011</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/analysis">Analysis</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/data-types">Data Types</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/indexing">Indexing</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/innodb">InnoDB</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/schema">Schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Today I have released <a title="common_schema" href="http://code.openark.org/forge/common_schema">common_schema</a>, a utility schema for MySQL which includes many views and functions, and is aimed to be installed on any MySQL server.</p>
<h4>What does it do?</h4>
<p>There are views answering for all sorts of useful information: stuff related to schema analysis, data dimensions, monitoring, processes &amp; transactions, security, internals&hellip; There are basic functions answering for common needs.</p>
<p>Some of the views/routines simply formalize those queries we tend to write over and over again. Others take the place of external tools, answering complex questions via SQL and metadata. Still others help out with SQL generation.</p>
<p>Here are a few highlights:</p>
<ul>
<li>Did you know you can work out <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/global_status_diff_nonzero.html">simple monitoring</a> of your server with a <em>query</em>?  There&rsquo;s a view to do that for you.</li>
<li>How about showing just <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/processlist_top.html">the good parts of the processlist</a>?</li>
<li>Does your schema have <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/redundant_keys.html">redundant keys</a>?</li>
<li>Or InnoDB tables with <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/no_pk_innodb_tables.html">no PRIMARY KEY</a>?</li>
<li>Is AUTO_INCREMENT <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/auto_increment_columns.html">running out of space</a>?</li>
<li>Can I get the SQL statements to <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_foreign_keys.html">generate my FOREIGN KEYs</a>? To drop them?</li>
<li>And can we finally get <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">SHOW GRANTS for all accounts</a>, and as an <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">SQL query</a>?</li>
<li>Ever needed a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/general_functions.html#crc64">64 bit CRC function</a>?</li>
<li>And aren&rsquo;t you tired of writing the cumbersome SUBSTRING_INDEX(SUBSTRING_INDEX(str, &lsquo;,&rsquo;, 3), &lsquo;,&rsquo;, -1)? <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/string_functions.html#split_token">There&rsquo;s an alternative</a>.</li>
</ul>
<p>There&rsquo;s more. Take a look at the <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/introduction.html">common_schema documentation</a> for full listing. And it&rsquo;s evolving: I&rsquo;ve got quite a few ideas already for future components.</p>
<p>Some of these views rely on heavyweight INFORMATION_SCHEMA tables. You should be aware of the impact and <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/risks.html">risks</a>.</p>
<h4>What do I need to install?</h4>
<p>There&rsquo;s no script or executable file. It&rsquo;s just a schema. The distribution in an SQL file which generates <em>common_schema</em>. Much like a dump file.</p>
<h4></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/announcing-common_schema-common-views-routines-for-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
</div>

</div>
</div>
<script src="/blog/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>
