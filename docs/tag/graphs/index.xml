<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Graphs on code.openark.org</title>
    <link>/blog/tag/graphs/</link>
    <description>Recent content in Graphs on code.openark.org</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2016. All rights reserved.</copyright>
    <lastBuildDate>Thu, 03 Mar 2011 09:38:10 +0000</lastBuildDate>
    <atom:link href="/blog/tag/graphs/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Generating Google line charts with SQL, part II</title>
      <link>/blog/mysql/generating-google-line-charts-with-sql-part-ii/</link>
      <pubDate>Thu, 03 Mar 2011 09:38:10 +0000</pubDate>
      
      <guid>/blog/mysql/generating-google-line-charts-with-sql-part-ii/</guid>
      <description>&lt;p&gt;This post continues &lt;a href=&#34;http://code.openark.org/blog/mysql/generating-google-line-charts-with-sql-part-i&#34;&gt;Generating Google line charts with SQL, part I&lt;/a&gt;, in pursue of generating time series based image charts.&lt;/p&gt;
&lt;p&gt;We ended last post with the following chart:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre /&gt;&lt;img class=&#34;alignnone&#34; title=&#34;Sample SQL Google Chart&#34; src=&#34;/blog/blog/assets/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0&amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&#34; alt=&#34;&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;
http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0&amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL

&lt;/blockquote&gt;
which has a nice curve, and a proper y-legend, but incorrect x-legend and no ticks nor grids.

To date, Google Image Charts do not support time-series charts. We can&#39;t just throw timestamp values and expect the chart to properly position them. We need to work these by hand.

This is not easily done; if our input consists of evenly spread timestamp values, we are in a reasonable position. If not, what do we do?

There are several solutions to this:
&lt;ul&gt;
	&lt;li&gt;We can present whatever points we have on the chart, making sure to position them properly. This makes for an uneven distribution of ticks on the x-axis, and is not pleasant to watch.&lt;/li&gt;
	&lt;li&gt;We can extrapolate values for round hours (or otherwise round timestamp resolutions), and so show evenly spread timestamps. I don&#39;t like this solution one bit, since we&#39;re essentially inventing values here. Extrapolation is nice when you know you have nice curves, but not when you&#39;re doing database monitoring, for example. You must have the precise values.&lt;/li&gt;
	&lt;li&gt;We can do &lt;a href=&#34;http://en.wikipedia.org/wiki/Oversampling&#34;&gt;oversampling&lt;/a&gt;, then group together several measurements within round timestamp resolutions. For example, we can make a measurement every &lt;strong&gt;2&lt;/strong&gt; minutes, yet present only &lt;strong&gt;6&lt;/strong&gt; measurements per hour, each averaging up &lt;strong&gt;10&lt;/strong&gt; round minutes. This is the approach I take with &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint&#34;&gt;mycheckpoint&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
The latest approach goes even beyond that: what if we missed 30 minutes of sampling? Say the server was down. We then need to &#34;invent&#34; the missing timestamps. Note that we invent the timestamps, we do not invent values. We must present the chart with missing values on our invented timestamps.

I may show how to do this in a future post. Meanwhile, let&#39;s simplify and assume our values &lt;em&gt;are&lt;/em&gt; evenly spread.&lt;!--more--&gt;
&lt;h4&gt;Sample data&lt;/h4&gt;
We use &lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2011/03/google_charts.sql_.txt&#34;&gt;google_charts.sql&lt;/a&gt;. Note that the timestamp values provided in Part I of this post is skewed, so make sure to use this file.
&lt;h4&gt;x-axis values&lt;/h4&gt;
We use &lt;strong&gt;chxl&lt;/strong&gt; to present with x-axis values. We may be tempted to just list all values. Would that work?

Sadly, no, for two reasons:
&lt;ol&gt;
	&lt;li&gt;Google is not smart enough; whatever we throw at it, it will try to present. So, if we have &lt;strong&gt;288&lt;/strong&gt; rows, that&#39;s &lt;strong&gt;288&lt;/strong&gt; x-axis values. Not enough room, to be sure! Smarter implementations would automatically hide some values, so as only to present with non-overlapping values.&lt;/li&gt;
	&lt;li&gt;Our URL will turn out to be too long. Remember: &lt;strong&gt;2048&lt;/strong&gt; characters is our maximum limit for GET request!&lt;/li&gt;
&lt;/ol&gt;
Also, we must format our timestamp to be of minimal width. In our example, we have a &lt;strong&gt;24&lt;/strong&gt; hour range. We therefore present timestamps in hh:MM format. So, a naive approach would be to:
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  CONCAT(
    &#39;http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,&#39;,
    ROUND(min_value, 1), &#39;,&#39;,
    ROUND(max_value, 1),
    &#39;&amp;amp;chd=s:&#39;,
    GROUP_CONCAT(
      IF(
        data IS NULL,
        &#39;_&#39;,
        SUBSTRING(
          &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;,
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR &#39;&#39;
    ),
   &#39;&amp;amp;chxl=0:|&#39;,
    &lt;strong&gt;GROUP_CONCAT(&lt;/strong&gt;
&lt;strong&gt;      DATE_FORMAT(ts, &#39;%H:%i&#39;)&lt;/strong&gt;
&lt;strong&gt;      SEPARATOR &#39;|&#39;&lt;/strong&gt;
&lt;strong&gt;    )&lt;/strong&gt;
  ) FROM chart_data, chart_data_minmax&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The resulting URL is just too long.&lt;/p&gt;
&lt;p&gt;Solution? Let&#39;s only consider round hour timestamps! Our next attempt looks like this (we also throw in &lt;strong&gt;chxs&lt;/strong&gt;, to show ticks):&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  CONCAT(
    &#39;http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,&#39;,
    ROUND(min_value, 1), &#39;,&#39;,
    ROUND(max_value, 1),
    &#39;&amp;amp;chd=s:&#39;,
    GROUP_CONCAT(
      IF(
        data IS NULL,
        &#39;_&#39;,
        SUBSTRING(
          &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;,
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR &#39;&#39;
    ),
   &lt;strong&gt;&#39;&amp;amp;chxs=0,505050,10,0,lt&#39;,&lt;/strong&gt;
&lt;strong&gt;   &#39;&amp;amp;chxl=0:|&#39;,&lt;/strong&gt;
&lt;strong&gt;    GROUP_CONCAT(&lt;/strong&gt;
&lt;strong&gt;      IF(&lt;/strong&gt;
&lt;strong&gt;        MINUTE(ts) = 0,&lt;/strong&gt;
&lt;strong&gt;        DATE_FORMAT(ts, &#39;%H:%i&#39;),&lt;/strong&gt;
&lt;strong&gt;        NULL&lt;/strong&gt;
&lt;strong&gt;      )&lt;/strong&gt;
&lt;strong&gt;      SEPARATOR &#39;|&#39;&lt;/strong&gt;
&lt;strong&gt;    )&lt;/strong&gt;
  ) FROM chart_data, chart_data_minmax
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;and results with:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre /&gt;&lt;img class=&#34;alignnone&#34; title=&#34;SQL line chart&#34; src=&#34;/blog/blog/assets/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0&amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chxl=0:|00:00|01:00|02:00|03:00|04:00|05:00|06:00|07:00|08:00|09:00|10:00|11:00|12:00|13:00|14:00|15:00|16:00|17:00|18:00|19:00|20:00|21:00|22:00|23:00&#34; alt=&#34;&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;
http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0&amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chxl=0:|00:00|01:00|02:00|03:00|04:00|05:00|06:00|07:00|08:00|09:00|10:00|11:00|12:00|13:00|14:00|15:00|16:00|17:00|18:00|19:00|20:00|21:00|22:00|23:00
&lt;/blockquote&gt;
Too messy, isn&#39;t it?
&lt;h4&gt;A word about ticks&lt;/h4&gt;
You would think: OK, then, let&#39;s just present every &lt;strong&gt;4&lt;/strong&gt; round hours timestamps. But there&#39;s a catch: a tick will show only when there&#39;s an x-axis value. It&#39;s nice to have a tick for every hour, but we only want to present values every &lt;strong&gt;4&lt;/strong&gt; hours.

Fortunately, we can provide with an unseen value: a space (URL encoded as &#39;&lt;strong&gt;+&lt;/strong&gt;&#39;). So we complicate things up a bit on the &lt;strong&gt;chxl&lt;/strong&gt; to read:
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  CONCAT(
    &#39;http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,&#39;,
    ROUND(min_value, 1), &#39;,&#39;,
    ROUND(max_value, 1),
    &#39;&amp;amp;chd=s:&#39;,
    GROUP_CONCAT(
      IF(
        data IS NULL,
        &#39;_&#39;,
        SUBSTRING(
          &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;,
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR &#39;&#39;
    ),
   &#39;&amp;amp;chxs=0,505050,10,0,lt&#39;,
   &#39;&amp;amp;chxl=0:|&#39;,
    &lt;strong&gt;GROUP_CONCAT(&lt;/strong&gt;
&lt;strong&gt;      IF(&lt;/strong&gt;
&lt;strong&gt;        MINUTE(ts) = 0,&lt;/strong&gt;
&lt;strong&gt;        IF(&lt;/strong&gt;
&lt;strong&gt;          HOUR(ts) MOD 4 = 0,&lt;/strong&gt;
&lt;strong&gt;          DATE_FORMAT(ts, &#39;%H:%i&#39;),&lt;/strong&gt;
&lt;strong&gt;          &#39;+&#39;&lt;/strong&gt;
&lt;strong&gt;        ),&lt;/strong&gt;
&lt;strong&gt;        NULL&lt;/strong&gt;
&lt;strong&gt;      )&lt;/strong&gt;
&lt;strong&gt;      SEPARATOR &#39;|&#39;&lt;/strong&gt;
&lt;strong&gt;    )&lt;/strong&gt;
  ) FROM chart_data, chart_data_minmax&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;and get:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre /&gt;&lt;img class=&#34;alignnone&#34; title=&#34;SQL line chart&#34; src=&#34;/blog/blog/assets/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0&amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chxl=0:|00:00|+|+|+|04:00|+|+|+|08:00|+|+|+|12:00|+|+|+|16:00|+|+|+|20:00|+|+|+&#34; alt=&#34;&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;
http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0&amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chxl=0:|00:00|+|+|+|04:00|+|+|+|08:00|+|+|+|12:00|+|+|+|16:00|+|+|+|20:00|+|+|+

&lt;/blockquote&gt;
&lt;h4&gt;OK, I cheated&lt;/h4&gt;
Who says sample data starts with a round hour? We have that hidden assumption here, since the first tick is necessarily a round hour in our code. Yet our data may start at &lt;strong&gt;12:35&lt;/strong&gt;, for example. Sorry, you&#39;ll have to dig into &lt;a href=&#34;http://code.google.com/p/mycheckpoint/source/browse/trunk/src/mycheckpoint.py&#34;&gt;mycheckpoint&#39;s source code&lt;/a&gt; to see a thorough solution. It&#39;s just too much for this post.
&lt;h4&gt;Grids&lt;/h4&gt;
Let&#39;s wrap this up with grids. Grids work by specifying the step size (in percent of overall height/width) and initial offset (again, in percent).

Wouldn&#39;t it be nicer if grids were automatically attached to ticks? I mean, REALLY! What were those guys thinking? (I know, they&#39;re doing great work. Keep it up!)

Problem is, I have no idea how Google chooses to distribute values on the y-axis. I don&#39;t know where y-axis ticks will be placed. So on y-axis, I just choose to split charts to &lt;strong&gt;4&lt;/strong&gt; even parts, and draw horizontal grids between them. Percent is &lt;strong&gt;25&lt;/strong&gt; (&lt;strong&gt;100/4&lt;/strong&gt;), offset is &lt;strong&gt;0&lt;/strong&gt;.

But I do have control over the x-axis. In our case, I know how many ticks we&#39;ll be having. Plus, I made life easier by assuming we start with a round hour, so no offset is required.

Umm... How many ticks do we have? Easy: the number of round hours. This can be calculated by: &lt;strong&gt;SUM(MINUTE(ts) = 0&lt;/strong&gt;. Actually, we need to take &lt;strong&gt;1&lt;/strong&gt; off.

We now build the &lt;a href=&#34;http://code.google.com/apis/chart/docs/chart_params.html#gcharts_grid_lines&#34;&gt;&lt;strong&gt;chg&lt;/strong&gt;&lt;/a&gt; parameter:
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  CONCAT(
    &#39;http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,&#39;,
    ROUND(min_value, 1), &#39;,&#39;,
    ROUND(max_value, 1),
    &#39;&amp;amp;chd=s:&#39;,
    GROUP_CONCAT(
      IF(
        data IS NULL,
        &#39;_&#39;,
        SUBSTRING(
          &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;,
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR &#39;&#39;
    ),
   &#39;&amp;amp;chxs=0,505050,10,0,lt&#39;,
   &#39;&amp;amp;chxl=0:|&#39;,
    GROUP_CONCAT(
      IF(
        MINUTE(ts) = 0,
        IF(
          HOUR(ts) MOD 4 = 0,
          DATE_FORMAT(ts, &#39;%H:%i&#39;),
          &#39;+&#39;
        ),
        NULL
      )
      SEPARATOR &#39;|&#39;
    ),
   &lt;strong&gt;&#39;&amp;amp;chg=&#39;, ROUND(100.0/((SUM(MINUTE(ts) = 0) -1)), 2), &#39;,25,1,2,0,0&#39;&lt;/strong&gt;
  ) FROM chart_data, chart_data_minmax
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;and get:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre /&gt;&lt;img class=&#34;alignnone&#34; title=&#34;SQL line chart&#34; src=&#34;/blog/blog/assets/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0&amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chxl=0:|00:00|+|+|+|04:00|+|+|+|08:00|+|+|+|12:00|+|+|+|16:00|+|+|+|20:00|+|+|+&amp;amp;chg=4.35,25,1,2,0,0&#34; alt=&#34;&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;&lt;br /&gt;
http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0&amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chxl=0:|00:00|+|+|+|04:00|+|+|+|08:00|+|+|+|12:00|+|+|+|16:00|+|+|+|20:00|+|+|+&amp;amp;chg=4.35,25,1,2,0,0&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Phew!&lt;/p&gt;
&lt;h4&gt;Conclusion&lt;/h4&gt;
&lt;p&gt;So we haven&#39;t worked on offsets. And, this is a single line chart. What about multiple lines? Legend? The following chart:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre /&gt;&lt;img class=&#34;alignnone&#34; title=&#34;SQL multi line chart&#34; src=&#34;/blog/blog/assets/chart?cht=lc&amp;amp;chs=370x180&amp;amp;chts=303030,12&amp;amp;chtt=Latest+24+hours:+Nov+9,+05:50++-++Nov+10,+05:50&amp;amp;chf=c,s,ffffff&amp;amp;chdl=com_select_psec|com_insert_psec|com_delete_psec|com_update_psec|com_replace_psec&amp;amp;chdlp=b&amp;amp;chco=ff8c00,4682b4,9acd32,dc143c,9932cc&amp;amp;chd=s:RTOSRORPNSSORROQTNQQMQRPQSOMUMPQOQUNRUQPUPSRQPUPSTRPQPPQQQQPPURPSQKUQPUQPUTPUQRUTRSRRWTRURRUPQUQSWTSUSOUURTRUTSPSRPPRMRRPRROQSNPQNPPSSRMQPQPQNRQV,MMMRQMPMNPOLOLLORLPOLQSLPRNNUNNQOPSNOQMNRNNPNMRMOQNNNOMNNLOPLPNNOOJPMMOOKRTMPONQNNQOLOMLOMLOKPXNMPMOOMKNNMPNMY976eMMRNQOOMKLOMKLKMMNKMOIPRJPMJMNK,EEDEEDEEDEFEEEDEFEEEDEFEEFEDEEEFEEEEEFEEEFEFEEFEEFEDEEEFEEEEEFEEEEEEFFEFFFEEEFFFFEEEFFFEEEEFDEEEEFFEEEEEFEEFFPx0xXFEEDEFEEEDEFEEEDEFEEEDEEDEEDEFF,FFEFFEFEEFFEFEEFFEFFEFGDEFDEFDEFEEGEEFEEFEEFEEFEEFEEEEEFEEFFDFEEFFDFEEFFEFEEFEEFEEFFDFEEFEDFEEFEEFDEFEDFEEFFENGDFEEFEEFEEFEEFFEFEEEFEFEEEFDFEEFGE,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&amp;amp;chxt=x,y&amp;amp;chxr=1,0,356.830000&amp;amp;chxl=0:|+||08:00||+||12:00||+||16:00||+||20:00||+||00:00||+||04:00||&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chg=4.17,25,1,2,0.69,0&amp;amp;chxp=0,0.69,4.86,9.03,13.20,17.37,21.54,25.71,29.88,34.05,38.22,42.39,46.56,50.73,54.90,59.07,63.24,67.41,71.58,75.75,79.92,84.09,88.26,92.43,96.60&amp;amp;tsstart=2010-11-09+05:50:00&amp;amp;tsstep=600&#34; alt=&#34;&#34; width=&#34;370&#34; height=&#34;180&#34; /&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;is harder to achieve. I&#39;m leaving this up to you!&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Generating Google line charts with SQL, part I</title>
      <link>/blog/mysql/generating-google-line-charts-with-sql-part-i/</link>
      <pubDate>Tue, 01 Feb 2011 10:29:31 +0000</pubDate>
      
      <guid>/blog/mysql/generating-google-line-charts-with-sql-part-i/</guid>
      <description>&lt;p&gt;In this series of posts I wish to show how &lt;a href=&#34;http://code.google.com/apis/chart/image_charts.html&#34;&gt;Google Charts&lt;/a&gt; can be generated via SQL. We discuss the Google Charts limitations which must be challenged, and work towards a simple chart.&lt;/p&gt;
&lt;p&gt;I&#39;m going to present the algorithm I use in &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint&#34;&gt;mycheckpoint&lt;/a&gt;, a MySQL monitoring utility, which generates Google charts by raw data using views. An example of such chart follows:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre /&gt;&lt;img class=&#34;alignnone&#34; title=&#34;Sample Google Chart&#34; src=&#34;/blog/blog/assets/chart?cht=lc&amp;amp;chs=370x180&amp;amp;chts=303030,12&amp;amp;chtt=Latest+24+hours:+Nov+9,+05:50++-++Nov+10,+05:50&amp;amp;chf=c,s,ffffff&amp;amp;chdl=Rentals+rate:+custom_1_psec&amp;amp;chdlp=b&amp;amp;chco=ff8c00&amp;amp;chd=s:GDGKGFLFGMJHRLMPPNULJRPLTOPRUMYPPVRNbQUSUSbSNWUOfSWTObVSUVWSVYVPbTPjfTbRTdXReUWhcTQRQZbTWYVYPaVZXdYYWPTabYUTbW99QLgLNIOIRNNMIKRJEHGFHGJGGFIFDFGDK&amp;amp;chxt=x,y&amp;amp;chxr=1,0,8.720000&amp;amp;chxl=0:|+||08:00||+||12:00||+||16:00||+||20:00||+||00:00||+||04:00||&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chg=4.17,25,1,2,0.69,0&amp;amp;chxp=0,0.69,4.86,9.03,13.20,17.37,21.54,25.71,29.88,34.05,38.22,42.39,46.56,50.73,54.90,59.07,63.24,67.41,71.58,75.75,79.92,84.09,88.26,92.43,96.60&amp;amp;tsstart=2010-11-09+05:50:00&amp;amp;tsstep=600&#34; alt=&#34;&#34; width=&#34;370&#34; height=&#34;180&#34; /&gt;
http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=370x180&amp;amp;chts=303030,12&amp;amp;chtt=Latest+24+hours:+Nov+9,+05:50++-++Nov+10,+05:50&amp;amp;chf=c,s,ffffff&amp;amp;chdl=Rentals+rate:+custom_1_psec&amp;amp;chdlp=b&amp;amp;chco=ff8c00&amp;amp;chd=s:GDGKGFLFGMJHRLMPPNULJRPLTOPRUMYPPVRNbQUSUSbSNWUOfSWTObVSUVWSVYVPbTPjfTbRTdXReUWhcTQRQZbTWYVYPaVZXdYYWPTabYUTbW99QLgLNIOIRNNMIKRJEHGFHGJGGFIFDFGDK&amp;amp;chxt=x,y&amp;amp;chxr=1,0,8.720000&amp;amp;chxl=0:|+||08:00||+||12:00||+||16:00||+||20:00||+||00:00||+||04:00||&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chg=4.17,25,1,2,0.69,0&amp;amp;chxp=0,0.69,4.86,9.03,13.20,17.37,21.54,25.71,29.88,34.05,38.22,42.39,46.56,50.73,54.90,59.07,63.24,67.41,71.58,75.75,79.92,84.09,88.26,92.43,96.60&amp;amp;tsstart=2010-11-09+05:50:00&amp;amp;tsstep=600
&lt;/blockquote&gt;
&lt;em&gt;mycheckpoint&lt;/em&gt; does not actually call on Google to do the chart rendering, but invokes its own JavaScript code to visualize the URL locally.

Here are some downsides for using Google charts:
&lt;ul&gt;
	&lt;li&gt;The URL cannot be as long as you like. 2048 characters is an upper bound you&#39;ll want to keep behind. &lt;em&gt;[Google charts POST method calls are available, which leads to 16K equivalent of URL length -- this is still not too helpful due to the nature of POST calls]&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;Features are inconsistent. To specify label or tick positions, one must specify exact positions. To specify grid positions, one must supply with step, offset, etc. There are more such inconsistencies.&lt;/li&gt;
	&lt;li&gt;Google charts are not too friendly. Taking the ticks and grids example from above, there really shouldn&#39;t be a reason why grids would not be automatically generated according to ticks definitions. But we are required to specify positions for the ticks as well as for the grids.&lt;/li&gt;
	&lt;li&gt;There is no support for time-series. One must translate time as x-axis values.&lt;/li&gt;
	&lt;li&gt;Perhaps most intimidating to many people: to generate a Google chart, once must send data to Google. Which is the main reason I used local JavaScript rendering.&lt;/li&gt;
&lt;/ul&gt;
Anyway, let&#39;s build a very simple chart. Since I will not cover everything in this post, we make for some relaxed conditions.&lt;!--more--&gt;
&lt;h4&gt;Sample data&lt;/h4&gt;
Consider the chart_data table, below:
&lt;blockquote&gt;
&lt;pre&gt;SELECT * FROM chart_data;
+-----+---------------------+-------------------+
| id  | ts                  | data              |
+-----+---------------------+-------------------+
|   1 | 2011-02-01 09:59:15 |  1.99666833293656 |
|   2 | 2011-02-01 09:59:15 |  7.94677323180245 |
|   3 | 2011-02-01 09:59:15 |  17.7312123996804 |
|   4 | 2011-02-01 09:59:15 |   31.153467384692 |
|   5 | 2011-02-01 09:59:15 |  47.9425538604203 |
|   6 | 2011-02-01 09:59:15 |  67.7570968074042 |
|   7 | 2011-02-01 09:59:15 |  90.1904762132767 |
|   8 | 2011-02-01 09:59:15 |  114.776974543924 |
|   9 | 2011-02-01 09:59:15 |  140.998843732947 |
|  10 | 2011-02-01 09:59:15 |  168.294196961579 |
|  11 | 2011-02-01 09:59:15 |  196.065619213516 |
|  12 | 2011-02-01 09:59:15 |  223.689380632134 |
|  13 | 2011-02-01 09:59:15 |   250.52512820847 |
...&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Find complete SQL script in &lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2011/02/google_charts.sql_.txt&#34;&gt;google_charts.sql&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;In the above table we assume the timestamp values are evenly distributed. This is because of the aforementioned fact that Google Charts do not support time-series. So, if the given timnestamps are not evenly distributed, or maybe some values are skipped, we must manually compensate for that. In &lt;em&gt;mycheckpoint&lt;/em&gt; I do that. In this blog post, we skip it.&lt;/p&gt;
&lt;h4&gt;Axis boundaries&lt;/h4&gt;
&lt;p&gt;By default, Google Charts expect data to lie within the range 0..100. We need to reset the scale to match our minimum/maximum values, and lay out our values within that range.&lt;/p&gt;
&lt;p&gt;We will be using views in this solution, and here is the first view:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;CREATE OR REPLACE VIEW
 chart_data_minmax
AS
 SELECT MIN(data) AS min_value, MAX(data) AS max_value
FROM
 chart_data
;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;In our example we will just settle with the min/max values. In real worlds we may:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Choose &lt;strong&gt;0&lt;/strong&gt; to be the lower value, even if the minimal value is positive&lt;/li&gt;
&lt;li&gt;Choose to round min-max values to a nearest power of &lt;strong&gt;10&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The axis boundaries go under the following parameters:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;chxt=x,y&lt;/strong&gt; (we hard code bottom axis, left axis)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;chxr=1,&lt;em&gt;min&lt;/em&gt;,&lt;em&gt;max&lt;/em&gt;&lt;/strong&gt; (with min, max as computed by the above)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The following query produces these params:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT CONCAT(&#39;&amp;amp;chxt=x,y&amp;amp;chxr=1,&#39;, ROUND(min_value, 1), &#39;,&#39;, ROUND(max_value, 1)) AS minmax FROM chart_data_minmax;
+---------------------------------+
| minmax                          |
+---------------------------------+
| &amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0 |
+---------------------------------+
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Data values&lt;/h3&gt;
&lt;p&gt;Next, we have some &lt;strong&gt;244&lt;/strong&gt; rows of data. Data is double. Can we be certain this all fits within &lt;strong&gt;2048&lt;/strong&gt; characters? What if we had more rows?&lt;/p&gt;
&lt;p&gt;Alas, we must make a trade-off. We will sacrifice accuracy in favor of a short URL. We will use &lt;a href=&#34;http://code.google.com/apis/chart/docs/data_formats.html#simple&#34;&gt;simple encoding&lt;/a&gt; for our data. This means just one character per value, encoded &lt;strong&gt;A-Za-z0-9&lt;/strong&gt;. This means just &lt;strong&gt;62&lt;/strong&gt; distinct values.&lt;/p&gt;
&lt;p&gt;So we must translate each data value into the range 0..61, and then into a character. First step is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT (data - min_value)/(max_value - min_value) AS range_01 FROM chart_data, chart_data_minmax;
+---------------------+
| range_01            |
+---------------------+
|   0.469204617275163 |
|   0.469796281944551 |
|   0.470769223945374 |
|   0.472103901937297 |
|   0.473773369865649 |
|   0.475743682188048 |
|   0.477974405550919 |
...
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The above translates the data into the 0..1 range. Next is to simply multiply by 61:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT 61*(data - min_value)/(max_value - min_value) AS range_0_61 FROM chart_data, chart_data_minmax;
+-------------------+
| range_0_61        |
+-------------------+
|  28.6214816537849 |
|  28.6575731986176 |
|  28.7169226606678 |
|  28.7983380181751 |
|  28.9001755618046 |
|  29.0203646134709 |
|  29.1564387386061 |
|  29.3055730348683 |
|  29.4646269983728 |
|  29.6301923928522 |
...&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;To translate into a &lt;em&gt;simple format&lt;/em&gt; character we parse a constant string:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  SUBSTRING(
    &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;,
    1+61*(data - min_value)/(max_value - min_value),
    1
  ) AS c FROM chart_data, chart_data_minmax;
+------+
| c    |
+------+
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| e    |
| e    |
...&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Oh, and we should handle NULLs, as well, so:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  IF(
    data IS NULL,
    &#39;_&#39;,
    SUBSTRING(
      &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;,
      1+61*(data - min_value)/(max_value - min_value),
      1
    )
  ) AS c FROM chart_data, chart_data_minmax;
&lt;/pre&gt;
&lt;pre&gt;+------+
| c    |
+------+
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| e    |
| e    |
...&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;And, to present it as a char sequence, we use the &lt;strong&gt;chd&lt;/strong&gt; parameter and call &lt;strong&gt;GROUP_CONCAT&lt;/strong&gt; to the rescue:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  CONCAT(&#39;&amp;amp;chd=s:&#39;,
    GROUP_CONCAT(
      IF(
        data IS NULL,
        &#39;_&#39;,
        SUBSTRING(
          &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;,
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR &#39;&#39;
    )
  ) AS c FROM chart_data, chart_data_minmax
\G
*************************** 1. row ***************************
c: &amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Wrap up&lt;/h4&gt;
&lt;p&gt;Combining the above two queries, with some URL necessities, we get:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  CONCAT(
    &#39;http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,&#39;,
    ROUND(min_value, 1), &#39;,&#39;,
    ROUND(max_value, 1),
    &#39;&amp;amp;chd=s:&#39;,
    GROUP_CONCAT(
      IF(
        data IS NULL,
        &#39;_&#39;,
        SUBSTRING(
          &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#39;,
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR &#39;&#39;
    )
  ) FROM chart_data, chart_data_minmax
;
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;And get:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre /&gt;&lt;img class=&#34;alignnone&#34; title=&#34;Sample SQL Google Chart&#34; src=&#34;/blog/blog/assets/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0&amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&#34; alt=&#34;&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;&lt;br /&gt;
http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chtt=SQL%20chart&amp;amp;chxt=x,y&amp;amp;chxr=1,-4716.6,5340.0&amp;amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The above chart depicts our visualized data. Alas, x-axis ranges are wrong; no ticks nor grids are yet presented.&lt;/p&gt;
&lt;p&gt;Granularity is not the best, either: the different &lt;strong&gt;62&lt;/strong&gt; values are spread across a &lt;strong&gt;200&lt;/strong&gt; pixel high chart, making for a &lt;strong&gt;3&lt;/strong&gt; pixel distinction between two values, evident on the left area of the chart.&lt;/p&gt;
&lt;p&gt;Continues on &lt;a href=&#34;http://code.openark.org/blog/mysql/generating-google-line-charts-with-sql-part-ii&#34;&gt;Generating Google line charts with SQL, part II&lt;/a&gt;.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>mycheckpoint (rev. 170): improved custom queries; local charting; page/swap I/O monitoring; improved HTML reports</title>
      <link>/blog/mysql/mycheckpoint-rev-170-improved-custom-queries-local-charting-pageswap-io-monitoring-improved-html-reports/</link>
      <pubDate>Fri, 16 Jul 2010 10:58:40 +0000</pubDate>
      
      <guid>/blog/mysql/mycheckpoint-rev-170-improved-custom-queries-local-charting-pageswap-io-monitoring-improved-html-reports/</guid>
      <description>&lt;p&gt;Revision &lt;strong&gt;170&lt;/strong&gt; of &lt;a href=&#34;../../forge/mycheckpoint&#34;&gt;mycheckpoint&lt;/a&gt;, a MySQL monitoring solution, has  been released. New and updated in this revision:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Improved custom queries&lt;/strong&gt;: lifting of limitations from previous, introductory revision; better HTML presentation&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Local, inline charting&lt;/strong&gt;: no rendering of Google Charts, unless explicitly requested. All charts are now rendered locally using JavaScript. No data is now sent over the network.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Page/Swap I/O monitoring&lt;/strong&gt;: now monitoring for page ins and outs, swap ins and outs (Linux only).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Improved HTML reports&lt;/strong&gt;: several improvements on presentation (see &lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-brief-169.html&#34;&gt;sample&lt;/a&gt;, more follow).&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Improved custom queries&lt;/h4&gt;
&lt;p&gt;Some limitations, introduced in revision &lt;strong&gt;132&lt;/strong&gt;, are now lifted. New features are introduced.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There is now no limit to the number of custom queries (well, an INT limit).&lt;/li&gt;
&lt;li&gt;In fact, the data tables adjust themselves to the existing custom queries in the form of auto-deploy: once a new &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint/documentation/custom-monitoring&#34;&gt;custom query is added&lt;/a&gt; or an old one removed, mycheckpoint will add or remove the relevant columns from the data tables.&lt;/li&gt;
&lt;li&gt;The &lt;strong&gt;chart_order&lt;/strong&gt; column is now utilized: HTML reports which include custom query charts now order those charts according to &lt;strong&gt;chart_order&lt;/strong&gt; values. This makes for nicer reports.&lt;/li&gt;
&lt;li&gt;The standard &lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-brief-169.html&#34;&gt;HTML brief report&lt;/a&gt; (&lt;strong&gt;SELECT html FROM sv_report_html_brief&lt;/strong&gt;) now automatically includes all custom charts. The HTML brief report is the report one usually wants to look at: it provides with the latest 24 hours metrics for selected values. It now becomes a centralized place for all that is interesting in the past 24 hours.&lt;/li&gt;
&lt;li&gt;Custom queries are now allowed to return &lt;strong&gt;NULL&lt;/strong&gt;, treated as a missing value. This is a bugfix from previous revisions.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Local charting&lt;/h4&gt;
&lt;p&gt;Motivation for local charting is clear: no one likes having their data being sent over the network. And no one likes Google to know about their DML values.&lt;/p&gt;
&lt;p&gt;I&#39;ve been playing around with quite a few charting solutions, and have gone into depths with two of them, adding and rewriting quite a lot of code. Eventually, I settled on my very own rendering. Here&#39;s what I&#39;ve seen &amp;amp; tested:&lt;!--more--&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://danvk.org/dygraphs/&#34;&gt;dygraphs&lt;/a&gt;: a very nice time series charting library. I&#39;ve presented a use case on &lt;a href=&#34;http://code.openark.org/blog/mysql/static-charts-vs-interactive-charts&#34;&gt;a previous post&lt;/a&gt;.
&lt;ul&gt;
&lt;li&gt;Pros: slick, easy to work with.&lt;/li&gt;
&lt;li&gt;Cons: uses HTML Canvas for rendering. This is fine on Firefox, Chrome, Safari, you name it. This isn&#39;t fine on IE, which does not support Canvas. There&#39;s &lt;a href=&#34;http://excanvas.sourceforge.net/&#34;&gt;ExplorerCanvas&lt;/a&gt;, a hack tool which converts canvas to IE&#39;s VML, but it is far from being satisfactory: it is &lt;em&gt;sloooow&lt;/em&gt;. Very, very slow. It is slow with one chart; but loading of 21 charts, as I do in some of &lt;em&gt;mycheckpoint&lt;/em&gt;&#39;s reports can take &lt;em&gt;long minutes&lt;/em&gt; on Internet explorer.&lt;/li&gt;
&lt;li&gt;Cons: Only provides with a time series chart. No scatter plots.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Because they&#39;re using ExplorerCanvas for IE, &lt;a href=&#34;http://code.google.com/p/flot/&#34;&gt;flot&lt;/a&gt;, &lt;a href=&#34;http://www.jqplot.com/&#34;&gt;jqPlot&lt;/a&gt; etc., are all unacceptable.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://g.raphaeljs.com/&#34;&gt;gRaphael&lt;/a&gt;: very slick charts based on Raphael. The original line charts are very basic, and I have invested a lot of time rewriting a great deal (you can find it all &lt;a href=&#34;http://code.google.com/p/mycheckpoint/source/browse/#svn/trunk/graphael&#34;&gt;here&lt;/a&gt;). Raphael uses VML on IE, and SVG for all other browsers.
&lt;ul&gt;
&lt;li&gt;Pros: very slick. Supports various chart types, including line (though not time-series) and scatter.&lt;/li&gt;
&lt;li&gt;Cons: &lt;em&gt;slooooooooow&lt;/em&gt; when instantiating multiple charts. Unbearably slow, both on Firefox and IE. Slow as in minutes of waiting.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In addition, all of the above solutions were quite heavyweight: at about 45KB to start with, then add ExplorerCanvas or jQuery, or Raphael as supporting libraries, these became a real burden.&lt;/p&gt;
&lt;p&gt;So, I had some time to spare (business is fine, thank you. I was a bit Ill. I&#39;m feeling well now, thank you), and was upset what with all the time I invested in the above coding. And I decided to invest even more time, and build &lt;em&gt;my own&lt;/em&gt; charts.&lt;/p&gt;
&lt;p&gt;Enter &lt;em&gt;openark-charts&lt;/em&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2010/07/mycheckpoint-report-html-screenshot.png&#34; /&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img class=&#34;alignnone size-full wp-image-2662&#34; title=&#34;mycheckpoint-report-html-screenshot&#34; src=&#34;/blog/blog/assets/mycheckpoint-report-html-screenshot.png&#34; alt=&#34;&#34; width=&#34;808&#34; height=&#34;307&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2010/07/mycheckpoint-24-7-report-html-screenshot.png&#34;&gt;&lt;img class=&#34;alignnone size-full wp-image-2663&#34; title=&#34;mycheckpoint-24-7-report-html-screenshot&#34; src=&#34;/blog/blog/assets/mycheckpoint-24-7-report-html-screenshot.png&#34; alt=&#34;&#34; width=&#34;808&#34; height=&#34;267&#34; /&gt;&lt;/a&gt;
&lt;/blockquote&gt;
&lt;p&gt;Currently, these line charts and scatter charts know how to parse a Google Image chart URL (only some features supported -- only those I&#39;m actually using with &lt;em&gt;mycheckpoint&lt;/em&gt;). These are not full blown solutions: they come to serve mycheckpoint. And they do so nicely, if I may say so. Using Canvas for most browsers, or VML for IE, these very small pieces of code (10K for line chart, 6K for scatter chart, minified) load fast, use very little memory, and do their work well.&lt;/p&gt;
&lt;p&gt;Granted, neither provides with interactive features: this is planned for the future.&lt;/p&gt;
&lt;h4&gt;Page/swap I/O monitoring&lt;/h4&gt;
&lt;p&gt;(Linux only) &lt;em&gt;mycheckpoint&lt;/em&gt; now reads &lt;strong&gt;/proc/vmstat&lt;/strong&gt; to get the &lt;em&gt;pageins&lt;/em&gt;, &lt;em&gt;pageouts&lt;/em&gt;, &lt;em&gt;swapins&lt;/em&gt; and &lt;em&gt;swapouts&lt;/em&gt; (since last reboot). I was actually looking at completely different places on the &lt;strong&gt;/proc&lt;/strong&gt; file system to get swap info, and was frustrated with the complexity involved, till I bumped on &lt;strong&gt;/proc/vmstat&lt;/strong&gt;... New tricks every day!&lt;/p&gt;
&lt;h4&gt;Improved HTML reports&lt;/h4&gt;
&lt;p&gt;This is mostly HTML make-up. Some minimal design, some more details thrown into the HTML pages (name of DB, MySQL version, &lt;em&gt;mycheckpoint&lt;/em&gt; version). A little more verbosity; all sorts of stuff which was neglected so far.&lt;/p&gt;
&lt;p&gt;Here are some &lt;span style=&#34;text-decoration: line-through;&#34;&gt;&lt;strong&gt;show off&lt;/strong&gt;&lt;/span&gt; examples of the new HTML views: &lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-full-169.html&#34;&gt;[full report]&lt;/a&gt;, &lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-brief-169.html&#34;&gt;[brief report]&lt;/a&gt;, &lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-24-7-169.html&#34;&gt;[24/7 report]&lt;/a&gt;, &lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-custom-full-169.html&#34;&gt;[custom full report]&lt;/a&gt;, &lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-custom-brief-169.html&#34;&gt;[custom brief report]&lt;/a&gt;, &lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-alert-pending-169.html&#34;&gt;[alert pending report]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;All HTML views now utilize the new &lt;em&gt;openark-charts&lt;/em&gt;, and none renders charts with Google charts. This means when you &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint/documentation/generating-html-reports&#34;&gt;use your HTML view&lt;/a&gt;, your data is safe. No data is sent over the net. All charts are rendered using Javascript, which is loaded and executed locally.&lt;/p&gt;
&lt;p&gt;But if you like, there&#39;s a [url] link next to each chart, which leads to a (online) Google chart image. Why? Because neither HTML Canvas nor VML allow for a complete rendering of the charts to an image. So this is a way for one to retrieve &amp;amp; store a chart&#39;s image. Don&#39;t use it if you see no reason for it; it&#39;s just there.&lt;/p&gt;
&lt;p&gt;And I even threw in rounded corners (IE users: only as of Windows 7).&lt;/p&gt;
&lt;h4&gt;Future plans&lt;/h4&gt;
&lt;p&gt;Work is going on. These are the non-scheduled future tasks I see:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Monitoring InnoDB Plugin &amp;amp; XtraDB status.&lt;/li&gt;
&lt;li&gt;Interactive charts. See my &lt;a href=&#34;../mysql/static-charts-vs-interactive-charts&#34;&gt;earlier  post&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;A proper &lt;em&gt;man&lt;/em&gt; page.&lt;/li&gt;
&lt;li&gt;Anything else that interests me.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Try it out&lt;/h4&gt;
&lt;p&gt;Try out &lt;em&gt;mycheckpoint&lt;/em&gt;. It’s a different kind of monitoring  solution. You will need basic SQL skills, and in return you’ll get a lot  of power under your hands.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Download mycheckpoint &lt;a href=&#34;https://code.google.com/p/mycheckpoint/&#34;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Visit the project’s &lt;a href=&#34;../../forge/mycheckpoint&#34;&gt;homepage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Browse the &lt;a href=&#34;../../forge/mycheckpoint/documentation&#34;&gt;documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Report &lt;a href=&#34;https://code.google.com/p/mycheckpoint/issues/list&#34;&gt;bugs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;mycheckpoint&lt;/em&gt; is released under the &lt;a href=&#34;http://www.opensource.org/licenses/bsd-license.php&#34;&gt;New BSD  License&lt;/a&gt;.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>mycheckpoint (rev. 132): custom monitoring, custom charts, process list dump</title>
      <link>/blog/mysql/mycheckpoint-rev-132-custom-monitoring-custom-charts-process-list-dump/</link>
      <pubDate>Fri, 04 Jun 2010 11:17:27 +0000</pubDate>
      
      <guid>/blog/mysql/mycheckpoint-rev-132-custom-monitoring-custom-charts-process-list-dump/</guid>
      <description>&lt;p&gt;Revision &lt;strong&gt;132&lt;/strong&gt; of &lt;a href=&#34;../../forge/mycheckpoint&#34;&gt;mycheckpoint&lt;/a&gt; has been released. New and updated in this revision:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Custom monitoring: monitoring &amp;amp; charting for user defined queries&lt;/li&gt;
&lt;li&gt;HTML reports for custom monitoring&lt;/li&gt;
&lt;li&gt;Process list dump upon alert notifications&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Custom monitoring &amp;amp; charts&lt;/h4&gt;
&lt;p&gt;Custom monitoring allows the user to supply with a query, the results of which will be monitored.&lt;/p&gt;
&lt;p&gt;That is, &lt;em&gt;mycheckpoint&lt;/em&gt; monitors the status variables, replication status, OS metrics. But it cannot by itself monitor one&#39;s &lt;em&gt;application&lt;/em&gt;. Which is why a user may supply with such query as:&lt;/p&gt;
&lt;blockquote&gt;&lt;pre&gt;
SELECT COUNT(*) FROM shopping_cart WHERE is_pending=1
&lt;/pre&gt;&lt;/blockquote&gt;
&lt;p&gt;Such a query will tell an online store how many customers are in the midst of shopping. There is no argument that this number is worth monitoring for. Given the above query, &lt;em&gt;mycheckpoint&lt;/em&gt; will execute it per sample, and store the query&#39;s result along with all sampled data, to be then aggregated by complex views to answer for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What was the value per given sample?&lt;/li&gt;
&lt;li&gt;What is the value difference for each sample?&lt;/li&gt;
&lt;li&gt;What is the change per second, i.e. the rate?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;mycheckpoint goes one step forward, and explicity records another metric:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How much time did it take to take that sample?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;!--more--&gt;As another example, a query worth testing for rate:&lt;/p&gt;
&lt;blockquote&gt;&lt;pre&gt;
SELECT MAX(shopping_cart_id) FROM shopping_cart
&lt;/pre&gt;&lt;/blockquote&gt;
&lt;p&gt;The above will provide with the last id. Assuming this is &lt;strong&gt;AUTO_INCREMENT&lt;/strong&gt;, and assuming we&#39;re on &lt;strong&gt;auto_increment_increment=1&lt;/strong&gt;, two samples will allow us to get the number of created carts between those samples. Now, here&#39;s a metric I&#39;d like to read:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How many carts are created per second, for each hour of the day?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We get all these for free with mycheckpoint, which already does this analysis. All we need to provide is the query, and how we would like it to be visualized (visualization is optional, it is not the only way to diagnose monitored data) graphically:&lt;/p&gt;
&lt;blockquote&gt;&lt;pre&gt;
INSERT INTO
 custom_query (custom_query_id, enabled, query_eval, description, chart_type, chart_order)
 VALUES (0, 1, &#39;SELECT COUNT(*) FROM store.shopping_cart WHERE is_pending=1&#39;, &#39;Number of pending carts&#39;, &#39;value&#39;, 0);
INSERT INTO
 custom_query (custom_query_id, enabled, query_eval, description, chart_type, chart_order)
 VALUES (1, 1, &#39;SELECT MAX(shopping_cart_id) FROM store.shopping_cart&#39;, &#39;Created carts rate&#39;, &#39;value_psec&#39;, 0);
&lt;/pre&gt;&lt;/blockquote&gt;
&lt;p&gt;We can later query for these values, just like we do for normal monitored values:&lt;/p&gt;
&lt;blockquote&gt;&lt;pre&gt;
mysql&amp;gt; SELECT id, ts, created_tmp_tables_psec, custom_0, custom_1_psec FROM sv_sample WHERE ts &amp;gt;= NOW() - INTERVAL 1 HOUR;
+-------+---------------------+-------------------------+----------+---------------+
| id    | ts                  | created_tmp_tables_psec | custom_0 | custom_1_psec |
+-------+---------------------+-------------------------+----------+---------------+
| 50730 | 2010-05-21 19:05:01 |                   16.64 |      448 |          3.02 |
| 50731 | 2010-05-21 19:10:02 |                   20.97 |       89 |          1.73 |
| 50732 | 2010-05-21 19:15:01 |                   15.70 |      367 |          3.56 |
| 50733 | 2010-05-21 19:20:01 |                   18.32 |       54 |          1.43 |
| 50734 | 2010-05-21 19:25:01 |                   16.42 |       91 |          1.96 |
| 50735 | 2010-05-21 19:30:02 |                   21.93 |      233 |          2.11 |
| 50736 | 2010-05-21 19:35:02 |                   14.58 |      176 |          1.91 |
| 50737 | 2010-05-21 19:40:01 |                   21.61 |      168 |          1.93 |
| 50738 | 2010-05-21 19:45:01 |                   16.05 |      241 |          2.44 |
| 50739 | 2010-05-21 19:50:01 |                   19.70 |       46 |          1.19 |
| 50740 | 2010-05-21 19:55:01 |                   15.85 |      177 |          2.28 |
| 50741 | 2010-05-21 20:00:01 |                   19.04 |        8 |          0.82 |
+-------+---------------------+-------------------------+----------+---------------+
&lt;/pre&gt;&lt;/blockquote&gt;
&lt;p&gt;Of course, it is also possible to harness &lt;em&gt;mycheckpoint&lt;/em&gt;&#39;s views power to generate charts:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; SELECT custom_1_psec FROM sv_report_chart_sample\G
&lt;/pre&gt;
&lt;img class=&#34;alignnone&#34; title=&#34;custom_1_psec&#34; src=&#34;/blog/blog/assets/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chts=303030,12&amp;amp;chtt=Latest+24+hours:+May+19,+20:10++-++May+20,+20:10&amp;amp;chf=c,s,ffffff&amp;amp;chdl=custom_1_psec&amp;amp;chdlp=b&amp;amp;chco=ff8c00&amp;amp;chd=s:QfXQmZQhXTmWVkWRobPpWUtQPVROaOOUMJPOKdJHQJFJEDJJEGCAIEFJHFFEGGDQHGJGMJPPMNZNRWR_ZUWfR_nSjuUcaXa3OgxRl4UivWZ5UhtWX4VgnUTYktiVW9WanUVxVYlgXwVdicXpb&amp;amp;chxt=x,y&amp;amp;chxr=1,0,5.120000&amp;amp;chxl=0:||+||00:00||+||04:00||+||08:00||+||12:00||+||16:00||+||20:00|&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chg=4.17,25,1,2,3.47,0&amp;amp;chxp=0,3.47,7.64,11.81,15.98,20.15,24.32,28.49,32.66,36.83,41.00,45.17,49.34,53.51,57.68,61.85,66.02,70.19,74.36,78.53,82.70,86.87,91.04,95.21,99.38&#34; alt=&#34;&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;
&lt;/blockquote&gt;
The rules are:
&lt;ul&gt;
&lt;li&gt;There can (currently) only be 18 custom queries.&lt;/li&gt;
&lt;li&gt;The &lt;strong&gt;custom_query_id&lt;/strong&gt; must range 0-17 (to be lifted soon).&lt;/li&gt;
&lt;li&gt;A custom query must return with &lt;em&gt;exactly&lt;/em&gt; one row, with &lt;em&gt;exactly&lt;/em&gt; one column, which is a kind of &lt;em&gt;integer&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
Please read &lt;a href=&#34;http://code.openark.org/blog/mysql/things-to-monitor-on-mysql-the-users-perspective&#34;&gt;my earlier post&lt;/a&gt; on custom monitoring to get more background.
&lt;h4&gt;Custom monitoring HTML reports&lt;/h4&gt;
Custom monitoring comes with a HTML reports, featuring requested charts. See a &lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2010/05/mcp_custom_report-128.html&#34;&gt;sample custom report&lt;/a&gt;.
In this sample report, a few queries are monitored for value (pending rentals, pending downloads) and a few for rates (downloads per second, emails per second etc.).
Custom HTML reports come in two flavors:
&lt;ul&gt;
&lt;li&gt;Brief reports, featuring last 24 hours, as in the example above. These are handled by the &lt;strong&gt;sv_custom_html_brief&lt;/strong&gt; view.&lt;/li&gt;
&lt;li&gt;Full reports, featuring last 24 hours, last 10 days, known history. These take longer to generate, and are handled by the &lt;strong&gt;sv_custom_html&lt;/strong&gt; view.&lt;/li&gt;
&lt;/ul&gt;
The sample report was generated by issuing:
&lt;blockquote&gt;
&lt;pre&gt;SELECT html FROM sv_custom_html_brief;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;I won&#39;t go into details here as for how this view generates the HTML code. There is a myriad of view dependencies, with many interesting tricks on the way. But do remember it&#39;s &lt;em&gt;just a view&lt;/em&gt;. You don&#39;t need an application (not even &lt;em&gt;mycheckpoint&lt;/em&gt; itself) to generate the report. All it takes is a query.&lt;/p&gt;
&lt;h4&gt;Processlist dump&lt;/h4&gt;
&lt;p&gt;When an alert notification fires (an email is prepared to inform on some alert condition), a processlist dump summary is taken and included in email report. It may be useful to understand why the slave is lagging, or exactly why there are so many active threads.&lt;/p&gt;
&lt;p&gt;The dump summary presents the processlist much as you would see it on SHOW PROCESSLIST, but only lists the active threads, noting down how many sleeping processes there are (PS, thread &amp;amp; process are the same in the terminology of MySQL connections). An example dump looks like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;PROCESSLIST summary:

     Id: 3
   User: system user
   Host:
     db: NULL
Command: Connect
   Time: 3168098
  State: Waiting for master to send event
   Info: NULL
-------

     Id: 4
   User: system user
   Host:
     db: prod_db
Command: Connect
   Time: 612
  State: Updating
   Info: UPDATE user SET is_offline = 1 WHERE id IN (50440010,50440011)
-------

     Id: 8916579
   User: prod_user
   Host: localhost
     db: prod_db
Command: Query
   Time: 1
  State: Sending data
   Info: INSERT IGNORE INTO archive.stat_archive (id, origin, path, ts, content
-------

     Id: 8916629
   User: mycheckpoint
   Host: localhost
     db: NULL
Command: Query
   Time: 0
  State: NULL
   Info: SHOW PROCESSLIST
-------
Sleeping: 3 processes
&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Future plans&lt;/h4&gt;
&lt;p&gt;Work is going on. These are the non-scheduled future tasks I see:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Monitoring InnoDB Plugin &amp;amp; XtraDB status.&lt;/li&gt;
&lt;li&gt;Interactive charts. See my &lt;a href=&#34;http://code.openark.org/blog/mysql/static-charts-vs-interactive-charts&#34;&gt;earlier post&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Monitoring for swap activity (Linux only).&lt;/li&gt;
&lt;li&gt;Enhanced custom queries handling, including auto-deploy upon change of custom queries.&lt;/li&gt;
&lt;li&gt;A proper &lt;em&gt;man&lt;/em&gt; page.&lt;/li&gt;
&lt;li&gt;Anything else that interests me.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Try it out&lt;/h4&gt;
&lt;p&gt;Try out &lt;em&gt;mycheckpoint&lt;/em&gt;. It’s a different kind of monitoring solution. You will need basic SQL skills, and in return you&#39;ll get a lot of power under your hands.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Download mycheckpoint &lt;a href=&#34;https://code.google.com/p/mycheckpoint/&#34;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Visit the project’s &lt;a href=&#34;../../forge/mycheckpoint&#34;&gt;homepage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Browse the &lt;a href=&#34;../../forge/mycheckpoint/documentation&#34;&gt;documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Report &lt;a href=&#34;https://code.google.com/p/mycheckpoint/issues/list&#34;&gt;bugs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;mycheckpoint&lt;/em&gt; is released under the &lt;a href=&#34;http://www.opensource.org/licenses/bsd-license.php&#34;&gt;New BSD License&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Static charts vs. interactive charts</title>
      <link>/blog/mysql/static-charts-vs-interactive-charts/</link>
      <pubDate>Tue, 02 Mar 2010 15:28:08 +0000</pubDate>
      
      <guid>/blog/mysql/static-charts-vs-interactive-charts/</guid>
      <description>&lt;p&gt;I&#39;m having my usual fun with charts. Working on &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint&#34;&gt;mycheckpoint&lt;/a&gt;, I&#39;ve generated monitoring charts using the &lt;a href=&#34;http://code.google.com/apis/chart/image_charts.html&#34;&gt;Google Chars API&lt;/a&gt;. But I&#39;ve also had chance to experiment and deploy interactive charts, JavaScript based. In particular, I used and tweaked &lt;a href=&#34;http://www.danvk.org/dygraphs/&#34;&gt;dygraphs&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I&#39;d like to note some differences in using charts of both kinds. And I think it makes a very big difference.&lt;/p&gt;
&lt;h4&gt;Static charts&lt;/h4&gt;
&lt;p&gt;I&#39;ll call any image-based chart by &#34;static chart&#34;. It&#39;s just a static image. Example of such charts are those generated by Google Image Charts (they now also have new, interactive charts), or &lt;a href=&#34;http://oss.oetiker.ch/rrdtool/index.en.html&#34;&gt;RRDtool&lt;/a&gt;. Show below is an example of a static chart; in this example, generated by Google:&lt;!--more--&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre /&gt;&lt;img class=&#34;alignnone&#34; src=&#34;/blog/blog/assets/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chts=808080,12&amp;amp;chtt=Dec+4,+15:00++-++Dec+5,+15:00&amp;amp;chf=c,s,ffffff&amp;amp;chdl=com_select_psec|com_insert_psec|com_delete_psec|com_update_psec|com_replace_psec&amp;amp;chdlp=b&amp;amp;chco=ff8c00,4682b4,9acd32,dc143c,9932cc&amp;amp;chd=s:zpvxszxsxur11p1xt10wyxzuyv6xw4yx3x041x2zz6zvz7y91x23z4niqkkmojllkhknhlgnmimohilkkqgkkmnmhlljinjmnhmo________________imlnpmkukopmnpjsojnrrlrqnpprs,iZagVcgWXaZdjVbgSbhYdXZXZcbcXZbcadabccabbZaaZeabdYbbZXceWUXaXYXSXVXaSSZUUXWYUUXbTYUUVabWWVZZVYaWZZYa________________ZYbVcXWdYWZcXaYaYWXYfZcdaVZaZ,MNNNNNONLKOMPNNMNNOPMNNLMQNOMMMNMNNNNRONNOPMNQMPONPOLMTNKJKMKKJILKILJJJLIIKUMHJJIIHHHKJIIHIIIHJHIIJM________________NOMLMMLOPOPKLKKNPKMMNMOPQNNOL,NIIMHKOIHKIKOHKMGKNJKIJIKMKLJJMKIKJKLLJLLJLLKMLJLJKKKIIVIIJLJKJHJIKLIHMIIKIKIIKLHKIIJLKIJJKKIJKIKKJK________________IIKILJJLKIKKHJJJJIJJMIKLKGJKK,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA________________AAAAAAAAAAAAAAAAAAAAAAAAAAAAA&amp;amp;chxt=x,y&amp;amp;chxr=1,0,136.620000&amp;amp;chxl=0:||16:00||+||20:00||+||00:00||+||04:00||+||08:00||+||12:00||+||&amp;amp;chxs=0,505050,10,0,lt&amp;amp;chg=4.17,25,1,2,0.00,0&amp;amp;chxp=0,0.00,4.17,8.34,12.51,16.68,20.85,25.02,29.19,33.36,37.53,41.70,45.87,50.04,54.21,58.38,62.55,66.72,70.89,75.06,79.23,83.40,87.57,91.74,95.91,100.08&#34; alt=&#34;&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Pros and cons of static charts&lt;/h4&gt;
Pros
&lt;ul&gt;
	&lt;li&gt;Images can be viewed on any graphical platform. Browsers, email clients, cell phones, whatever.&lt;/li&gt;
	&lt;li&gt;Self contained: chart image, legend, scales: all in one image.&lt;/li&gt;
	&lt;li&gt;As such, easy to move around.&lt;/li&gt;
	&lt;li&gt;Are safe to use.&lt;/li&gt;
&lt;/ul&gt;
Cons
&lt;ul&gt;
	&lt;li&gt;Images are fuzzy. Is the &lt;strong&gt;com_replace_psec&lt;/strong&gt; really 0? Maybe it&#39;s 0.1? A larger value can make lower values hard to tell.&lt;/li&gt;
	&lt;li&gt;Images are inaccurate: the colors can lie. The red and green lines showing are hard to tell apart. The red is painted above the green. Data gets &#34;lost&#34;.&lt;/li&gt;
	&lt;li&gt;They do not zoom (one needs to regenerate larger image)&lt;/li&gt;
	&lt;li&gt;Unless encoded with base64, HTML pages which include images need to link outside.&lt;/li&gt;
	&lt;li&gt;In the particular case of Google Charts, one is limited to 2K length URL. Trust me, it&#39;s a big limitation! (PS, Google now support POST method to allow for up to 16K. But... it&#39;s a POST method...)&lt;/li&gt;
	&lt;li&gt;In the particular case of Google Charts, one must have an internet connection.&lt;/li&gt;
	&lt;li&gt;In the particular case of Google Charts, one must submit data to Google.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Interactive charts&lt;/h4&gt;
Interactive charts are those which react to your commands. These are either JavaScript or Flash based, mostly. They allow for really nice features. Take the following chart as an example: try and &lt;strong&gt;move over with your mouse&lt;/strong&gt;; or &lt;strong&gt;select sections to zoom in&lt;/strong&gt;.

&lt;script src=&#34;http://code.openark.org/blog/wp-content/uploads/2010/03/dygraph-combined.js&#34; type=&#34;text/javascript&#34;&gt;&lt;/script&gt;
&lt;!--[if IE]&gt;&lt;script src=&#34;http://code.openark.org/blog/wp-content/uploads/2010/03/excanvas-min.js&#34;&gt;&lt;/script&gt;&lt; ![endif]--&gt;

&lt;blockquote&gt;
&lt;pre&gt;
&lt;/pre&gt;
&lt;h4&gt;DML&lt;/h4&gt;
&lt;div id=&#34;graphDiv_DML&#34; class=&#34;graphdiv&#34; style=&#34;width: 400px; height: 160px;&#34;&gt;[graphDiv]&lt;/div&gt;
&lt;div id=&#34;labelsDiv_DML&#34; class=&#34;legend&#34;&gt;[labelsDiv]&lt;/div&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;script type=&#34;text/javascript&#34;&gt;// &lt; ![CDATA[&lt;br /&gt;
// &lt; ![CDATA[&lt;br /&gt;
 g_DML = new Dygraph( document.getElementById(&#34;graphDiv_DML&#34;),                         &#34;Date,com_select_psec,com_insert_psec,com_delete_psec,com_update_psec,com_replace_psec\n2009-12-04 15:00:00,113.28,76.54,26.14,29.54,0.00\n2009-12-04 15:10:00,91.51,55.74,30.07,18.13,0.00\n2009-12-04 15:20:00,104.98,57.75,28.26,18.24,0.00\n2009-12-04 15:30:00,110.64,72.17,30.17,27.58,0.00\n2009-12-04 15:40:00,97.79,46.27,29.27,15.91,0.00\n2009-12-04 15:50:00,114.35,61.85,29.55,22.45,0.00\n2009-12-04 16:00:00,110.82,72.38,30.67,30.70,0.00\n2009-12-04 16:10:00,99.05,49.70,29.35,18.56,0.00\n2009-12-04 16:20:00,109.68,50.87,25.74,16.55,0.00\n2009-12-04 16:30:00,103.92,58.70,22.09,22.58,0.00\n2009-12-04 16:40:00,97.24,56.29,31.71,18.78,0.00\n2009-12-04 16:50:00,119.25,65.72,27.80,22.56,0.00\n2009-12-04 17:00:00,118.31,78.34,34.18,30.43,0.00\n2009-12-04 17:10:00,91.06,47.59,29.66,16.60,0.00\n2009-12-04 17:20:00,117.81,59.82,28.94,21.40,0.00\n2009-12-04 17:30:00,109.79,71.37,27.62,27.64,0.00\n2009-12-04 17:40:00,101.07,40.51,29.57,14.18,0.00\n2009-12-04 17:50:00,117.66,61.18,28.31,22.44,0.00\n2009-12-04 18:00:00,115.48,72.82,32.12,28.74,0.00\n2009-12-04 18:10:00,106.51,54.34,32.96,20.37,0.00\n2009-12-04 18:20:00,111.34,65.11,27.60,22.60,0.00\n2009-12-04 18:30:00,109.66,52.25,29.47,18.47,0.00\n2009-12-04 18:40:00,113.63,55.16,28.67,19.98,0.00\n2009-12-04 18:50:00,103.72,51.86,24.67,18.08,0.00\n2009-12-04 19:00:00,111.27,55.78,26.66,22.62,0.00\n2009-12-04 19:10:00,105.73,63.16,35.37,25.88,0.00\n2009-12-04 19:20:00,130.50,60.07,29.82,22.99,0.00\n2009-12-04 19:30:00,110.41,62.64,30.35,24.46,0.00\n2009-12-04 19:40:00,107.05,52.04,27.15,19.22,0.00\n2009-12-04 19:50:00,126.11,57.06,27.12,19.34,0.00\n2009-12-04 20:00:00,111.36,61.40,26.13,25.96,0.00\n2009-12-04 20:10:00,108.82,61.97,29.52,23.49,0.00\n2009-12-04 20:20:00,122.57,59.28,26.03,18.48,0.00\n2009-12-04 20:30:00,109.35,65.42,29.21,23.13,0.00\n2009-12-04 20:40:00,117.19,57.69,28.01,19.24,0.00\n2009-12-04 20:50:00,125.03,61.15,28.95,21.74,0.00\n2009-12-04 21:00:00,118.31,63.11,29.66,23.99,0.00\n2009-12-04 21:10:00,109.98,62.24,38.77,24.02,0.00\n2009-12-04 21:20:00,121.28,57.78,30.48,20.26,0.00\n2009-12-04 21:30:00,113.89,59.62,29.77,23.72,0.00\n2009-12-04 21:40:00,113.93,60.42,29.35,24.71,0.00\n2009-12-04 21:50:00,130.36,55.68,31.94,21.16,0.00\n2009-12-04 22:00:00,114.11,58.93,32.62,24.41,0.00\n2009-12-04 22:10:00,105.52,58.58,26.04,24.47,0.00\n2009-12-04 22:20:00,113.52,57.04,29.26,22.28,0.00\n2009-12-04 22:30:00,132.64,66.22,34.87,26.82,0.00\n2009-12-04 22:40:00,112.08,59.19,27.16,23.73,0.00\n2009-12-04 22:50:00,136.62,59.74,33.41,20.04,0.00\n2009-12-04 23:00:00,119.58,65.67,31.40,24.40,0.00\n2009-12-04 23:10:00,109.12,53.74,28.38,19.60,0.00\n2009-12-04 23:20:00,121.52,60.03,33.16,22.38,0.00\n2009-12-04 23:30:00,123.33,59.59,31.09,22.51,0.00\n2009-12-04 23:40:00,114.75,56.82,25.53,23.43,0.00\n2009-12-04 23:50:00,124.92,51.26,27.86,19.03,0.00\n2009-12-05 00:00:00,88.23,63.21,41.50,18.59,0.00\n2009-12-05 00:10:00,75.10,66.62,29.94,48.01,0.00\n2009-12-05 00:20:00,94.85,49.27,22.05,18.66,0.00\n2009-12-05 00:30:00,80.27,45.21,20.56,17.55,0.00\n2009-12-05 00:40:00,80.96,52.03,21.66,21.14,0.00\n2009-12-05 00:50:00,85.21,57.68,26.57,23.58,0.00\n2009-12-05 01:00:00,88.66,52.56,21.75,20.94,0.00\n2009-12-05 01:10:00,78.66,53.26,22.89,22.36,0.00\n2009-12-05 01:20:00,83.80,50.74,20.65,19.49,0.00\n2009-12-05 01:30:00,82.70,39.99,17.23,15.86,0.00\n2009-12-05 01:40:00,79.66,52.35,23.55,20.94,0.00\n2009-12-05 01:50:00,74.56,47.64,23.05,18.97,0.00\n2009-12-05 02:00:00,81.25,51.35,17.94,21.61,0.00\n2009-12-05 02:10:00,86.83,58.48,25.03,24.95,0.00\n2009-12-05 02:20:00,73.31,41.39,21.09,17.56,0.00\n2009-12-05 02:30:00,82.31,39.70,19.84,16.74,0.00\n2009-12-05 02:40:00,71.19,55.84,19.05,25.97,0.00\n2009-12-05 02:50:00,88.00,44.13,25.32,17.74,0.00\n2009-12-05 03:00:00,84.54,44.78,18.42,18.78,0.00\n2009-12-05 03:10:00,76.92,50.57,17.91,21.81,0.00\n2009-12-05 03:20:00,84.45,49.12,21.54,18.58,0.00\n2009-12-05 03:30:00,89.52,54.20,45.41,22.39,0.00\n2009-12-05 03:40:00,74.15,44.67,26.54,18.04,0.00\n2009-12-05 03:50:00,76.32,44.36,15.02,18.39,0.00\n2009-12-05 04:00:00,83.90,52.30,19.50,22.39,0.00\n2009-12-05 04:10:00,80.26,61.12,20.66,25.68,0.00\n2009-12-05 04:20:00,80.95,42.11,16.95,14.84,0.00\n2009-12-05 04:30:00,93.01,53.36,17.91,21.94,0.00\n2009-12-05 04:40:00,72.70,45.22,16.63,18.16,0.00\n2009-12-05 04:50:00,81.22,44.73,15.41,18.54,0.00\n2009-12-05 05:00:00,80.02,46.60,16.07,21.04,0.00\n2009-12-05 05:10:00,84.33,57.86,21.77,24.71,0.00\n2009-12-05 05:20:00,87.48,60.54,19.66,22.95,0.00\n2009-12-05 05:30:00,86.19,48.62,18.47,17.51,0.00\n2009-12-05 05:40:00,72.92,50.10,18.46,21.00,0.00\n2009-12-05 05:50:00,81.79,48.14,15.75,19.36,0.00\n2009-12-05 06:00:00,83.11,55.70,17.15,23.02,0.00\n2009-12-05 06:10:00,77.98,55.89,18.36,23.16,0.00\n2009-12-05 06:20:00,77.05,45.96,18.06,17.27,0.00\n2009-12-05 06:30:00,87.58,53.76,15.56,20.79,0.00\n2009-12-05 06:40:00,79.33,58.86,21.02,22.84,0.00\n2009-12-05 06:50:00,85.33,49.99,16.23,18.82,0.00\n2009-12-05 07:00:00,87.54,56.70,17.96,23.31,0.00\n2009-12-05 07:10:00,73.33,56.51,17.57,21.74,0.00\n2009-12-05 07:20:00,84.02,52.77,21.21,20.80,0.00\n2009-12-05 07:30:00,88.86,58.34,27.45,23.10,0.00\n2009-12-05 07:40:00,,,,,\n2009-12-05 07:50:00,,,,,\n2009-12-05 08:00:00,,,,,\n2009-12-05 08:10:00,,,,,\n2009-12-05 08:20:00,,,,,\n2009-12-05 08:30:00,,,,,\n2009-12-05 08:40:00,,,,,\n2009-12-05 08:50:00,,,,,\n2009-12-05 09:00:00,,,,,\n2009-12-05 09:10:00,,,,,\n2009-12-05 09:20:00,,,,,\n2009-12-05 09:30:00,,,,,\n2009-12-05 09:40:00,,,,,\n2009-12-05 09:50:00,,,,,\n2009-12-05 10:00:00,,,,,\n2009-12-05 10:10:00,,,,,\n2009-12-05 10:20:00,77.11,55.87,29.31,18.09,0.00\n2009-12-05 10:30:00,85.31,53.70,31.03,18.46,0.00\n2009-12-05 10:40:00,82.72,61.32,26.30,22.98,0.00\n2009-12-05 10:50:00,87.28,46.53,25.04,18.04,0.00\n2009-12-05 11:00:00,92.07,62.62,27.09,25.14,0.00\n2009-12-05 11:10:00,84.59,50.42,25.97,19.96,0.00\n2009-12-05 11:20:00,80.34,49.64,25.75,20.31,0.00\n2009-12-05 11:30:00,103.61,64.36,31.79,24.71,0.00\n2009-12-05 11:40:00,80.03,54.33,33.83,22.37,0.00\n2009-12-05 11:50:00,90.42,48.24,31.26,18.43,0.00\n2009-12-05 12:00:00,92.51,56.34,33.53,22.45,0.00\n2009-12-05 12:10:00,84.34,62.26,22.66,23.31,0.00\n2009-12-05 12:20:00,86.24,51.96,25.69,16.02,0.00\n2009-12-05 12:30:00,92.08,58.61,23.16,19.34,0.00\n2009-12-05 12:40:00,78.48,53.33,22.72,19.51,0.00\n2009-12-05 12:50:00,97.85,57.71,29.80,20.19,0.00\n2009-12-05 13:00:00,89.23,54.84,34.62,20.93,0.00\n2009-12-05 13:10:00,78.92,50.02,22.47,18.19,0.00\n2009-12-05 13:20:00,87.24,50.92,26.37,19.38,0.00\n2009-12-05 13:30:00,96.29,54.78,27.13,20.04,0.00\n2009-12-05 13:40:00,96.39,69.48,30.21,27.19,0.00\n2009-12-05 13:50:00,83.21,55.13,26.48,18.00,0.00\n2009-12-05 14:00:00,97.00,63.61,30.89,22.23,0.00\n2009-12-05 14:10:00,94.65,65.33,33.51,25.04,0.00\n2009-12-05 14:20:00,86.94,58.14,36.10,22.07,0.00\n2009-12-05 14:30:00,91.91,47.25,28.41,14.45,0.00\n2009-12-05 14:40:00,92.55,55.73,29.59,20.69,0.00\n2009-12-05 14:50:00,97.35,58.90,31.63,22.22,0.00\n2009-12-05 15:00:00,97.91,56.09,23.80,21.68,0.00\n&#34;,                         { chartDiv:  document.getElementById(&#34;chartDiv_DML&#34;), labelsDiv: document.getElementById(&#34;labelsDiv_DML&#34;) } ); g_DML.resize(400,160);&lt;br /&gt;
// ]]&gt;&lt;/script&gt;&lt;/p&gt;
&lt;p&gt;The above chart is generated with &lt;em&gt;dygraphs&lt;/em&gt;. Since it is embedded within my Wordpress page, the layout is affected by that of my theme. Take a look at this &lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2010/03/mycheckpoint_interactive_demo.html&#34;&gt;&lt;strong&gt;example page&lt;/strong&gt;&lt;/a&gt; to see similar charts outside this blog site (Internet Explorer users: Maxmimize/minimize button will not work well for now. And, may I suggest &lt;a href=&#34;http://www.mozilla.com/en-US/firefox&#34;&gt;Mozilla Firefox&lt;/a&gt;?)&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2010/03/mycheckpoint_interactive_demo.html&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;Pros and cons of interactive charts&lt;/h4&gt;
&lt;p&gt;Pros&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Can present you with exact values. No more doubt about the &lt;strong&gt;com_replace_psec&lt;/strong&gt; values.&lt;/li&gt;
&lt;li&gt;Can allow for zoom in, zoom out.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cons&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Need supporting platform. The above cannot be viewed by non-JavaScript browsers (cell phones, etc.)&lt;/li&gt;
&lt;li&gt;Browser support is also an issue with JavaScript.&lt;/li&gt;
&lt;li&gt;Emailing such report will result in mail blocking in many companies: mail filters will not allow for JavaScript code to pass.&lt;/li&gt;
&lt;li&gt;Charts are not necessarily self-contained, in terms of the chart entity With Flash charts (e.g. Fusion Charts) this works. But in the above, the legend and scales are outside the image. As such, they cannot be just moved around.&lt;/li&gt;
&lt;li&gt;HTML pages which include such charts &lt;em&gt;can be&lt;/em&gt; self contained. The HTML page can include all the JavaScript dependencies, in addition to the chart generating code. Flash based charts cannot be self contained.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Summary&lt;/h4&gt;
&lt;p&gt;Interactive charts are cool!&lt;/p&gt;
&lt;p&gt;I&#39;m now integrating &lt;a href=&#34;http://www.danvk.org/dygraphs/&#34;&gt;dygraphs&lt;/a&gt; into &lt;em&gt;mycheckpoint&lt;/em&gt; (How nice it is to work with BSD &amp;amp; MIT licenses!). Though I may later switch to &lt;a href=&#34;http://code.google.com/p/flot/&#34;&gt;flot&lt;/a&gt;, interactive charts will be the next standard charting way in &lt;em&gt;mycheckpoint&lt;/em&gt;. I will continue supporting static Google Charts, as follows from the above pros and cons list.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>mycheckpoint (rev. 88): mount points monitoring, improved charting, enhanced auto-deploy</title>
      <link>/blog/mysql/mycheckpoint-rev-88-mount-points-monitoring-improved-charting-enhanced-auto-deploy/</link>
      <pubDate>Wed, 10 Feb 2010 08:29:47 +0000</pubDate>
      
      <guid>/blog/mysql/mycheckpoint-rev-88-mount-points-monitoring-improved-charting-enhanced-auto-deploy/</guid>
      <description>&lt;p&gt;Revision &lt;a href=&#34;http://code.google.com/p/mycheckpoint/&#34;&gt;#88&lt;/a&gt; of &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint&#34;&gt;mycheckpoint&lt;/a&gt; is released. In this revision:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Disk space monitoring&lt;/li&gt;
&lt;li&gt;Improved charting&lt;/li&gt;
&lt;li&gt;Enhanced auto-deploy&lt;/li&gt;
&lt;li&gt;And more...&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Disk space monitoring&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;mycheckpoint&lt;/em&gt; now monitors (on Linux only) three mount points:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The &#34;&lt;strong&gt;/&lt;/strong&gt;&#34; (root) mount point&lt;/li&gt;
&lt;li&gt;The &lt;strong&gt;datadir&lt;/strong&gt; mount point&lt;/li&gt;
&lt;li&gt;The &lt;strong&gt;tmpdir&lt;/strong&gt; mount point&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;It may well be the case that two of the above (or perhaps all three of them) share the same mount point. For example, if there isn&#39;t any particular partition for &#34;&lt;strong&gt;/tmp&lt;/strong&gt;&#34;, it is possible that the &lt;strong&gt;tmpdir&lt;/strong&gt; (by default &#34;&lt;strong&gt;/tmp&lt;/strong&gt;&#34;) is on the same mount point as &#34;&lt;strong&gt;/&lt;/strong&gt;&#34;. &lt;em&gt;mycheckpoint&lt;/em&gt; does not care.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;mycheckpoint&lt;/em&gt; monitors and reports the mount point&#39;s used percent, in a similar algorithm &lt;strong&gt;df&lt;/strong&gt; uses.&lt;/p&gt;
&lt;p&gt;Disk space monitoring is only possible when monitoring the local machine (i.e. &lt;em&gt;mycheckpoint&lt;/em&gt; runs on the same machine as the monitored MySQL server). In the future &lt;em&gt;mycheckpoint&lt;/em&gt; may also monitor additional mount points, such as the various logs mount points.&lt;/p&gt;
&lt;h4&gt;&lt;!--more--&gt;Improved charting&lt;/h4&gt;
&lt;p&gt;There has been some extensive work to turn the charts into real time-series based. &lt;a href=&#34;http://code.google.com/apis/chart/&#34;&gt;Google charts&lt;/a&gt; does not support time series charts; when it will, the required URL length would probably be too long to be used. Some SQL tweaks made it possible to display the charts in correct time-scale even if sampling is taken on non constant interval (or fail to be taken for long periods).&lt;/p&gt;
&lt;blockquote&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2010/02/mycheckpoint-dml-chart-sample-88.png&#34;&gt;&lt;img class=&#34;alignnone size-full wp-image-1951&#34; title=&#34;mycheckpoint-dml-chart-sample-88&#34; src=&#34;/blog/blog/assets/mycheckpoint-dml-chart-sample-88.png&#34; alt=&#34;&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;For more examples see the link for &lt;em&gt;HTML brief reports&lt;/em&gt; sample, below.&lt;/p&gt;
&lt;p&gt;I will write more on SQL Google charts generation in the future.&lt;/p&gt;
&lt;h4&gt;Enhanced auto-deploy&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;mycheckpoint&lt;/em&gt; will now detect changes to the MySQL version, in addition to changes in &lt;em&gt;mycheckpoint&lt;/em&gt;&#39;s version itself. This means there&#39;s no need in ever worrying about upgrades to either one of these components. Just use mycheckpoint to take another sample; it will auto-detect if the MySQL version is different, and start sampling all those new variables introduced in the new version (or stop sampling variables no longer used). It works both for MySQL upgrades and downgrades.&lt;/p&gt;
&lt;h4&gt;Enhanced localhost detection&lt;/h4&gt;
&lt;p&gt;To determine whether it is monitoring the local host, &lt;em&gt;mycheckpoint&lt;/em&gt; now considers the hostname for the monitored server, and sees if it is either &lt;strong&gt;&#39;127.0.0.1&#39;&lt;/strong&gt;, &lt;strong&gt;&#39;localhost&#39;&lt;/strong&gt;, or the machine&#39;s &lt;em&gt;hostname&lt;/em&gt; or fully qualified &lt;em&gt;hostname.domainname&lt;/em&gt; (these last two additions apply for Unix based machines, and have only been tested on Linux so far).&lt;/p&gt;
&lt;h4&gt;HTML brief reports&lt;/h4&gt;
&lt;p&gt;Getting a full HTML report is time consuming. I&#39;ve had requests (though not officially submitted through the Issues mechanism) to make it shorter. This is as yet a difficult job. There&#39;s just too much data to aggregate (up to ~180 days of every-5-minute-samples, in a common scenario).&lt;/p&gt;
&lt;p&gt;HTML &lt;em&gt;brief reports&lt;/em&gt; were introduced in previous versions, and have now been enhanced to include more data. These only present last 24 hours data, and load fast. See &lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2010/02/mycheckpoint-brief-report-sample-88.html&#34;&gt;HTML brief report sample&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Get it&lt;/h4&gt;
&lt;p&gt;Downloads are available on Google code&#39;s &lt;a href=&#34;http://code.google.com/p/mycheckpoint/&#34;&gt;mycheckpoint&lt;/a&gt; page. Documentation can be found on the &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint/&#34;&gt;mycheckpoint home page&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;On the press&lt;/h4&gt;
&lt;p&gt;Not so new by now (it&#39;s two months old), I&#39;m very happy that mycheckpoint has been noted by &lt;a href=&#34;http://jeremy.zawodny.com/blog/&#34;&gt;&lt;strong&gt;Jeremy Zawodny&lt;/strong&gt;&lt;/a&gt; in his &#34;&lt;a href=&#34;http://www.linux-mag.com/cache/7639/1.html&#34;&gt;My Top Resources of 2009&lt;/a&gt;&#34; column on Linux Magazine.&lt;/p&gt;
&lt;h4&gt;Future plans&lt;/h4&gt;
&lt;p&gt;Immediate plans for mycheckpoint are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Email alerts notifications; this will allow &lt;em&gt;mycheckpoint&lt;/em&gt; to become a real monitoring solution. Following the concept of &#34;&lt;em&gt;SQL oritented monitoring&lt;/em&gt;&#34;, these will be SQL based as well.&lt;/li&gt;
&lt;li&gt;Custom monitoring: allowing user defined queries to be recorded by &lt;em&gt;mycheckpoint&lt;/em&gt;; these can then participate in alerts monitoring. This will allow for easy email notifications on program-level errors.&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>mycheckpoint rev. 76: OS monitoring, auto deploy, brief HTML and 24/7 reports</title>
      <link>/blog/mysql/mycheckpoint-rev-76-os-monitoring-auto-deploy-brief-html-and-247-reports/</link>
      <pubDate>Tue, 05 Jan 2010 10:55:14 +0000</pubDate>
      
      <guid>/blog/mysql/mycheckpoint-rev-76-os-monitoring-auto-deploy-brief-html-and-247-reports/</guid>
      <description>&lt;p&gt;Revision &lt;strong&gt;76&lt;/strong&gt; of &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint&#34;&gt;mycheckpoint&lt;/a&gt; comes with quite a few improvements, including:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OS monitoring (CPU, load average, memory)&lt;/li&gt;
&lt;li&gt;Auto-deploy&lt;/li&gt;
&lt;li&gt;Improved charting&lt;/li&gt;
&lt;li&gt;Brief HTML reports&lt;/li&gt;
&lt;li&gt;24/7 charts&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;OS Monitoring&lt;/h4&gt;
&lt;p&gt;When monitoring the local machine, &lt;em&gt;mycheckpoint&lt;/em&gt; now monitors CPU utilization, load average, memory and swap space.&lt;/p&gt;
&lt;p&gt;This only applies to the Linux operating system; there is currently no plan to work this out for other operating systems.&lt;/p&gt;
&lt;p&gt;Examples:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; SELECT &lt;strong&gt;os_cpu_utilization_percent&lt;/strong&gt; FROM sv_report_chart_sample;

&lt;/pre&gt;
&lt;img class=&#34;size-full wp-image-1794 alignnone&#34; title=&#34;mycheckpoint-chart-cpu-sample&#34; src=&#34;/blog/blog/assets/mycheckpoint-chart-cpu-sample.png&#34; alt=&#34;mycheckpoint-chart-cpu-sample&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; SELECT ts, &lt;strong&gt;os_loadavg&lt;/strong&gt; FROM mycheckpoint.sv_report_sample;
+---------------------+------------+
| 2009-12-27 11:45:01 |       1.78 |
| 2009-12-27 11:50:01 |       2.48 |
| 2009-12-27 11:55:01 |       2.35 |
...
+---------------------+------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; SELECT report FROM mycheckpoint.sv_report_human_sample ORDER BY id DESC LIMIT 1 \G
*************************** 1. row ***************************
report:
Report period: 2009-12-27 13:20:01 to 2009-12-27 13:25:01. Period is 5 minutes (0.08 hours)
Uptime: 100.0% (Up: 334 days, 06:37:28 hours)

&lt;strong&gt;OS:
 Load average: 1.67
 CPU utilization: 25.2%
 Memory: 7486.4MB used out of 7985.6484MB (Active: 6685.8906MB)
 Swap: 3835.2MB used out of 8189.3750MB&lt;/strong&gt;
...&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Auto-deploy&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;mycheckpoint&lt;/em&gt; now has a version recognition mechanism. There is no need to call &lt;em&gt;mycheckpoint&lt;/em&gt; with the &#34;&lt;strong&gt;deploy&lt;/strong&gt;&#34; argument on first install or after upgrade. &lt;em&gt;mycheckpoint&lt;/em&gt; will recognize a change of version and will auto-deploy before moving on to monitoring your system.&lt;/p&gt;
&lt;p&gt;&lt;!--more--&gt;It is still possible, though, to use &#34;&lt;strong&gt;deploy&lt;/strong&gt;&#34;, in case you just want to make sure an upgrade takes place, without issuing a monitoring action.&lt;/p&gt;
&lt;h4&gt;Improved charting&lt;/h4&gt;
&lt;p&gt;Further improvements and bug fixes made to the Google charts, including the implementation of missing values charting.&lt;/p&gt;
&lt;h4&gt;Brief HTML report&lt;/h4&gt;
&lt;p&gt;In contrast with the full blown HTML report (see &lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2009/12/mycheckpoint_report-72.html&#34;&gt;sample&lt;/a&gt;), which presents hourly/daily/weekly reports for the many metrics, the new brief report only presents with a few hourly based charts. These include InnoDB performance, DML, OS metrics, and replication status.&lt;/p&gt;
&lt;p&gt;To get a brief HTML report, issue:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; SELECT html FROM sv_report_html_brief;

&lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2009/12/mycheckpoint-brief-report.html&#34; /&gt;&lt;/pre&gt;
&lt;img class=&#34;alignnone size-full wp-image-1839&#34; title=&#34;mycehckpoint-report-html-brief-screenshot-small&#34; src=&#34;/blog/blog/assets/mycehckpoint-report-html-brief-screenshot-small2.png&#34; alt=&#34;&#34; width=&#34;611&#34; height=&#34;409&#34; /&gt;
&lt;/blockquote&gt;
See &lt;a href=&#34;http://code.openark.org/forge/wp-content/uploads/2009/12/mycheckpoint-brief-report.html&#34;&gt;sample brief HTML report&lt;/a&gt;.
&lt;h4&gt;24/7 charts&lt;/h4&gt;
24/7 charts present the various metrics on a 24x7 matrix, which allows for diagnostics of usage throughout the day and week. For example, it makes it easier to see how things slow down on Saturday/Sunday; how load increases on 10:00am every day, etc.
24/7 charts are provided by the &lt;strong&gt;sv_report_chart_24_7&lt;/strong&gt; view.
&lt;blockquote&gt;
&lt;pre&gt;DESC sv_report_chart_24_7;
+---------------------------------------+----------+------+-----+---------+-------+
| Field                                 | Type     | Null | Key | Default | Extra |
+---------------------------------------+----------+------+-----+---------+-------+
| innodb_read_hit_percent               | longblob | YES  |     | NULL    |       |
| innodb_buffer_pool_reads_psec         | longblob | YES  |     | NULL    |       |
| innodb_buffer_pool_pages_flushed_psec | longblob | YES  |     | NULL    |       |
| innodb_os_log_written_psec            | longblob | YES  |     | NULL    |       |
| innodb_row_lock_waits_psec            | longblob | YES  |     | NULL    |       |
| mega_bytes_sent_psec                  | longblob | YES  |     | NULL    |       |
| mega_bytes_received_psec              | longblob | YES  |     | NULL    |       |
| key_read_hit_percent                  | longblob | YES  |     | NULL    |       |
| key_write_hit_percent                 | longblob | YES  |     | NULL    |       |
| com_select_psec                       | longblob | YES  |     | NULL    |       |
| com_insert_psec                       | longblob | YES  |     | NULL    |       |
| com_delete_psec                       | longblob | YES  |     | NULL    |       |
| com_update_psec                       | longblob | YES  |     | NULL    |       |
| com_replace_psec                      | longblob | YES  |     | NULL    |       |
| com_set_option_percent                | longblob | YES  |     | NULL    |       |
| com_commit_percent                    | longblob | YES  |     | NULL    |       |
| slow_queries_percent                  | longblob | YES  |     | NULL    |       |
| select_scan_psec                      | longblob | YES  |     | NULL    |       |
| select_full_join_psec                 | longblob | YES  |     | NULL    |       |
| select_range_psec                     | longblob | YES  |     | NULL    |       |
| table_locks_waited_psec               | longblob | YES  |     | NULL    |       |
| opened_tables_psec                    | longblob | YES  |     | NULL    |       |
| created_tmp_tables_psec               | longblob | YES  |     | NULL    |       |
| created_tmp_disk_tables_psec          | longblob | YES  |     | NULL    |       |
| connections_psec                      | longblob | YES  |     | NULL    |       |
| aborted_connects_psec                 | longblob | YES  |     | NULL    |       |
| threads_created_psec                  | longblob | YES  |     | NULL    |       |
| seconds_behind_master                 | longblob | YES  |     | NULL    |       |
| os_loadavg                            | longblob | YES  |     | NULL    |       |
| os_cpu_utilization_percent            | longblob | YES  |     | NULL    |       |
| os_mem_used_mb                        | longblob | YES  |     | NULL    |       |
| os_mem_active_mb                      | longblob | YES  |     | NULL    |       |
| os_swap_used_mb                       | longblob | YES  |     | NULL    |       |
+---------------------------------------+----------+------+-----+---------+-------&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mysql&amp;gt; SELECT com_select_psec, innodb_buffer_pool_pages_flushed_psec FROM mycheckpoint.&lt;strong&gt;sv_report_chart_24_7&lt;/strong&gt; \G
&lt;/pre&gt;
&lt;p&gt;&lt;img class=&#34;alignnone size-full wp-image-1798&#34; title=&#34;mycheckpoint-chart-247-sample&#34; src=&#34;/blog/blog/assets/mycheckpoint-chart-247-sample1.png&#34; alt=&#34;mycheckpoint-chart-247-sample&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;&lt;br /&gt;
&lt;img class=&#34;alignnone size-full wp-image-1830&#34; title=&#34;mycheckpoint-24-7-chart-sample2&#34; src=&#34;/blog/blog/assets/mycheckpoint-24-7-chart-sample2.png&#34; alt=&#34;&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Trying mycheckpoint&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Get &lt;em&gt;mycheckpoint&lt;/em&gt; from the &lt;a href=&#34;https://code.google.com/p/mycheckpoint/&#34;&gt;mycheckpoint Google Code project page&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Read the &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint/documentation&#34;&gt;documentation&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Report &lt;a href=&#34;https://code.google.com/p/mycheckpoint/issues/list&#34;&gt;issues&lt;/a&gt;!&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Future plans&lt;/h4&gt;
&lt;p&gt;I haven&#39;t got any major immediate issues; planning on user customization of charts and HTML reports. Considering thresholds and alerting for the future.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>New and noteworthy in mycheckpoint (rev. 57)</title>
      <link>/blog/mysql/new-and-noteworthy-in-mycheckpoint-rev-57/</link>
      <pubDate>Wed, 16 Dec 2009 21:12:07 +0000</pubDate>
      
      <guid>/blog/mysql/new-and-noteworthy-in-mycheckpoint-rev-57/</guid>
      <description>&lt;p&gt;Rev. 57 of &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint&#34;&gt;mycheckpoint&lt;/a&gt; has been released and is available for &lt;a href=&#34;http://code.google.com/p/mycheckpoint/&#34;&gt;download&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;New and updated in this revision:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#Remote host monitoring&#34;&gt;Remote host monitoring&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#Improved charting&#34;&gt;Improved charting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#Flexible charting&#34;&gt;Flexible charting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#Fix to questions vs. queries issues&#34;&gt;Fix to questions vs. queries issues&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a name=&#34;Remote host monitoring&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;Remote host monitoring&lt;/h4&gt;
&lt;p&gt;It is now possible to monitor one host, while writing into another. Either or both could be remote hosts:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mycheckpoint --host=localhost --monitored-host=192.168.10.178&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The above monitors the MySQL server on 192.168.10.178, and writes down to localhost (to be queried later)&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;mycheckpoint --monitored-host=127.0.0.1 --host=192.168.10.178&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The above monitors the MySQL server on 127.0.0.1, and writes down to 192.168.10.178.&lt;/p&gt;
&lt;p&gt;&lt;!--more--&gt;As result of the above addition, binary logging for monitoring statements are now enabled by default. The previous solution, in which binary logging were disabled by default and the same schema was utilized by different servers was far from being a clean solution. &lt;em&gt;[Read more on &lt;a href=&#34;http://code.openark.org/forge/mycheckpoint/documentation/remote-multiple-hosts&#34;&gt;Remote &amp;amp; multiple hosts&lt;/a&gt; monitoring]&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;Improved charting&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;Improved charting&lt;/h4&gt;
&lt;p&gt;The google charts reports have been improved significantly. Here&#39;s how:&lt;/p&gt;
&lt;blockquote&gt;&lt;img class=&#34;size-full wp-image-1702&#34; title=&#34;Before&#34; src=&#34;/blog/blog/assets/chart-old-sample11.png&#34; alt=&#34;Before&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;&lt;img class=&#34;size-full wp-image-1703&#34; title=&#34;After&#34; src=&#34;/blog/blog/assets/chart-new-sample1.png&#34; alt=&#34;After&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;&lt;br /&gt;
&lt;strong&gt;Before&lt;/strong&gt; on left (or above), &lt;strong&gt;After&lt;/strong&gt; on right (or below)&lt;/blockquote&gt;
&lt;p&gt;And&lt;/p&gt;
&lt;blockquote&gt;&lt;img class=&#34;size-full wp-image-1708&#34; title=&#34;Before&#34; src=&#34;/blog/blog/assets/chart-old-sample2.png&#34; alt=&#34;Before&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;&lt;img class=&#34;size-full wp-image-1709&#34; title=&#34;After&#34; src=&#34;/blog/blog/assets/chart-new-sample2.png&#34; alt=&#34;After&#34; width=&#34;400&#34; height=&#34;200&#34; /&gt;&lt;br /&gt;
&lt;strong&gt;Before&lt;/strong&gt; on left (or above), &lt;strong&gt;After&lt;/strong&gt; on right (or below)&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;Recap&lt;/em&gt;: the charts are not stored anywhere; they are being calculated and generated by SQL queries &amp;amp; views, based on the raw data. For example, to generate the above, I do:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT innodb_estimated_log_mb_written_per_hour FROM sv_report_chart_sample\G
*************************** 1. row ***************************
innodb_estimated_log_mb_written_per_hour: http://chart.apis.google.com/chart?cht=lc&amp;amp;chs=400x200&amp;amp;chts=303030,12&amp;amp;chtt=Latest+24+hours:+Dec+8,+08:20++-++Dec+9,+08:20&amp;amp;chdl=innodb_estimated_log_mb_written_per_hour&amp;amp;chdlp=b&amp;amp;chco=ff8c00&amp;amp;chd=s:OQOTSPPQPSROUQMTRSQTPSURQTQQPSOSRTRRUTRRTSRRRSRSTRRQSURSUVRRXQTVRUTTVUTOYTXSYTTSYUSUTWUPRRPQSQRQTPPSPQMPPQOQMQPMOMOLQORNNPNRNNOPQOOMQQPNRNMNORQMSTQQPTPRUQVQTTVSURUVVVSSSVWQVUSTVSWSSUURWRVRTWdotpQNROPQRPQQMPLRO9PWNRPNNNPXUMLNNPQQPSONPLLNWXZTQROSQMOONQPLJNOOQQKMPSMMPLfPSSSRTUQSORSSRSPNRSQSQ&amp;amp;chxt=x,y&amp;amp;chxr=1,0,2708.0&amp;amp;chxl=0:|09:00||||13:00||||17:00||||21:00||||01:00||||05:00||||&amp;amp;chxs=0,505050,10&amp;amp;chg=4.17,25,1,3,2.78,0&amp;amp;chxp=0,2.78,6.95,11.12,15.29,19.46,23.63,27.80,31.97,36.14,40.31,44.48,48.65,52.82,56.99,61.16,65.33,69.50,73.67,77.84,82.01,86.18,90.35,94.52,98.69&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;If you thought I was going over the edge in &lt;a href=&#34;http://code.openark.org/blog/mysql/auto-scaling-scaled-sql-graphs-concluded&#34;&gt;Auto scaling, scaled SQL graphs concluded&lt;/a&gt; or &lt;a href=&#34;http://code.openark.org/blog/mysql/sql-pie-chart&#34;&gt;SQL pie chart&lt;/a&gt;, allow me to assure you: generation of the above charts using SQL &amp;amp; views is &lt;em&gt;SQL blasphemy&lt;/em&gt;. While cool, the Google Charts API does not do too much on its own, and expects the caller to do the math for putting in the grids, scales and labels (and though all of them are tightly related, they must all be explicitly specified). I&#39;ll write a later post on this.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;Flexible charting&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;Flexible charting&lt;/h4&gt;
&lt;p&gt;A new table, called &lt;strong&gt;charts_api&lt;/strong&gt;, is introduced. It contains one row, which lists charting configuration.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT * FROM charts_api;
+-------------+--------------+----------------------------------------------------------------+------------------------------------+
| chart_width | chart_height | simple_encoding                                                | service_url                        |
+-------------+--------------+----------------------------------------------------------------+------------------------------------+
|         400 |          200 | ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 | http://chart.apis.google.com/chart |
+-------------+--------------+----------------------------------------------------------------+------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;To change generated charts dimensions, simply update &lt;strong&gt;chart_width&lt;/strong&gt; or &lt;strong&gt;chart_height&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;To use other chart APIs, update &lt;strong&gt;service_url&lt;/strong&gt;. I&#39;ve tried out &lt;a href=&#34;http://www.jfree.org/eastwood/&#34;&gt;Eastwood Charts&lt;/a&gt;, a Java-based service, which implements the Google Charts API. There&#39;s still some stuff missing, such as the positioning of labels and grids; and it&#39;s slightly less polished (but configurable). But if you&#39;re concerned about sending requests to Google, it&#39;s a viable alternative.&lt;/p&gt;
&lt;p&gt;So, drop the WAR file into your &lt;a href=&#34;http://tomcat.apache.org/&#34;&gt;Tomcat&lt;/a&gt; / &lt;a href=&#34;http://www.jboss.org/&#34;&gt;JBoss&lt;/a&gt; / other j2ee server, then follow &lt;strong&gt;http://127.0.0.1/eastwood/chart?&lt;/strong&gt;...&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;Fix to questions vs. queries issues&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;Fix to questions vs. queries issues&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;mycheckpoint&lt;/em&gt; now correctly identifies whether to use &lt;a href=&#34;http://code.openark.org/blog/mysql/questions-or-queries&#34;&gt;questions or queries&lt;/a&gt; when analyzing DML queries. If you got some &lt;strong&gt;570%&lt;/strong&gt; for &lt;strong&gt;com_update&lt;/strong&gt; out of total queries and wondered about it, it should now be resolved to normal values.&lt;/p&gt;
&lt;h4&gt;On upgrading your current installation&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;Download &amp;amp; install via debian or python installers&lt;/li&gt;
&lt;li&gt;Issue &lt;em&gt;mycheckpoint&lt;/em&gt; once with &#34;deploy&#34; as argument&lt;/li&gt;
&lt;li&gt;Done&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;Future plans&lt;/h4&gt;
&lt;p&gt;I&#39;m working on 24x7 charting; minimal operating system monitoring; auto-detection and auto-deploy on version upgrade; and more.&lt;/p&gt;
&lt;p&gt;Stay tuned!&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>SQL multi line chart</title>
      <link>/blog/mysql/sql-multi-line-chart/</link>
      <pubDate>Tue, 03 Nov 2009 12:44:13 +0000</pubDate>
      
      <guid>/blog/mysql/sql-multi-line-chart/</guid>
      <description>&lt;p&gt;Time for another charting SQL query. I wish to present a single-query generated multi-line/area chart. I&#39;ll walk through some of the steps towards making this happen. By the end of this post I&#39;ll present some real-data charts, area charts and colored charts.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+---------+-----------------------------------------------------------------------------------+
| y_scale | chart                                                                             |
+---------+-----------------------------------------------------------------------------------+
| 1       | ****---------#######----------------------------------------*******--------###### |
| 0.88    | ----***---###-------##-----------------------------------***-------***---##------ |
| 0.75    | -------**#------------##-------------------------------**-------------*##-------- |
| 0.63    | ------##-*--------------##----------------------------*--------------##**-------- |
| 0.5     | -@@@@@@@@@@@@@@@----------#-----@@@@@@@@@@@@@@@@----**---------@@@@@@@@@@@@@@@@-- |
| 0.38    | ----#-------*--------------##----------------------*---------------#-------*----- |
| 0.25    | --##---------*---------------#--------------------*--------------##---------*---- |
| 0.13    | -#------------**--------------#-----------------**--------------#------------*--- |
| 0       | @---------------*--------------##--------------*---------------#--------------**- |
| -0.12   | -----------------*---------------#------------*--------------##-----------------* |
| -0.25   | ------------------*---------------#---------**--------------#-------------------- |
| -0.37   | -------------------**--------------#-------*---------------#--------------------- |
| -0.5    | ----------------@@@@@@@@@@@@@@@@----##----*-----@@@@@@@@@@@@@@@----------------@@ |
| -0.62   | ----------------------**--------------#-**--------------#------------------------ |
| -0.75   | ------------------------**------------**#-------------##------------------------- |
| -0.87   | --------------------------**-------***---###-------###--------------------------- |
| -1      | ----------------------------*******---------#######------------------------------ |
|         | v:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 0                                                                               8 |
|         |     # sin(x)                                                                      |
|         |     * cos(x)                                                                      |
|         |     @ sign(tan(x))/2                                                              |
+---------+-----------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;&lt;!--more--&gt;Requirements&lt;/h4&gt;
&lt;p&gt;We need a generic query, which returns at least these two columns: &lt;strong&gt;ordering_column&lt;/strong&gt; and &lt;strong&gt;row_values&lt;/strong&gt;, The latter being a comma-delimited list of values. For example, the following query will do:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
 value/10 AS ordering_column,
 CONCAT(SIN(value/10), &#39;,&#39;, COS(value/10), &#39;,&#39;, SIGN(TAN(value/10))/2) AS row_values,
 @multi_line_chart_values_legend := &#39;sin(x),cos(x),sign(tan(x))/2&#39; AS legend
FROM tinyint_asc
LIMIT 81;
+-----------------+---------------------------------------------+------------------------------+
| ordering_column | row_values                                  | legend                       |
+-----------------+---------------------------------------------+------------------------------+
|          0.0000 | 0,1,0.0000                                  | sin(x),cos(x),sign(tan(x))/2 |
|          0.1000 | 0.099833416646828,0.99500416527803,0.5000   | sin(x),cos(x),sign(tan(x))/2 |
|          0.2000 | 0.19866933079506,0.98006657784124,0.5000    | sin(x),cos(x),sign(tan(x))/2 |
|          0.3000 | 0.29552020666134,0.95533648912561,0.5000    | sin(x),cos(x),sign(tan(x))/2 |
|          0.4000 | 0.38941834230865,0.92106099400289,0.5000    | sin(x),cos(x),sign(tan(x))/2 |
|          0.5000 | 0.4794255386042,0.87758256189037,0.5000     | sin(x),cos(x),sign(tan(x))/2 |
|          0.6000 | 0.56464247339504,0.82533561490968,0.5000    | sin(x),cos(x),sign(tan(x))/2 |
...&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Don&#39;t worry about the &lt;strong&gt;@multi_line_chart_values_legend&lt;/strong&gt; variable; it will be used later on for presenting chart legend.&lt;/p&gt;
&lt;p&gt;Since I&#39;ve already presented with how to create line charts in &lt;a href=&#34;http://code.openark.org/blog/mysql/auto-scaling-scaled-sql-graphs-concluded&#34;&gt;Auto scaling, scaled SQL graphs concluded&lt;/a&gt;, we will concentrate on how to present a single chart column, which includes multiple values.&lt;/p&gt;
&lt;h4&gt;Step 1&lt;/h4&gt;
&lt;p&gt;Let&#39;s say we wish to present the values 12,5,16. We wish to eventually generate something like:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+------------------+
| unwalked_bar     |
+------------------+
| ----Y------X---Z |
+------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Where &lt;strong&gt;X&lt;/strong&gt; is in position 12, &lt;strong&gt;Y&lt;/strong&gt; in position 5, and &lt;strong&gt;Z&lt;/strong&gt; in position 16.&lt;/p&gt;
&lt;p&gt;We begin with having these values concatenated into one string:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SET @values := &#39;12,5,16&#39;;
SET @num_values := CHAR_LENGTH(@values)-CHAR_LENGTH(REPLACE(@values,&#39;,&#39;,&#39;&#39;))+1;
SELECT @num_values;
+-------------+
| @num_values |
+-------------+
| 3           |
+-------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The query above parses the string and correctly identified there are three tokens.&lt;/p&gt;
&lt;h4&gt;Step 2&lt;/h4&gt;
&lt;p&gt;We now move on to tokenizing the text:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
 *,
 SUBSTRING_INDEX(SUBSTRING_INDEX(@row_values, &#39;,&#39;, tinyint_asc.value), &#39;,&#39;, -1) AS row_value
FROM
 tinyint_asc,
 (SELECT @row_values := &#39;12,5,16&#39; AS row_values) AS sel_values,
 (SELECT @num_values := CHAR_LENGTH(@row_values)-CHAR_LENGTH(REPLACE(@row_values,&#39;,&#39;,&#39;&#39;))+1 AS num_values) AS sel_num_values
WHERE
 tinyint_asc.value BETWEEN 1 AND @num_values
;
+-------+------------+------------+-----------+
| value | row_values | num_values | row_value |
+-------+------------+------------+-----------+
|     1 | 12,5,16    |          3 | 12        |
|     2 | 12,5,16    |          3 | 5         |
|     3 | 12,5,16    |          3 | 16        |
+-------+------------+------------+-----------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Using a numbers table (&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/08/tinyint_asc.sql&#34;&gt;tinyint_asc&lt;/a&gt;), we walk the string and tokenize it. We also maintain an indicator per value.&lt;/p&gt;
&lt;h4&gt;Step 3&lt;/h4&gt;
&lt;p&gt;We need to recognize the minimum and maximum values:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  value AS row_value_indicator,
  row_value,
  @min_row_value := LEAST(IFNULL(@min_row_value, row_value), row_value) AS min_row_value,
  @max_row_value := GREATEST(IFNULL(@max_row_value, row_value), row_value) AS max_row_value
FROM (
  SELECT
  *,
  SUBSTRING_INDEX(SUBSTRING_INDEX(@row_values, &#39;,&#39;, tinyint_asc.value), &#39;,&#39;, -1)+0 AS row_value
    FROM
      tinyint_asc,
      (SELECT @row_values := &#39;12,5,16&#39; AS row_values) AS sel_values,
      (SELECT @num_values := CHAR_LENGTH(@row_values)-CHAR_LENGTH(REPLACE(@row_values,&#39;,&#39;,&#39;&#39;))+1 AS num_values) AS sel_num_values,
      (SELECT @min_row_value := NULL) AS sel_min_row_value,
      (SELECT @max_row_value := NULL) AS sel_max_row_value
    WHERE
      tinyint_asc.value BETWEEN 1 AND @num_values
  ) sel_row_values
;
+---------------------+-----------+---------------+---------------+
| row_value_indicator | row_value | min_row_value | max_row_value |
+---------------------+-----------+---------------+---------------+
|                   1 |        12 |            12 |            12 |
|                   2 |         5 |             5 |            12 |
|                   3 |        16 |             5 |            16 |
+---------------------+-----------+---------------+---------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The last line presents the correct values: 5 and 16 being min, max values respectively.&lt;/p&gt;
&lt;h4&gt;Step 4&lt;/h4&gt;
&lt;p&gt;We now iterate from min value to max value, this being the graph range, and, per row value (token in &lt;strong&gt;row_values&lt;/strong&gt; column), we indicate whether there&#39;s a pixel on the graph.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  * ,
  IF(tinyint_asc.value = row_value, row_value_indicator, &#39;-&#39;) AS display_val
FROM
  tinyint_asc,
  (SELECT
    value AS row_value_indicator,
    row_value,
    @min_row_value := LEAST(IFNULL(@min_row_value, row_value), row_value) AS min_row_value,
    @max_row_value := GREATEST(IFNULL(@max_row_value, row_value), row_value) AS max_row_value
    FROM (
    SELECT
      *,
      SUBSTRING_INDEX(SUBSTRING_INDEX(@row_values, &#39;,&#39;, tinyint_asc.value), &#39;,&#39;, -1)+0 AS row_value
    FROM
      tinyint_asc,
      (SELECT @row_values := &#39;12,5,16&#39; AS row_values) AS sel_values,
      (SELECT @num_values := CHAR_LENGTH(@row_values)-CHAR_LENGTH(REPLACE(@row_values,&#39;,&#39;,&#39;&#39;))+1 AS num_values) AS sel_num_values,
      (SELECT @min_row_value := NULL) AS sel_min_row_value,
      (SELECT @max_row_value := NULL) AS sel_max_row_value
    WHERE
      tinyint_asc.value BETWEEN 1 AND @num_values
    ) sel_row_values
  ) AS sel_row_values_indicators
WHERE
  tinyint_asc.value BETWEEN 1 AND @max_row_value
;
+-------+---------------------+-----------+---------------+---------------+-------------+
| value | row_value_indicator | row_value | min_row_value | max_row_value | display_val |
+-------+---------------------+-----------+---------------+---------------+-------------+
|     1 |                   1 |        12 |            12 |            12 | -           |
|     1 |                   2 |         5 |             5 |            12 | -           |
|     1 |                   3 |        16 |             5 |            16 | -           |
|     2 |                   1 |        12 |            12 |            12 | -           |
|     2 |                   2 |         5 |             5 |            12 | -           |
|     2 |                   3 |        16 |             5 |            16 | -           |
|     3 |                   1 |        12 |            12 |            12 | -           |
|     3 |                   2 |         5 |             5 |            12 | -           |
|     3 |                   3 |        16 |             5 |            16 | -           |
|     4 |                   1 |        12 |            12 |            12 | -           |
|     4 |                   2 |         5 |             5 |            12 | -           |
|     4 |                   3 |        16 |             5 |            16 | -           |
|     5 |                   1 |        12 |            12 |            12 | -           |
|     5 |                   2 |         5 |             5 |            12 | 2           |
|     5 |                   3 |        16 |             5 |            16 | -           |
|     6 |                   1 |        12 |            12 |            12 | -           |
|     6 |                   2 |         5 |             5 |            12 | -           |
|     6 |                   3 |        16 |             5 |            16 | -           |&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;This table can get very long.&lt;/p&gt;
&lt;h4&gt;Step 5&lt;/h4&gt;
&lt;p&gt;We now group the marks per graph-row value. If there&#39;s no mark, we present with an empty space. If only one mark is present, we display that mark. If two lines collide on that point, we need to decide which mark to use. In the following example, we choose by order of appearance in the &lt;strong&gt;row_values&lt;/strong&gt; column. Another way (used later on) is to choose the higher value.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  string_position,
  LEFT(GROUP_CONCAT(bar_string_token ORDER BY bar_string_token DESC separator &#39;&#39;), 1) AS chosen_mark
FROM
  (SELECT
    value AS string_position,
    IF(tinyint_asc.value = row_value, row_value_indicator, &#39; &#39;) AS bar_string_token
  FROM
    tinyint_asc,
    (SELECT
      value AS row_value_indicator,
      row_value,
      @min_row_value := LEAST(IFNULL(@min_row_value, row_value), row_value) AS min_row_value,
      @max_row_value := GREATEST(IFNULL(@max_row_value, row_value), row_value) AS max_row_value
      FROM (
      SELECT
        *,
        SUBSTRING_INDEX(SUBSTRING_INDEX(@row_values, &#39;,&#39;, tinyint_asc.value), &#39;,&#39;, -1)+0 AS row_value
      FROM
        tinyint_asc,
        (SELECT @row_values := &#39;12,5,16&#39; AS row_values) AS sel_values,
        (SELECT @num_values := CHAR_LENGTH(@row_values)-CHAR_LENGTH(REPLACE(@row_values,&#39;,&#39;,&#39;&#39;))+1 AS num_values) AS sel_num_values,
        (SELECT @min_row_value := NULL) AS sel_min_row_value,
        (SELECT @max_row_value := NULL) AS sel_max_row_value
      WHERE
        tinyint_asc.value BETWEEN 1 AND @num_values
      ) sel_row_values
    ) AS sel_row_values_indicators
  WHERE
    tinyint_asc.value BETWEEN 1 AND @max_row_value
  ) AS sel_marked_row_values
GROUP BY
  string_position
;
+-----------------+-------------+
| string_position | chosen_mark |
+-----------------+-------------+
|               1 |             |
|               2 |             |
|               3 |             |
|               4 |             |
|               5 | 2           |
|               6 |             |
|               7 |             |
|               8 |             |
|               9 |             |
|              10 |             |
|              11 |             |
|              12 | 1           |
|              13 |             |
|              14 |             |
|              15 |             |
|              16 | 3           |
+-----------------+-------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Step 6&lt;/h4&gt;
&lt;p&gt;It&#39;s now just a matter of using GROUP_CONCAT to turn this into the following horizontal bar:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+------------------+
| unwalked_bar     |
+------------------+
| ----2------1---3 |
+------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;(I know I&#39;m mixing spaces and dashes, it&#39;s just for display purposes).&lt;/p&gt;
&lt;h4&gt;Putting it all together&lt;/h4&gt;
&lt;p&gt;From this point on, we use the techniques shown on &lt;a href=&#34;../mysql/auto-scaling-scaled-sql-graphs-concluded&#34;&gt;Auto scaling, scaled SQL graphs concluded&lt;/a&gt; to generate the complete chart. For the curious, here&#39;s what the complete query looks like. The text in &lt;strong&gt;bold&lt;/strong&gt; is the only thing that needs to change; replace this with your own query.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  y_scale,
  horizontal_bar as chart
  FROM
  (
  SELECT
    @multi_line_chart_row_number := @multi_line_chart_row_number+1,
    CASE @multi_line_chart_row_number
      WHEN 1 THEN ROUND(@multi_line_chart_max_value, @multi_line_chart_value_precision)
      WHEN @multi_line_chart_graph_rows THEN ROUND(@multi_line_chart_min_value, @multi_line_chart_value_precision)
      ELSE ROUND(@multi_line_chart_max_value-(@multi_line_chart_max_value-@multi_line_chart_min_value)*(@multi_line_chart_row_number-1)/(@multi_line_chart_graph_rows-1), @multi_line_chart_value_precision)
    END AS y_scale,
    horizontal_bar,
    @multi_line_chart_bar_length := IFNULL(@multi_line_chart_bar_length, CHAR_LENGTH(horizontal_bar))
  FROM
    (SELECT @multi_line_chart_row_number := 0) AS select_row
    INNER JOIN
    (
    SELECT
      GROUP_CONCAT(SUBSTRING(unwalked_bar, tinyint_asc.value, 1) ORDER BY ordering_column SEPARATOR &#39;&#39;) AS horizontal_bar
    FROM
      tinyint_asc
    INNER JOIN (
      SELECT
        ordering_column,
        GROUP_CONCAT(bar_string_token ORDER BY string_position SEPARATOR &#39;&#39;) AS unwalked_bar
      FROM
        (SELECT
          ordering_column,
          string_position,
          scaled_string_position,
          REPLACE(LEFT(GROUP_CONCAT(bar_string_token ORDER BY bar_string_token DESC SEPARATOR &#39;&#39;), 1), &#39; &#39;, &#39;-&#39;) AS bar_string_token
        FROM
          (SELECT
            ordering_column,
            @multi_line_chart_scaled_string_position := CONVERT((row_value-@multi_line_chart_min_value)*(@multi_line_chart_graph_rows-1)/(@multi_line_chart_max_value-@multi_line_chart_min_value), UNSIGNED) AS scaled_string_position,
            value AS string_position,
            IF(tinyint_asc.value = @multi_line_chart_scaled_string_position+1, SUBSTRING(IF(@multi_line_chart_values_legend IS NULL, @multi_line_chart_graph_fallback_colors, @multi_line_chart_graph_colors), row_value_indicator, 1), &#39; &#39;) AS bar_string_token
          FROM
            tinyint_asc,
            (SELECT
              ordering_column,
              value AS row_value_indicator,
              row_value
            FROM (
              SELECT
                *,
                @multi_line_chart_min_value := LEAST(IFNULL(@multi_line_chart_min_value, row_value), row_value) AS min_value,
                @multi_line_chart_max_value := GREATEST(IFNULL(@multi_line_chart_max_value, row_value), row_value) AS max_value,
                @multi_line_chart_min_range := LEAST(IFNULL(@multi_line_chart_min_range, ordering_column), ordering_column) AS min_range,
                @multi_line_chart_max_range := GREATEST(IFNULL(@multi_line_chart_max_range, ordering_column), ordering_column) AS max_range
              FROM
                (SELECT
                  *,
                  SUBSTRING_INDEX(SUBSTRING_INDEX(row_values, &#39;,&#39;, tinyint_asc.value), &#39;,&#39;, -1)+0 AS row_value,
                  @multi_line_chart_num_values := CHAR_LENGTH(row_values)-CHAR_LENGTH(REPLACE(row_values,&#39;,&#39;,&#39;&#39;))+1 AS num_values
                FROM
                  (SELECT @multi_line_chart_values_legend := NULL) AS select_nullify_values_legend,
                  (SELECT @multi_line_chart_bar_length := NULL) AS select_nullify_bar_length,
                  tinyint_asc,
                  (
                    &lt;strong&gt;SELECT
                      value/10 AS ordering_column,
                      CONCAT(SIN(value/10), &#39;,&#39;, COS(value/10), &#39;,&#39;, SIGN(TAN(value/10))/2) AS row_values,
                      @multi_line_chart_values_legend := &#39;sin(x),cos(x),sign(tan(x))/2&#39;
                    FROM tinyint_asc LIMIT 81&lt;/strong&gt;
                  ) AS sel_main_values,
                  (SELECT @multi_line_chart_min_value := NULL) AS select_min,
                  (SELECT @multi_line_chart_max_value := NULL) AS select_max,
                  (SELECT @multi_line_chart_min_range := NULL) AS select_min_range,
                  (SELECT @multi_line_chart_max_range := NULL) AS select_max_range,
                  (SELECT @multi_line_chart_graph_colors := &#39;#*@%o+x;m:&#39;) AS select_graph_colors,
                  (SELECT @multi_line_chart_graph_fallback_colors := &#39;abcdefghij&#39;) AS select_graph_fallback_colors,
                  (SELECT @multi_line_chart_value_precision := 2) AS select_value_precision,
                  (SELECT @multi_line_chart_graph_rows := 17) AS select_graph_rows
                ) sel_counted_values_main_values
              WHERE
                value BETWEEN 1 AND @multi_line_chart_num_values
              ) sel_row_values
            ) AS sel_row_values_indicators
          WHERE
            tinyint_asc.value BETWEEN 1 AND @multi_line_chart_graph_rows
          ) AS sel_marked_row_values
        GROUP BY
          ordering_column, string_position
        ) AS sel_walked_bar
      GROUP BY
        ordering_column
    ) AS select_vertical
    WHERE
      tinyint_asc.value BETWEEN 1 AND CHAR_LENGTH(unwalked_bar)
    GROUP BY
      tinyint_asc.value
    ORDER BY
      tinyint_asc.value DESC
    ) AS select_horizontal
  ) AS select_horizontal_untitled
UNION ALL
SELECT &#39;&#39;, CONCAT(&#39;v&#39;, REPEAT(&#39;:&#39;, @multi_line_chart_bar_length-2), &#39;v&#39;)
UNION ALL
SELECT &#39;&#39;, CONCAT(@multi_line_chart_min_range, REPEAT(&#39; &#39;, @multi_line_chart_bar_length-CHAR_LENGTH(@multi_line_chart_min_range)-CHAR_LENGTH(@multi_line_chart_max_range)), @multi_line_chart_max_range)
UNION ALL
SELECT
  &#39;&#39;, CONCAT(&#39;    &#39;, SUBSTRING(@multi_line_chart_graph_colors, value, 1), &#39; &#39;, SUBSTRING_INDEX(SUBSTRING_INDEX(@multi_line_chart_values_legend, &#39;,&#39;, value), &#39;,&#39;, -1))
FROM
  tinyint_asc
WHERE
  value BETWEEN 1 AND @multi_line_chart_num_values
  AND @multi_line_chart_values_legend IS NOT NULL
;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Area charts&lt;/h4&gt;
&lt;p&gt;Sinus functions curves go nicely with ASCII art. But your everyday chart won&#39;t have such nice curves. There is some erratic behavior to, say, your number of queries per hour. It doesn&#39;t display well in the above graph.&lt;/p&gt;
&lt;p&gt;Which is why we can choose to present area graphs: not only display the &lt;em&gt;line&lt;/em&gt;, but also the &lt;em&gt;area&lt;/em&gt; beneath it.&lt;/p&gt;
&lt;p&gt;This leads to the problem of hiding: higher values can hide the lower values display. So we need to adjust the above logic and make sure we always bring to front the lower values.&lt;/p&gt;
&lt;p&gt;The following example shows the relation between the percentage of slow queries (per hour) and the percentage of full table scans (of total queries, per hour). It&#39;s really fun to see the unmistakeable connection!&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+---------+---------------------------------------------------------------+
| y_scale | chart                                                         |
+---------+---------------------------------------------------------------+
| 4       | --------------------------------*--*------------------------- |
| 3       | -----------------------------****-*****------------------*--- |
| 3       | -----------------------------**********-----------------**-*- |
| 3       | ----------*------------------**********--------------*****-** |
| 3       | ------*--**-----------------************-*-----------******** |
| 3       | ------*******---------------****************--------********* |
| 3       | ------*******---------------******************------********* |
| 3       | ------*********-------------******************------********* |
| 3       | -----************--------*-*******************------********* |
| 2       | *----*****************--************************-**-********* |
| 2       | *----******************************************************** |
| 2       | *----******************************************************** |
| 2       | **--********************************************************* |
| 2       | ************************************************************* |
| 2       | ************************************************************* |
| 2       | ************************************************************* |
| 2       | *****************************#******************************* |
| 1       | *****************************##########*****************##*#* |
| 1       | ******#***#*****************###########**************######## |
| 1       | ******#######***************###############*********######### |
| 1       | #*****########**************##################******######### |
| 1       | #****##########*#*******##*###################******######### |
| 1       | #***######################################################### |
| 1       | #***######################################################### |
| 1       | ############################################################# |
|         | v:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 2009-10-22 20:00:00                       2009-10-25 08:00:00 |
|         |     # slow queries percent                                    |
|         |     * select scan percent                                     |
+---------+---------------------------------------------------------------&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Next we look at the number of &lt;strong&gt;SELECT&lt;/strong&gt;, &lt;strong&gt;INSERT&lt;/strong&gt;, &lt;strong&gt;UPDATE&lt;/strong&gt;, &lt;strong&gt;DELETE&lt;/strong&gt; queries per sec - on a per hour basis.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+---------+---------------------------------------------------------------+
| y_scale | chart                                                         |
+---------+---------------------------------------------------------------+
| 135     | --##--------------------------------------------------------- |
| 130     | -###--------------------------------------------------------- |
| 125     | -###----------------------##--------------------------------- |
| 120     | -###-------------------#####--------------------------------- |
| 115     | -###-----------------#######--------------------------------- |
| 110     | -###----------------########----------------------##--------- |
| 104     | -###--------------##########--------------------####--------- |
| 99      | ####*--------#--############------------------######--------- |
| 94      | ####*--------#-#############---------------#########--------- |
| 89      | #####-----##################------------############--------# |
| 84      | ############################-----------#############--------# |
| 79      | ####%########################---####################---###### |
| 74      | ####%######################################################## |
| 69      | ####%*####################################################### |
| 64      | ####%*####################################################### |
| 59      | ##*#%*###############*####################################### |
| 54      | #**#%*#####*#*****###*****##*###########*#####*#####*#####*## |
| 49      | #***%%*#*********************##########****#*********#**##*** |
| 44      | #***%%*************************##**************************** |
| 39      | ****%%******************************************************* |
| 33      | ****%%**********************************************%******** |
| 28      | *%%*%%**********%******%%*%*%*******%***************%******** |
| 23      | %%%%o%**%**%%o%%%%%%%%%%%%%%o******%%*%%%%%%%%%%%%%%%%*****%% |
| 18      | %oooooooo%%oooooooooooooooooo%%oo%oooooooooooooooooooo%o%%ooo |
| 13      | ooooooooo%%oooooooooooooooooo%%%%%%ooooooooooooooooooo%o%%ooo |
|         | v:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 2009-10-22 20:00:00                       2009-10-25 08:00:00 |
|         |     # com_select per second                                   |
|         |     * com_insert per second                                   |
|         |     o com_update per second                                   |
|         |     % com_delete per second                                   |
+---------+---------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/10/sql_multi_line_graph2.txt&#34;&gt;Here&#39;s the code&lt;/a&gt; to do that.&lt;/p&gt;
&lt;h4&gt;Colored charts&lt;/h4&gt;
&lt;p&gt;Time to add colors! The previous charts can be easily improved by sending the terminal escape characters to instruct initiating color display (thanks to &lt;strong&gt;TheVoo&lt;/strong&gt; for providing the idea and implementation for that on &lt;a href=&#34;../mysql/sql-pie-chart&#34;&gt;SQL pie chart&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;I recommend using the following &lt;strong&gt;pager&lt;/strong&gt; if you&#39;re on unix-like OS:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;pager awk &#39;{sub(/..$/, &#34;&#34;)} {sub(/[ ]+$/, &#34;&#34;)} !/^[+][-]/ &amp;amp;&amp;amp; NR &amp;gt; 3 { print }&#39;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The following chart is similar to the above, but now utilizes colors. It presents the number of popular DML queries per second, on an hourly basis.&lt;/p&gt;
&lt;blockquote&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/10/colored-multi-area-chart-1.png&#34;&gt;&lt;img class=&#34;size-full wp-image-1411 alignnone&#34; title=&#34;Colored multi area chart&#34; src=&#34;/blog/blog/assets/colored-multi-area-chart-1.png&#34; alt=&#34;Colored multi area chart&#34; width=&#34;525&#34; height=&#34;507&#34; /&gt;&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;Again, comparing slow queries with full table scans:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/10/colored-slow-and-scan-queries.png&#34;&gt;&lt;img class=&#34;size-full wp-image-1444&#34; title=&#34;colored-slow-and-scan-queries&#34; src=&#34;/blog/blog/assets/colored-slow-and-scan-queries.png&#34; alt=&#34;Slow queries and full scans overlay&#34; width=&#34;548&#34; height=&#34;319&#34; /&gt;&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;Comparing number of created temporary tables with number of created disk temporary tables:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/10/color_multi_line_chart_tmp_tables.png&#34;&gt;&lt;img class=&#34;size-full wp-image-1446&#34; title=&#34;color_multi_line_chart_tmp_tables&#34; src=&#34;/blog/blog/assets/color_multi_line_chart_tmp_tables.png&#34; alt=&#34;temp tables vs disk temp tables&#34; width=&#34;549&#34; height=&#34;485&#34; /&gt;&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;And, once again, the number of popular DML statements, zoomed in.&lt;/p&gt;
&lt;blockquote&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/10/color_multi_line_chart_dml.png&#34;&gt;&lt;img class=&#34;alignnone size-full wp-image-1451&#34; title=&#34;color_multi_line_chart_dml&#34; src=&#34;/blog/blog/assets/color_multi_line_chart_dml.png&#34; alt=&#34;color_multi_line_chart_dml&#34; width=&#34;552&#34; height=&#34;517&#34; /&gt;&lt;/a&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/10/sql_multi_line_graph3.txt&#34;&gt;Here&#39;s the code&lt;/a&gt; for colored charts.&lt;/p&gt;
&lt;p&gt;Some of the techinuqes used in my &lt;a href=&#34;http://code.openark.org/blog/tag/graphs&#34;&gt;charting series&lt;/a&gt; of blogs can be used, pretty much in the same way, in order to generate &lt;a href=&#34;http://code.google.com/apis/chart/&#34;&gt;Google charts&lt;/a&gt;. But other techniques can be used, as well.&lt;/p&gt;
&lt;p&gt;More on this in future posts.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>SQL pie chart</title>
      <link>/blog/mysql/sql-pie-chart/</link>
      <pubDate>Wed, 12 Aug 2009 12:49:41 +0000</pubDate>
      
      <guid>/blog/mysql/sql-pie-chart/</guid>
      <description>&lt;p&gt;My other half says I&#39;m losing it. But I think that as an enthusiast kernel developer she doesn&#39;t have the right to criticize people. (&#34;I like user space better!&#34; - she exclaims upon reading this).&lt;/p&gt;
&lt;p&gt;Shown below is a (single query) SQL-generated pie chart. I will walk through the steps towards making this happen, and conclude with what, I hope you&#39;ll agree, are real-world, useful usage samples.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+----------------------------------------------------------------------+
| pie_chart                                                            |
+----------------------------------------------------------------------+
|                                                                      |
|                         ;;;;;;;;;;;;;;;;;;;;;                        |
|                  oooooooo;;;;;;;;;;;;;;;;;;;;;;;;;;;                 |
|             oooooooooooooo;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;            |
|          ooooooooooooooooo                 ;;;;;;;;;;;;#####         |
|        oooooooooooooo                           ;#############       |
|       oooooooooooo                                 ############      |
|      oooooooooooo                                   ############     |
|      ooooooooooo                                     ###########     |
|      oooooooooooo                                   ::::::::::::     |
|       oooooooooooo                                 ::::::::::::      |
|        ooooooooo:::::                           ::::::::::::::       |
|          o::::::::::::::::                 :::::::::::::::::         |
|             :::::::::::::::::::::::::::::::::::::::::::::            |
|                  :::::::::::::::::::::::::::::::::::                 |
|                         :::::::::::::::::::::                        |
|                                                                      |
| ##  red: 1 (10%)                                                     |
| ;;  blue: 2 (20%)                                                    |
| oo  orange: 3 (30%)                                                  |
| ::  white: 4 (40%)                                                   |
+----------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Requirements&lt;/h4&gt;
&lt;p&gt;We need a generic query, which returns at least these two columns: &lt;strong&gt;name_column&lt;/strong&gt; and &lt;strong&gt;value_column&lt;/strong&gt;. For example, the following query will do:&lt;!--more--&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT name AS name_column, value AS value_column FROM sample_values2;
+-------------+--------------+
| name_column | value_column |
+-------------+--------------+
| red         |            1 |
| blue        |            2 |
| orange      |            3 |
| white       |            4 |
+-------------+--------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Find sample data in &lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/08/pie_data.sql&#34;&gt;pie_data.sql&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Part 1: expanding the original query&lt;/h4&gt;
&lt;p&gt;We&#39;re going to need to take the above query&#39;s results and expand them: how much is the ratio from total, per value? As first step, accumulate values:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  name_column,
  value_column,
  @accumulating_value := @accumulating_value+value_column AS accumulating_value
FROM (
  SELECT name AS name_column, value AS value_column FROM sample_values2
  ) select_values,
  (SELECT @accumulating_value := 0) select_accumulating_value
;
+-------------+--------------+--------------------+
| name_column | value_column | accumulating_value |
+-------------+--------------+--------------------+
| red         |            1 |                  1 |
| blue        |            2 |                  3 |
| orange      |            3 |                  6 |
| white       |            4 |                 10 |
+-------------+--------------+--------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Next, we calculate ratio of accumulating value, and present it both in [0..1] range, as well as in [0..2*PI] (radians):&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  name_order,
  name_column,
  value_column,
  accumulating_value,
  accumulating_value/@accumulating_value AS accumulating_value_ratio,
  2*PI()*accumulating_value/@accumulating_value AS accumulating_value_radians
FROM (
  SELECT
    name_column,
    value_column,
    @name_order := @name_order+1 AS name_order,
    @accumulating_value := @accumulating_value+value_column AS accumulating_value,
    @aggregated_name_column := CONCAT(@aggregated_name_column, name_column, &#39;,&#39;) AS aggregated_name_column
  FROM (
    SELECT name AS name_column, value AS value_column FROM sample_values2
    ) select_values,
    (SELECT @name_order := 0) select_name_order,
    (SELECT @accumulating_value := 0) select_accumulating_value,
    (SELECT @aggregated_name_column := &#39;&#39;) select_aggregated_name_column
  ) select_accumulating_values
;
+------------+-------------+--------------+--------------------+--------------------------+----------------------------+
| name_order | name_column | value_column | accumulating_value | accumulating_value_ratio | accumulating_value_radians |
+------------+-------------+--------------+--------------------+--------------------------+----------------------------+
|          1 | red         |            1 |                  1 |                      0.1 |           0.62831853071796 |
|          2 | blue        |            2 |                  3 |                      0.3 |            1.8849555921539 |
|          3 | orange      |            3 |                  6 |                      0.6 |            3.7699111843078 |
|          4 | white       |            4 |                 10 |                        1 |            6.2831853071796 |
+------------+-------------+--------------+--------------------+--------------------------+----------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The radians value will help us decide where in the pie chart lies each value.&lt;/p&gt;
&lt;h4&gt;Part 2: behind the scenes of the pie chart&lt;/h4&gt;
&lt;p&gt;We now explain how the pie chart works. Later on we combine with &lt;strong&gt;Part 1&lt;/strong&gt;, to produce the complete chart.&lt;/p&gt;
&lt;p&gt;We first generate a coordinates system (see &lt;a href=&#34;http://code.openark.org/blog/mysql/sql-graphics&#34;&gt;SQL graphics&lt;/a&gt;):&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  GROUP_CONCAT(CONCAT(t2.value,&#39;.&#39;,t1.value) order by t1.value separator &#39; &#39;) as circle
FROM
  tinyint_asc t1,
  tinyint_asc t2,
  (select @size := 10) sel_size,
  (select @radius := (@size/2 - 1)) sel_radius
WHERE
  t1.value &amp;lt; @size
  AND t2.value &amp;lt; @size
GROUP BY t2.value
;
+-----------------------------------------+
| circle                                  |
+-----------------------------------------+
| 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 |
| 1.0 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 |
| 2.0 2.1 2.2 2.3 2.4 2.5 2.6 2.7 2.8 2.9 |
| 3.0 3.1 3.2 3.3 3.4 3.5 3.6 3.7 3.8 3.9 |
| 4.0 4.1 4.2 4.3 4.4 4.5 4.6 4.7 4.8 4.9 |
| 5.0 5.1 5.2 5.3 5.4 5.5 5.6 5.7 5.8 5.9 |
| 6.0 6.1 6.2 6.3 6.4 6.5 6.6 6.7 6.8 6.9 |
| 7.0 7.1 7.2 7.3 7.4 7.5 7.6 7.7 7.8 7.9 |
| 8.0 8.1 8.2 8.3 8.4 8.5 8.6 8.7 8.8 8.9 |
| 9.0 9.1 9.2 9.3 9.4 9.5 9.6 9.7 9.8 9.9 |
+-----------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Taking a slightly big step further, we calculate the angle per coordinate, in relation to center of coordinate system. Calculation is in radians, but presented in degrees, since it&#39;s more readable. Also, we note in which quarter of the graph each point lies.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  group_concat(
    round(radians*180/PI())
    order by col_number separator &#39; &#39;) as circle
FROM (
  SELECT
    t1.value AS col_number,
    t2.value AS row_number,
    @dx := (t1.value - (@size-1)/2) AS dx,
    @dy := ((@size-1)/2 - t2.value) AS dy,
    @abs_radians := IF(@dx = 0, PI()/2, (atan(abs(@dy/@dx)))) AS abs_radians,
    CASE
      WHEN SIGN(@dy) &amp;gt;= 0 AND SIGN(@dx) &amp;gt;= 0 THEN @abs_radians
      WHEN SIGN(@dy) &amp;gt;= 0 AND SIGN(@dx) &amp;lt;= 0 THEN PI()-@abs_radians
      WHEN SIGN(@dy) &amp;lt;= 0 AND SIGN(@dx) &amp;lt;= 0 THEN PI()+@abs_radians
      WHEN SIGN(@dy) &amp;lt;= 0 AND SIGN(@dx) &amp;gt;= 0 THEN 2*PI()-@abs_radians
    END AS radians
  FROM
    tinyint_asc t1,
    tinyint_asc t2,
    (select @size := 15) sel_size,
    (select @radius := (@size/2 - 1)) sel_radius
  WHERE
    t1.value &amp;lt; @size
    AND t2.value &amp;lt; @size) select_combinations
  GROUP BY row_number
;
+-------------------------------------------------------------+
| circle                                                      |
+-------------------------------------------------------------+
| 135 131 126 120 113 106 98 90 82 74 67 60 54 49 45          |
| 139 135 130 124 117 108 99 90 81 72 63 56 50 45 41          |
| 144 140 135 129 121 112 101 90 79 68 59 51 45 40 36         |
| 150 146 141 135 127 117 104 90 76 63 53 45 39 34 30         |
| 157 153 149 143 135 124 108 90 72 56 45 37 31 27 23         |
| 164 162 158 153 146 135 117 90 63 45 34 27 22 18 16         |
| 172 171 169 166 162 153 135 90 45 27 18 14 11 9 8           |
| 180 180 180 180 180 180 180 90 0 0 0 0 0 0 0                |
| 188 189 191 194 198 207 225 270 315 333 342 346 349 351 352 |
| 196 198 202 207 214 225 243 270 297 315 326 333 338 342 344 |
| 203 207 211 217 225 236 252 270 288 304 315 323 329 333 337 |
| 210 214 219 225 233 243 256 270 284 297 307 315 321 326 330 |
| 216 220 225 231 239 248 259 270 281 292 301 309 315 320 324 |
| 221 225 230 236 243 252 261 270 279 288 297 304 310 315 319 |
| 225 229 234 240 247 254 262 270 278 286 293 300 306 311 315 |
+-------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The above needs some formattign to present well, but that&#39;s not the purpose; I&#39;m only showing the above to explain the steps taken.&lt;/p&gt;
&lt;h4&gt;Part 3: combining the two&lt;/h4&gt;
&lt;p&gt;Next step is probably the most significant one: we&#39;re going to present a rough, square, weird looking pie chart using the original values:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  group_concat(
    (SELECT name_order FROM
      (
      SELECT
        name_order,
        name_column,
        value_column,
        accumulating_value,
        accumulating_value/@accumulating_value AS accumulating_value_ratio,
        2*PI()*accumulating_value/@accumulating_value AS accumulating_value_radians
      FROM (
        SELECT
          name_column,
          value_column,
          @name_order := @name_order+1 AS name_order,
          @accumulating_value := @accumulating_value+value_column AS accumulating_value,
          @aggregated_name_column := CONCAT(@aggregated_name_column, name_column, &#39;,&#39;) AS aggregated_name_column
        FROM (
          SELECT name AS name_column, value AS value_column FROM sample_values2
          ) select_values,
          (SELECT @name_order := 0) select_name_order,
          (SELECT @accumulating_value := 0) select_accumulating_value,
          (SELECT @aggregated_name_column := &#39;&#39;) select_aggregated_name_column
        ) select_accumulating_values
      ) select_for_radians
    WHERE accumulating_value_radians &amp;gt;= radians LIMIT 1
    )
    order by col_number separator &#39; &#39;) as circle
FROM (
  SELECT
    t1.value AS col_number,
    t2.value AS row_number,
    @dx := (t1.value - (@size-1)/2) AS dx,
    @dy := ((@size-1)/2 - t2.value) AS dy,
    @abs_radians := IF(@dx = 0, PI()/2, (atan(abs(@dy/@dx)))) AS abs_radians,
    CASE
      WHEN SIGN(@dy) &amp;gt;= 0 AND SIGN(@dx) &amp;gt;= 0 THEN @abs_radians
      WHEN SIGN(@dy) &amp;gt;= 0 AND SIGN(@dx) &amp;lt;= 0 THEN PI()-@abs_radians
      WHEN SIGN(@dy) &amp;lt;= 0 AND SIGN(@dx) &amp;lt;= 0 THEN PI()+@abs_radians
      WHEN SIGN(@dy) &amp;lt;= 0 AND SIGN(@dx) &amp;gt;= 0 THEN 2*PI()-@abs_radians
    END AS radians
  FROM
    tinyint_asc t1,
    tinyint_asc t2,
    (select @size := 21) sel_size,
    (select @radius := (@size/2 - 1)) sel_radius
  WHERE
    t1.value &amp;lt; @size
    AND t2.value &amp;lt; @size) select_combinations
  GROUP BY row_number
;
+-------------------------------------------+
| circle                                    |
+-------------------------------------------+
| 3 3 3 3 3 3 3 2 2 2 2 2 2 2 2 2 2 2 2 2 2 |
| 3 3 3 3 3 3 3 3 2 2 2 2 2 2 2 2 2 2 2 2 2 |
| 3 3 3 3 3 3 3 3 2 2 2 2 2 2 2 2 2 2 2 2 2 |
| 3 3 3 3 3 3 3 3 2 2 2 2 2 2 2 2 2 2 2 2 1 |
| 3 3 3 3 3 3 3 3 3 2 2 2 2 2 2 2 2 2 2 1 1 |
| 3 3 3 3 3 3 3 3 3 2 2 2 2 2 2 2 2 1 1 1 1 |
| 3 3 3 3 3 3 3 3 3 2 2 2 2 2 2 2 1 1 1 1 1 |
| 3 3 3 3 3 3 3 3 3 3 2 2 2 2 2 1 1 1 1 1 1 |
| 3 3 3 3 3 3 3 3 3 3 2 2 2 1 1 1 1 1 1 1 1 |
| 3 3 3 3 3 3 3 3 3 3 2 2 1 1 1 1 1 1 1 1 1 |
| 3 3 3 3 3 3 3 3 3 3 2 1 1 1 1 1 1 1 1 1 1 |
| 3 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4 |
| 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4 4 |
| 3 3 3 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 |
| 3 3 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 |
| 3 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 |
| 3 3 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 |
| 3 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 |
| 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 |
| 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 |
| 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 |
+-------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The interesting SQL trick is that &lt;em&gt;everything goes within the GROUP_CONCAT clause&lt;/em&gt;. Instead of presenting the coordinate, we check on the enhanced values table, looking for the first row which has a greater angle (in radians) than the current pixel has. We then display &lt;strong&gt;1&lt;/strong&gt;, &lt;strong&gt;2&lt;/strong&gt;, etc. to denote the value.&lt;/p&gt;
&lt;p&gt;The next step is actually very simple: instead of drawing the full square, limit to a circle!&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  group_concat(
    IF(round(sqrt(pow(col_number-(@size-1)/2, 2) + pow(row_number-(@size-1)/2, 2))) BETWEEN @radius/2 AND @radius,
    (SELECT name_order FROM
      (
      SELECT
        name_order,
        name_column,
        value_column,
        accumulating_value,
        accumulating_value/@accumulating_value AS accumulating_value_ratio,
        2*PI()*accumulating_value/@accumulating_value AS accumulating_value_radians
      FROM (
        SELECT
          name_column,
          value_column,
          @name_order := @name_order+1 AS name_order,
          @accumulating_value := @accumulating_value+value_column AS accumulating_value,
          @aggregated_name_column := CONCAT(@aggregated_name_column, name_column, &#39;,&#39;) AS aggregated_name_column
        FROM (
          SELECT name AS name_column, value AS value_column FROM sample_values2
          ) select_values,
          (SELECT @name_order := 0) select_name_order,
          (SELECT @accumulating_value := 0) select_accumulating_value,
          (SELECT @aggregated_name_column := &#39;&#39;) select_aggregated_name_column
        ) select_accumulating_values
      ) select_for_radians
    WHERE accumulating_value_radians &amp;gt;= radians LIMIT 1
    ), &#39;-&#39;)
    order by col_number separator &#39; &#39;) as circle
FROM (
  SELECT
    t1.value AS col_number,
    t2.value AS row_number,
    @dx := (t1.value - (@size-1)/2) AS dx,
    @dy := ((@size-1)/2 - t2.value) AS dy,
    @abs_radians := IF(@dx = 0, PI()/2, (atan(abs(@dy/@dx)))) AS abs_radians,
    CASE
      WHEN SIGN(@dy) &amp;gt;= 0 AND SIGN(@dx) &amp;gt;= 0 THEN @abs_radians
      WHEN SIGN(@dy) &amp;gt;= 0 AND SIGN(@dx) &amp;lt;= 0 THEN PI()-@abs_radians
      WHEN SIGN(@dy) &amp;lt;= 0 AND SIGN(@dx) &amp;lt;= 0 THEN PI()+@abs_radians
      WHEN SIGN(@dy) &amp;lt;= 0 AND SIGN(@dx) &amp;gt;= 0 THEN 2*PI()-@abs_radians
    END AS radians
  FROM
    tinyint_asc t1,
    tinyint_asc t2,
    (select @size := 21) sel_size,
    (select @radius := 7) sel_radius
  WHERE
    t1.value &amp;lt; @size
    AND t2.value &amp;lt; @size) select_combinations
  GROUP BY row_number
;
+-------------------------------------------+
| circle                                    |
+-------------------------------------------+
| - - - - - - - - - - - - - - - - - - - - - |
| - - - - - - - - - - - - - - - - - - - - - |
| - - - - - - - - - - - - - - - - - - - - - |
| - - - - - - - - 2 2 2 2 2 - - - - - - - - |
| - - - - - - 3 3 3 2 2 2 2 2 2 - - - - - - |
| - - - - - 3 3 3 3 2 2 2 2 2 2 2 - - - - - |
| - - - - 3 3 3 3 3 2 2 2 2 2 2 2 1 - - - - |
| - - - - 3 3 3 3 3 - - - 2 2 2 1 1 - - - - |
| - - - 3 3 3 3 3 - - - - - 1 1 1 1 1 - - - |
| - - - 3 3 3 3 - - - - - - - 1 1 1 1 - - - |
| - - - 3 3 3 3 - - - - - - - 1 1 1 1 - - - |
| - - - 3 3 3 3 - - - - - - - 4 4 4 4 - - - |
| - - - 3 3 3 3 3 - - - - - 4 4 4 4 4 - - - |
| - - - - 3 3 4 4 4 - - - 4 4 4 4 4 - - - - |
| - - - - 3 4 4 4 4 4 4 4 4 4 4 4 4 - - - - |
| - - - - - 4 4 4 4 4 4 4 4 4 4 4 - - - - - |
| - - - - - - 4 4 4 4 4 4 4 4 4 - - - - - - |
| - - - - - - - - 4 4 4 4 4 - - - - - - - - |
| - - - - - - - - - - - - - - - - - - - - - |
| - - - - - - - - - - - - - - - - - - - - - |
| - - - - - - - - - - - - - - - - - - - - - |
+-------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;That looks a lot more like a pie chart.&lt;/p&gt;
&lt;h4&gt;Part 4: doing the fancy work&lt;/h4&gt;
&lt;p&gt;We will now add (in one big step):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Stretching along the X-axis.&lt;/li&gt;
&lt;li&gt;Condensing the spaces.&lt;/li&gt;
&lt;li&gt;Coloring for the pie parts.&lt;/li&gt;
&lt;li&gt;A legend.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The text in &lt;strong&gt;bold&lt;/strong&gt; is the original query, and is the only thing you need to change in order to create your own pie charts.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  group_concat(
    IF(round(sqrt(pow(col_number/@stretch-0.5-(@size-1)/2, 2) + pow(row_number-(@size-1)/2, 2))) BETWEEN @radius*2/3 AND @radius,
    (SELECT SUBSTRING(@colors, name_order, 1) FROM
      (
      SELECT
        name_order,
        name_column,
        value_column,
        accumulating_value,
        accumulating_value/@accumulating_value AS accumulating_value_ratio,
        @aggregated_data := CONCAT(@aggregated_data, name_column, &#39;: &#39;, value_column, &#39; (&#39;, ROUND(100*value_column/@accumulating_value), &#39;%)&#39;, &#39;|&#39;) AS aggregated_name_column,
        2*PI()*accumulating_value/@accumulating_value AS accumulating_value_radians
      FROM (
        SELECT
          name_column,
          value_column,
          @name_order := @name_order+1 AS name_order,
          @accumulating_value := @accumulating_value+value_column AS accumulating_value
        FROM (
          &lt;strong&gt;SELECT name AS name_column, value AS value_column FROM sample_values2 LIMIT 4&lt;/strong&gt;
          ) select_values,
          (SELECT @name_order := 0) select_name_order,
          (SELECT @accumulating_value := 0) select_accumulating_value,
          (SELECT @aggregated_data := &#39;&#39;) select_aggregated_name_column
        ) select_accumulating_values
      ) select_for_radians
    WHERE accumulating_value_radians &amp;gt;= radians LIMIT 1
    ), &#39; &#39;)
    order by col_number separator &#39;&#39;) as pie
FROM (
  SELECT
    t1.value AS col_number,
    t2.value AS row_number,
    @dx := (t1.value/@stretch - (@size-1)/2) AS dx,
    @dy := ((@size-1)/2 - t2.value) AS dy,
    @abs_radians := IF(@dx = 0, PI()/2, (atan(abs(@dy/@dx)))) AS abs_radians,
    CASE
      WHEN SIGN(@dy) &amp;gt;= 0 AND SIGN(@dx) &amp;gt;= 0 THEN @abs_radians
      WHEN SIGN(@dy) &amp;gt;= 0 AND SIGN(@dx) &amp;lt;= 0 THEN PI()-@abs_radians
      WHEN SIGN(@dy) &amp;lt;= 0 AND SIGN(@dx) &amp;lt;= 0 THEN PI()+@abs_radians
      WHEN SIGN(@dy) &amp;lt;= 0 AND SIGN(@dx) &amp;gt;= 0 THEN 2*PI()-@abs_radians
    END AS radians
  FROM
    tinyint_asc t1,
    tinyint_asc t2,
    (select @size := 23) sel_size,
    (select @radius := (@size/2 - 1)) sel_radius,
    (select @stretch := 4) sel_stretch,
    (select @colors := &#39;#;o:X&#34;@+-=123456789abcdef&#39;) sel_colors
  WHERE
    t1.value &amp;lt; @size*@stretch
    AND t2.value &amp;lt; @size) select_combinations
  GROUP BY row_number
UNION ALL
  SELECT
    CONCAT(
      REPEAT(SUBSTRING(@colors, value, 1), 2),
      &#39;  &#39;,
      SUBSTRING_INDEX(SUBSTRING_INDEX(@aggregated_data, &#39;|&#39;, value), &#39;|&#39;, -1)
    )
  FROM
    tinyint_asc
  WHERE
    value BETWEEN 1 AND @name_order
;
+----------------------------------------------------------------------------------------------+
| pie                                                                                          |
+----------------------------------------------------------------------------------------------+
|                                                                                              |
|                                   ;;;;;;;;;;;;;;;;;;;;;;;;;                                  |
|                          oooooooo;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                         |
|                    ooooooooooooooo;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                   |
|                oooooooooooooooooooo;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;               |
|             oooooooooooooooooooooooo                     ;;;;;;;;;;;;;;;;;;;;;###            |
|           oooooooooooooooooooo                                 ;;;;;;;;;###########          |
|         oooooooooooooooooo                                         ##################        |
|       ooooooooooooooooo                                               #################      |
|      ooooooooooooooooo                                                 #################     |
|      oooooooooooooooo                                                   ################     |
|     oooooooooooooooo                                                     ################    |
|      oooooooooooooooo                                                   ::::::::::::::::     |
|      ooooooooooooooooo                                                 :::::::::::::::::     |
|       ooooooooooooooooo                                               :::::::::::::::::      |
|         oooooooooooooo::::                                         ::::::::::::::::::        |
|           ooooooo:::::::::::::                                 ::::::::::::::::::::          |
|             ::::::::::::::::::::::::                     ::::::::::::::::::::::::            |
|                :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::               |
|                    :::::::::::::::::::::::::::::::::::::::::::::::::::::::                   |
|                          :::::::::::::::::::::::::::::::::::::::::::                         |
|                                   :::::::::::::::::::::::::                                  |
|                                                                                              |
| ##  red: 1 (10%)                                                                             |
| ;;  blue: 2 (20%)                                                                            |
| oo  orange: 3 (30%)                                                                          |
| ::  white: 4 (40%)                                                                           |
+----------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Making the legend is by itself an interesting hack: aggregating an unknown number of rows using a session user variable, then splitting it again. Of course, this works well if we only have a small number of rows (values), as we expect in our case.&lt;/p&gt;
&lt;h4&gt;Showcase&lt;/h4&gt;
&lt;p&gt;OK. Why? &lt;em&gt;Why?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Here are three charts I hope will convince the skeptic reader:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Given the &lt;strong&gt;sakila&lt;/strong&gt; database, list the 8 largest tables (size in KB):&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+------------------------------------------------------------------------------+
| pie_chart                                                                    |
+------------------------------------------------------------------------------+
|                                                                              |
|                            #######################                           |
|                    #######################################                   |
|               #################################################              |
|            ##################                   ##################           |
|         ###############                               ###############        |
|        ;;###########                                     #############       |
|      ;;;;;;;;;;;;;                                         #############     |
|      ;;;;;;;;;;;;                                           ############     |
|     ;;;;;;;;;;;;;                                           #############    |
|      ;;;;;;;;;;;;                                           @@@@@@@@@@@@     |
|      ;;;;;;;;;;;;;                                         &#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;     |
|        ;;;;;;;;;;;;;                                     XX&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;       |
|         ;;;;;;;;;;;;;;;                               XXXXXXXXXXXXX&#34;&#34;        |
|            ;;;;;;;;;;;;;;;;;;                   ::::::::::XXXXXXXX           |
|               ;;;;;;;;;;;;;;;;;;;;;;;;;;oooooooooo::::::::::::X              |
|                    ;;;;;;;;;;;;;;;;;;;;;;ooooooooooo::::::                   |
|                            ;;;;;;;;;;;;;;ooooooooo                           |
|                                                                              |
| ##  rental: 2850816 (43%)                                                    |
| ;;  payment: 2228224 (34%)                                                   |
| oo  inventory: 376832 (6%)                                                   |
| ::  film_text: 325440 (5%)                                                   |
| XX  film: 278528 (4%)                                                        |
| &#34;&#34;  film_actor: 278528 (4%)                                                  |
| @@  customer: 131072 (2%)                                                    |
| ++  staff: 98304 (1%)                                                        |
+------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;How much disk space does each storage engine consume (sum table size per engine)?&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+------------------------------------------------------------------------------+
| pie_chart                                                                    |
+------------------------------------------------------------------------------+
|                                                                              |
|                            #######################                           |
|                    #######################################                   |
|               #################################################              |
|            ##################                   ##################           |
|         ###############                               ###############        |
|        #############                                     #############       |
|      #############                                         #############     |
|      ############                                           ############     |
|     #############                                           #############    |
|      ############                                           oooooooooooo     |
|      #############                                         ;;;;;;;;;;;oo     |
|        #############                                     ;;;;;;;;;;;;;       |
|         ###############                               ;;;;;;;;;;;;;;;        |
|            ##################                   #;;;;;;;;;;;;;;;;;           |
|               #####################################;;;;;;;;;;;;              |
|                    ###################################;;;;                   |
|                            #######################                           |
|                                                                              |
| ##  InnoDB: 1908732 (84%)                                                    |
| ;;  MyISAM: 284074 (12%)                                                     |
| oo  ARCHIVE: 84276 (4%)                                                      |
+------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;What were the most popular DMLs during the last 10 seconds?&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+------------------------------------------------------------------------------+
| pie_chart                                                                    |
+------------------------------------------------------------------------------+
|                                                                              |
|                            #######################                           |
|                    #######################################                   |
|               #################################################              |
|            ##################                   ##################           |
|         ###############                               ###############        |
|        #############                                     #############       |
|      #############                                         #############     |
|      ############                                           ############     |
|     #############                                           #############    |
|      ############                                           oooo::::::::     |
|      #############                                         ooooooooooooo     |
|        #############                                     ooooooooooooo       |
|         ###############                               ooooooooooooooo        |
|            #################;                   ;;;;;;;;;ooooooooo           |
|               #############;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;oo              |
|                    ######;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                   |
|                            ;;;;;;;;;;;;;;;;;;;;;;;                           |
|                                                                              |
| ##  com_select: 1876 (69%)                                                   |
| ;;  com_insert: 514 (19%)                                                    |
| oo  com_delete: 277 (10%)                                                    |
| ::  com_update: 63 (2%)                                                      |
+------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Conclusion&lt;/h4&gt;
&lt;p&gt;ASCII graphics always look funny; some would say the same about &lt;em&gt;top&lt;/em&gt;, &lt;em&gt;wget&lt;/em&gt;,  &lt;em&gt;cal&lt;/em&gt;, etc. (should I even mention &lt;em&gt;lynx&lt;/em&gt;?)&lt;/p&gt;
&lt;p&gt;I think it is possible to do most common charting with SQL: I&#39;ve already shown how to do horizontal graphs and pie charts. Multi-column bar charts can also be worked out. These are not meant as a permanent solution; but it&#39;s good to be able to visualize some values without having to install Nagios (along with &lt;em&gt;apache&lt;/em&gt;, &lt;em&gt;php&lt;/em&gt;, drivers, etc.), or otherwise exporting table, copying to desktop machines, loading into OpenOffice impress, generating graphs.&lt;/p&gt;
&lt;p&gt;Sometimes you just need an immediate overlook. This is where I find SQL charting to be useful.&lt;/p&gt;
&lt;p&gt;Sure, there are Perl and Python solutions for that; that&#39;s easily achieved as well. But doing it from with the MySQL client gives, in my opinion, a level of confidence: you&#39;ll always be able to produce the graph; &lt;em&gt;perl-DBD-MySQL&lt;/em&gt; or no &lt;em&gt;perl-DBD-MySQL&lt;/em&gt;; Linux or Windows.&lt;/p&gt;
&lt;p&gt;Besides, it was fun doing it.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Auto scaling, scaled SQL graphs concluded</title>
      <link>/blog/mysql/auto-scaling-scaled-sql-graphs-concluded/</link>
      <pubDate>Tue, 28 Jul 2009 14:38:08 +0000</pubDate>
      
      <guid>/blog/mysql/auto-scaling-scaled-sql-graphs-concluded/</guid>
      <description>&lt;p&gt;I wasn&#39;t sure I was to go this far. After catching breath the following have been added to &lt;a href=&#34;http://code.openark.org/blog/mysql/generic-auto-scaling-scaled-sql-graphs&#34;&gt;Generic, auto scaling, scaled SQL graphs&lt;/a&gt;, and these will conclude my current hacks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Displaying X-axis min/max values.&lt;/li&gt;
&lt;li&gt;Support for Y-axis values precision.&lt;/li&gt;
&lt;li&gt;Support for pre-defined scale range.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The addition of the above makes for presentable, usable graphs. See also sample graphs at the end of this post.&lt;/p&gt;
&lt;h4&gt;Step 8: adding X-axis values&lt;/h4&gt;
&lt;p&gt;I add minimum/maximum X-scale values to the graph. What was just &lt;strong&gt;ordering_column&lt;/strong&gt; before, now turns to be the &lt;strong&gt;x&lt;/strong&gt; in the &lt;strong&gt;y = f(x)&lt;/strong&gt; function.&lt;!--more--&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  y_scale,
  horizontal_bar
  FROM
  (
  SELECT
    @row_number := @row_number+1,
    CASE @row_number
      WHEN 1 THEN ROUND(max_value)
      WHEN (@graph_rows+1)/2 THEN ROUND((max_value+min_value)/2)
      WHEN @graph_rows THEN ROUND(min_value)
      ELSE &#39;~&#39;
    END AS y_scale,
    horizontal_bar,
    &lt;strong&gt;@bar_length := IFNULL(@bar_length, CHAR_LENGTH(horizontal_bar))&lt;/strong&gt;
  FROM
    (SELECT @row_number := 0) AS select_row
    INNER JOIN
    (
    SELECT
      min_value,
      max_value,
      value_column,
      GROUP_CONCAT(SUBSTRING(graph_bar, tinyint_asc.value, 1) ORDER BY ordering_column SEPARATOR &#39;&#39;) AS horizontal_bar
    FROM
      (SELECT @row_number := 0) AS select_row,
      tinyint_asc
    INNER JOIN (
      SELECT
        ordering_column,
        @min_value AS min_value,
        @max_value AS max_value,
        value_column,
        @scaled_value := CONVERT((value_column-@min_value)*(@graph_rows-1)/(@max_value-@min_value), UNSIGNED) AS scaled_value,
        CONCAT(REPEAT(&#39;-&#39;,@scaled_value),&#39;#&#39;,REPEAT(&#39;-&#39;,(@graph_rows-1)-@scaled_value)) AS graph_bar
      FROM
        (
        SELECT
          @min_value := LEAST(IFNULL(@min_value, value_column), value_column) AS min_value,
          @max_value := GREATEST(IFNULL(@max_value, value_column), value_column) AS max_value,
          &lt;strong&gt;@min_range := LEAST(IFNULL(@min_range, ordering_column), ordering_column) AS min_range&lt;/strong&gt;,
          &lt;strong&gt;@max_range := GREATEST(IFNULL(@max_range, ordering_column), ordering_column) AS max_range&lt;/strong&gt;,
          ordering_column,
          value_column
        FROM
          (
            SELECT id AS ordering_column, val AS value_column
            FROM sample_values LIMIT 100
          ) AS value_select,
          (SELECT @min_value := NULL) AS select_min,
          (SELECT @max_value := NULL) AS select_max,
          &lt;strong&gt;(SELECT @min_range := NULL) AS select_min_range&lt;/strong&gt;,
          &lt;strong&gt;(SELECT @max_range := NULL) AS select_max_range&lt;/strong&gt;,
          &lt;strong&gt;(SELECT @bar_length := NULL) AS select_bar_length&lt;/strong&gt;,
          (SELECT @graph_rows := 15) AS select_graph_rows
        ) AS select_range
      ) AS select_vertical
    WHERE
      tinyint_asc.value BETWEEN 1 AND CHAR_LENGTH(graph_bar)
    GROUP BY
      tinyint_asc.value
    ORDER BY
      tinyint_asc.value DESC
    ) AS select_horizontal
  ) AS select_horizontal_untitled
&lt;strong&gt;UNION ALL&lt;/strong&gt;
&lt;strong&gt;SELECT &#39;&#39;, CONCAT(&#39;v&#39;, REPEAT(&#39;:&#39;, @bar_length-2), &#39;v&#39;)&lt;/strong&gt;
&lt;strong&gt;UNION ALL&lt;/strong&gt;
&lt;strong&gt;SELECT &#39;&#39;, CONCAT(@min_range, REPEAT(&#39; &#39;, @bar_length-CHAR_LENGTH(@min_range)-CHAR_LENGTH(@max_range)), @max_range)&lt;/strong&gt;
;
+---------+------------------------------------------------------------------------------------------------------+
| y_scale | horizontal_bar                                                                                       |
+---------+------------------------------------------------------------------------------------------------------+
| 2       | ------------########-------------------------------------------------------########----------------- |
| ~       | ----------##--------###-------------------------------------------------###--------###-------------- |
| ~       | -------###-------------##---------------------------------------------##--------------##------------ |
| ~       | ------#------------------##------------------------------------------#------------------##---------- |
| ~       | ----##---------------------#---------------------------------------##---------------------#--------- |
| ~       | ---#------------------------##-----------------------------------##------------------------##------- |
| ~       | -##---------------------------#---------------------------------#----------------------------#------ |
| 1       | #------------------------------##------------------------------#------------------------------#----- |
| ~       | ---------------------------------#---------------------------##--------------------------------##--- |
| ~       | ----------------------------------##------------------------#------------------------------------#-- |
| ~       | ------------------------------------#---------------------##--------------------------------------## |
| ~       | -------------------------------------##-----------------##------------------------------------------ |
| ~       | ---------------------------------------##-------------##-------------------------------------------- |
| ~       | -----------------------------------------###-------###---------------------------------------------- |
| 0       | --------------------------------------------#######------------------------------------------------- |
|         | v::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 0                                                                                                 99 |
+---------+------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The X-axis range is &lt;strong&gt;[0..99]&lt;/strong&gt;, displayed below. The code does not limit us to &lt;strong&gt;INTEGER&lt;/strong&gt;. We may as well have &lt;strong&gt;FLOAT&lt;/strong&gt;, &lt;strong&gt;DATE&lt;/strong&gt;, &lt;strong&gt;TIMESTAMP&lt;/strong&gt; etc. (examples follow).&lt;/p&gt;
&lt;h4&gt;Step 9: adding precision&lt;/h4&gt;
&lt;p&gt;The &lt;strong&gt;0,1,2&lt;/strong&gt; Y-axis values play nicely here. But if my generic query is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT id AS ordering_column, val/3 AS value_column FROM sample_values LIMIT 100&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The resulting graph looks like:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+---------+------------------------------------------------------------------------------------------------------+
| y_scale | horizontal_bar                                                                                       |
+---------+------------------------------------------------------------------------------------------------------+
| 1       | ------------#########------------------------------------------------------#########---------------- |
| ~       | --------####---------###-----------------------------------------------####---------###------------- |
| ~       | ------##----------------###------------------------------------------##----------------###---------- |
| ~       | ----##---------------------##-------------------------------------###---------------------##-------- |
| ~       | -###-------------------------##---------------------------------##--------------------------##------ |
| 0       | #------------------------------##-----------------------------##------------------------------##---- |
| ~       | ---------------------------------##-------------------------##----------------------------------##-- |
| ~       | -----------------------------------##---------------------##--------------------------------------## |
| ~       | -------------------------------------###----------------##------------------------------------------ |
| ~       | ----------------------------------------###---------####-------------------------------------------- |
| 0       | -------------------------------------------#########------------------------------------------------ |
|         | v::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 0                                                                                                 99 |
+---------+------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;And the &lt;strong&gt;0,0,1&lt;/strong&gt; values are completely inappropriate. We will now introduce precision:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  y_scale,
  horizontal_bar
  FROM
  (
  SELECT
    @row_number := @row_number+1,
    CASE @row_number
      WHEN 1 THEN &lt;strong&gt;ROUND(max_value * POW(10, @value_precision))/POW(10, @value_precision)&lt;/strong&gt;
      WHEN (@graph_rows+1)/2 THEN &lt;strong&gt;ROUND((max_value+min_value)*POW(10, @value_precision)/2)/POW(10, @value_precision)&lt;/strong&gt;
      WHEN @graph_rows THEN &lt;strong&gt;ROUND(min_value*POW(10, @value_precision))/POW(10, @value_precision)&lt;/strong&gt;
      ELSE &#39;~&#39;
    END AS y_scale,
    horizontal_bar,
    @bar_length := IFNULL(@bar_length, CHAR_LENGTH(horizontal_bar))
  FROM
    (SELECT @row_number := 0) AS select_row
    INNER JOIN
    (
    SELECT
      min_value,
      max_value,
      value_column,
      GROUP_CONCAT(SUBSTRING(graph_bar, tinyint_asc.value, 1) ORDER BY ordering_column SEPARATOR &#39;&#39;) AS horizontal_bar
    FROM
      (SELECT @row_number := 0) AS select_row,
      tinyint_asc
    INNER JOIN (
      SELECT
        ordering_column,
        @min_value AS min_value,
        @max_value AS max_value,
        value_column,
        @scaled_value := CONVERT((value_column-@min_value)*(@graph_rows-1)/(@max_value-@min_value), UNSIGNED) AS scaled_value,
        CONCAT(REPEAT(&#39;-&#39;,@scaled_value),&#39;#&#39;,REPEAT(&#39;-&#39;,(@graph_rows-1)-@scaled_value)) AS graph_bar
      FROM
        (
        SELECT
          @min_value := LEAST(IFNULL(@min_value, value_column), value_column) AS min_value,
          @max_value := GREATEST(IFNULL(@max_value, value_column), value_column) AS max_value,
          @min_range := LEAST(IFNULL(@min_range, ordering_column), ordering_column) AS min_range,
          @max_range := GREATEST(IFNULL(@max_range, ordering_column), ordering_column) AS max_range,
          ordering_column,
          value_column
        FROM
          (
            SELECT id AS ordering_column, val/3 AS value_column
            FROM sample_values LIMIT 100
          ) AS value_select,
          (SELECT @min_value := NULL) AS select_min,
          (SELECT @max_value := NULL) AS select_max,
          (SELECT @min_range := NULL) AS select_min_range,
          (SELECT @max_range := NULL) AS select_max_range,
          (SELECT @bar_length := NULL) AS select_bar_length,
          &lt;strong&gt;(SELECT @value_precision := 2) AS select_value_precision,&lt;/strong&gt;
          (SELECT @graph_rows := 15) AS select_graph_rows
        ) AS select_range
      ) AS select_vertical
    WHERE
      tinyint_asc.value BETWEEN 1 AND CHAR_LENGTH(graph_bar)
    GROUP BY
      tinyint_asc.value
    ORDER BY
      tinyint_asc.value DESC
    ) AS select_horizontal
  ) AS select_horizontal_untitled
UNION ALL
SELECT &#39;&#39;, CONCAT(&#39;v&#39;, REPEAT(&#39;:&#39;, @bar_length-2), &#39;v&#39;)
UNION ALL
SELECT &#39;&#39;, CONCAT(@min_range, REPEAT(&#39; &#39;, @bar_length-CHAR_LENGTH(@min_range)-CHAR_LENGTH(@max_range)), @max_range)
;
+---------+------------------------------------------------------------------------------------------------------+
| y_scale | horizontal_bar                                                                                       |
+---------+------------------------------------------------------------------------------------------------------+
| 0.67    | ------------########-------------------------------------------------------########----------------- |
| ~       | ----------##--------###-------------------------------------------------###--------###-------------- |
| ~       | -------###-------------##---------------------------------------------##--------------##------------ |
| ~       | ------#------------------##------------------------------------------#------------------##---------- |
| ~       | ----##---------------------#---------------------------------------##---------------------#--------- |
| ~       | ---#------------------------##-----------------------------------##------------------------##------- |
| ~       | -##---------------------------#---------------------------------#----------------------------#------ |
| 0.33    | #------------------------------##------------------------------#------------------------------#----- |
| ~       | ---------------------------------#---------------------------##--------------------------------##--- |
| ~       | ----------------------------------##------------------------#------------------------------------#-- |
| ~       | ------------------------------------#---------------------##--------------------------------------## |
| ~       | -------------------------------------##-----------------##------------------------------------------ |
| ~       | ---------------------------------------##-------------##-------------------------------------------- |
| ~       | -----------------------------------------###-------###---------------------------------------------- |
| 0       | --------------------------------------------#######------------------------------------------------- |
|         | v::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 0                                                                                                 99 |
+---------+------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Watch the &lt;strong&gt;0.33, 0.67&lt;/strong&gt; values generated here. This is much better.&lt;/p&gt;
&lt;h4&gt;Step 10: setting fixed scale range&lt;/h4&gt;
&lt;p&gt;When we compare two graphs, it&#39;s best if they are scaled the same way. So far, our graphs have scaled automatically according to min/max values. What we add now is a way to predefine the range. For example, dealing with &lt;strong&gt;per-cent&lt;/strong&gt; values, I may always wish to scale &lt;strong&gt;[0..100]&lt;/strong&gt;, regardless of min/max values.&lt;/p&gt;
&lt;p&gt;The code below defines a scale of &lt;strong&gt;[-1, 1]&lt;/strong&gt;. It &lt;em&gt;automatically extends&lt;/em&gt; if the range is actually insufficient, so it&#39;s safe to use. Let&#39;s see the same last graph again:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  y_scale,
  horizontal_bar
  FROM
  (
  SELECT
    @row_number := @row_number+1,
    CASE @row_number
      WHEN 1 THEN ROUND(max_value * POW(10, @value_precision))/POW(10, @value_precision)
      WHEN (@graph_rows+1)/2 THEN ROUND((max_value+min_value)*POW(10, @value_precision)/2)/POW(10, @value_precision)
      WHEN @graph_rows THEN ROUND(min_value*POW(10, @value_precision))/POW(10, @value_precision)
      ELSE &#39;~&#39;
    END AS y_scale,
    horizontal_bar,
    @bar_length := IFNULL(@bar_length, CHAR_LENGTH(horizontal_bar))
  FROM
    (SELECT @row_number := 0) AS select_row
    INNER JOIN
    (
    SELECT
      min_value,
      max_value,
      value_column,
      GROUP_CONCAT(SUBSTRING(graph_bar, tinyint_asc.value, 1) ORDER BY ordering_column SEPARATOR &#39;&#39;) AS horizontal_bar
    FROM
      (SELECT @row_number := 0) AS select_row,
      tinyint_asc
    INNER JOIN (
      SELECT
        ordering_column,
        @min_value AS min_value,
        @max_value AS max_value,
        value_column,
        @scaled_value := CONVERT((value_column-@min_value)*(@graph_rows-1)/(@max_value-@min_value), UNSIGNED) AS scaled_value,
        CONCAT(REPEAT(&#39;-&#39;,@scaled_value),&#39;#&#39;,REPEAT(&#39;-&#39;,(@graph_rows-1)-@scaled_value)) AS graph_bar
      FROM
        (
        SELECT
          @min_value := LEAST(&lt;strong&gt;IFNULL(@min_scale_value, value_column),&lt;/strong&gt; IFNULL(@min_value, value_column), value_column) AS min_value,
          @max_value := GREATEST(&lt;strong&gt;IFNULL(@max_scale_value, value_column),&lt;/strong&gt; IFNULL(@max_value, value_column), value_column) AS max_value,
          @min_range := LEAST(IFNULL(@min_range, ordering_column), ordering_column) AS min_range,
          @max_range := GREATEST(IFNULL(@max_range, ordering_column), ordering_column) AS max_range,
          ordering_column,
          value_column
        FROM
          (
            SELECT id AS ordering_column, val/3 AS value_column FROM sample_values LIMIT 100
          ) AS value_select,
          (SELECT @min_value := NULL) AS select_min,
          (SELECT @max_value := NULL) AS select_max,
          (SELECT @min_range := NULL) AS select_min_range,
          (SELECT @max_range := NULL) AS select_max_range,
          (SELECT @bar_length := NULL) AS select_bar_length,
          &lt;strong&gt;(SELECT @min_scale_value := -1) AS select_min_scale,&lt;/strong&gt;
          &lt;strong&gt;(SELECT @max_scale_value := 1) AS select_max_scale,&lt;/strong&gt;
          (SELECT @value_precision := 2) AS select_value_precision,
          (SELECT @graph_rows := 15) AS select_graph_rows
        ) AS select_range
      ) AS select_vertical
    WHERE
      tinyint_asc.value BETWEEN 1 AND CHAR_LENGTH(graph_bar)
    GROUP BY
      tinyint_asc.value
    ORDER BY
      tinyint_asc.value DESC
    ) AS select_horizontal
  ) AS select_horizontal_untitled
UNION ALL
SELECT &#39;&#39;, CONCAT(&#39;v&#39;, REPEAT(&#39;:&#39;, @bar_length-2), &#39;v&#39;)
UNION ALL
SELECT &#39;&#39;, CONCAT(@min_range, REPEAT(&#39; &#39;, @bar_length-CHAR_LENGTH(@min_range)-CHAR_LENGTH(@max_range)), @max_range)
;
+---------+------------------------------------------------------------------------------------------------------+
| y_scale | horizontal_bar                                                                                       |
+---------+------------------------------------------------------------------------------------------------------+
| 1       | ---------------------------------------------------------------------------------------------------- |
| ~       | ---------------------------------------------------------------------------------------------------- |
| ~       | ------------########-------------------------------------------------------########----------------- |
| ~       | ------######--------#######------------------------------------------######--------#######---------- |
| ~       | -#####---------------------####---------------------------------#####---------------------####------ |
| ~       | #------------------------------#####------------------------####------------------------------####-- |
| ~       | ------------------------------------#####-------------######--------------------------------------## |
| 0       | -----------------------------------------#############---------------------------------------------- |
| ~       | ---------------------------------------------------------------------------------------------------- |
| ~       | ---------------------------------------------------------------------------------------------------- |
| ~       | ---------------------------------------------------------------------------------------------------- |
| ~       | ---------------------------------------------------------------------------------------------------- |
| ~       | ---------------------------------------------------------------------------------------------------- |
| ~       | ---------------------------------------------------------------------------------------------------- |
| -1      | ---------------------------------------------------------------------------------------------------- |
|         | v::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 0                                                                                                 99 |
+---------+------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Values are still in range &lt;strong&gt;[0..0.667]&lt;/strong&gt;, but are presented on a wider scale.&lt;/p&gt;
&lt;h4&gt;Showcase&lt;/h4&gt;
&lt;p&gt;Here are some nice graphs generated, to show off.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;+---------+----------------------------------------------------------------------------------+
| y_scale | horizontal_bar                                                                   |
+---------+----------------------------------------------------------------------------------+
| 14.17   | ----------------------------------------------------------------------###------- |
| ~       | ---------------------------------------------------------------------#---#------ |
| ~       | --------------------------------------------------------------------#-----#----- |
| ~       | -------------------------------------------------------##----------------------- |
| ~       | -----------------------------------------------------##--#---------#-------#---- |
| ~       | ----------------------------------------------------#-----#--------------------- |
| ~       | ---------------------------------------###-----------------#------#------------- |
| 7.09    | -------------------------------------##---#--------#------------------------#--- |
| ~       | ------------------------------------#------#----------------#------------------- |
| ~       | -----------------------####--------#--------#-----#--------------#-----------#-- |
| ~       | ---------------------##----#-----------------#---#-----------#------------------ |
| ~       | --------------------#-------##----#-----------------------------#--------------- |
| ~       | --------#####-----##----------#--#------------#-#-------------#---------------#- |
| ~       | ----####-----##--#-------------##----------------------------------------------# |
| 0       | ####-----------##------------------------------#---------------#---------------- |
|         | v::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 2009-07-25 21:43:27                                          2009-07-29 06:02:27 |
+---------+----------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;+---------+---------------------------------------------------------------------------------+
| y_scale | horizontal_bar                                                                  |
+---------+---------------------------------------------------------------------------------+
| 0.99    | ##----------------------------------------------------------------------------- |
| ~       | --##--------------------------------------------------------------------------- |
| ~       | ----#-------------------------------------------------------------------------- |
| ~       | -----##------------------------------------------------------------------------ |
| ~       | -------#----------------------------------------------------------------------- |
| ~       | --------#---------------------------------------------------------------------- |
| ~       | ---------#--------------------------------------------------------------------- |
| 0.39    | ----------#-------------------------------------------------------------------- |
| ~       | -----------#------------------------------------------------------------------- |
| ~       | ------------#------------------------------------------------------------------ |
| ~       | -------------#--------------------########------------------------------------- |
| ~       | --------------#----------------###--------#####---------------################- |
| ~       | ---------------##-----------###----------------#####----######----------------# |
| ~       | -----------------##------###------------------------####----------------------- |
| -0.22   | -------------------######------------------------------------------------------ |
|         | v:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 2009-07-25 21:43:27                                         2009-07-29 06:02:27 |
+---------+---------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;+---------+---------------------------------------------------------------------------------+
| y_scale | horizontal_bar                                                                  |
+---------+---------------------------------------------------------------------------------+
| -0      | --------------------######################------------------------------------- |
| ~       | ------------########----------------------#######--------------------------#### |
| ~       | --------####-------------------------------------#####-----------------####---- |
| ~       | ------##----------------------------------------------##------------###-------- |
| ~       | ----##--------------------------------------------------##---------#----------- |
| ~       | ---#------------------------------------------------------#------##------------ |
| ~       | --#--------------------------------------------------------#------------------- |
| -2.39   | -#----------------------------------------------------------#---#-------------- |
| ~       | ---------------------------------------------------------------#--------------- |
| ~       | #------------------------------------------------------------#----------------- |
| ~       | ------------------------------------------------------------------------------- |
| ~       | ------------------------------------------------------------------------------- |
| ~       | ------------------------------------------------------------------------------- |
| ~       | ------------------------------------------------------------------------------- |
| -4.78   | --------------------------------------------------------------#---------------- |
|         | v:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 0                                                                          3.95 |
+---------+---------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;pre&gt;+---------+----------------------------------------------------------------------------------+
| y_scale | horizontal_bar                                                                   |
+---------+----------------------------------------------------------------------------------+
| 110.82  | ---------------------------------------------------oooooo----------------------- |
| ~       | ------------------------------------------------ooooooooooo--------------------- |
| ~       | ----------------------------------------------oooooooooooooo-------------------- |
| ~       | --------------------------------------------oooooooooooooooooo------------------ |
| ~       | ----------------------------------oooo----ooooooooooooooooooooo----------------- |
| ~       | o------------------------------ooooooooooooooooooooooooooooooooo---------------- |
| ~       | o----------------------------ooooooooooooooooooooooooooooooooooo---------------- |
| ~       | oo--------------------------ooooooooooooooooooooooooooooooooooooo--------------- |
| ~       | oo-------------------------ooooooooooooooooooooooooooooooooooooooo-------------- |
| ~       | ooo-----------------------ooooooooooooooooooooooooooooooooooooooooo------------- |
| ~       | oooo--------------------oooooooooooooooooooooooooooooooooooooooooooo------------ |
| ~       | oooo-------------------ooooooooooooooooooooooooooooooooooooooooooooo------------ |
| 85.93   | ooooo-----------------ooooooooooooooooooooooooooooooooooooooooooooooo----------- |
| ~       | oooooo---------------ooooooooooooooooooooooooooooooooooooooooooooooooo---------- |
| ~       | ooooooo-------------oooooooooooooooooooooooooooooooooooooooooooooooooo---------- |
| ~       | oooooooo-----------oooooooooooooooooooooooooooooooooooooooooooooooooooo--------- |
| ~       | ooooooooo--------ooooooooooooooooooooooooooooooooooooooooooooooooooooooo-------- |
| ~       | ooooooooooo----oooooooooooooooooooooooooooooooooooooooooooooooooooooooooo------- |
| ~       | ooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo------- |
| ~       | oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo------ |
| ~       | ooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo----- |
| ~       | oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo---- |
| ~       | ooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo--- |
| ~       | oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo-- |
| 61.04   | oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo |
|         | v::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::v |
|         | 93                                                                           172 |
+---------+----------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Why?&lt;/h4&gt;
&lt;p&gt;Why go for all this trouble? Isn&#39;t this nothing but a cool hack?&lt;/p&gt;
&lt;p&gt;Is this stuff useful? Practical?&lt;/p&gt;
&lt;p&gt;I have some agenda with this, which I&#39;ll be happy to share when comes into being. I think there are very practical uses for SQL-based graphs. I&#39;m sure many readers can think of interesting uses, other than the ones I have in mind.&lt;/p&gt;
&lt;h4&gt;Conclusion&lt;/h4&gt;
&lt;p&gt;There are many more possibilities and featured which can be built into the graphs. I&#39;m going to stop here, before this becomes too picky. I hope I have shown that some very nice graphs can be produced with SQL alone.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Generic, auto scaling, scaled SQL graphs</title>
      <link>/blog/mysql/generic-auto-scaling-scaled-sql-graphs/</link>
      <pubDate>Mon, 27 Jul 2009 12:17:16 +0000</pubDate>
      
      <guid>/blog/mysql/generic-auto-scaling-scaled-sql-graphs/</guid>
      <description>&lt;p&gt;In &lt;a href=&#34;http://code.openark.org/blog/mysql/rotating-sql-graphs-horizontally&#34;&gt;Rotating SQL graphs horizontally&lt;/a&gt;, I have shown how to rotate an ASCII SQL graph into horizontal position.&lt;/p&gt;
&lt;p&gt;I was dissatisfied with some parts of the solution, which I will show now how to fix:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I had to manually scale the graph values so as to fit nicely into screen.&lt;/li&gt;
&lt;li&gt;I had to rely on hard coded scaling schemes.&lt;/li&gt;
&lt;li&gt;I had to rely on hard coded column names.&lt;/li&gt;
&lt;li&gt;I had no y-axis legend.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I will now present an SQL query which allows for &lt;em&gt;pluggable queries&lt;/em&gt;, which creates self, &lt;em&gt;auto scaling graphs&lt;/em&gt;, along with &lt;em&gt;y-axis scales&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Using deeply nested subqueries, we will evolve a simple SELECT query into an elaborate graph. I will present the many steps required, followed by explanations and sample results. But in the end - the steps are unimportant. I&#39;ll present a &lt;em&gt;generic query&lt;/em&gt;, into which your own SELECT can be embedded, and which will provide you with the graph.&lt;/p&gt;
&lt;p&gt;We&#39;ll use the same example, found in &lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/07/graph2.sql&#34;&gt;graph.sql&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;&lt;!--more--&gt;Recap&lt;/h4&gt;
&lt;p&gt;Following is the table data we want to use. Values represent a sinus function.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT * FROM sample_values;
+-----+----------------------+
| id  | val                  |
+-----+----------------------+
|   0 |                    1 |
|   1 |     1.09983341664683 |
|   2 |     1.19866933079506 |
|   3 |     1.29552020666134 |
|   4 |     1.38941834230865 |
|   5 |      1.4794255386042 |
|   6 |     1.56464247339504 |
|   7 |     1.64421768723769 |
|   8 |     1.71735609089952 |
|   9 |     1.78332690962748 |
...
| 246 |    0.492103409609378 |
| 247 |    0.580639083926769 |
| 248 |    0.673364873895278 |
| 249 |    0.769354294072604 |
| 250 |    0.867648249902227 |
| 251 |    0.967264620669155 |
| 252 |     1.06720807252547 |
| 253 |     1.16648000353716 |
| 254 |     1.26408852138447 |
| 255 |     1.35905835402217 |
+-----+----------------------+
256 rows in set (0.00 sec)&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Step 1: Generic query&lt;/h4&gt;
&lt;p&gt;The only requirements from your query is for it to be generic. It need to provide tow columns:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ordering_column&lt;/strong&gt;: A column which orders the values, e.g. an &lt;strong&gt;AUTO_INCREMENT&lt;/strong&gt;, some &lt;strong&gt;TIMESTAMP&lt;/strong&gt; etc.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;value_column&lt;/strong&gt;: The values themselves.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In the above example, the generic query will be:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT id AS &lt;strong&gt;ordering_column&lt;/strong&gt;, val AS &lt;strong&gt;value_column&lt;/strong&gt; FROM sample_values LIMIT 100&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;From this point on, &lt;em&gt;everything else&lt;/em&gt; is self-computed. The above is the only thing that needs to change if you wish to provide your own graphs.&lt;/p&gt;
&lt;h4&gt;Problem: hard coded scaling&lt;/h4&gt;
&lt;p&gt;In the following example I generate a vertical graph, but I need to hard-code the scaling:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  ordering_column,
  CONCAT(REPEAT(&#39;-&#39;,(value_column*10+1)-1),&#39;#&#39;,REPEAT(&#39;-&#39;,22-(value_column*10+1))) AS graph_bar
FROM
  (
  SELECT id AS ordering_column, val AS value_column FROM sample_values LIMIT 100
  ) AS value_select
;
+-----------------+------------------------+
| ordering_column | graph_bar              |
+-----------------+------------------------+
|               0 | ----------#----------- |
|               1 | -----------#---------- |
|               2 | ------------#--------- |
|               3 | -------------#-------- |
|               4 | --------------#------- |
|               5 | ---------------#------ |
|               6 | ----------------#----- |
|               7 | ----------------#----- |
|               8 | -----------------#---- |
|               9 | ------------------#--- |
|              10 | ------------------#--- |
|              11 | -------------------#-- |
|              12 | -------------------#-- |
|              13 | --------------------#- |
|              14 | --------------------#- |
|              15 | --------------------#- |
|              16 | --------------------#- |&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Step 2: towards auto-scaling&lt;/h4&gt;
&lt;p&gt;In this step we will find the minimum/maximum values for &lt;strong&gt;value_column&lt;/strong&gt;. We will as yet do nothing with these.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  &lt;strong&gt;@min_value := LEAST(@min_value, value_column) AS min_value&lt;/strong&gt;,
  &lt;strong&gt;@max_value := GREATEST(@max_value, value_column) AS max_value&lt;/strong&gt;,
  ordering_column,
  CONCAT(REPEAT(&#39;-&#39;,(value_column*10+1)-1),&#39;#&#39;,REPEAT(&#39;-&#39;,22-(value_column*10+1))) AS graph_bar
FROM
  (
  SELECT id AS ordering_column, val AS value_column FROM sample_values LIMIT 100
  ) AS value_select,
  &lt;strong&gt;(SELECT @min_value := 1000000) AS select_min&lt;/strong&gt;,
  &lt;strong&gt;(SELECT @max_value := -1000000) AS select_max&lt;/strong&gt;
;
+---------------------+-----------------+-----------------+------------------------+
| min_value           | max_value       | ordering_column | graph_bar              |
+---------------------+-----------------+-----------------+------------------------+
|                   1 |               1 |               0 | ----------#----------- |
|                   1 | 1.0998334166468 |               1 | -----------#---------- |
|                   1 | 1.1986693307951 |               2 | ------------#--------- |
|                   1 | 1.2955202066613 |               3 | -------------#-------- |
|                   1 | 1.3894183423086 |               4 | --------------#------- |
|                   1 | 1.4794255386042 |               5 | ---------------#------ |
|                   1 |  1.564642473395 |               6 | ----------------#----- |
|                   1 | 1.6442176872377 |               7 | ----------------#----- |
|                   1 | 1.7173560908995 |               8 | -----------------#---- |
|                   1 | 1.7833269096275 |               9 | ------------------#--- |
|                   1 | 1.8414709848079 |              10 | ------------------#--- |
|                   1 | 1.8912073600614 |              11 | -------------------#-- |
|                   1 | 1.9320390859672 |              12 | -------------------#-- |
|                   1 | 1.9635581854172 |              13 | --------------------#- |
|                   1 | 1.9854497299885 |              14 | --------------------#- |
|                   1 |  1.997494986604 |              15 | --------------------#- |
|                   1 | 1.9995736030415 |              16 | --------------------#- |
|                   1 | 1.9995736030415 |              17 | --------------------#- |
|                   1 | 1.9995736030415 |              18 | --------------------#- |
|                   1 | 1.9995736030415 |              19 | -------------------#-- |
|                   1 | 1.9995736030415 |              20 | -------------------#-- |
|                   1 | 1.9995736030415 |              21 | -------------------#-- |
|                   1 | 1.9995736030415 |              22 | ------------------#--- |
|                   1 | 1.9995736030415 |              23 | -----------------#---- |
|                   1 | 1.9995736030415 |              24 | -----------------#---- |
|                   1 | 1.9995736030415 |              25 | ----------------#----- |
|                   1 | 1.9995736030415 |              26 | ---------------#------ |
|                   1 | 1.9995736030415 |              27 | --------------#------- |
|                   1 | 1.9995736030415 |              28 | -------------#-------- |
|                   1 | 1.9995736030415 |              29 | ------------#--------- |
|                   1 | 1.9995736030415 |              30 | -----------#---------- |
|                   1 | 1.9995736030415 |              31 | ----------#----------- |
|    0.94162585657242 | 1.9995736030415 |              32 | ---------#------------ |
|    0.84225430585675 | 1.9995736030415 |              33 | --------#------------- |
|    0.74445889797317 | 1.9995736030415 |              34 | -------#-------------- |
...&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;I&#39;m using ugly values for initial min/max comparison (-100000, 1000000). I&#39;ll soon get rid of them, don&#39;t worry!&lt;/p&gt;
&lt;h4&gt;Step 3: formalizing min/max values&lt;/h4&gt;
&lt;p&gt;Using another sub-query, we will isolate the minimum/maximum values, and forget about the graph for the moment.&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  &lt;strong&gt;@min_value&lt;/strong&gt;,
  &lt;strong&gt;@max_value&lt;/strong&gt;,
  ordering_column,
  value_column
FROM
  (
  SELECT
    @min_value := LEAST(@min_value, value_column) AS min_value,
    @max_value := GREATEST(@max_value, value_column) AS max_value,
    ordering_column,
    value_column
  FROM
    (
    SELECT id AS ordering_column, val AS value_column FROM sample_values LIMIT 100
    ) AS value_select,
    (SELECT @min_value := 1000000) AS select_min,
    (SELECT @max_value := -1000000) AS select_max
  ) AS select_range
;
+---------------------+-----------------+-----------------+----------------------+
| @min_value          | @max_value      | ordering_column | value_column         |
+---------------------+-----------------+-----------------+----------------------+
| 7.6742435899169e-05 | 1.9995736030415 |               0 |                    1 |
| 7.6742435899169e-05 | 1.9995736030415 |               1 |     1.09983341664683 |
| 7.6742435899169e-05 | 1.9995736030415 |               2 |     1.19866933079506 |
| 7.6742435899169e-05 | 1.9995736030415 |               3 |     1.29552020666134 |
| 7.6742435899169e-05 | 1.9995736030415 |               4 |     1.38941834230865 |
| 7.6742435899169e-05 | 1.9995736030415 |               5 |      1.4794255386042 |
| 7.6742435899169e-05 | 1.9995736030415 |               6 |     1.56464247339504 |
| 7.6742435899169e-05 | 1.9995736030415 |               7 |     1.64421768723769 |
| 7.6742435899169e-05 | 1.9995736030415 |               8 |     1.71735609089952 |
| 7.6742435899169e-05 | 1.9995736030415 |               9 |     1.78332690962748 |
| 7.6742435899169e-05 | 1.9995736030415 |              10 |      1.8414709848079 |
| 7.6742435899169e-05 | 1.9995736030415 |              11 |     1.89120736006144 |
...&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Step 4: scaling the values&lt;/h4&gt;
&lt;p&gt;In this step I&#39;ll do two things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Get rid of ugly hard coded values for min/max comparison. I&#39;ll use the &lt;strong&gt;IFNULL&lt;/strong&gt; function to check for initial conditions.&lt;/li&gt;
&lt;li&gt;Introduce self scaling: I will assume a 21-rows high graph is desired, and will auto-scale the values to fit in. Don&#39;t worry, I&#39;ll get rid of those values later on!&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  @min_value AS min_value,
  @max_value AS max_value,
  value_column,
  &lt;strong&gt;@scaled_value := CONVERT((value_column-@min_value)*20/(@max_value-@min_value), UNSIGNED) AS scaled_value&lt;/strong&gt;,
  &lt;strong&gt;CONCAT(REPEAT(&#39;-&#39;,@scaled_value),&#39;#&#39;,REPEAT(&#39;-&#39;,20-@scaled_value)) AS graph_bar&lt;/strong&gt;
FROM
  (
  SELECT
    @min_value := LEAST(&lt;strong&gt;IFNULL(@min_value, value_column)&lt;/strong&gt;, value_column) AS min_value,
    @max_value := GREATEST(&lt;strong&gt;IFNULL(@max_value, value_column)&lt;/strong&gt;, value_column) AS max_value,
    ordering_column,
    value_column
  FROM
    (
    SELECT id AS ordering_column, val AS value_column FROM sample_values LIMIT 100
    ) AS value_select,
    (SELECT @min_value := &lt;strong&gt;NULL&lt;/strong&gt;) AS select_min,
    (SELECT @max_value := &lt;strong&gt;NULL&lt;/strong&gt;) AS select_max
  ) AS select_range
;
+---------------------+-----------------+----------------------+--------------+-----------------------+
| min_value           | max_value       | value_column         | scaled_value | graph_bar             |
+---------------------+-----------------+----------------------+--------------+-----------------------+
| 7.6742435899169e-05 | 1.9995736030415 |                    1 |           10 | ----------#---------- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.09983341664683 |           11 | -----------#--------- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.19866933079506 |           12 | ------------#-------- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.29552020666134 |           13 | -------------#------- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.38941834230865 |           14 | --------------#------ |
| 7.6742435899169e-05 | 1.9995736030415 |      1.4794255386042 |           15 | ---------------#----- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.56464247339504 |           16 | ----------------#---- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.64421768723769 |           16 | ----------------#---- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.71735609089952 |           17 | -----------------#--- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.78332690962748 |           18 | ------------------#-- |
| 7.6742435899169e-05 | 1.9995736030415 |      1.8414709848079 |           18 | ------------------#-- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.89120736006144 |           19 | -------------------#- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.93203908596723 |           19 | -------------------#- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.96355818541719 |           20 | --------------------# |
| 7.6742435899169e-05 | 1.9995736030415 |     1.98544972998846 |           20 | --------------------# |
| 7.6742435899169e-05 | 1.9995736030415 |     1.99749498660405 |           20 | --------------------# |
| 7.6742435899169e-05 | 1.9995736030415 |      1.9995736030415 |           20 | --------------------# |
| 7.6742435899169e-05 | 1.9995736030415 |     1.99166481045247 |           20 | --------------------# |
| 7.6742435899169e-05 | 1.9995736030415 |      1.9738476308782 |           20 | --------------------# |
| 7.6742435899169e-05 | 1.9995736030415 |     1.94630008768741 |           19 | -------------------#- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.90929742682568 |           19 | -------------------#- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.86320936664887 |           19 | -------------------#- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.80849640381959 |           18 | ------------------#-- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.74570521217672 |           17 | -----------------#--- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.67546318055115 |           17 | -----------------#--- |
| 7.6742435899169e-05 | 1.9995736030415 |     1.59847214410396 |           16 | ----------------#---- |&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;I have now re-introduced the graph. Note that while values are in the range 0..2, the SQL query &lt;em&gt;automatically scales&lt;/em&gt; to a 1-21 long graph bar.&lt;/p&gt;
&lt;h4&gt;Step 5: rotation&lt;/h4&gt;
&lt;p&gt;Shall we now present this as a horizontal graph?&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  &lt;strong&gt;GROUP_CONCAT(SUBSTRING(graph_bar, tinyint_asc.value, 1) ORDER BY ordering_column SEPARATOR &#39;&#39;) AS `result`&lt;/strong&gt;
FROM
  &lt;strong&gt;tinyint_asc&lt;/strong&gt;
&lt;strong&gt;INNER JOIN&lt;/strong&gt; (
  SELECT
    ordering_column,
    @min_value AS min_value,
    @max_value AS max_value,
    value_column,
    @scaled_value := CONVERT((value_column-@min_value)*20/(@max_value-@min_value), UNSIGNED) AS scaled_value,
    CONCAT(REPEAT(&#39;-&#39;,@scaled_value),&#39;#&#39;,REPEAT(&#39;-&#39;,20-@scaled_value)) AS graph_bar
  FROM
    (
    SELECT
      @min_value := LEAST(IFNULL(@min_value, value_column), value_column) AS min_value,
      @max_value := GREATEST(IFNULL(@max_value, value_column), value_column) AS max_value,
      ordering_column,
      value_column
    FROM
      (
      SELECT id AS ordering_column, val AS value_column FROM sample_values LIMIT 100
      ) AS value_select,
      (SELECT @min_value := NULL) AS select_min,
      (SELECT @max_value := NULL) AS select_max
    ) AS select_range
  ) AS select_vertical
WHERE
  &lt;strong&gt;tinyint_asc.value BETWEEN 1 AND CHAR_LENGTH(graph_bar)&lt;/strong&gt;
&lt;strong&gt;GROUP BY&lt;/strong&gt;
  &lt;strong&gt;tinyint_asc.value&lt;/strong&gt;
&lt;strong&gt;ORDER BY&lt;/strong&gt;
  &lt;strong&gt;tinyint_asc.value DESC;&lt;/strong&gt;
;
+------------------------------------------------------------------------------------------------------+
| result                                                                                               |
+------------------------------------------------------------------------------------------------------+
| -------------######---------------------------------------------------------######------------------ |
| -----------##------###---------------------------------------------------###------###--------------- |
| ---------##-----------#-------------------------------------------------#------------#-------------- |
| --------#--------------##---------------------------------------------##--------------##------------ |
| ------##-----------------#-------------------------------------------#------------------#----------- |
| -----#--------------------#-----------------------------------------#--------------------#---------- |
| ----#----------------------#---------------------------------------#----------------------#--------- |
| ---#------------------------#-------------------------------------#------------------------#-------- |
| --#--------------------------#-----------------------------------#--------------------------#------- |
| -#----------------------------#---------------------------------#----------------------------#------ |
| #------------------------------#-------------------------------#------------------------------#----- |
| --------------------------------#-----------------------------#--------------------------------#---- |
| ---------------------------------#---------------------------#----------------------------------#--- |
| ----------------------------------#-------------------------#------------------------------------#-- |
| -----------------------------------##----------------------#--------------------------------------#- |
| -------------------------------------#--------------------#----------------------------------------# |
| --------------------------------------#-----------------##------------------------------------------ |
| ---------------------------------------#---------------#-------------------------------------------- |
| ----------------------------------------##-----------##--------------------------------------------- |
| ------------------------------------------##-------##----------------------------------------------- |
| --------------------------------------------#######------------------------------------------------- |
+------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;We now have a &lt;em&gt;self-scaling&lt;/em&gt; horizontal graph! Phew!&lt;/p&gt;
&lt;p&gt;But I&#39;m not satisfied yet.&lt;/p&gt;
&lt;h4&gt;Step 6: towards Y-axis scaling&lt;/h4&gt;
&lt;p&gt;We will now introduce min/max Y-scale values into the graph. Note the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I&#39;ll be using a counter to count rows.&lt;/li&gt;
&lt;li&gt;I&#39;ll rely on previous knowledge of hard-coded 21 rows value (I promise, this will be fixed soon).&lt;/li&gt;
&lt;li&gt;We already have min/max values. Using the two, I&#39;ll also provide the mid-value.&lt;/li&gt;
&lt;li&gt;I chose to use &lt;strong&gt;ROUND()&lt;/strong&gt;. This may not be the best idea when your values are very small fractions. Remove the&lt;strong&gt; ROUND()&lt;/strong&gt; if it does not fit in with your values.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  &lt;strong&gt;@row_number := @row_number+1,&lt;/strong&gt;
  &lt;strong&gt;CASE @row_number&lt;/strong&gt;
    &lt;strong&gt;WHEN 1  THEN ROUND(max_value)&lt;/strong&gt;
    &lt;strong&gt;WHEN 11 THEN ROUND((max_value+min_value)/2)&lt;/strong&gt;
    &lt;strong&gt;WHEN 21 THEN ROUND(min_value)&lt;/strong&gt;
    &lt;strong&gt;ELSE &#39;&#39;&lt;/strong&gt;
  &lt;strong&gt;END AS y_scale&lt;/strong&gt;,
  horizontal_bar
FROM
  &lt;strong&gt;(SELECT @row_number := 0) AS select_row&lt;/strong&gt;
  INNER JOIN
  (
  SELECT
    min_value,
    max_value,
    value_column,
    GROUP_CONCAT(SUBSTRING(graph_bar, tinyint_asc.value, 1) ORDER BY ordering_column SEPARATOR &#39;&#39;) AS horizontal_bar
  FROM
    (SELECT @row_number := 0) AS select_row,
    tinyint_asc
  INNER JOIN (
    SELECT
      ordering_column,
      @min_value AS min_value,
      @max_value AS max_value,
      value_column,
      @scaled_value := CONVERT((value_column-@min_value)*20/(@max_value-@min_value), UNSIGNED) AS scaled_value,
      CONCAT(REPEAT(&#39;-&#39;,@scaled_value),&#39;#&#39;,REPEAT(&#39;-&#39;,20-@scaled_value)) AS graph_bar
    FROM
      (
      SELECT
        @min_value := LEAST(IFNULL(@min_value, value_column), value_column) AS min_value,
        @max_value := GREATEST(IFNULL(@max_value, value_column), value_column) AS max_value,
        ordering_column,
        value_column
      FROM
        (
        SELECT id AS ordering_column, val AS value_column FROM sample_values LIMIT 100
        ) AS value_select,
        (SELECT @min_value := NULL) AS select_min,
        (SELECT @max_value := NULL) AS select_max
      ) AS select_range
    ) AS select_vertical
  WHERE
    tinyint_asc.value BETWEEN 1 AND CHAR_LENGTH(graph_bar)
  GROUP BY
    tinyint_asc.value
  ORDER BY
    tinyint_asc.value DESC
  ) AS select_horizontal
;+------------------------------+---------+------------------------------------------------------------------------------------------------------+
| @row_number := @row_number+1 | y_scale | horizontal_bar                                                                                       |
+------------------------------+---------+------------------------------------------------------------------------------------------------------+
|                            1 | 2       | -------------######---------------------------------------------------------######------------------ |
|                            2 |         | -----------##------###---------------------------------------------------###------###--------------- |
|                            3 |         | ---------##-----------#-------------------------------------------------#------------#-------------- |
|                            4 |         | --------#--------------##---------------------------------------------##--------------##------------ |
|                            5 |         | ------##-----------------#-------------------------------------------#------------------#----------- |
|                            6 |         | -----#--------------------#-----------------------------------------#--------------------#---------- |
|                            7 |         | ----#----------------------#---------------------------------------#----------------------#--------- |
|                            8 |         | ---#------------------------#-------------------------------------#------------------------#-------- |
|                            9 |         | --#--------------------------#-----------------------------------#--------------------------#------- |
|                           10 |         | -#----------------------------#---------------------------------#----------------------------#------ |
|                           11 | 1       | #------------------------------#-------------------------------#------------------------------#----- |
|                           12 |         | --------------------------------#-----------------------------#--------------------------------#---- |
|                           13 |         | ---------------------------------#---------------------------#----------------------------------#--- |
|                           14 |         | ----------------------------------#-------------------------#------------------------------------#-- |
|                           15 |         | -----------------------------------##----------------------#--------------------------------------#- |
|                           16 |         | -------------------------------------#--------------------#----------------------------------------# |
|                           17 |         | --------------------------------------#-----------------##------------------------------------------ |
|                           18 |         | ---------------------------------------#---------------#-------------------------------------------- |
|                           19 |         | ----------------------------------------##-----------##--------------------------------------------- |
|                           20 |         | ------------------------------------------##-------##----------------------------------------------- |
|                           21 | 0       | --------------------------------------------#######------------------------------------------------- |
+------------------------------+---------+------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Well, now we&#39;re getting somewhere!&lt;/p&gt;
&lt;h4&gt;Step 7: cleaning up&lt;/h4&gt;
&lt;p&gt;In this step I&#39;ll do the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Using yet another subquery (how many do we have already?), I&#39;ll get rid of the counter column.&lt;/li&gt;
&lt;li&gt;I&#39;ll remove the 21-rows hard coding. There will only be one session variable set to this value; All calculations will scale themselves according to that value.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  y_scale,
  horizontal_bar
  FROM
  (
  SELECT
    @row_number := @row_number+1,
    CASE @row_number
      WHEN 1  THEN ROUND(max_value)
      WHEN &lt;strong&gt;(@graph_rows+1)/2&lt;/strong&gt; THEN ROUND((max_value+min_value)/2)
      WHEN &lt;strong&gt;@graph_rows&lt;/strong&gt; THEN ROUND(min_value)
      ELSE &#39;&#39;
    END AS y_scale,
    horizontal_bar
  FROM
    (SELECT @row_number := 0) AS select_row
    INNER JOIN
    (
    SELECT
      min_value,
      max_value,
      value_column,
      GROUP_CONCAT(SUBSTRING(graph_bar, tinyint_asc.value, 1) ORDER BY ordering_column SEPARATOR &#39;&#39;) AS horizontal_bar
    FROM
      (SELECT @row_number := 0) AS select_row,
      tinyint_asc
    INNER JOIN (
      SELECT
        ordering_column,
        @min_value AS min_value,
        @max_value AS max_value,
        value_column,
        @scaled_value := CONVERT((value_column-@min_value)*(@graph_rows-1)/(@max_value-@min_value), UNSIGNED) AS scaled_value,
        CONCAT(REPEAT(&#39;-&#39;,@scaled_value),&#39;#&#39;,REPEAT(&#39;-&#39;,(@graph_rows-1)-@scaled_value)) AS graph_bar
      FROM
        (
        SELECT
          @min_value := LEAST(IFNULL(@min_value, value_column), value_column) AS min_value,
          @max_value := GREATEST(IFNULL(@max_value, value_column), value_column) AS max_value,
          ordering_column,
          value_column
        FROM
          (
            SELECT id AS ordering_column, val AS value_column
            FROM sample_values LIMIT 100
          ) AS value_select,
          (SELECT @min_value := NULL) AS select_min,
          (SELECT @max_value := NULL) AS select_max,
          &lt;strong&gt;(SELECT @graph_rows := 21) AS select_graph_rows&lt;/strong&gt;
        ) AS select_range
      ) AS select_vertical
    WHERE
      tinyint_asc.value BETWEEN 1 AND CHAR_LENGTH(graph_bar)
    GROUP BY
      tinyint_asc.value
    ORDER BY
      tinyint_asc.value DESC
    ) AS select_horizontal
  ) AS select_horizontal_untitled
;
+---------+------------------------------------------------------------------------------------------------------+
| y_scale | horizontal_bar                                                                                       |
+---------+------------------------------------------------------------------------------------------------------+
| 2       | -------------######---------------------------------------------------------######------------------ |
|         | -----------##------###---------------------------------------------------###------###--------------- |
|         | ---------##-----------#-------------------------------------------------#------------#-------------- |
|         | --------#--------------##---------------------------------------------##--------------##------------ |
|         | ------##-----------------#-------------------------------------------#------------------#----------- |
|         | -----#--------------------#-----------------------------------------#--------------------#---------- |
|         | ----#----------------------#---------------------------------------#----------------------#--------- |
|         | ---#------------------------#-------------------------------------#------------------------#-------- |
|         | --#--------------------------#-----------------------------------#--------------------------#------- |
|         | -#----------------------------#---------------------------------#----------------------------#------ |
| 1       | #------------------------------#-------------------------------#------------------------------#----- |
|         | --------------------------------#-----------------------------#--------------------------------#---- |
|         | ---------------------------------#---------------------------#----------------------------------#--- |
|         | ----------------------------------#-------------------------#------------------------------------#-- |
|         | -----------------------------------##----------------------#--------------------------------------#- |
|         | -------------------------------------#--------------------#----------------------------------------# |
|         | --------------------------------------#-----------------##------------------------------------------ |
|         | ---------------------------------------#---------------#-------------------------------------------- |
|         | ----------------------------------------##-----------##--------------------------------------------- |
|         | ------------------------------------------##-------##----------------------------------------------- |
| 0       | --------------------------------------------#######------------------------------------------------- |
+---------+------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;And that&#39;s as far as we go in our example.&lt;/p&gt;
&lt;h4&gt;Proof of concept&lt;/h4&gt;
&lt;p&gt;Just to prove my point, I&#39;ll present another SQL graph. This time the function is &lt;strong&gt;x*sin(x)&lt;/strong&gt;, which has a nice curve.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Take a look at the &lt;strong&gt;bold text&lt;/strong&gt; in the query. This is &lt;em&gt;the only thing&lt;/em&gt; that changes. Replace this with your generic query, and you&#39;re done!&lt;/li&gt;
&lt;li&gt;I&#39;ve also set the number of rows to be &lt;strong&gt;11&lt;/strong&gt;. Also find bold text in query. Change this to scale the graph!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note how the graph &lt;em&gt;automatically&lt;/em&gt; scales to the range [-17,16].&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  y_scale,
  horizontal_bar
  FROM
  (
  SELECT
    @row_number := @row_number+1,
    CASE @row_number
      WHEN 1  THEN ROUND(max_value)
      WHEN (@graph_rows+1)/2 THEN ROUND((max_value+min_value)/2)
      WHEN @graph_rows THEN ROUND(min_value)
      ELSE &#39;&#39;
    END AS y_scale,
    horizontal_bar
  FROM
    (SELECT @row_number := 0) AS select_row
    INNER JOIN
    (
    SELECT
      min_value,
      max_value,
      value_column,
      GROUP_CONCAT(SUBSTRING(graph_bar, tinyint_asc.value, 1) ORDER BY ordering_column SEPARATOR &#39;&#39;) AS horizontal_bar
    FROM
      (SELECT @row_number := 0) AS select_row,
      tinyint_asc
    INNER JOIN (
      SELECT
        ordering_column,
        @min_value AS min_value,
        @max_value AS max_value,
        value_column,
        @scaled_value := CONVERT((value_column-@min_value)*(@graph_rows-1)/(@max_value-@min_value), UNSIGNED) AS scaled_value,
        CONCAT(REPEAT(&#39;-&#39;,@scaled_value),&#39;#&#39;,REPEAT(&#39;-&#39;,(@graph_rows-1)-@scaled_value)) AS graph_bar
      FROM
        (
        SELECT
          @min_value := LEAST(IFNULL(@min_value, value_column), value_column) AS min_value,
          @max_value := GREATEST(IFNULL(@max_value, value_column), value_column) AS max_value,
          ordering_column,
          value_column
        FROM
          (
            &lt;strong&gt;SELECT id AS ordering_column, SIN(id/5)*id/5 AS value_column FROM sample_values LIMIT 100&lt;/strong&gt;
          ) AS value_select,
          (SELECT @min_value := NULL) AS select_min,
          (SELECT @max_value := NULL) AS select_max,
          (SELECT @graph_rows := &lt;strong&gt;11&lt;/strong&gt;) AS select_graph_rows
        ) AS select_range
      ) AS select_vertical
    WHERE
      tinyint_asc.value BETWEEN 1 AND CHAR_LENGTH(graph_bar)
    GROUP BY
      tinyint_asc.value
    ORDER BY
      tinyint_asc.value DESC
    ) AS select_horizontal
  ) AS select_horizontal_untitled
;
+---------+------------------------------------------------------------------------------------------------------+
| y_scale | horizontal_bar                                                                                       |
+---------+------------------------------------------------------------------------------------------------------+
| 16      | ---------------------------------------------------------------------------------------------------# |
|         | --------------------------------------------------------------------#######-----------------------#- |
|         | ---------------------------------------##-------------------------##-------#---------------------#-- |
|         | -----------------------------------####--####--------------------#----------##------------------#--- |
|         | ------########-------------------##----------##-----------------#-------------#----------------#---- |
| -1      | ######--------#####-----------###--------------##-------------##---------------#--------------#----- |
|         | -------------------###########-------------------##----------#------------------#------------#------ |
|         | ---------------------------------------------------##------##--------------------#----------#------- |
|         | -----------------------------------------------------######-----------------------#--------#-------- |
|         | -----------------------------------------------------------------------------------##----##--------- |
| -17     | -------------------------------------------------------------------------------------####----------- |
+---------+------------------------------------------------------------------------------------------------------&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Conclusion&lt;/h4&gt;
&lt;p&gt;There goes my Saturday afternoon nap.&lt;/p&gt;
&lt;p&gt;To be done:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Present X-axis values.&lt;/li&gt;
&lt;li&gt;Do better work with value precision.&lt;/li&gt;
&lt;li&gt;Present proper titles. This is easy with session variables. I&#39;ll make a draft.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To be continued... (and concluded, I don&#39;t mean to drag this much longer).&lt;/p&gt;
&lt;p&gt;[Continues on: &lt;a href=&#34;http://code.openark.org/blog/mysql/auto-scaling-scaled-sql-graphs-concluded&#34;&gt;Auto scaling, scaled SQL graphs concluded&lt;/a&gt;]&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Rotating SQL graphs horizontally</title>
      <link>/blog/mysql/rotating-sql-graphs-horizontally/</link>
      <pubDate>Fri, 24 Jul 2009 06:00:12 +0000</pubDate>
      
      <guid>/blog/mysql/rotating-sql-graphs-horizontally/</guid>
      <description>&lt;p&gt;We all love graphs. We all love SQL hacks. We all know the SQL hack which displays a character-based graph (example follows for those unfamiliar).&lt;/p&gt;
&lt;p&gt;But we all love &lt;em&gt;horizontal&lt;/em&gt; graphs, not vertical ones. We are used to the X axis being horizontal, Y being vertical. Not vice versa.&lt;/p&gt;
&lt;p&gt;In this post I&#39;ll present a SQL hack which rotates a vertical graph to horizontal. In fact, the technique shown will rotate any &#39;textual image&#39;; but graphs are a nice example.&lt;/p&gt;
&lt;h4&gt;A vertical graph example&lt;/h4&gt;
&lt;p&gt;What&#39;s prettier than a sinus curve? I have prepared a simple table that will serve nicely, and can be found in &lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/07/graph.sql&#34;&gt;graph_tables.sql&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;!--more--&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT * FROM sample_values;
+-----+----------------------+
| id  | val                  |
+-----+----------------------+
|   0 |                    1 |
|   1 |     1.09983341664683 |
|   2 |     1.19866933079506 |
|   3 |     1.29552020666134 |
|   4 |     1.38941834230865 |
|   5 |      1.4794255386042 |
|   6 |     1.56464247339504 |
|   7 |     1.64421768723769 |
|   8 |     1.71735609089952 |
|   9 |     1.78332690962748 |
...
| 246 |    0.492103409609378 |
| 247 |    0.580639083926769 |
| 248 |    0.673364873895278 |
| 249 |    0.769354294072604 |
| 250 |    0.867648249902227 |
| 251 |    0.967264620669155 |
| 252 |     1.06720807252547 |
| 253 |     1.16648000353716 |
| 254 |     1.26408852138447 |
| 255 |     1.35905835402217 |
+-----+----------------------+
256 rows in set (0.00 sec)&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;The common trick for displaying a graph is something like:&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  id,
  CONCAT(REPEAT(&#39;-&#39;,(val*10+1)-1),&#39;#&#39;,REPEAT(&#39;-&#39;,22-(val*10+1))) AS bar
FROM
  sample_values
LIMIT 100
+----+------------------------+
| id | bar                    |
+----+------------------------+
|  0 | ----------#----------- |
|  1 | -----------#---------- |
|  2 | ------------#--------- |
|  3 | -------------#-------- |
|  4 | --------------#------- |
|  5 | ---------------#------ |
|  6 | ----------------#----- |
|  7 | ----------------#----- |
|  8 | -----------------#---- |
|  9 | ------------------#--- |
| 10 | ------------------#--- |
| 11 | -------------------#-- |
| 12 | -------------------#-- |
| 13 | --------------------#- |
| 14 | --------------------#- |
| 15 | --------------------#- |
| 16 | --------------------#- |
| 17 | --------------------#- |
| 18 | --------------------#- |
| 19 | -------------------#-- |
| 20 | -------------------#-- |
| 21 | -------------------#-- |
| 22 | ------------------#--- |
| 23 | -----------------#---- |
| 24 | -----------------#---- |
| 25 | ----------------#----- |
| 26 | ---------------#------ |
| 27 | --------------#------- |
...
+----+------------------------+
100 rows in set (0.00 sec)&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;In the above I&#39;ve explicitly stretched values for them to be presentable.&lt;/blockquote&gt;
&lt;p&gt;So that&#39;s the vertical graph. It&#39;s not easy to read, plus you need to scroll down on your terminal to find out what&#39;s going on. Can we rotate it?&lt;/p&gt;
&lt;h4&gt;Rotating the graph&lt;/h4&gt;
&lt;p&gt;We will combine the String Walking technique with &lt;a title=&#34;Unwalking a string with GROUP_CONCAT&#34; href=&#34;http://code.openark.org/blog/mysql/unwalking-a-string-with-group_concat&#34;&gt;String Unwalking&lt;/a&gt;. What we need and assume is as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; The above graph pads the bars up to some fixed length.&lt;/li&gt;
&lt;li&gt;Said length is not too high, so as to fit nicely within our screen.&lt;/li&gt;
&lt;li&gt;We have an integers table, used for string walking.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The idea is to iterate the textual column character by character &lt;em&gt;from end to start&lt;/em&gt; (done by string walking), and convert each such character column to row (done by string unwalking).&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;SELECT
  GROUP_CONCAT(SUBSTRING(bar,tinyint_asc.value,1) ORDER BY id SEPARATOR &#39;&#39;) AS `Sinus graph`
FROM
  tinyint_asc
INNER JOIN (
  SELECT
    id,
    CONCAT(REPEAT(&#39;-&#39;,(val*10+1)-1),&#39;#&#39;,REPEAT(&#39;-&#39;,22-(val*10+1))) AS bar
  FROM
    sample_values
  LIMIT 100) sel_graph
WHERE
  tinyint_asc.value BETWEEN 1 AND CHAR_LENGTH(bar)
GROUP BY
  tinyint_asc.value
ORDER BY
  tinyint_asc.value DESC;

+------------------------------------------------------------------------------------------------------+
| Sinus graph                                                                                          |
+------------------------------------------------------------------------------------------------------+
| ---------------------------------------------------------------------------------------------------- |
| -------------######---------------------------------------------------------######------------------ |
| -----------##------###---------------------------------------------------###------###--------------- |
| ---------##-----------#-------------------------------------------------#------------#-------------- |
| --------#--------------##---------------------------------------------##--------------##------------ |
| ------##-----------------#-------------------------------------------#------------------#----------- |
| -----#--------------------#-----------------------------------------#--------------------#---------- |
| ----#----------------------#---------------------------------------#----------------------#--------- |
| ---#------------------------#-------------------------------------#------------------------#-------- |
| --#--------------------------#-----------------------------------#--------------------------#------- |
| -#----------------------------#---------------------------------#----------------------------#------ |
| #------------------------------#-------------------------------#------------------------------#----- |
| --------------------------------#-----------------------------#--------------------------------#---- |
| ---------------------------------#---------------------------#----------------------------------#--- |
| ----------------------------------#-------------------------#------------------------------------#-- |
| -----------------------------------##----------------------#--------------------------------------#- |
| -------------------------------------#--------------------#----------------------------------------# |
| --------------------------------------#-----------------##------------------------------------------ |
| ---------------------------------------#---------------#-------------------------------------------- |
| ----------------------------------------##-----------##--------------------------------------------- |
| ------------------------------------------##-------##----------------------------------------------- |
| --------------------------------------------#######------------------------------------------------- |
+------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;Now that&#39;s much prettier, isn&#39;t it?&lt;/p&gt;
&lt;h4&gt;Crazy stuff challenge&lt;/h4&gt;
&lt;p&gt;For those eager to improve upon this, I raise a few challenges (no prize but fame, though). Use the given data (&lt;a href=&#34;http://code.openark.org/blog/wp-content/uploads/2009/07/graph.sql&#34;&gt;graph_tables.sql&lt;/a&gt;), to produce:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;(Vertical) values on the X-axis for all graph points.&lt;/li&gt;
&lt;li&gt;Min/max values for Y-axis, on separate column.&lt;/li&gt;
&lt;li&gt;As I understand it, full, in place, values for Y-axis is not possible; please prove me wrong!&lt;/li&gt;
&lt;li&gt;Other crazy stuff?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Please add solutions in comments!&lt;/p&gt;
&lt;p&gt;[Continues on: &lt;a href=&#34;http://code.openark.org/blog/mysql/generic-auto-scaling-scaled-sql-graphs&#34;&gt;Generic, auto scaling, scaled SQL graphs&lt;/a&gt;]&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>