<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>Checking for string permutation &middot; code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blog/img/favicon.ico" type="image/x-icon" />


  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link">
        Shlomi Noach
        
          <div class="avatar-container">
        	  <div class="avatar-img-border">
                <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
        	  </div>
        	</div>
        
      </a>
    </li>

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">

<div class="header-post">
  <div>code.openark.org</div>
</div>

<div class="header">
  <h1>Checking for string permutation</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>

    <time>20 Jan 2010</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/math">Math</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/sql">SQL</a>
          
        </span>
      
    
  </div>

</div>


  <p>A permutation is a change of places. Thus, <strong>'lolhe'</strong> is a permuted <strong>'hello'</strong> (commonly referred to as 'scrambled text').</p>
<p>I wish to present an SQL solution for checking if two strings are permutations of the same text.</p>
<h4>About permutations</h4>
<p>So, if <strong>'lolhe'</strong> is a permutation of <strong>'hello'</strong>, then <strong>'hello'</strong> is a permutation of <strong>'lolhe'</strong>, as well; and both are permutations of <strong>'elloh'</strong>. The <strong>REVERSE()</strong> of a text is an example of permutation. Mathematically, string permutation is an equivalence relation, and divides all strings to equivalence classes.</p>
<h4>Use cases</h4>
<ul>
<li>We may be interested in permutations when a user chooses a password. We may disallow a password which is identical to the login name; but we may also disallow upper-lower-case-only transformations of the text. We may still disallow a <em>permutation</em> of the text.</li>
<li>On a slightly different scale, the two queries: <strong>SELECT * FROM City WHERE id IN (5, 21, 13)</strong> and <strong>SELECT * FROM City WHERE id IN (13, 5, 21)</strong> are identical. Here, the permutation is not with string characters, but with string tokens. While the solution discussed is targeted at string characters, it can be easily converted to work with string tokens.</li>
</ul>
<h4>Checking for permutation</h4>
<p>The solution I'm suggesting checks for permutation between 2 strings by permuting both to a third, <strong>normal form</strong>. The two string are permutations of each other if both have <em>the same normal form</em>.</p>
<p><!--more-->What exactly <em>is</em> a normal form? Well, anything you like, really, as long as it's deterministic and works the same for all elements in the equivalence class (mathematically speaking, this was a really bad definition, I know).</p>
<p>Enough of mathematical notions: on the practical side, I'll normalize 'CAB' to 'ABC', and 'DOG' to 'DGO'. Can you see what normalization means here? I'm merely rearranging the characters in alphabetical order. This rearrangement is in itself a permutation of the string (hence, one last mathematical statement, it can be seen as a representative of the equivalence class).</p>
<p>So, to see if two strings are permutations of each other, we rearrange both in alphabetical order, and see if we got the same text. <strong>'hello'</strong> and <strong>'lolhe'</strong> both normalize to <strong>'ehllo'</strong>, hence are permutations.</p>
<h4>Normalizing the text</h4>
<p>Down to business: how do we normalize a text using SQL? Well, once again, <a href="http://code.openark.org/blog/mysql/unwalking-a-string-with-group_concat">string walking and string unwalking</a> to the rescue. The trick is to break the string apart (to distinct characters), then re-combine the characters, but instead of in original order, do that in ascending order.</p>
<p>Breaking of the word 'hello' is as follows:</p>
<blockquote>
<pre>SELECT
 SUBSTRING(s, value+1, 1) AS c
FROM
 tinyint_asc, (SELECT 'hello' AS s) sel1
WHERE
 value &lt; char_length(s);</pre>
</blockquote>
<p>Recombining it in ascending character order is as follows:</p>
<blockquote>
<pre>SELECT GROUP_CONCAT(c ORDER BY c SEPARATOR '') AS normalized FROM
 (
 SELECT
   SUBSTRING(s, value+1, 1) AS c
 FROM
   tinyint_asc, (SELECT 'hello' AS s) sel1
 WHERE
   value &lt; char_length(s)
 ) walked_string_select;
+------------+
| normalized |
+------------+
| ehllo      |
+------------+
1 row in set (0.00 sec)</pre>
</blockquote>
<p>We can write a stored function to do that more conveniently (and, while at it, also normalize character case):</p>
<blockquote>
<pre>DELIMITER $$

DROP FUNCTION IF EXISTS `normalize_text`$$
CREATE FUNCTION `normalize_text` (input_text VARCHAR(255) CHARSET utf8) RETURNS VARCHAR(255) CHARSET utf8
DETERMINISTIC
READS SQL DATA
BEGIN
 SELECT GROUP_CONCAT(c ORDER BY c SEPARATOR '') INTO @normalized FROM
 (
 SELECT
   SUBSTRING(s, value+1, 1) AS c
 FROM
   tinyint_asc, (SELECT input_text AS s) sel1
 WHERE
   value &lt; char_length(s)
 ) walked_string_select;
 RETURN LOWER(@normalized);
END$$

DELIMITER ;</pre>
</blockquote>
<p>And use like this:</p>
<blockquote>
<pre>mysql&gt; SELECT normalize_text('Smith');
+-------------------------+
| normalize_text('Smith') |
+-------------------------+
| himst                   |
+-------------------------+
1 row in set (0.00 sec)

mysql&gt; SELECT normalize_text('Smith') = normalize_text('Thims');
+---------------------------------------------------+
| normalize_text('Smith') = normalize_text('Thims') |
+---------------------------------------------------+
|                                                 1 |
+---------------------------------------------------+
1 row in set (0.00 sec)

mysql&gt; SELECT normalize_text('Smith') = normalize_text('Sniff');
+---------------------------------------------------+
| normalize_text('Smith') = normalize_text('Sniff') |
+---------------------------------------------------+
|                                                 0 |
+---------------------------------------------------+
1 row in set (0.00 sec)</pre>
</blockquote>
<p>To compare tokenized strings (like <strong>'21,5,13'</strong> vs. <strong>'5,13,21'</strong>), we can use the <strong>SUBSTRING_INDEX()</strong> function to break the string apart, instead of <strong>SUBSTRING()</strong>.</p>

  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/blog/mysql/misimproving-performance-problems-with-insert-delayed/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/blog/mysql/misimproving-performance-problems-with-insert-delayed/">Misimproving performance problems with INSERT DELAYED</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/blog/mysql/beware-of-implicit-casting/">Beware of implicit casting</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/blog/mysql/beware-of-implicit-casting/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'code-openark-org-blog';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="/blog/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

