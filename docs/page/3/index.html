<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="code.openark.org" href="/blog/index.xml" />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blogimg/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
      <li class="pure-menu-item">
        <a class="pure-menu-link" href="/blog/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link">
        Shlomi Noach
        
          <div class="avatar-container">
        	  <div class="avatar-img-border">
                <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
        	  </div>
        	</div>
        
      </a>
    </li>

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>code.openark.org</h1>
  <h2>Software musings by Shlomi Noach</h2>
</div>

<div class="content">
  
    <article>
  <header>
    <h2><a href="/blog/mysql/speaking-at-percona-live-amsterdam-orchestrator/">Speaking at Percona Live Amsterdam: Orchestrator</a></h2>

    <div class="post-meta">

  <div>

    <time>15 Sep 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>In a week&rsquo;s time I&rsquo;ll be speaking at <a href="https://www.percona.com/live/europe-amsterdam-2015/">Percona Live Amsterdam</a>. I will be presenting:</p>
<blockquote><a href="https://www.percona.com/live/europe-amsterdam-2015/sessions/managing-and-visualizing-your-replication-topologies-orchestrator">Managing and Visualizing your replication topologies with Orchestrator<br />
</a>23 September 4:20PM<a href="https://www.percona.com/live/europe-amsterdam-2015/sessions/managing-and-visualizing-your-replication-topologies-orchestrator"><br />
</a></blockquote>
<p>This talk will present <strong><a href="https://github.com/outbrain/orchestrator">orchestrator</a></strong>, on which I&rsquo;ve been working for the last year and a half, originally at <a href="http://www.outbrain.com">Outbrain</a> and now at <a href="https://workingatbooking.com/">Booking.com</a>.</p>
<p>I will show off what <em>orchestrator</em> can do to manage your replication topologies. From visualization, through topology refactoring to automated crash recoveries, <em>orchestrator</em> today plays a key role at Booking.com infrastructure, at scale (oh I love using these words).</p>
<p>You can expect an outrageous demo, a visual walkthrough, some command line examples, and a lot on the logic and mechanisms behind <em>orchestrator</em>. I will present the difficult problems <em>orchestrator</em> covers.</p>
<p><em>orchestrator</em> is free and open source, and is built to be as generic as possible; it is known to be used by multiple well known companies these days, so please join the party.</p>
<p>With that, I conclude with the almighty motto:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/speaking-at-percona-live-amsterdam-orchestrator/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/three-wishes-for-a-new-year-2015/">Three wishes for a new year</a></h2>

    <div class="post-meta">

  <div>

    <time>14 Sep 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
  </div>

</div>


  </header>

  <p>
  Another new year by Jewish calendar. What do I wish for the following year? World peace Good health to all Decent, operations friendly built in online table refactoring The existing online ALTER TABLE solution is still not there. It does not take into consideration the load on the server. In replication stream it's serialized just as any other statement. It's not easy to stop/revert in case of problem. The existing online-schema-change scripts are still based on my 6-year old original solution, I'm proud to say, but the technology used, i.e.
  </p>

  
  <footer>
    <a href="/blog/mysql/three-wishes-for-a-new-year-2015/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-visual-cheatsheet-tldr-the-smart-way/">Orchestrator visual cheatsheet, TL;DR the &#34;smart&#34; way</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Sep 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong> is <em>really</em> growing. And the amount of users (DBAs, sys admins) using it is growing. Which gives me a lot of immediate feedback in the form of <em>&ldquo;Look, there&rsquo;s just too many options to move slaves around! Which ones should we use?&rdquo;</em></p>
<h3>TL;DR look at the two visualized commands below</h3>
<p>They are enough</p>
<h3>The &ldquo;smart&rdquo; commands to end all commands</h3>
<p>So all relocation commands are important, and give you fine-grained, pin-pointed control of the method of topology refactoring. However, most of the time you <em>just want to move those servers around</em>. Which is why there&rsquo;s a new &ldquo;smart&rdquo; mode which support these two commands, which you should be happy using:</p>
<ul>
<li><strong>relocate</strong>: move a single slave to another position</li>
<li><strong>relocate-slaves</strong>: move all/some slaves of some server to another position.</li>
</ul>
<p>What makes these commands Smart? You can move slaves around from <em>anywhere</em> to <em>anywhere</em>. And <em>orchestrator</em> figures out the bast execution path. If possible, it uses GTID. Not possible? Is Pseudo-GTID available? Great, using Pseudo-GTID. Oh, are there binlog servers involved? Really simple, use them. None of the above? <em>Orchestrator</em> will use &ldquo;standard&rdquo; binlog file:pos math (with limitations). <em>Orchestrator</em> will even figure out if multiple steps are necessary and will combine any of the above.</p>
<p>So you don&rsquo;t have to remember all the possible ways and options. The visual cheatsheet now boils down to these two:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2015/08/orchestrator-cheatsheet-visualized-relocate.png"><img class="alignnone size-full wp-image-7357" src="/blog/assets/orchestrator-cheatsheet-visualized-relocate.png" alt="orchestrator-cheatsheet-visualized-relocate" width="720" height="405" /></a></p>
<p><a href="http://code.openark.org/blog/wp-content/uploads/2015/08/orchestrator-cheatsheet-visualized-relocate-slaves.png"><img class="alignnone size-full wp-image-7350" src="/blog/assets/orchestrator-cheatsheet-visualized-relocate-slaves.png" alt="orchestrator-cheatsheet-visualized-relocate-slaves" width="720" height="405" /></a></blockquote>
<p>Let&rsquo;s take a slightly deeper look</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-visual-cheatsheet-tldr-the-smart-way/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-1-4-340-gtid-binlog-servers-smart-mode-failovers-and-lots-of-goodies/">Orchestrator 1.4.340: GTID, binlog servers, Smart Mode, failovers and lots of goodies</a></h2>

    <div class="post-meta">

  <div>

    <time>01 Sep 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><a href="https://github.com/outbrain/orchestrator/releases"><strong>Orchestrator</strong> 1.4.340 is released</a>. Not quite competing with the MySQL latest changelog, and as I haven&rsquo;t blogged about <em>orchestrator</em> featureset in a while, this is a quick listing of <em>orchestrator</em> features available since my last publication:</p>
<ul>
<li>Supports <strong>GTID</strong> (Oracle &amp; MariaDB)
<ul>
<li>GTID still not being used in automated recovery &ndash; in progress.</li>
<li><strong>enable-gtid</strong>, <strong>disable-gtid</strong>, <strong>skip-query</strong> for GTID commands</li>
</ul>
</li>
<li>Supports <strong>binlog servers</strong> (MaxScale)
<ul>
<li>Discovery &amp; operations on binlog servers</li>
<li>Understanding slave repositioning in a binlog-server architecture</li>
</ul>
</li>
<li><strong>Smart mode</strong>: relocate &amp; relocate-below commands (or Web/GUI drag-n-drop) let <em>orchestrator</em> figure out the best way of slave repositioning. <em>Orchestrator</em> picks from GTID, Pseudo GTID, binlog servers, binlog file:pos math (and more) options, or combinations of the above. Fine grained commands still there, but mostly you won&rsquo;t need them.</li>
<li><strong>Crash recoveries</strong> (did you know <em>orchestrator</em> does that?):
<ul>
<li>For intermediate master recovery: improved logic in picking the best recovery plan (prefer in-DC, prefer promoting local slave, supporting binlog server topologies, &hellip;)</li>
<li>For master recovery: even better slave promotion; supports <em>candidate slaves </em>(prefer promoting such slaves); supports binlog server shared topologies</li>
<li>Better auditing and logging of recovery cases</li>
<li>Better analysis of crash scenarios, also in the event of lost VIPs, hanging connections; emergent checks in crash suspected scenarios</li>
<li>recover-lite: do all topology-only recovery steps, without invoking external processes</li>
</ul>
</li>
<li><strong>Better browser support</strong>: used to only work on Firefox and Chrome (and the latter has had issues), the Web UI should now work well on all browsers, at the cost of reduced <strong>d3</strong> animation. More work still in progress.</li>
<li><strong>Faster</strong>, more parallel, less blocking operations on all counts; removed a lots of serialized code; less locks.</li>
<li><strong>Web enhancements</strong>
<ul>
<li>More verbose drag-n-drop (operation hint; color hints)</li>
<li>Drag-n-drop for <em>slaves-of-a-server</em></li>
<li>Replication/crash analysis dashboard</li>
</ul>
</li>
<li><strong>Pools</strong>: <em>orchestrator</em> can be <em>told</em> about instance-to-pool association (<strong>submit-pool-instances</strong> command)
<ul>
<li>And can then present pool status (web)</li>
<li>Or pool hints within topologies (web)</li>
<li>Or queried for all pools (<strong>cluster-pool-instances</strong> command)</li>
</ul>
</li>
<li>Other:
<ul>
<li>Supports MySQL <strong>5.7</strong> (tested with <strong>5.7.8</strong>)</li>
<li>Configurable graphite path for metrics</li>
<li><strong>&ndash;noop</strong> flag; does all the work except for actually changing master on slaves. Shows intentions.</li>
<li>Web (or cli <strong>which-cluster-osc-slaves</strong> command) provide list of control slaves to use in <strong>pt-osc</strong> operation</li>
<li><strong>hostname-unresolve</strong>: force <em>orchestrator</em> to unresolve a fqdn into VIP/CNAME/&hellip; when issuing a CHANGE MASTER TO</li>
</ul>
</li>
<li>3rd party contributions (hey, thanks!) include:
<ul>
<li>More &amp; better SSL support</li>
<li>Vagrant templates</li>
</ul>
</li>
<li>For developers:
<ul>
<li><em>Orchestrator</em> now go-gettable. Just <strong>go get github.com/outbrain/orchestrator</strong></li>
<li>Improved build script; supports more architectures</li>
</ul>
</li>
</ul>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-4-340-gtid-binlog-servers-smart-mode-failovers-and-lots-of-goodies/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/percona-live-amsterdam-community-dinner-sep-22nd/">Percona Live Amsterdam: Community Dinner, Sep. 22nd</a></h2>

    <div class="post-meta">

  <div>

    <time>13 Aug 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/community">community</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/perconalive">PerconaLive</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Keeping up with tradition, there will be a community event held at the upcoming <a href="https://www.percona.com/live/europe-amsterdam-2015/">Percona Live Europe: Amsterdam 2015</a> conference.</p>
<p>This year, <strong><a href="http://www.booking.com">Booking.com</a></strong> will be hosting the event at the company&rsquo;s headquarters in the heart of Amsterdam.</p>
<p>We will hold a community dinner (dish selection, includes vegetarian; beverages will be served) in our caffeteria and hope to add some spicy activities to the event!</p>
<p>Space is limited, and tickets can be <a href="https://www.eventbrite.com/e/community-dinner-bookingcom-tickets-17901675393">purchased via Eventbrite</a>.</p>
<p>Special thanks to Daniël van Eeden and Jean-François Gagné for their work in making this happen!</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/percona-live-amsterdam-community-dinner-sep-22nd/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/baffling-5-7-globalstatus-variables-issues-unclean-migration-path/">Baffling 5.7 global/status variables issues, unclean migration path</a></h2>

    <div class="post-meta">

  <div>

    <time>07 Aug 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/configuration">Configuration</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/information_schema">INFORMATION_SCHEMA</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/monitoring">Monitoring</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/new-features">New Features</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/performance_schema">performance_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/stored-routines">Stored routines</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>MySQL <strong>5.7</strong> introduces a change in the way we query for global variables and status variables: the <strong>INFORMATION<em>SCHEMA.(GLOBAL|SESSION)</em>(VARIABLES|STATUS)</strong> tables are now deprecated and empty. Instead, we are to use the respective <strong>performance<em>schema.(global|session)</em>(variables|status)</strong> tables.</p>
<p>But the change goes farther than that; there is also a security change. Oracle created a pitfall of <strong>2</strong> changes at the same time:</p>
<ol>
<li>Variables/status moved to a different table</li>
<li>Privileges required on said table</li>
</ol>
<p>As an example, my non-root user gets:</p>
<blockquote>
<pre>mysql&gt; show session variables like &lsquo;tx_isolation&rsquo;;
ERROR 1142 (42000): SELECT command denied to user &lsquo;normal_user&rsquo;@&lsquo;my_host&rsquo; for table &lsquo;session_variables&rsquo;</pre>
</blockquote>
<p>Who gets affected by this? Nearly <em>everyone and everything</em>.</p>
<ul>
<li>Your Nagios will not be able to read status variables</li>
<li>Your ORM will not be able to determine session variables</li>
<li>Your replication user will fail connecting (see <a href="http://datacharmer.blogspot.nl/2015/08/mysql-578-features-bugs-and-rumors.html">this post by Giuseppe</a>)</li>
<li>And most everyone else.</li>
</ul>
<p>The problem with the above is that involves two unrelated changes to your setup, which are not entirely simple to coordinate:</p>
<ol>
<li>Change your app code to choose the correct schema (information_schema vs. performance_schema)</li>
<li><strong>GRANT</strong> the permissions on your database</li>
</ol>
<p>Perhaps at this point you still do not consider this to be a problem. You may be thinking: <em>well, let&rsquo;s first prepare by creating the GRANTs, and once that is in place, we can, at our leisure, modify the code</em>.</p>
<p>Not so fast. Can you really that simply create those GRANTs?</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/baffling-5-7-globalstatus-variables-issues-unclean-migration-path/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/on-show-binlogrelaylog-events/">On SHOW BINLOG/RELAYLOG EVENTS</a></h2>

    <div class="post-meta">

  <div>

    <time>04 Aug 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Some notes after working with <a href="https://dev.mysql.com/doc/refman/5.6/en/show-binlog-events.html">SHOW BINLOG EVENTS</a> and <a href="https://dev.mysql.com/doc/refman/5.6/en/show-relaylog-events.html">SHOW RELAYLOG EVENTS</a> statements; there are a few gotchas and some interesting facts. My reflections also follow.</p>
<p>I&rsquo;m calling these commands from <a href="https://github.com/outbrain/orchestrator">orchestrator</a> when working with <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">Pseudo-GTID</a> (which I do <em>alot</em>). I prefer to work with agent-free design, where a single, remote service can do everything: examine replication status, scan binary logs for information, and recover broken topologies via gluing together servers that were not previously directly associated.</p>
<p>Alas, documentation is short on these commands, and some stuff I learned the hard way.</p>
<p>Basically, <strong>SHOW BINLOG/RELAYLOG EVENTS</strong> commands are a poor man&rsquo;s replacement to <strong>mysqlbinlog</strong>, only you can issue them on MySQL protocol, and you do not have to have the binary/relay log files locally on your host.</p>
<h3>Fun fact</h3>
<p>The binary logs are called so because they are compressed. You are familiar with the binlog position you see on <strong>SHOW MASTER STATUS</strong> or <strong>SHOW SLAVE STATUS</strong>. You are familiar with the binlog position as you see it when you execute <strong>&ldquo;mysqlbinlog mybinlog.001234&rdquo;</strong>. The position of a new entry equals to the file size of the binary log at that time. If:</p>
<blockquote>
<pre>$ ls -l master/data/mysql-bin.015901
-rw-rw&mdash;- 1 user user 401408 Jul 18 02:44 master/data/mysql-bin.015901</pre>
</blockquote>
<p>Then the next entry will be at position <strong>401408</strong>, as this is the file size in bytes.</p>
<p>And so when MySQL writes an entry to the binary log, it (of course) knows the entry&rsquo;s position in the binary log, but then also immediately knows the position of the next entry.</p>
<p>We&rsquo;ll revisit this fact later.</p>
<h3>Output of SHOW BINLOG/RELAYLOG EVENTS</h3>
<p>The output of both statement depends on the <strong>binlog_format</strong>. In Statement Based Replication it may look like:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/on-show-binlogrelaylog-events/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/pseudo-gtid-ascending/">Pseudo GTID, ASCENDING</a></h2>

    <div class="post-meta">

  <div>

    <time>29 Jul 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/pseudo-gtid">Pseudo GTID</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Pseudo GTID is a technique where we inject Globally Unique entries into MySQL, gaining GTID abilities without using GTID. It is supported by <strong><a href="https://github.com/outbrain/orchestrator">orchestrator</a></strong> and described in more detail <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">here</a>, <a href="http://code.openark.org/blog/tag/pseudo-gtid">here</a> and <a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual#pseudo-gtid">here</a>.</p>
<p>Quick recap: we can join two slaves to replicate from one another even if they never were in parent-child relationship, based on our uniquely identifiable entries which can be found in the slaves&rsquo; binary logs or relay logs. Having Pseudo-GTID injected and controlled by us allows us to optimize failovers into quick operations, especially where a large number of server is involved.</p>
<p><strong>Ascending Pseudo-GTID</strong> further speeds up this process for delayed/lagging slaves.</p>
<h3>Recap, visualized</h3>
<p>(but do look at the <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">presentation</a>):</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2015/07/pseudo-gtid-quick1.png"><img class="alignnone size-full wp-image-7303" src="/blog/assets/pseudo-gtid-quick1.png" alt="pseudo-gtid-quick" width="636" height="366" /></a></p>
<ol>
<li>Find last pseudo GTID in slave’s binary log (or last applied one in relay log)</li>
<li>Search for exact match on new master’s binary logs</li>
<li>Fast forward both through successive identical statements until end of slave’s applied entries is reached</li>
<li>Point slave into cursor position on master</li>
</ol>
</blockquote>
<p>What happens if the slave we wish to reconnect is lagging? Or perhaps it is a delayed replica, set to run <strong>24</strong> hours behind its master?</p>
<p>The naive approach would expand bullet <strong>#2</strong> into:</p>
<ul>
<li>Search for exact match on master’s last binary logs</li>
<li>Unfound? Move on to previous (older) binary log on master</li>
<li>Repeat</li>
</ul>
<p>The last Pseudo-GTID executed by the slave was issued by the master over <strong>24</strong> hours ago. Suppose the master generates one binary log per hour. This means we would need to full-scan <strong>24</strong> binary logs of the master where the entry will not be found; to only be matched in the <strong>25th</strong> binary log (it&rsquo;s an off-by-one problem, don&rsquo;t hold the exact number against me).</p>
<h3>Ascending Pseudo GTID</h3>
<p>Since we control the generation of Pseudo-GTID, and since we control the search for Pseudo-GTID, we are free to choose the form of Pseudo-GTID entries. We recently switched into using Ascending Pseudo-GTID entries, and this works like a charm. Consider these Pseudo-GTID entries:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/pseudo-gtid-ascending/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/what-makes-a-mysql-server-failurerecovery-case/">What makes a MySQL server failure/recovery case?</a></h2>

    <div class="post-meta">

  <div>

    <time>25 Jul 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/failover">Failover</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Or: How do you reach the conclusion your MySQL master/intermediate-master is dead and must be recovered?</p>
<p>This is an attempt at making a holistic diagnosis of our replication topologies. The aim is to cover obvious and not-so-obvious crash scenarios, and to be able to act accordingly and heal the topology.</p>
<p>At <strong>Booking.com</strong> we are dealing with very large amounts of MySQL servers. We have many topologies, and many servers in each topology. <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">See past numbers</a> to get a feel for it. At these numbers failures happen frequently. Typically we would see normal slaves failing, but occasionally &ndash; and far more frequently than we would like to be paged for &ndash; an intermediate master or a master would crash. But our current (and ever in transition) setup also include SANs, DNS records, VIPs, any of which can fail and bring down our topologies.</p>
<p>Tackling issues of monitoring, disaster analysis and recovery processes, I feel safe to claim the following statements:</p>
<ul>
<li>The fact your monitoring tool cannot access your database does not mean your database has failed.</li>
<li>The fact your monitoring tool can access your database does not mean your database is available.</li>
<li>The fact your database master is unwell does not mean you should fail over.</li>
<li>The fact your database master is alive and well does not mean you should not fail over.</li>
</ul>
<p>Bummer. Let&rsquo;s review a simplified topology with a few failure scenarios. Some of these scenarios you will find familiar. Some others may be caused by setups you&rsquo;re not using. I would love to say <em>I&rsquo;ve seen it all</em> but the more I see the more I know how strange things can become.</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/what-makes-a-mysql-server-failurerecovery-case/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="/blog/mysql/orchestrator-visual-cheatsheet/">Orchestrator visual cheatsheet</a></h2>

    <div class="post-meta">

  <div>

    <time>05 Jun 2015</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p><strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong> is growing. Supporting automatic detection of topologies, simple refactoring of topology trees, complex refactoring via Pseudo-GTID, failure detection and automated discovery, it is becoming larger and larger by the day.</p>
<p>One of the problems with growign projects is hwo to properly document them. Orchestrator enjoys <a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">a comprehensive manual</a>, but as these get more and more detailed, it is becoming difficult to get oriented and pointed in the right direction. I&rsquo;ve done my best to advise the simple use cases throughout the manual.</p>
<p>One thing that is difficult to put into words is topologies. Explaining &ldquo;failover of an intermediate master S1 that has S2,&hellip;,Sn slaves onto a sibling of S1 provided that&hellip;&rdquo; is too verbose. So here&rsquo;s a quick visual cheatsheet for (current) topology refactoring commands. Refactoring commands are a mere subset of overall orchestrator commands, but they&rsquo;re great to play with and perfect for visualization.</p>
<p>The &ldquo;move&rdquo; and related commands use normal replication commands (STOP SLAVE; CHANGE MASTER TO; START SLAVE UNTIL;&ldquo;&hellip;).</p>
<p>The &ldquo;match&rdquo; and related commands utilize Pseudo-GTID and use more elaborate MySQL commands (SHOW BINLOG EVENTS, SHOW RELAYLOG EVENTS).</p>
<p>So without further ado, here&rsquo;s what each command does (and do run &ldquo;orchestrator&rdquo; from the command line to get a man-like explanation of everything, or just <a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual#executing-via-command-line">go to the manual</a>).</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-visual-cheatsheet/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  

  


<nav class="pagination" role="pagination">
  
  <a href="/page/2/"><i class="fa fa-chevron-left"></i></a>
  
  <span>&nbsp;3 / 38&nbsp;</span>
  
  <a href="/page/4/"><i class="fa fa-chevron-right"></i></a>
  
</nav>



</div>

</div>
</div>
<script src="/blogjs/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

