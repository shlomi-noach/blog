<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.16" />

  <title>code.openark.org</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/blog/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/blog/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="code.openark.org" href="/blog/index.xml" />
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/blog/img/favicon.ico" type="image/x-icon" />


  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <a class="pure-menu-heading brand" href="/blog">openark.org</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/blog/page/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
      <li class="pure-menu-item">
        <a class="pure-menu-link" href="/blog/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link">
        Shlomi Noach
        
          <div class="avatar-container">
        	  <div class="avatar-img-border">
                <img class="avatar-img" src="/blog/images/shlomi-noach.png" alt="code.openark.org" />
        	  </div>
        	</div>
        
      </a>
    </li>

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shlomi-noach" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/ShlomiNoach" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shlominoach" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>





  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>code.openark.org</h1>
  <h2>Software musings by Shlomi Noach</h2>
</div>

<div class="content">
  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/get-per-object-grants-via-common_schema/">Get per-object grants via common_schema</a></h2>

    <div class="post-meta">

  <div>

    <time>29 Sep 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/common_schema">common_schema</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Did you know <a href="http://code.google.com/p/common-schema">common_schema</a> supports a complete breakdown of all accounts on your database server? It can provide you with the <strong>GRANT</strong> statements required to set up an account, the <strong>REVOKE</strong> statements to undo the former, and this can be broken down on a per-object &amp; per-object-type basis. Consider the <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">sql_grants</a> view:</p>
<p><em>Find who has privileges on a table called <strong>t</strong></em>:</p>
<blockquote>
<pre>select * from <strong>common_schema.sql_grants</strong> where <strong>priv_level_name</strong>=&lsquo;table&rsquo; and <strong>object_name</strong>=&rsquo;t&rsquo;\G</p>

<p>           GRANTEE: &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
              user: power1
              host: localhost
        priv_level: <code>mytst</code>.<code>t</code>
   priv_level_name: table
     object_schema: mytst
       object_name: t
current_privileges: SELECT
      IS_GRANTABLE: NO
         sql_grant: GRANT SELECT ON <code>mytst</code>.<code>t</code> TO &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
        sql_revoke: REVOKE SELECT ON <code>mytst</code>.<code>t</code> FROM &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
     sql_drop_user: DROP USER &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;</pre>
</blockquote>
<p>or, <em>who has privileges on the <strong>test</strong> schema</em>:</p>
<blockquote>
<pre>select * from common_schema.sql_grants where priv_level_name=&lsquo;schema&rsquo; and object_name=&lsquo;test&rsquo; \G</p>

<p>           GRANTEE: &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
              user: power1
              host: localhost
        priv_level: <code>test</code>.*
   priv_level_name: schema
     object_schema: NULL
       object_name: test
current_privileges: ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE
      IS_GRANTABLE: NO
         sql_grant: GRANT ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* TO &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
        sql_revoke: REVOKE ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* FROM &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;
     sql_drop_user: DROP USER &lsquo;power1&rsquo;@&lsquo;localhost&rsquo;</p>

<p>           GRANTEE: &lsquo;test&rsquo;@&lsquo;localhost&rsquo;
              user: test
              host: localhost
        priv_level: <code>test</code>.*
   priv_level_name: schema
     object_schema: NULL
       object_name: test
current_privileges: ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE
      IS_GRANTABLE: NO
         sql_grant: GRANT ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* TO &lsquo;test&rsquo;@&lsquo;localhost&rsquo;
        sql_revoke: REVOKE ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON <code>test</code>.* FROM &lsquo;test&rsquo;@&lsquo;localhost&rsquo;
     sql_drop_user: DROP USER &lsquo;test&rsquo;@&lsquo;localhost&rsquo;</p>

<p></pre>
</blockquote>
<p>In the same manner, you can easily SELECT for all grants that are defined per-table, per-schema, &hellip; <strong>priv_level_name</strong>: is any one of <strong>&lsquo;user&rsquo;</strong>, <strong>&lsquo;schema&rsquo;</strong>, <strong>&lsquo;table&rsquo;</strong>, <strong>&lsquo;column&rsquo;</strong>, <strong>&lsquo;routine&rsquo;</strong>.</p>
<p>The above is a view, which aggregates data from all relevant <strong>INFORMATION_SCHEMA</strong> tables, normalizing and de-normalizing as necessary.</p>
<p>You might also want to look at <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">sql_show_grants</a> which provides with a no-breakdown GRANT for all accounts. It&rsquo;s like a SHOW ALL GRANTS which doesn&rsquo;t exist, plus it&rsquo;s SELECTable.</p>
<p>Also, thanks to <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/eval.html">eval()</a>, the above make for executable code. Consider:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/get-per-object-grants-via-common_schema/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/three-wishes-for-a-new-year-3/">Three wishes for a new year</a></h2>

    <div class="post-meta">

  <div>

    <time>23 Sep 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/opinions">Opinions</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/secondary">secondary</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Another new year by Jewish calendar. What do I wish for the following year? World peace Good health to all Multi-core execution for queries After having evaluated a few columnar databases, and having seen how a single query gets 24 cores busy, I can't look at MySQL the same way again. The fact that a single query consumes a single core only doesn't seem right in the year 2014. Shard-query is a cool application-level attempt to solve the above; I would like to see stuff like this implemented inside the server (or inside the storage engine where possible).
  </p>

  
  <footer>
    <a href="/blog/mysql/three-wishes-for-a-new-year-3/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/linux/zookeepercli-lightweight-powerful-controlled-command-line-client-for-zookeeper/">zookeepercli: lightweight, powerful, controlled command line client for ZooKeeper</a></h2>

    <div class="post-meta">

  <div>

    <time>17 Sep 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/development">Development</a>&nbsp;&#47;
          
            <a class="post-taxonomy-category" href="/blog/category/linux">Linux</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/command-line">command line</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/go">go</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/zookeeper">ZooKeeper</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  I'm happy to announce the availability of zookeepercli: a lightweight, simple, fast and controlled command line client for ZooKeeper. zookeepercli allows for: Basic CRUD-like operations: create, set, delete, exists, get, ls (aka children). Extended operations: lsr (ls recursive), creater (create recursively) Well formatted and controlled output: supporting either txt or json format Single, no-dependencies binary file, based on a native Go ZooKeeper library by github.com/samuel/go-zookeeper (LICENSE) I was dissatisfied with existing command line access to ZooKeeper.
  </p>

  
  <footer>
    <a href="/blog/linux/zookeepercli-lightweight-powerful-controlled-command-line-client-for-zookeeper/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-1-0-5-refactoring-masters-multi-master-replication/">Orchestrator 1.0.5: refactoring masters, multi-master replication</a></h2>

    <div class="post-meta">

  <div>

    <time>06 Aug 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Outbrain&rsquo;s <em>orchestrator</em> Version <strong>1.0.5</strong> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.0.5">is released</a>.</p>
<blockquote>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></blockquote>
<p><em>Orchestrator</em> now supports refactoring of masters via master-master topologies. It now allows promoting slaves as co-masters and detachment of instances from a co-master topology, effectively allowing for replacing an active master.</p>
<h4>Like this</h4>
<p>Drag a master:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/08/orchestator-cm-simple-drag-master-01.png"><img class="alignnone size-full wp-image-6965" src="/blog/assets/orchestator-cm-simple-drag-master-01.png" alt="orchestator-cm-simple-drag-master-01" width="804" height="340" /></a></blockquote>
<p>Onto one of its slaves:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-0-5-refactoring-masters-multi-master-replication/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/orchestrator-1-0-4-released/">Orchestrator 1.0.4 released</a></h2>

    <div class="post-meta">

  <div>

    <time>29 Jul 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>Outbrain&rsquo;s <em>orchestrator</em> Version <strong>1.0.4</strong> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.0.4">is released</a>.</p>
<blockquote>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></blockquote>
<p>What&rsquo;s new?</p>
<h4>Co-masters</h4>
<p>orchestrator now does a much better visualization of Master-Master replication:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/07/orchestrator-co-masters.png"><img class="alignnone size-full wp-image-6946" src="/blog/assets/orchestrator-co-masters.png" alt="orchestrator-co-masters" width="783" height="357" /></a></blockquote>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/orchestrator-1-0-4-released/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/some-mysql-security-tips/">Some MySQL security tips</a></h2>

    <div class="post-meta">

  <div>

    <time>28 Jul 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/security">Security</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  This is a brief list of security tips for MySQL. It is by no means complete. Follow the sudo example. Don't let all you DBAs and Ops have the password for the root account. Have each and every one of them have their own personal super-duper account, with their own personal and private password. This makes it so easy when someone leaves the company. No need to change passwords, just to remove the employee's account.
  </p>

  
  <footer>
    <a href="/blog/mysql/some-mysql-security-tips/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/introducing-orchestrator-manage-and-visualize-your-mysql-replication-topologies-and-get-home-for-dinner/">Introducing Orchestrator: manage and visualize your MySQL replication topologies and get home for dinner</a></h2>

    <div class="post-meta">

  <div>

    <time>09 Jun 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/open-source">Open Source</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/orchestrator">orchestrator</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>&nbsp;&#47;
          
            <a class="post-taxonomy-tag" href="/blog/tag/tools">tools</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>I&rsquo;m happy to announce the availability of <a href="http://www.outbrain.com/">Outbrain</a>&rsquo;s <strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong>: MySQL replication management &amp; visualization tool.</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/05/orchestrator-simple.png"><img class="alignnone size-full wp-image-6898" src="/blog/assets/orchestrator-simple.png" alt="orchestrator - simple topology" width="785" height="353" /></a></blockquote>
<ul>
<li>Orchestrator reads your replication topologies (give it one server - be it master or slave - in each topology, and it will reveal the rest).</li>
<li>It keeps a state of this topology.</li>
<li>It can continuously poll your servers to get an up to date topology map.</li>
<li>It visualizes the topology in a clear and slick D3 tree.</li>
<li>It allows you to <em>modify your topology;</em> move slaves around. You can use the command line variation, the JSON API, or you can use the web interface.</li>
</ul>
<p>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></p>
<h4>Nothing like nice screenshots</h4>
<p>To move slaves around the topology (repoint a slave to a different master) through <em>orchestrator</em>&rsquo;s web interface, we use <em>Drag and Drop</em>,</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/introducing-orchestrator-manage-and-visualize-your-mysql-replication-topologies-and-get-home-for-dinner/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/using-deep-nested-replication-topologies/">Using deep nested replication topologies</a></h2>

    <div class="post-meta">

  <div>

    <time>02 Jun 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>If you&rsquo;re running more than a few slaves in a replication topology, you might choose to use deeply nested replication: slaves replicating from other slaves at 2, 3 or even 4 levels. There are pros and cons to such topologies, discussed below.</p>
<p>A simple, small deep nested topology is depicted below (it is also a real production topology of ours):</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/05/topology-sample-02.png"><img class="alignnone size-full wp-image-6878" src="/blog/assets/topology-sample-02.png" alt="topology-sample-02" width="736" height="309" /></a></blockquote>
<p>Two slaves, <strong>srv-4</strong> and <strong>srv-8</strong> act as local masters to yet other slaves. Why would we want to have this complexity?</p>
<h4>Pros</h4>
<ul>
<li>Reduce load on master: too many slaves replicating from single master means the master becomes loaded with serving the binary logs. Typically, when all slaves are up to date, this isn&rsquo;t a big deal, since they all get served roughly the same entries, and caching works great. If not all are in sync, the master needs to look up different log entries and pays with more disk I/O.</li>
<li>Reduce network load. We serve from three different data centres. Our master is in one DC, and our slaves are spread through all three. Inter-DC network is naturally slower; it is also more expensive, hence more easily saturated. Reducing cross-DC network is done across all our systems, including MySQL. <strong>srv-4</strong>, for example, could depict a slave that is a local master in its own DC, serving <strong>srv-5</strong>, <strong>srv-6</strong>, <strong>srv-7</strong> all in the same DC, hence only using cross-DC network for one slave instead of four. A bit over-simplistic example but true.</li>
<li>Failover. <a href="http://code.google.com/p/mysql-master-ha/">MHA</a> does a good job at synchronizing slaves of same master by figuring out the missing binary log entries for each slave. It should do well within a single region, but I do not know that it would do the same cross region (I&rsquo;m assuming the binlog entries copy should work, but I haven&rsquo;t tried it cross region). In case of a disaster such as an entire DC going down (we actually had such a case a couple weeks ago; power went out for the entire DC), we have a designated master into which we can fail over in each other DC, and which contains enough slaves (from each remaining DCs) to keep serving. That it, we&rsquo;re willing to skip the fancy syncing and just point to a newly promoted master, with the benefit that the entire replication topology under it is intact.</li>
<li>Testing &amp; upgrades. For example, I might want to upgrade to <strong>5.6</strong>. Upgrading a slave from <strong>5.5</strong> to <strong>5.6</strong> is a good start; we look at replication and see that nothing gets broken. But how will our production master behave with <strong>5.6</strong>? Put some more slaves under your newly upgraded <strong>5.6</strong> server and get a clearer picture. At some stage you might just promote this entire subtree as the new topology.</li>
</ul>
<p>Here&rsquo;s another topology; DC info is not depicted in this image, but you can guess what designated masters we have:</p>

  </p>

  
  <footer>
    <a href="/blog/mysql/using-deep-nested-replication-topologies/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/from-percona-server-to-mysql-and-back-to-percona-server-beware-of-crash-safe-replication-info/">From Percona Server to MySQL and back to Percona Server: beware of crash safe replication info</a></h2>

    <div class="post-meta">

  <div>

    <time>27 May 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  <p><p>We&rsquo;re migrating some of our &ldquo;vanilla&rdquo; MySQL 5.5 servers to Percona Server 5.5. One of the major incentives is the <a href="http://www.percona.com/doc/percona-server/5.5/reliability/crash_resistant_replication.html">crash-safe replication</a> feature, allowing slaves to die (power failure) and resume replication without losing position in relay logs.</p>
<p>Whether or not we will migrate all our servers depends on further benchmarking; so far we&rsquo;ve noticed unexpected results, but these are still premature to publish.</p>
<p>However the fact that we are using both MySQL &amp; Percona Server has led us into a peculiar situation which I&rsquo;d like to share. We reseed our servers via LVM snapshots. If we need a new machine, or have a corrupted slave, we capture an image of a running slave and duplicate it, a process which takes the better part of a day. This duplicates not only the data, of course, but also the relay logs, the <strong>relay-log.info</strong> file, <strong>master.info</strong> file, implying the <em>position within the topology</em>.</p>
<p>With crash safe replication this also means the transactional relay log position. Recap: crash safe replication writes, per transaction, the relay log status into <strong>ibdata1</strong> file. So the relay log info in <strong>ibdata1</strong> is in perfect alignment with your committed transactions. Upon server startup, Percona Server reads the info from <strong>ibdata1</strong> and overwrites <strong>relay-log.info</strong> file (it completely disregards whatever was in that file prior to startup).</p>
<p>Can you guess what could get wrong here? Here&rsquo;s the scenario we had; the same problem can unfold in different scenarios.</p>
<p>Take a look at the following topology:</p>
<blockquote><a href="http://code.openark.org/blog/wp-content/uploads/2014/05/simple-topology.png"><img class="alignnone size-full wp-image-6869" src="/blog/assets/simple-topology.png" alt="simple topology" width="701" height="297" /></a></blockquote>
<p>(this image is an actual online visualization of a replication topology; for purposes of this blog it&rsquo;s a sandbox topology on my laptop. Please stand by for some very cool open source release announcement shortly)</p>
<p></p>

  </p>

  
  <footer>
    <a href="/blog/mysql/from-percona-server-to-mysql-and-back-to-percona-server-beware-of-crash-safe-replication-info/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header class="index-header">
    <h2><a href="/blog/mysql/when-you-cannot-replicate-from-master-m-to-slave-s/">When you cannot replicate from master M to slave S</a></h2>

    <div class="post-meta">

  <div>

    <time>28 Apr 2014</time>
  </div>

  

  

  <div>
    
      
      
        <span>
          
            <a class="post-taxonomy-category" href="/blog/category/mysql">MySQL</a>
          
        </span>
      
    

    
      
      
        <span>
          <i class="fa fa-tags fa-fw"></i>
          
            <a class="post-taxonomy-tag" href="/blog/tag/replication">Replication</a>
          
        </span>
      
    
  </div>

</div>


  </header>

  <p>
  Working on some replication topology automation, here are some rules that will prevent you from replicating from a MySQL server M to a slave S: M does not have binary logs (log_bin) enabled M is itself a slave and does not have log_slave_updates enabled M has a higher major version than S (e.g. M is 5.6 and S is 5.5, but do note log_bin_use_v1_row_events) Both servers have same server_id S has log_bin &amp; log_slave_updates, uses STATEMENT binlog_format, and M uses ROW or MIXED binlog_format S has log_bin &amp; log_slave_updates, uses MIXED binlog_format, and M uses ROW binlog_format S and M are using different replication filters (some rules could work; good luck if you're that adventurous) [EDIT: the above is configuration-wise] Did I miss anything?
  </p>

  
  <footer>
    <a href="/blog/mysql/when-you-cannot-replicate-from-master-m-to-slave-s/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  

  


<nav class="pagination" role="pagination">
  
  <a href="/page/5/"><i class="fa fa-chevron-left"></i></a>
  
  <span>&nbsp;6 / 38&nbsp;</span>
  
  <a href="/page/7/"><i class="fa fa-chevron-right"></i></a>
  
</nav>



</div>

</div>
</div>
<script src="/blog/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

