<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	

	<title>MySQL – Page 19 – code.openark.org</title>
<link rel="dns-prefetch" href="//secure.gravatar.com">
<link rel="dns-prefetch" href="//s.w.org">



<link rel="stylesheet" id="wp-block-library-css" href="https://shlomi-noach.github.io/blog/wp-includes/css/dist/block-library/style.min.css" media="all">
<style id="wp-block-library-inline-css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="wp-polls-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-css.css" media="all">
<style id="wp-polls-inline-css">
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel="stylesheet" id="openark-primer-style-css" href="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/style.css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/css/jetpack.css" media="all">
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery-migrate.min.js"></script>



<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<link rel="dns-prefetch" href="//v0.wordpress.com">


<meta property="og:type" content="website">
<meta property="og:title" content="MySQL – Page 19 – code.openark.org">
<meta property="og:url" content="https://shlomi-noach.github.io/blog/category/mysql">
<meta property="og:description" content="MySQL related posts">
<meta property="og:site_name" content="code.openark.org">
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg">
<meta property="og:locale" content="en_US">


<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(242,101,34,.88);}</style></head>

<body class="archive paged category category-mysql category-5 paged-19 category-paged-19 hfeed no-sidebar">
<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#primary">Skip to content</a>

	<header id="masthead" class="site-header">
		<div class="site-branding">
							<p class="site-title"><a href="https://shlomi-noach.github.io/blog/" rel="home">code.openark.org</a></p>
								<p class="site-description">Blog by Shlomi Noach</p>
			
			<nav id="site-navigation" class="main-navigation">
				<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">primary-menu</button>
				<div class="menu-primary-menu-container"><ul id="menu-primary-menu" class="menu"><li id="menu-item-8109" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8109"><a href="https://shlomi-noach.github.io/blog/archives">archives</a></li>
<li id="menu-item-8050" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8050"><a href="https://shlomi-noach.github.io/blog/presentations">presentations</a></li>
<li id="menu-item-8055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8055"><a href="https://shlomi-noach.github.io/blog/about">about</a></li>
<li id="menu-item-8071" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8071"><a href="https://github.com/shlomi-noach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li>
<li id="menu-item-8074" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8074"><a href="https://www.linkedin.com/in/shlominoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li>
<li id="menu-item-8072" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8072"><a href="https://twitter.com/ShlomiNoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"></path></svg></a></li>
<li id="menu-item-8073" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8073"><a href="https://shlomi-noach.github.io/blog/feed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-12.832 20c-1.197 0-2.168-.969-2.168-2.165s.971-2.165 2.168-2.165 2.167.969 2.167 2.165-.97 2.165-2.167 2.165zm5.18 0c-.041-4.029-3.314-7.298-7.348-7.339v-3.207c5.814.041 10.518 4.739 10.561 10.546h-3.213zm5.441 0c-.021-7.063-5.736-12.761-12.789-12.792v-3.208c8.83.031 15.98 7.179 16 16h-3.211z"></path></svg></a></li>
</ul></div>			</nav>
		</div>
	</header>

	<main id="primary" class="site-main">

		
			<header class="page-header">
				<h1 class="page-title">Category: MySQL</h1><div class="archive-description"><p>MySQL related posts</p>
</div>			</header>

			
<article id="post-5050" class="post-5050 post type-post status-publish format-standard hentry category-mysql tag-sql tag-syntax">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/mysql-joins-on-vs-using-vs-theta-style" rel="bookmark">MySQL joins: ON vs. USING vs. Theta-style</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a><a href="https://shlomi-noach.github.io/blog/tag/syntax" rel="tag">Syntax</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/mysql-joins-on-vs-using-vs-theta-style" rel="bookmark"><time class="entry-date published updated" datetime="2012-07-11T06:54:20+02:00">July 11, 2012</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>What is the difference between the following three syntaxes?</p>
<blockquote>
<pre>SELECT * FROM film JOIN film_actor ON (film.film_id = film_actor.film_id)
SELECT * FROM film JOIN film_actor USING (film_id)
SELECT * FROM film, film_actor WHERE film.film_id = film_actor.film_id</pre>
</blockquote>
<p>The difference is mostly syntactic sugar, but with a couple interesting notes.</p>
<p>To put names, the first two are called <strong>“ANSI-style”</strong> while the third is called <strong>“Theta-style”</strong>.</p>
<h4>Theta style</h4>
<p>On the <strong>FROM</strong> clause, tables are listed as if with Cartesian products, and the <strong>WHERE</strong> clause specifies how the join should take place.</p>
<p>This is considered to be the “old” style. It is somewhat confusing to read. Consider the following query: <a href="https://shlomi-noach.github.io/blog/mysql/mysql-joins-on-vs-using-vs-theta-style#more-5050" class="more-link">Continue reading »<span class="screen-reader-text"> “MySQL joins: ON vs. USING vs. Theta-style”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/mysql-joins-on-vs-using-vs-theta-style#comments">15 Comments<span class="screen-reader-text"> on MySQL joins: ON vs. USING vs. Theta-style</span></a></span>	</footer>
</article>

<article id="post-4915" class="post-4915 post type-post status-publish format-standard hentry category-mysql tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/notes-on-row-based-replication" rel="bookmark">Notes on row based replication</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/notes-on-row-based-replication" rel="bookmark"><time class="entry-date published updated" datetime="2012-07-04T10:00:24+02:00">July 4, 2012</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>MySQL’s <a href="http://dev.mysql.com/doc/refman/5.1/en/replication-formats.html">Row Based Replication</a> (RBR) succeeds (though not replaces) Statement Based Replication (SBR), as of version <strong>5.1</strong>.</p>
<p>Anyone who is familiar with replication data drift — the unexplained growing data difference between master & slave — might wish to look into row based replication. On multiple servers I’m handling the change to RBR has eliminated (to the best of my findings) replication data drift.</p>
<p>This is easily explained, as RBR writes particular row IDs into the binary log. You no longer need to hope the statement</p>
<blockquote>
<pre>DELETE FROM my_table ORDER BY my_column LIMIT 100</pre>
</blockquote>
<p>acts deterministically on all servers (is <strong>my_column</strong> UNIQUE?). With row based replication the particular rows deleted on the master are then deleted on the slave.</p>
<p>Here are three notes on RBR: <a href="https://shlomi-noach.github.io/blog/mysql/notes-on-row-based-replication#more-4915" class="more-link">Continue reading »<span class="screen-reader-text"> “Notes on row based replication”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/notes-on-row-based-replication#comments">13 Comments<span class="screen-reader-text"> on Notes on row based replication</span></a></span>	</footer>
</article>

<article id="post-5008" class="post-5008 post type-post status-publish format-standard hentry category-mysql tag-common_schema tag-openark-kit tag-performance tag-queryscript">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/delete-dont-insert" rel="bookmark">DELETE, don’t INSERT</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/common_schema" rel="tag">common_schema</a><a href="https://shlomi-noach.github.io/blog/tag/openark-kit" rel="tag">openark kit</a><a href="https://shlomi-noach.github.io/blog/tag/performance" rel="tag">Performance</a><a href="https://shlomi-noach.github.io/blog/tag/queryscript" rel="tag">QueryScript</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/delete-dont-insert" rel="bookmark"><time class="entry-date published" datetime="2012-06-27T07:25:09+02:00">June 27, 2012</time><time class="updated" datetime="2012-06-27T07:47:38+02:00">June 27, 2012</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Have just read <a href="http://blog.9minutesnooze.com/insert-delete/">INSERT, Don’t DELETE</a> by Aaron Brown, and have some lengthy response, which is why I write this post instead of commenting on said post.</p>
<p>I wish to offer my counter thought and suggest that <strong>DELETE</strong>s are probably the better choice.</p>
<p>Aaron suggests that, when one wishes to purge rows from some table, a trick can be used: instead of <strong>DELETE</strong>ing unwanted rows, one can <strong>INSERT</strong> “good” rows into a new table, then switch over with <strong>RENAME</strong> (but please read referenced post for complete details).</p>
<p>I respectfully disagree on several points discussed.</p>
<h4>Lockdown</h4>
<p>The fact one needs to block writes during the time of creation of new table is problematic: you need to essentially turn off parts of your application. The posts suggests one could use a slave – but this solution is far from being trivial as well. To switch over, you yet again need to turn off access to DB, even if for a short while. <a href="https://shlomi-noach.github.io/blog/mysql/delete-dont-insert#more-5008" class="more-link">Continue reading »<span class="screen-reader-text"> “DELETE, don’t INSERT”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/delete-dont-insert#comments">6 Comments<span class="screen-reader-text"> on DELETE, don’t INSERT</span></a></span>	</footer>
</article>

<article id="post-4602" class="post-4602 post type-post status-publish format-standard hentry category-mysql tag-backup">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/a-new-mysql-backups-temperature-scale-with-showers" rel="bookmark">A new MySQL backups temperature scale, with showers</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/backup" rel="tag">Backup</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/a-new-mysql-backups-temperature-scale-with-showers" rel="bookmark"><time class="entry-date published" datetime="2012-06-26T08:08:15+02:00">June 26, 2012</time><time class="updated" datetime="2012-06-27T11:59:13+02:00">June 27, 2012</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>We’re used to Cold, Warm and Hot backups. This scale of three temperatures does not quite reflect the impact of backups on your MySQL database.</p>
<p>In this post I offer a new backup temperature scale, and (somewhat seriously) compare it with showers. Call it the <em>backup shower scale</em>.</p>
<blockquote><p>A database backup is like a shower: the colder it is, the less time you want to spend doing it.</p></blockquote>
<h4>Cold</h4>
<p>A cold backup requires taking your database down (i.e. stop the service).</p>
<p>Example: file system copy</p>
<p>This can work well for replicating slaves, which may not be required for normal operation. You take the slave down, turn off the service, make your backup, turn everything on again, and let the backup catch up. Just make sure its master has all the necessary binary logs.</p>
<p>A friend was staying at my place and was lecturing me on the benefits of cold showers; how it was good for your health. A couple hours later, preparing for bed, I hear him exclaiming from the bathroom: <em>“Whaaaaa! There’s no hot water!” <a href="https://shlomi-noach.github.io/blog/mysql/a-new-mysql-backups-temperature-scale-with-showers#more-4602" class="more-link">Continue reading »<span class="screen-reader-text"> “A new MySQL backups temperature scale, with showers”</span></a></em></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/a-new-mysql-backups-temperature-scale-with-showers#comments">5 Comments<span class="screen-reader-text"> on A new MySQL backups temperature scale, with showers</span></a></span>	</footer>
</article>

<article id="post-4977" class="post-4977 post type-post status-publish format-standard hentry category-mysql tag-common_schema">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/who-is-hogging-my-mysql-connections" rel="bookmark">Who is hogging my MySQL connections?</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/common_schema" rel="tag">common_schema</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/who-is-hogging-my-mysql-connections" rel="bookmark"><time class="entry-date published" datetime="2012-06-21T08:38:54+02:00">June 21, 2012</time><time class="updated" datetime="2012-06-21T08:39:57+02:00">June 21, 2012</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Got <em>“too many connections”</em> this morning. New attempts continuously abort. Every once in a while some slipped through, but overall behavior was unacceptable.</p>
<p><strong>max_connections</strong> is set to <strong>500</strong>, well above normal requirements.</p>
<p>Immediate move: raise <strong>max_connections</strong> to <strong>600</strong>, some urgent connections must take place. But, this is no solution: if <strong>500</strong> got hogged, so will the extra <strong>100</strong> I’ve just made available.</p>
<p>So, who’s to blame? <strong>SHOW PROCESSLIST</strong> is so unfriendly at that. Wait. Didn’t I create that view in <em>common_schema</em>, called <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/processlist_per_userhost.html">processlist_per_userhost</a>? I wonder what it says…</p>
<blockquote>
<pre>SELECT * FROM <strong>common_schema.processlist_per_userhost</strong>;
+-------------+------------------+-----------------+------------------+---------------------+
| user        | host             | count_processes | active_processes | average_active_time |
+-------------+------------------+-----------------+------------------+---------------------+
| maatkit     | sqlhost02.myweb  |               1 |                0 |                NULL |
| rango       | webhost04.myweb  |               2 |                0 |                NULL |
| rango       | webhost07.myweb  |               8 |                0 |                NULL |
| rango       | sqlhost02.myweb  |              38 |                0 |                NULL |
| rango       | management.myweb |              35 |                0 |                NULL |
| rango       | webhost03.myweb  |              10 |                0 |                NULL |
| rango       | local01.myweb    |               8 |                0 |                NULL |
| rango       | analytic02.myweb |              11 |                0 |                NULL |
| mytop       | localhost        |               2 |                0 |                NULL |
| buttercup   | sqlhost02.myweb  |             451 |                5 |              0.0000 |
| replc_user  | sqlhost00.myweb  |               1 |                1 |         392713.0000 |
| replc_user  | sqlhost02.myweb  |               1 |                1 |          38028.0000 |
| root        | localhost        |               2 |                0 |                NULL |
| system user |                  |               2 |                2 |         196311.5000 |
+-------------+------------------+-----------------+------------------+---------------------+</pre>
</blockquote>
<p>Ah! It’s <strong>buttercup</strong> connecting from <strong>sqlhost02.myweb</strong> who is making a fuss. I knew that view was created for a reason.</p>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/who-is-hogging-my-mysql-connections#more-4977" class="more-link">Continue reading »<span class="screen-reader-text"> “Who is hogging my MySQL connections?”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/who-is-hogging-my-mysql-connections#comments">11 Comments<span class="screen-reader-text"> on Who is hogging my MySQL connections?</span></a></span>	</footer>
</article>

<article id="post-4947" class="post-4947 post type-post status-publish format-standard hentry category-mysql tag-common_schema tag-prepared-statements tag-queryscript tag-stored-routines">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/on-stored-routines-and-dynamic-statements" rel="bookmark">On stored routines and dynamic statements</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/common_schema" rel="tag">common_schema</a><a href="https://shlomi-noach.github.io/blog/tag/prepared-statements" rel="tag">Prepared Statements</a><a href="https://shlomi-noach.github.io/blog/tag/queryscript" rel="tag">QueryScript</a><a href="https://shlomi-noach.github.io/blog/tag/stored-routines" rel="tag">Stored routines</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/on-stored-routines-and-dynamic-statements" rel="bookmark"><time class="entry-date published updated" datetime="2012-06-18T11:16:29+02:00">June 18, 2012</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>I very much enjoyed reading <a href="http://blog.mclaughlinsoftware.com/2012/06/16/overloading-procedures/" rel="bookmark">Overloading Procedures</a> by Michael McLaughlin: good stuff!</p>
<p>I’m dealing with similar issues in <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script.html">common_schema/QueryScript</a>, where I implement a whole new scripting language within MySQL, interpreted by stored routines. I am now finalizing the next version of <em>common_schema/QueryScript</em>, with a major addition to the scripting language to put yet even more power at the hands of the programmer/DBA using simple, clean syntax.</p>
<p>Still hush hush, the development of that feature touched at the very same issues described in Michael’s post. Present in current release, these issues are intensified by the use and complexity of the new development. Here are a few insights of mine:</p>
<h4>Internal array implementation</h4>
<p>Like Michael, I started by implementing arrays through tables. That is, create a (temporary, in my case) table, wrap it up with a lot of stored routine code, and simulate an array. This array is not yet provided to the user, but is used internally for QueryScript’s own code.</p>
<p>Well, disappointment here: during load tests on intense structures, such as a <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/query_script_foreach.html">foreach</a> loop, where each iteration of the loop requires the creation of an array, I found that the current solution does not hold well on busy servers.</p>
<p>Seemingly, there’s nothing wrong with the creation of a new table every once in a while — and in particular a temporary table. However, I quickly found out that a busy server thrashes the table cache with such intense rate of creation/dropping of tables. The competition over the table cache mutex becomes intolerable and hogs not only the script’s execution but the entire server’s.</p>
<p>There’s also the issue of the type of array values — no going around using textual columns, of course, but — how long? A <strong>VARCHAR(32767)</strong> should be enough for any reasonable implementation, but — how much memory would that consume? Both <strong>MEMORY</strong> and standard temporary tables (<em>Percona Server</em> has that partially <a href="http://www.mysqlperformanceblog.com/2011/09/06/dynamic-row-format-for-memory-tables/">resolved</a>) use a fixed row format, which means a 32K text is actually allocated in memory even when your value is ‘x’. <a href="https://shlomi-noach.github.io/blog/mysql/on-stored-routines-and-dynamic-statements#more-4947" class="more-link">Continue reading »<span class="screen-reader-text"> “On stored routines and dynamic statements”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/on-stored-routines-and-dynamic-statements#comments">1 Comment<span class="screen-reader-text"> on On stored routines and dynamic statements</span></a></span>	</footer>
</article>

<article id="post-4528" class="post-4528 post type-post status-publish format-standard hentry category-mysql tag-data-types">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/char-and-spaces" rel="bookmark">CHAR and spaces</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/data-types" rel="tag">Data Types</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/char-and-spaces" rel="bookmark"><time class="entry-date published updated" datetime="2012-06-12T07:28:08+02:00">June 12, 2012</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>I know about it, I knew about it all along, but… it’s so easy to fall for it; there’s just so much absurdity!</p>
<p>A <strong>CHAR</strong> type has a known number of characters. For example, the column:</p>
<blockquote>
<pre>CountryCode CHAR(3) CHARSET ascii NOT NULL</pre>
</blockquote>
<p>– is known to have exactly three characters. These could be <strong>‘USA’</strong>, <strong>‘FRA’</strong>, etc.</p>
<p>What happens with spaces? A SQL <strong>CHAR</strong> type ignores any trailing spaces; thus, the code <strong>‘GB ‘</strong> (the characters <strong>‘G’</strong>, <strong>‘B’</strong>, and the space <strong>‘ ‘</strong>) is interpreted as <strong>‘GB’</strong>. Trailing spaces are not regarded as part of the text. Want to see some absurdity?</p>
<blockquote>
<pre>CREATE TABLE `c_test` (
  `c` char(1) DEFAULT NULL
);
INSERT INTO c_test VALUES ('a');
INSERT INTO c_test VALUES ('b');
INSERT INTO c_test VALUES (' ');

SELECT c, LENGTH(c), c = 'a', c = 'b', c = ' ', LENGTH(' ') FROM c_test;
+------+-----------+---------+---------+---------+-------------+
| c    | LENGTH(c) | c = 'a' | c = 'b' | c = ' ' | LENGTH(' ') |
+------+-----------+---------+---------+---------+-------------+
| a    |         1 |       1 |       0 |       0 |           1 |
| b    |         1 |       0 |       1 |       0 |           1 |
|      |         0 |       0 |       0 |       1 |           1 |
+------+-----------+---------+---------+---------+-------------+</pre>
</blockquote>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/char-and-spaces#more-4528" class="more-link">Continue reading »<span class="screen-reader-text"> “CHAR and spaces”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/char-and-spaces#comments">12 Comments<span class="screen-reader-text"> on CHAR and spaces</span></a></span>	</footer>
</article>

<article id="post-4845" class="post-4845 post type-post status-publish format-standard hentry category-mysql tag-hack tag-innodb tag-myisam tag-refactoring">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/getting-rid-of-huge-ibdata-file-no-dump-required-part-ii" rel="bookmark">Getting rid of huge ibdata file, no dump required, part II</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/hack" rel="tag">Hack</a><a href="https://shlomi-noach.github.io/blog/tag/innodb" rel="tag">InnoDB</a><a href="https://shlomi-noach.github.io/blog/tag/myisam" rel="tag">MyISAM</a><a href="https://shlomi-noach.github.io/blog/tag/refactoring" rel="tag">Refactoring</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/getting-rid-of-huge-ibdata-file-no-dump-required-part-ii" rel="bookmark"><time class="entry-date published" datetime="2012-05-30T09:03:18+02:00">May 30, 2012</time><time class="updated" datetime="2012-06-03T12:12:47+02:00">June 3, 2012</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>This post continues <a href="https://shlomi-noach.github.io/blog/mysql/getting-rid-of-huge-ibdata-file-no-dump-required">Getting rid of huge ibdata file, no dump required, part I</a>, where I describe way of converting your single-tablespace InnoDB database into a file-per-table one, without the pain of exporting and importing <em>everything at once</em>.</p>
<p>In previous part we put aside the issue of foreign keys. We address this issue now.</p>
<h4>What if my InnoDB tables have foreign keys?</h4>
<p>MyISAM does not support them, so you can’t just <strong>ALTER</strong> an InnoDB table to MyISAM and back into InnoDB, and expect everything to work.</p>
<p>Alas, this calls for additional steps (i.e. additional <strong>ALTER</strong> commands). However, these still fall well under the concept of <em>“do it one table at a time, then take time to recover your breath and replication lag”</em>.</p>
<h4>Save , drop and restore your Foreign Keys setup</h4>
<p>You can use <a href="http://code.google.com/p/common-schema/">common_schema</a>‘s  <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_foreign_keys.html">sql_foreign_keys</a> to get the full listing and create definition of your foreign keys. For example, assume we use the <strong>sakila</strong> database: <a href="https://shlomi-noach.github.io/blog/mysql/getting-rid-of-huge-ibdata-file-no-dump-required-part-ii#more-4845" class="more-link">Continue reading »<span class="screen-reader-text"> “Getting rid of huge ibdata file, no dump required, part II”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/getting-rid-of-huge-ibdata-file-no-dump-required-part-ii#comments">6 Comments<span class="screen-reader-text"> on Getting rid of huge ibdata file, no dump required, part II</span></a></span>	</footer>
</article>

<article id="post-3442" class="post-3442 post type-post status-publish format-standard hentry category-mysql tag-hack tag-innodb tag-myisam tag-refactoring">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/getting-rid-of-huge-ibdata-file-no-dump-required" rel="bookmark">Getting rid of huge ibdata file, no dump required</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/hack" rel="tag">Hack</a><a href="https://shlomi-noach.github.io/blog/tag/innodb" rel="tag">InnoDB</a><a href="https://shlomi-noach.github.io/blog/tag/myisam" rel="tag">MyISAM</a><a href="https://shlomi-noach.github.io/blog/tag/refactoring" rel="tag">Refactoring</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/getting-rid-of-huge-ibdata-file-no-dump-required" rel="bookmark"><time class="entry-date published" datetime="2012-05-22T07:33:05+02:00">May 22, 2012</time><time class="updated" datetime="2012-05-22T07:34:23+02:00">May 22, 2012</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>You <a href="https://shlomi-noach.github.io/blog/mysql/upgrading-to-barracuda-getting-rid-of-huge-ibdata1-file">have</a> been <a href="http://ronaldbradford.com/blog/leveraging-the-innodb-plugin-2011-02-11/">told</a> (guilty as charged), that the only way to get rid of the huge InnoDB tablespace file (commonly named <strong>ibdata1</strong>), when moving to <strong>innodb_file_per_table</strong>, is to do a logical dump of your data, completely erase everything, then import the dump.</p>
<p>To quickly reiterate, you can only delete the <strong>ibdata1</strong> file when no InnoDB tables exist. Delete this file with an existing InnoDB table, even a table in its own tablespace, and nothing ever works anymore.</p>
<h4>The problem with the dump-based solution</h4>
<p>The impact of doing a logical dump is often overwhelming. Well, the dump may be tolerable, but the restore is much longer. The real pain is that you can’t do this one table at a time: you have to destroy everything before dropping the <strong>ibdata1</strong> file; you then have to import everything.</p>
<p>Perhaps the most common scenario is that we do the changes on a slave, so as not to completely shut down our database. This is nice; no one is aware of the shutdown process. However, Huston, we have a problem: we need to make sure we can keep up the binary logs on the master for the duration of the <em>entire process</em>. <a href="https://shlomi-noach.github.io/blog/mysql/getting-rid-of-huge-ibdata-file-no-dump-required#more-3442" class="more-link">Continue reading »<span class="screen-reader-text"> “Getting rid of huge ibdata file, no dump required”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/getting-rid-of-huge-ibdata-file-no-dump-required#comments">4 Comments<span class="screen-reader-text"> on Getting rid of huge ibdata file, no dump required</span></a></span>	</footer>
</article>

<article id="post-4860" class="post-4860 post type-post status-publish format-standard hentry category-mysql tag-common_schema tag-data-integrity">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/impact-of-foreign-keys-absence-on-replicating-slaves" rel="bookmark">Impact of foreign keys absence on replicating slaves</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/common_schema" rel="tag">common_schema</a><a href="https://shlomi-noach.github.io/blog/tag/data-integrity" rel="tag">data integrity</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/impact-of-foreign-keys-absence-on-replicating-slaves" rel="bookmark"><time class="entry-date published updated" datetime="2012-05-14T07:52:41+02:00">May 14, 2012</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>In this post I describe what happens when a slave’s Foreign Key setup is different from that of the master. I’m in particular interested in a setup where the slave has a subset of the master’s foreign keys, or no foreign keys at all. I wish to observe whether integrity holds.</p>
<h4>Making the changes</h4>
<p>Which foreign keys do we have and how do we drop them? If you want to do this by hand, well, good luck! Fortunately, <a href="http://code.google.com/p/common-schema/">common_schema</a> provides with quite a few handy views and routines to assist us. Consider viewing the existing foreign keys on <strong>sakila</strong>:</p>
<blockquote>
<pre>master> SELECT <strong>create_statement</strong> FROM <strong>common_schema.sql_foreign_keys</strong> WHERE TABLE_SCHEMA='sakila';
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| create_statement                                                                                                                                                                                |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ALTER TABLE `sakila`.`address` ADD CONSTRAINT `fk_address_city` FOREIGN KEY (`city_id`) REFERENCES `sakila`.`city` (`city_id`) ON DELETE RESTRICT ON UPDATE CASCADE                             |
| ALTER TABLE `sakila`.`city` ADD CONSTRAINT `fk_city_country` FOREIGN KEY (`country_id`) REFERENCES `sakila`.`country` (`country_id`) ON DELETE RESTRICT ON UPDATE CASCADE                       |
| ALTER TABLE `sakila`.`customer` ADD CONSTRAINT `fk_customer_address` FOREIGN KEY (`address_id`) REFERENCES `sakila`.`address` (`address_id`) ON DELETE RESTRICT ON UPDATE CASCADE               |
| ALTER TABLE `sakila`.`customer` ADD CONSTRAINT `fk_customer_store` FOREIGN KEY (`store_id`) REFERENCES `sakila`.`store` (`store_id`) ON DELETE RESTRICT ON UPDATE CASCADE                       |
| ALTER TABLE `sakila`.`film` ADD CONSTRAINT `fk_film_language` FOREIGN KEY (`language_id`) REFERENCES `sakila`.`language` (`language_id`) ON DELETE RESTRICT ON UPDATE CASCADE                   |
| ALTER TABLE `sakila`.`film` ADD CONSTRAINT `fk_film_language_original` FOREIGN KEY (`original_language_id`) REFERENCES `sakila`.`language` (`language_id`) ON DELETE RESTRICT ON UPDATE CASCADE |
| ALTER TABLE `sakila`.`film_actor` ADD CONSTRAINT `fk_film_actor_actor` FOREIGN KEY (`actor_id`) REFERENCES `sakila`.`actor` (`actor_id`) ON DELETE RESTRICT ON UPDATE CASCADE                   |
| ALTER TABLE `sakila`.`film_actor` ADD CONSTRAINT `fk_film_actor_film` FOREIGN KEY (`film_id`) REFERENCES `sakila`.`film` (`film_id`) ON DELETE RESTRICT ON UPDATE CASCADE                       |
| ALTER TABLE `sakila`.`film_category` ADD CONSTRAINT `fk_film_category_category` FOREIGN KEY (`category_id`) REFERENCES `sakila`.`category` (`category_id`) ON DELETE RESTRICT ON UPDATE CASCADE |
| ALTER TABLE `sakila`.`film_category` ADD CONSTRAINT `fk_film_category_film` FOREIGN KEY (`film_id`) REFERENCES `sakila`.`film` (`film_id`) ON DELETE RESTRICT ON UPDATE CASCADE                 |
| ALTER TABLE `sakila`.`inventory` ADD CONSTRAINT `fk_inventory_film` FOREIGN KEY (`film_id`) REFERENCES `sakila`.`film` (`film_id`) ON DELETE RESTRICT ON UPDATE CASCADE                         |
| ALTER TABLE `sakila`.`inventory` ADD CONSTRAINT `fk_inventory_store` FOREIGN KEY (`store_id`) REFERENCES `sakila`.`store` (`store_id`) ON DELETE RESTRICT ON UPDATE CASCADE                     |
| ALTER TABLE `sakila`.`payment` ADD CONSTRAINT `fk_payment_customer` FOREIGN KEY (`customer_id`) REFERENCES `sakila`.`customer` (`customer_id`) ON DELETE RESTRICT ON UPDATE CASCADE             |
| ALTER TABLE `sakila`.`payment` ADD CONSTRAINT `fk_payment_rental` FOREIGN KEY (`rental_id`) REFERENCES `sakila`.`rental` (`rental_id`) ON DELETE SET NULL ON UPDATE CASCADE                     |
| ALTER TABLE `sakila`.`payment` ADD CONSTRAINT `fk_payment_staff` FOREIGN KEY (`staff_id`) REFERENCES `sakila`.`staff` (`staff_id`) ON DELETE RESTRICT ON UPDATE CASCADE                         |
| ALTER TABLE `sakila`.`rental` ADD CONSTRAINT `fk_rental_customer` FOREIGN KEY (`customer_id`) REFERENCES `sakila`.`customer` (`customer_id`) ON DELETE RESTRICT ON UPDATE CASCADE               |
| ALTER TABLE `sakila`.`rental` ADD CONSTRAINT `fk_rental_inventory` FOREIGN KEY (`inventory_id`) REFERENCES `sakila`.`inventory` (`inventory_id`) ON DELETE RESTRICT ON UPDATE CASCADE           |
| ALTER TABLE `sakila`.`rental` ADD CONSTRAINT `fk_rental_staff` FOREIGN KEY (`staff_id`) REFERENCES `sakila`.`staff` (`staff_id`) ON DELETE RESTRICT ON UPDATE CASCADE                           |
| ALTER TABLE `sakila`.`staff` ADD CONSTRAINT `fk_staff_address` FOREIGN KEY (`address_id`) REFERENCES `sakila`.`address` (`address_id`) ON DELETE RESTRICT ON UPDATE CASCADE                     |
| ALTER TABLE `sakila`.`staff` ADD CONSTRAINT `fk_staff_store` FOREIGN KEY (`store_id`) REFERENCES `sakila`.`store` (`store_id`) ON DELETE RESTRICT ON UPDATE CASCADE                             |
| ALTER TABLE `sakila`.`store` ADD CONSTRAINT `fk_store_address` FOREIGN KEY (`address_id`) REFERENCES `sakila`.`address` (`address_id`) ON DELETE RESTRICT ON UPDATE CASCADE                     |
| ALTER TABLE `sakila`.`store` ADD CONSTRAINT `fk_store_staff` FOREIGN KEY (`manager_staff_id`) REFERENCES `sakila`.`staff` (`staff_id`) ON DELETE RESTRICT ON UPDATE CASCADE                     |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</pre>
</blockquote>
<p>Most of the foreign key constraints use <strong>RESTRICT</strong> for <strong>DELETE</strong> (meaning you are not allowed to delete a parent row when children exist), and <strong>CASCADE</strong> for <strong>UPDATE</strong> (meaning changes to parent will propagate to children). This is good, since I want to test behavior of both <strong>RESTRICT</strong> and <strong>CASCADE</strong>.</p>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/impact-of-foreign-keys-absence-on-replicating-slaves#more-4860" class="more-link">Continue reading »<span class="screen-reader-text"> “Impact of foreign keys absence on replicating slaves”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/impact-of-foreign-keys-absence-on-replicating-slaves#comments">4 Comments<span class="screen-reader-text"> on Impact of foreign keys absence on replicating slaves</span></a></span>	</footer>
</article>

	<nav class="navigation posts-navigation" role="navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://shlomi-noach.github.io/blog/category/mysql/page/20">Older posts</a></div><div class="nav-next"><a href="https://shlomi-noach.github.io/blog/category/mysql/page/18">Newer posts</a></div></div>
	</nav>
	</main>


	<footer id="colophon" class="site-footer">
		<div class="site-info">
			<a href="https://wordpress.org/">
				Powered by WordPress			</a>
			<span class="sep"> | </span>
				Theme: <a href="http://openark.org">openark-primer</a> by <a href="http://underscores.me/">Underscores.me</a>.		</div>
	</footer>
</div>

	<div style="display:none">
	</div>
<script>
var pollsL10n = {"ajax_url":"https:\/\/shlomi-noach.github.io\/blog\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-js.js"></script>
<script src="https://secure.gravatar.com/js/gprofiles.js?ver=2020Junaa"></script>
<script>
var WPGroHo = {"my_hash":""};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/modules/wpgroho.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/navigation.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/skip-link-focus-fix.js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202024.js" async="async" defer></script>
<script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:8.2.1',blog:'32412571',post:'0',tz:'2',srv:'code.openark.org'} ]);
	_stq.push([ 'clickTrackerInit', '32412571', '0' ]);
</script>

</body>
</html>
