<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	

	<title>Replication – Page 6 – code.openark.org</title>
<link rel="dns-prefetch" href="//secure.gravatar.com">
<link rel="dns-prefetch" href="//s.w.org">



<link rel="stylesheet" id="wp-block-library-css" href="https://shlomi-noach.github.io/blog/wp-includes/css/dist/block-library/style.min.css" media="all">
<style id="wp-block-library-inline-css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="wp-polls-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-css.css" media="all">
<style id="wp-polls-inline-css">
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel="stylesheet" id="openark-primer-style-css" href="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/style.css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/css/jetpack.css" media="all">
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery-migrate.min.js"></script>



<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<link rel="dns-prefetch" href="//v0.wordpress.com">


<meta property="og:type" content="website">
<meta property="og:title" content="Replication – Page 6 – code.openark.org">
<meta property="og:url" content="https://shlomi-noach.github.io/blog/tag/replication">
<meta property="og:site_name" content="code.openark.org">
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg">
<meta property="og:locale" content="en_US">


<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(242,101,34,.88);}</style></head>

<body class="archive paged tag tag-replication tag-8 paged-6 tag-paged-6 hfeed no-sidebar">
<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#primary">Skip to content</a>

	<header id="masthead" class="site-header">
		<div class="site-branding">
							<p class="site-title"><a href="https://shlomi-noach.github.io/blog/" rel="home">code.openark.org</a></p>
								<p class="site-description">Blog by Shlomi Noach</p>
			
			<nav id="site-navigation" class="main-navigation">
				<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">primary-menu</button>
				<div class="menu-primary-menu-container"><ul id="menu-primary-menu" class="menu"><li id="menu-item-8109" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8109"><a href="https://shlomi-noach.github.io/blog/archives">archives</a></li>
<li id="menu-item-8050" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8050"><a href="https://shlomi-noach.github.io/blog/presentations">presentations</a></li>
<li id="menu-item-8055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8055"><a href="https://shlomi-noach.github.io/blog/about">about</a></li>
<li id="menu-item-8071" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8071"><a href="https://github.com/shlomi-noach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li>
<li id="menu-item-8074" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8074"><a href="https://www.linkedin.com/in/shlominoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li>
<li id="menu-item-8072" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8072"><a href="https://twitter.com/ShlomiNoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"></path></svg></a></li>
<li id="menu-item-8073" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8073"><a href="https://shlomi-noach.github.io/blog/feed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-12.832 20c-1.197 0-2.168-.969-2.168-2.165s.971-2.165 2.168-2.165 2.167.969 2.167 2.165-.97 2.165-2.167 2.165zm5.18 0c-.041-4.029-3.314-7.298-7.348-7.339v-3.207c5.814.041 10.518 4.739 10.561 10.546h-3.213zm5.441 0c-.021-7.063-5.736-12.761-12.789-12.792v-3.208c8.83.031 15.98 7.179 16 16h-3.211z"></path></svg></a></li>
</ul></div>			</nav>
		</div>
	</header>

	<main id="primary" class="site-main">

		
			<header class="page-header">
				<h1 class="page-title">Tag: Replication</h1>			</header>

			
<article id="post-3528" class="post-3528 post type-post status-publish format-standard hentry category-mysql tag-mysqlconf tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/impressions-from-mysql-conf-2011-part-iii-bof-replication" rel="bookmark">Impressions from MySQL conf 2011, part III: BoF Replication</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/mysqlconf" rel="tag">mysqlconf</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/impressions-from-mysql-conf-2011-part-iii-bof-replication" rel="bookmark"><time class="entry-date published" datetime="2011-04-19T06:11:14+02:00">April 19, 2011</time><time class="updated" datetime="2011-04-21T13:39:38+02:00">April 21, 2011</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>This post continues my impressions from some of the talks I’ve been to. I’ll dedicate this post to a single session.</p>
<h4>Wednesday</h4>
<ul>
<li>BoF: Replication, Lars Thalmann<em>, </em>Mat Keep<em> (Oracle)</em></li>
</ul>
<p>Lars Thallman presented the MySQL 5.5 replication features, as well as the expected 5.6 features. Among other features, one could notice parallel replication, binlog checksums, sub-second resolution and more. There was an open discussion about these features, asking for comments; looking for new ideas and suggestion from the audience.</p>
<p>I can’t possibly cover it all. I’ll note two discussion I participated in, and which have interested me. This also serves for noting down to myself my ideas and thoughts. <a href="https://shlomi-noach.github.io/blog/mysql/impressions-from-mysql-conf-2011-part-iii-bof-replication#more-3528" class="more-link">Continue reading »<span class="screen-reader-text"> “Impressions from MySQL conf 2011, part III: BoF Replication”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/impressions-from-mysql-conf-2011-part-iii-bof-replication#comments">4 Comments<span class="screen-reader-text"> on Impressions from MySQL conf 2011, part III: BoF Replication</span></a></span>	</footer>
</article>

<article id="post-3412" class="post-3412 post type-post status-publish format-standard hentry category-mysql tag-configuration tag-replication tag-security">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/recovering-a-mysql-root-password-the-fourth-solution" rel="bookmark">Recovering a MySQL `root` password: the fourth solution</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/configuration" rel="tag">Configuration</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a><a href="https://shlomi-noach.github.io/blog/tag/security" rel="tag">Security</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/recovering-a-mysql-root-password-the-fourth-solution" rel="bookmark"><time class="entry-date published updated" datetime="2011-03-22T09:47:46+02:00">March 22, 2011</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Have just read Darren Cassar’s <a title="Permanent Link to Recovering a MySQL `root` password – Three solutions" rel="bookmark" href="http://mysqlpreacher.com/wordpress/2011/03/recovering-a-mysql-root-password-three-solutions/">Recovering a MySQL `root` password – Three solutions</a>. There’s a fourth solution: using an <strong>init-file</strong>, which leads to just one restart of the database instead of two. It also avoids the security issue involved with using <strong>skip-grant-tables</strong>.</p>
<p>I’ve written all about it before on <a title="Permanent Link to Dangers of skip-grant-tables" rel="bookmark" href="https://shlomi-noach.github.io/blog/mysql/dangers-of-skip-grant-tables">Dangers of skip-grant-tables</a>.</p>
<p>Darren’s 1st advice (look for password ini files, scripts, etc.) is a very good one. One password that can always be looked up in files is the replication’s password.</p>
<p>Replication’s password is easily forgotten: you only set it once and never use it again; never script it nor manually login with. When setting up new slaves, though, you suddenly need it.</p>
<p>Apparently not many realize that the replication password is written in plaintext in the <strong>master.info</strong> file. This file tells the slave all about it’s master connection: host, port, user & password are all there for you to read.</p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/recovering-a-mysql-root-password-the-fourth-solution#comments">13 Comments<span class="screen-reader-text"> on Recovering a MySQL `root` password: the fourth solution</span></a></span>	</footer>
</article>

<article id="post-3304" class="post-3304 post type-post status-publish format-standard hentry category-mysql tag-backup tag-configuration tag-innodb tag-mysqldump tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/upgrading-to-barracuda-getting-rid-of-huge-ibdata1-file" rel="bookmark">Upgrading to Barracuda & getting rid of huge ibdata1 file</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/backup" rel="tag">Backup</a><a href="https://shlomi-noach.github.io/blog/tag/configuration" rel="tag">Configuration</a><a href="https://shlomi-noach.github.io/blog/tag/innodb" rel="tag">InnoDB</a><a href="https://shlomi-noach.github.io/blog/tag/mysqldump" rel="tag">mysqldump</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/upgrading-to-barracuda-getting-rid-of-huge-ibdata1-file" rel="bookmark"><time class="entry-date published updated" datetime="2011-02-15T10:01:15+02:00">February 15, 2011</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Some of this is old stuff, but more people are now converting to InnoDB plugin, so as to enjoy table compression, performance boosts. Same holds for people converting to Percona’s XtraDB. InnoDB plugin requires <strong>innodb_file_per_table</strong>. No more shared tablespace file.</p>
<p>So your <strong>ibdata1</strong> file is some <strong>150GB</strong>, and it won’t reduce. Really, it won’t reduce. You set <strong>innodb_file_per_table=1</strong>, do <strong>ALTER TABLE t ENGINE=InnoDB</strong> (optionally <strong>ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8</strong>), and you get all your tables in file-per-table <strong>.ibd</strong> files.</p>
<p>But the original <strong>ibdata1</strong> file is still there. It has to be there, don’t delete it! It contains more than your old data.</p>
<p>InnoDB tablespace files never reduce in size, it’s an old-time annoyance. The only way to go round it, if you need the space, is to completely drop them and start afresh. That’s one of the things so nice about file-per-table: an <strong>ALTER TABLE</strong> actually creates a new tablespace file and drops the original one.</p>
<h4>The procedure</h4>
<p>The procedure is somewhat painful:</p>
<ul>
<li>Dump everything logically (either use <em>mysqldump</em>, <a href="http://www.maatkit.org/doc/mk-parallel-dump.html">mk-parallel-dump</a>, or do it your own way)</li>
<li>Erase your data (literally, delete everything under your <strong>datadir</strong>)</li>
<li>Generate a new empty database</li>
<li>Load your dumped data. <a href="https://shlomi-noach.github.io/blog/mysql/upgrading-to-barracuda-getting-rid-of-huge-ibdata1-file#more-3304" class="more-link">Continue reading »<span class="screen-reader-text"> “Upgrading to Barracuda & getting rid of huge ibdata1 file”</span></a></li>
</ul>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/upgrading-to-barracuda-getting-rid-of-huge-ibdata1-file#comments">16 Comments<span class="screen-reader-text"> on Upgrading to Barracuda & getting rid of huge ibdata1 file</span></a></span>	</footer>
</article>

<article id="post-3124" class="post-3124 post type-post status-publish format-standard hentry category-development category-mysql tag-analysis tag-open-source tag-openark-kit tag-python tag-replication tag-scripts">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/openark-kit-rev-170-new-tools-new-functionality" rel="bookmark">openark-kit (rev. 170): new tools, new functionality</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/development" rel="category tag">Development</a> <a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/analysis" rel="tag">Analysis</a><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/openark-kit" rel="tag">openark kit</a><a href="https://shlomi-noach.github.io/blog/tag/python" rel="tag">python</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a><a href="https://shlomi-noach.github.io/blog/tag/scripts" rel="tag">scripts</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/openark-kit-rev-170-new-tools-new-functionality" rel="bookmark"><time class="entry-date published" datetime="2010-12-15T08:31:24+02:00">December 15, 2010</time><time class="updated" datetime="2010-12-15T13:02:08+02:00">December 15, 2010</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>I’m pleased to announce a new release of the <a href="http://code.openark.org/forge/openark-kit">openark kit</a>. There’s a lot of new functionality inside; following is a brief overview.</p>
<p>The <em>openark kit</em> is a set of utilities for MySQL. They  solve everyday maintenance tasks, which may be complicated or time  consuming to work by hand.</p>
<p>It’s been a while since the last announced release. Most of my attention was on <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a>, building new features, writing documentation etc. However my own use of <em>openark kit</em> has only increased in the past few months, and there’s new useful solutions to common problems that have been developed.</p>
<p>I’ve used and improved many tools over this time, but doing the final cut, along with proper documentation, took some time. Anyway, here are the highlights:</p>
<h4>New tool: oak-hook-general-log</h4>
<p><em>oak-hook-general-log</em> hooks up a MySQL server and dumps the general log based on filtering rules, applying to query role or execution plan. It is possible to only dump connect/disconnect entries, queries which make a full table scan, or use temporary tables, or scan more than X number of rows, or…</p>
<p>I’ll write more on this tool shortly.</p>
<h4>New tool: oak-prepare-shutdown</h4>
<p>This tool makes for an orderly and faster shutdown by safely stopping replication, and flushing InnoDB pages to disk prior to shutting down (keeping server available for connections even while attempting to flush dirty pages to disk). A typical use case would be:</p>
<blockquote>
<pre>oak-prepare-shutdown --user=root --ask-pass --socket=/tmp/mysql.sock && /etc/init.d/mysql stop</pre>
</blockquote>
<h4>New tool: oak-repeat query</h4>
<p><em>oak-repeat-query</em> repeats executing a given query until some condition holds. The condition can be:</p>
<ul>
<li>Number of given iterations has been reached</li>
<li>Given time has elapsed</li>
<li>No rows have been affected by query</li>
</ul>
<p>The tool comes in handy for cleanup jobs, warming up caches, etc. <a href="https://shlomi-noach.github.io/blog/mysql/openark-kit-rev-170-new-tools-new-functionality#more-3124" class="more-link">Continue reading »<span class="screen-reader-text"> “openark-kit (rev. 170): new tools, new functionality”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/openark-kit-rev-170-new-tools-new-functionality#comments">3 Comments<span class="screen-reader-text"> on openark-kit (rev. 170): new tools, new functionality</span></a></span>	</footer>
</article>

<article id="post-2824" class="post-2824 post type-post status-publish format-standard hentry category-mysql tag-configuration tag-high-availability tag-open-source tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/mmm-for-mysql-single-reader-role" rel="bookmark">MMM for MySQL single reader role</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/configuration" rel="tag">Configuration</a><a href="https://shlomi-noach.github.io/blog/tag/high-availability" rel="tag">High availability</a><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/mmm-for-mysql-single-reader-role" rel="bookmark"><time class="entry-date published" datetime="2010-08-12T14:12:16+02:00">August 12, 2010</time><time class="updated" datetime="2010-08-12T14:38:34+02:00">August 12, 2010</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>The standard documentation and tutorials on <a href="http://mysql-mmm.org/">MMM for MySQL</a>, for master-master replication setup, suggest one Virtual IP for the <em>writer</em> role, and two Virtual IPs for the <em>reader</em> role. It can be desired to only have a single virtual IP for the reader role, as explained below.</p>
<h4>The two IPs for the reader role</h4>
<p>A simplified excerpt from the <strong>mmm_common.conf</strong> sample configuration file, as can be found on the project’s site and which is most quoted: <a href="https://shlomi-noach.github.io/blog/mysql/mmm-for-mysql-single-reader-role#more-2824" class="more-link">Continue reading »<span class="screen-reader-text"> “MMM for MySQL single reader role”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/mmm-for-mysql-single-reader-role#comments">3 Comments<span class="screen-reader-text"> on MMM for MySQL single reader role</span></a></span>	</footer>
</article>

<article id="post-2801" class="post-2801 post type-post status-publish format-standard hentry category-development category-mysql tag-development tag-indexing tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/table-refactoring-application-version-upgrades-part-ii" rel="bookmark">Table refactoring & application version upgrades, Part II</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/development" rel="category tag">Development</a> <a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/development" rel="tag">Development</a><a href="https://shlomi-noach.github.io/blog/tag/indexing" rel="tag">Indexing</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/table-refactoring-application-version-upgrades-part-ii" rel="bookmark"><time class="entry-date published" datetime="2010-08-12T05:24:06+02:00">August 12, 2010</time><time class="updated" datetime="2010-08-12T10:16:04+02:00">August 12, 2010</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Continuing <a href="https://shlomi-noach.github.io/blog/mysql/table-refactoring-application-version-upgrades-part-i">Table refactoring & application version upgrades, Part I</a>, we now discuss code & database upgrades which require <strong>DROP</strong> operations. As before, we break apart the upgrade process into sequential steps, each involving either the application or the database, but not both.</p>
<p>As I’ll show, DROP operations are significantly simpler than creation operations. Interestingly, it’s the same as in life.</p>
<h4>DROP COLUMN</h4>
<p>A column turns to be redundant, unused. Before it is dropped from the database, we must ensure no one is using it anymore. The steps are:</p>
<ol>
<li>App: <strong>V1</strong> -> <strong>V2</strong>. Remove all references to column; make sure no queries use said column.</li>
<li>DB: <strong>V1</strong> -> <strong>V2</strong> (possibly failover from <strong>M1</strong> to <strong>M2</strong>), change is <strong>DROP COLUMN</strong>.</li>
</ol>
<h4>DROP INDEX</h4>
<p>A possibly simpler case here. Why would you drop an index? Is it because you found out you never use it anymore? Then all you have to do is just drop it.</p>
<p>Or perhaps you don’t need the functionality the index supports anymore? Then first drop the functionality:</p>
<ol>
<li>(optional) App: <strong>V1</strong> -> <strong>V2</strong>. Discard using functionality which relies on index.</li>
<li>DB: <strong>V1</strong> -> <strong>V2</strong> (possibly failover from <strong>M1</strong> to <strong>M2</strong>), change is <strong>DROP INDEX</strong>. Check out InnoDB Plugin here. <a href="https://shlomi-noach.github.io/blog/mysql/table-refactoring-application-version-upgrades-part-ii#more-2801" class="more-link">Continue reading »<span class="screen-reader-text"> “Table refactoring & application version upgrades, Part II”</span></a></li>
</ol>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/table-refactoring-application-version-upgrades-part-ii#respond">Leave a Comment<span class="screen-reader-text"> on Table refactoring & application version upgrades, Part II</span></a></span>	</footer>
</article>

<article id="post-2775" class="post-2775 post type-post status-publish format-standard hentry category-development category-mysql tag-development tag-indexing tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/table-refactoring-application-version-upgrades-part-i" rel="bookmark">Table refactoring & application version upgrades, Part I</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/development" rel="category tag">Development</a> <a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/development" rel="tag">Development</a><a href="https://shlomi-noach.github.io/blog/tag/indexing" rel="tag">Indexing</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/table-refactoring-application-version-upgrades-part-i" rel="bookmark"><time class="entry-date published updated" datetime="2010-08-10T14:36:28+02:00">August 10, 2010</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>A developer’s major concern is: <em>How do I do application & database upgrades with minimal downtime? How do I synchronize between a DB’s version upgrade and an application’s version upgrade?<br>
</em></p>
<p>I will break down the discussion into types of database refactoring operations, and I will limit to single table refactoring. The discussion will try to understand the need for refactoring and will dictate the steps towards a successful upgrade.</p>
<h4>Reader prerequisites</h4>
<p>I will assume MySQL to be the underlying database. To take a major component out of the equation: we may need to deal with very large tables, for which an <strong>ALTER</strong> command may take long hours. I will assume familiarity with Master-Master (Active-Passive) replication, with possible use of <a href="http://mysql-mmm.org/">MMM for MySQL</a>. When I describe “Failover from <strong>M1</strong> to <strong>M2</strong>“, I mean “Make the <strong>ALTER</strong> changes on <strong>M2</strong> (passive), then switch your application from <strong>M1</strong> to <strong>M2</strong> (change of IPs, VIP, etc.), promoting <strong>M2</strong> to active position, then apply same changes on <strong>M1</strong> (now passive) or completely rebuild it”.</p>
<p>Phew, a one sentence description of M-M usage…</p>
<p>I also assume the reader’s understanding that a table’s schema can be different on master & slave, which is the basis for the “use replication for refactoring” trick. But it cannot be too different, or, to be precise, the two schemata must both support the ongoing queries for the table.</p>
<p>A full discussion of the above is beyond the scope of this post.</p>
<h4>Types of refactoring needs</h4>
<p>As I limit this discussion to single table refactoring,we can look at major refactoring operations and their impact on application & upgrades. We will discuss ADD/DROP COLUMN, ADD/DROP INDEX, ADD/DROP UNIQUE INDEX, ADD/DROP FOREIGN KEY, ADD/DROP TABLE.</p>
<p>We will assume the database and application are both in Version #1 (<strong>V1</strong>), and need to be upgraded to <strong>V2</strong> or greater. <a href="https://shlomi-noach.github.io/blog/mysql/table-refactoring-application-version-upgrades-part-i#more-2775" class="more-link">Continue reading »<span class="screen-reader-text"> “Table refactoring & application version upgrades, Part I”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/table-refactoring-application-version-upgrades-part-i#comments">1 Comment<span class="screen-reader-text"> on Table refactoring & application version upgrades, Part I</span></a></span>	</footer>
</article>

<article id="post-2357" class="post-2357 post type-post status-publish format-standard hentry category-mysql tag-configuration tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/replication-configuration-checklist" rel="bookmark">Replication configuration checklist</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/configuration" rel="tag">Configuration</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/replication-configuration-checklist" rel="bookmark"><time class="entry-date published" datetime="2010-05-18T09:27:06+02:00">May 18, 2010</time><time class="updated" datetime="2010-05-18T19:14:44+02:00">May 18, 2010</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>This post lists the essential and optional settings for a replication environment.</p>
<p>It does not explain how to create replicating slaves. See <a href="http://dev.mysql.com/doc/refman/5.1/en/replication-howto.html">How To Setup Replication</a> for that. However, not all configuration options are well understood, and their roles in varying architectures can change.</p>
<p>Here are the settings for a basic Master/Slave(s) replication architecturee.</p>
<h4>Essential</h4>
<ul>
<li><strong>log-bin</strong>: enable binary logs on the master. Replication is based on the master logging all modifying queries (<strong>INSERT</strong>/<strong>CREATE</strong>/<strong>ALTER</strong>/<strong>GRANT</strong> etc.), and the slaves being able to replicate them.</li>
<li><strong>server-id</strong>: each machine must have a <em>unique</em> <strong>server-id</strong>. A slave will not replay queries originating from a server with the same <strong>server-id</strong> as its own.</li>
<li><strong>GRANT</strong>: grant a user with <strong>REPLICATION SLAVE</strong>. The host list must include all replication slave hosts.</li>
<li><strong>expire-logs-days</strong>: automatically clean up master’s binary logs older than given value. By default, binary logs are never removed.</li>
</ul>
<p>When working with Master/Slaves replication, one should be prepared to master failure and slave promotion to master. It may be desirable to identify a particular slave as primary candidate for promotion.</p>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/replication-configuration-checklist#more-2357" class="more-link">Continue reading »<span class="screen-reader-text"> “Replication configuration checklist”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/replication-configuration-checklist#comments">13 Comments<span class="screen-reader-text"> on Replication configuration checklist</span></a></span>	</footer>
</article>

<article id="post-2077" class="post-2077 post type-post status-publish format-standard hentry category-mysql tag-configuration tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/quick-reminder-avoid-using-binlog-do-db" rel="bookmark">Quick reminder: avoid using binlog-do-db</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/configuration" rel="tag">Configuration</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/quick-reminder-avoid-using-binlog-do-db" rel="bookmark"><time class="entry-date published updated" datetime="2010-03-02T21:03:50+02:00">March 2, 2010</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Nothing new about this warning; but it’s worth repeating:</p>
<p>Using <a href="http://dev.mysql.com/doc/refman/5.1/en/replication-options-binary-log.html#option_mysqld_binlog-do-db"><strong>binlog-do-db</strong></a> is dangerous to your replication. It means the master will not write to binary logs any statement not in the given database.</p>
<p>Ahem. Not exactly. It will not write to binary logs any statement which did not originate from the given database.</p>
<p>Which is why a customer, who was using <strong>Toad for MySQL</strong> as client interface to MySQL, and by default connected to the <strong>mysql</strong> schema, did not see his queries being replicated. In fact, he later on got replication errors. If you do:</p>
<blockquote>
<pre>USE test;
INSERT INTO world.City VALUES (...)</pre>
</blockquote>
<p>Then the statement is assumed to be in the <strong>test</strong> database, not in the <strong>world</strong> database.</p>
<p>Slightly better is using <strong>replicate-do-db</strong> on the slave machines. At least we allow the master to write everything. But still, for the same reasons, slaves may fail to repeat a perfectly valid query, just because it has been issued in the context of the wrong database. <strong>replicate-ignore-db</strong> is somewhat safer yet, but the trap is still there.</p>
<p>My advice is that replication should replicate <em>everything</em>. Make sure you and everyone else you work with understand the implications of <strong>binlog-do-db</strong> and <strong>replicate-do-db</strong> before implementing it.</p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/quick-reminder-avoid-using-binlog-do-db#comments">6 Comments<span class="screen-reader-text"> on Quick reminder: avoid using binlog-do-db</span></a></span>	</footer>
</article>

<article id="post-1976" class="post-1976 post type-post status-publish format-standard hentry category-mysql tag-backup tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/defined-your-mysql-backup-recovery-plan-recently" rel="bookmark">Defined your MySQL backup & recovery plan recently?</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/backup" rel="tag">Backup</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/defined-your-mysql-backup-recovery-plan-recently" rel="bookmark"><time class="entry-date published" datetime="2010-02-17T11:52:00+02:00">February 17, 2010</time><time class="updated" datetime="2010-02-17T11:54:09+02:00">February 17, 2010</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Following up on <a href="http://ronaldbradford.com/">Ronald Bradford</a>‘s <a href="http://ronaldbradford.com/blog/checked-your-mysql-recovery-process-recently-2010-02-15/">Checked your MySQL recovery process recently?</a> post, I wish to add a <em>prequel</em>.</p>
<p>To see whether you have a clear definition of your backup requirements, ask yourself these questions:</p>
<ul>
<li>Is there a backup/restore plan?</li>
<li>Is there a written backup/restore plan?</li>
<li>How fast do you need to recover a backup? What’s the longest downtime you will allow from the point of failure to the point of restored, functional database?</li>
<li>How much data are you willing to lose in case of crash? A second’s worth of data? An hour’s worth? A day’s worth? None?</li>
<li>Are you willing to allow that the database becomes read-only when taking the backup? Or completely down?</li>
<li>Are you willing to take the risk that the backup will not be 100% compatible with the data? (Backing up your slave holds this risk)</li>
<li>Is your manager willing to all that you are willing?</li>
<li>Is the backup plan known to the management team, or do they just know that “<em>the database has backups</em>“?</li>
</ul>
<p>The above checklist is by no means complete.</p>
<p>I have a vivid memory of a very good sys admin who failed on the last two points. He had some very sour days when recovering a lost file from tape took much longer than was affordable to some contract.</p>
<p>I found that technical people rarely share the same views as marketing/management. Make sure to consult with the management team; they will have a clearer view on what the company can afford and what it cannot afford.</p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/defined-your-mysql-backup-recovery-plan-recently#respond">Leave a Comment<span class="screen-reader-text"> on Defined your MySQL backup & recovery plan recently?</span></a></span>	</footer>
</article>

	<nav class="navigation posts-navigation" role="navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://shlomi-noach.github.io/blog/tag/replication/page/7">Older posts</a></div><div class="nav-next"><a href="https://shlomi-noach.github.io/blog/tag/replication/page/5">Newer posts</a></div></div>
	</nav>
	</main>


	<footer id="colophon" class="site-footer">
		<div class="site-info">
			<a href="https://wordpress.org/">
				Powered by WordPress			</a>
			<span class="sep"> | </span>
				Theme: <a href="http://openark.org">openark-primer</a> by <a href="http://underscores.me/">Underscores.me</a>.		</div>
	</footer>
</div>

	<div style="display:none">
	</div>
<script>
var pollsL10n = {"ajax_url":"https:\/\/shlomi-noach.github.io\/blog\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-js.js"></script>
<script src="https://secure.gravatar.com/js/gprofiles.js?ver=2020Junaa"></script>
<script>
var WPGroHo = {"my_hash":""};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/modules/wpgroho.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/navigation.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/skip-link-focus-fix.js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202024.js" async="async" defer></script>
<script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:8.2.1',blog:'32412571',post:'0',tz:'2',srv:'code.openark.org'} ]);
	_stq.push([ 'clickTrackerInit', '32412571', '0' ]);
</script>

</body>
</html>
