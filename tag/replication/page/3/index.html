<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	

	<title>Replication – Page 3 – code.openark.org</title>
<link rel="dns-prefetch" href="//secure.gravatar.com">
<link rel="dns-prefetch" href="//s.w.org">



<link rel="stylesheet" id="wp-block-library-css" href="https://shlomi-noach.github.io/blog/wp-includes/css/dist/block-library/style.min.css" media="all">
<style id="wp-block-library-inline-css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="wp-polls-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-css.css" media="all">
<style id="wp-polls-inline-css">
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel="stylesheet" id="openark-primer-style-css" href="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/style.css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/css/jetpack.css" media="all">
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery-migrate.min.js"></script>



<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<link rel="dns-prefetch" href="//v0.wordpress.com">


<meta property="og:type" content="website">
<meta property="og:title" content="Replication – Page 3 – code.openark.org">
<meta property="og:url" content="https://shlomi-noach.github.io/blog/tag/replication">
<meta property="og:site_name" content="code.openark.org">
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg">
<meta property="og:locale" content="en_US">


<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(242,101,34,.88);}</style></head>

<body class="archive paged tag tag-replication tag-8 paged-3 tag-paged-3 hfeed no-sidebar">
<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#primary">Skip to content</a>

	<header id="masthead" class="site-header">
		<div class="site-branding">
							<p class="site-title"><a href="https://shlomi-noach.github.io/blog/" rel="home">code.openark.org</a></p>
								<p class="site-description">Blog by Shlomi Noach</p>
			
			<nav id="site-navigation" class="main-navigation">
				<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">primary-menu</button>
				<div class="menu-primary-menu-container"><ul id="menu-primary-menu" class="menu"><li id="menu-item-8109" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8109"><a href="https://shlomi-noach.github.io/blog/archives">archives</a></li>
<li id="menu-item-8050" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8050"><a href="https://shlomi-noach.github.io/blog/presentations">presentations</a></li>
<li id="menu-item-8055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8055"><a href="https://shlomi-noach.github.io/blog/about">about</a></li>
<li id="menu-item-8071" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8071"><a href="https://github.com/shlomi-noach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li>
<li id="menu-item-8074" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8074"><a href="https://www.linkedin.com/in/shlominoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li>
<li id="menu-item-8072" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8072"><a href="https://twitter.com/ShlomiNoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"></path></svg></a></li>
<li id="menu-item-8073" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8073"><a href="https://shlomi-noach.github.io/blog/feed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-12.832 20c-1.197 0-2.168-.969-2.168-2.165s.971-2.165 2.168-2.165 2.167.969 2.167 2.165-.97 2.165-2.167 2.165zm5.18 0c-.041-4.029-3.314-7.298-7.348-7.339v-3.207c5.814.041 10.518 4.739 10.561 10.546h-3.213zm5.441 0c-.021-7.063-5.736-12.761-12.789-12.792v-3.208c8.83.031 15.98 7.179 16 16h-3.211z"></path></svg></a></li>
</ul></div>			</nav>
		</div>
	</header>

	<main id="primary" class="site-main">

		
			<header class="page-header">
				<h1 class="page-title">Tag: Replication</h1>			</header>

			
<article id="post-7299" class="post-7299 post type-post status-publish format-standard hentry category-mysql tag-orchestrator tag-pseudo-gtid tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid-ascending" rel="bookmark">Pseudo GTID, ASCENDING</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid-ascending" rel="bookmark"><time class="entry-date published updated" datetime="2015-07-29T12:59:50+02:00">July 29, 2015</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Pseudo GTID is a technique where we inject Globally Unique entries into MySQL, gaining GTID abilities without using GTID. It is supported by <strong><a href="https://github.com/outbrain/orchestrator">orchestrator</a></strong> and described in more detail <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">here</a>, <a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid">here</a> and <a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual#pseudo-gtid">here</a>.</p>
<p>Quick recap: we can join two slaves to replicate from one another even if they never were in parent-child relationship, based on our uniquely identifiable entries which can be found in the slaves’ binary logs or relay logs. Having Pseudo-GTID injected and controlled by us allows us to optimize failovers into quick operations, especially where a large number of server is involved.</p>
<p><strong>Ascending Pseudo-GTID</strong> further speeds up this process for delayed/lagging slaves.</p>
<h3>Recap, visualized</h3>
<p>(but do look at the <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">presentation</a>):</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2015/07/pseudo-gtid-quick1.png"><img class="alignnone size-full wp-image-7303" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2015/07/pseudo-gtid-quick1.png" alt="pseudo-gtid-quick" width="636" height="366" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2015/07/pseudo-gtid-quick1.png 636w,https://shlomi-noach.github.io/blog/wp-content/uploads/2015/07/pseudo-gtid-quick1-300x173.png 300w" sizes="(max-width: 636px) 100vw, 636px"></a></p>
<ol>
<li>Find last pseudo GTID in slave’s binary log (or last applied one in relay log)</li>
<li>Search for exact match on new master’s binary logs</li>
<li>Fast forward both through successive identical statements until end of slave’s applied entries is reached</li>
<li>Point slave into cursor position on master</li>
</ol>
</blockquote>
<p>What happens if the slave we wish to reconnect is lagging? Or perhaps it is a delayed replica, set to run <strong>24</strong> hours behind its master?</p>
<p>The naive approach would expand bullet <strong>#2</strong> into:</p>
<ul>
<li>Search for exact match on master’s last binary logs</li>
<li>Unfound? Move on to previous (older) binary log on master</li>
<li>Repeat</li>
</ul>
<p>The last Pseudo-GTID executed by the slave was issued by the master over <strong>24</strong> hours ago. Suppose the master generates one binary log per hour. This means we would need to full-scan <strong>24</strong> binary logs of the master where the entry will not be found; to only be matched in the <strong>25th</strong> binary log (it’s an off-by-one problem, don’t hold the exact number against me).</p>
<h3>Ascending Pseudo GTID</h3>
<p>Since we control the generation of Pseudo-GTID, and since we control the search for Pseudo-GTID, we are free to choose the form of Pseudo-GTID entries. We recently switched into using Ascending Pseudo-GTID entries, and this works like a charm. Consider these Pseudo-GTID entries: <a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid-ascending#more-7299" class="more-link">Continue reading »<span class="screen-reader-text"> “Pseudo GTID, ASCENDING”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid-ascending#comments">1 Comment<span class="screen-reader-text"> on Pseudo GTID, ASCENDING</span></a></span>	</footer>
</article>

<article id="post-7274" class="post-7274 post type-post status-publish format-standard hentry category-mysql tag-failover tag-orchestrator tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/what-makes-a-mysql-server-failurerecovery-case" rel="bookmark">What makes a MySQL server failure/recovery case?</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/failover" rel="tag">Failover</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/what-makes-a-mysql-server-failurerecovery-case" rel="bookmark"><time class="entry-date published updated" datetime="2015-07-25T09:00:03+02:00">July 25, 2015</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Or: How do you reach the conclusion your MySQL master/intermediate-master is dead and must be recovered?</p>
<p>This is an attempt at making a holistic diagnosis of our replication topologies. The aim is to cover obvious and not-so-obvious crash scenarios, and to be able to act accordingly and heal the topology.</p>
<p>At <strong>Booking.com</strong> we are dealing with very large amounts of MySQL servers. We have many topologies, and many servers in each topology. <a href="https://speakerdeck.com/shlominoach/pseudo-gtid-and-easy-mysql-replication-topology-management">See past numbers</a> to get a feel for it. At these numbers failures happen frequently. Typically we would see normal slaves failing, but occasionally — and far more frequently than we would like to be paged for — an intermediate master or a master would crash. But our current (and ever in transition) setup also include SANs, DNS records, VIPs, any of which can fail and bring down our topologies.</p>
<p>Tackling issues of monitoring, disaster analysis and recovery processes, I feel safe to claim the following statements:</p>
<ul>
<li>The fact your monitoring tool cannot access your database does not mean your database has failed.</li>
<li>The fact your monitoring tool can access your database does not mean your database is available.</li>
<li>The fact your database master is unwell does not mean you should fail over.</li>
<li>The fact your database master is alive and well does not mean you should not fail over.</li>
</ul>
<p>Bummer. Let’s review a simplified topology with a few failure scenarios. Some of these scenarios you will find familiar. Some others may be caused by setups you’re not using. I would love to say <em>I’ve seen it all</em> but the more I see the more I know how strange things can become. <a href="https://shlomi-noach.github.io/blog/mysql/what-makes-a-mysql-server-failurerecovery-case#more-7274" class="more-link">Continue reading »<span class="screen-reader-text"> “What makes a MySQL server failure/recovery case?”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/what-makes-a-mysql-server-failurerecovery-case#comments">1 Comment<span class="screen-reader-text"> on What makes a MySQL server failure/recovery case?</span></a></span>	</footer>
</article>

<article id="post-7241" class="post-7241 post type-post status-publish format-standard hentry category-mysql tag-orchestrator tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-visual-cheatsheet" rel="bookmark">Orchestrator visual cheatsheet</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-visual-cheatsheet" rel="bookmark"><time class="entry-date published" datetime="2015-06-05T14:19:34+02:00">June 5, 2015</time><time class="updated" datetime="2015-06-05T14:21:08+02:00">June 5, 2015</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p><strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong> is growing. Supporting automatic detection of topologies, simple refactoring of topology trees, complex refactoring via Pseudo-GTID, failure detection and automated discovery, it is becoming larger and larger by the day.</p>
<p>One of the problems with growign projects is hwo to properly document them. Orchestrator enjoys <a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">a comprehensive manual</a>, but as these get more and more detailed, it is becoming difficult to get oriented and pointed in the right direction. I’ve done my best to advise the simple use cases throughout the manual.</p>
<p>One thing that is difficult to put into words is topologies. Explaining “failover of an intermediate master S1 that has S2,…,Sn slaves onto a sibling of S1 provided that…” is too verbose. So here’s a quick visual cheatsheet for (current) topology refactoring commands. Refactoring commands are a mere subset of overall orchestrator commands, but they’re great to play with and perfect for visualization.</p>
<p>The “move” and related commands use normal replication commands (STOP SLAVE; CHANGE MASTER TO; START SLAVE UNTIL;”…).</p>
<p>The “match” and related commands utilize Pseudo-GTID and use more elaborate MySQL commands (SHOW BINLOG EVENTS, SHOW RELAYLOG EVENTS).</p>
<p>So without further ado, here’s what each command does (and do run “orchestrator” from the command line to get a man-like explanation of everything, or just <a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual#executing-via-command-line">go to the manual</a>). <a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-visual-cheatsheet#more-7241" class="more-link">Continue reading »<span class="screen-reader-text"> “Orchestrator visual cheatsheet”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-visual-cheatsheet#respond">Leave a Comment<span class="screen-reader-text"> on Orchestrator visual cheatsheet</span></a></span>	</footer>
</article>

<article id="post-7205" class="post-7205 post type-post status-publish format-standard hentry category-mysql tag-open-source tag-orchestrator tag-perconalive tag-pseudo-gtid tag-replication tag-secondary">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/speaking-at-percona-live-pseudo-gtid-and-easy-replication-topology-management" rel="bookmark">Speaking at Percona Live: Pseudo GTID and Easy Replication Topology Management</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/perconalive" rel="tag">PerconaLive</a><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a><a href="https://shlomi-noach.github.io/blog/tag/secondary" rel="tag">secondary</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/speaking-at-percona-live-pseudo-gtid-and-easy-replication-topology-management" rel="bookmark"><time class="entry-date published" datetime="2015-03-31T17:42:21+02:00">March 31, 2015</time><time class="updated" datetime="2015-04-30T13:17:04+02:00">April 30, 2015</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>In two weeks time I will be presenting <a href="https://www.percona.com/live/mysql-conference-2015/sessions/pseudo-gtid-and-easy-replication-management">Pseudo GTID and Easy Replication Topology Management</a> at Percona Live. From the time I submitted the proposal a LOT has been developed, experimented, deployed and used with both <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a> and with <a href="https://github.com/outbrain/orchestrator">orchestrator</a>. In my talk I will:</p>
<ul>
<li>Suggest that you skip the “to GTID or not to GTID” question and go for the lightweight Pseudo GTID</li>
<li>Show how Pseudo GTID is used in production to recover from various replication failures and server crashes</li>
<li>Do an outrageous demonstration</li>
<li>Tell you about 50,000 successful experiments and tests done in production</li>
<li>Show off orchestrator and its support for Pseudo GTID, including automated crash analysis and recovery mechanism.</li>
</ul>
<p>I will further show how the orchestrator tooling makes for a less restrictive, more performant, less locking, non-intrusive, trusted and lightweight replication topology management solution. <a href="https://shlomi-noach.github.io/blog/mysql/speaking-at-percona-live-pseudo-gtid-and-easy-replication-topology-management#more-7205" class="more-link">Continue reading »<span class="screen-reader-text"> “Speaking at Percona Live: Pseudo GTID and Easy Replication Topology Management”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/speaking-at-percona-live-pseudo-gtid-and-easy-replication-topology-management#comments">1 Comment<span class="screen-reader-text"> on Speaking at Percona Live: Pseudo GTID and Easy Replication Topology Management</span></a></span>	</footer>
</article>

<article id="post-7194" class="post-7194 post type-post status-publish format-standard hentry category-mysql tag-pseudo-gtid tag-replication tag-speaking">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/speaking-at-fosdem-pseudo-gtid-and-easy-replication-management" rel="bookmark">Speaking at FOSDEM: Pseudo GTID and easy replication management</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a><a href="https://shlomi-noach.github.io/blog/tag/speaking" rel="tag">Speaking</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/speaking-at-fosdem-pseudo-gtid-and-easy-replication-management" rel="bookmark"><time class="entry-date published" datetime="2015-01-29T21:06:10+02:00">January 29, 2015</time><time class="updated" datetime="2015-02-01T12:57:34+02:00">February 1, 2015</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>This coming Sunday I’ll be presenting <a href="https://fosdem.org/2015/schedule/event/pseudo_gtid/">Pseudo GTID and easy replication management</a> at FOSDEM, Brussels.</p>
<p>There’s been a lot of development on <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a> these last few weeks. In this talk I’ll show you how you can use Pseudo GTID instead of “normal” GTID to easily repoint your slaves, recover from intermediate master failure, promote slaves to masters as well as emply crash safe replication without crash safe replication.</p>
<p>Moreover, I will show how you can achieve all the above with <em>less constraints</em> than GTID, and for bulk operations — with <em>less overhead</em> and in <em>shorter time</em>. You will also see that Pseudo GTID is a non intrusive solution which does not require you to change anything in your topologies.</p>
<p>Moral: I’ll try and convince you to <em>drop your plans for using GTID</em> in favor of <em>Pseudo GTID</em>.</p>
<p>We will be employing Pseudo GTID as the basis for high availability and failover at Booking.com on many topologies, and as a safety mechanism in other topologies where we will employ <a href="http://blog.booking.com/mysql_slave_scaling_and_more.html">Binlog servers</a>.</p>
<p><iframe title="Pseudo gtid & easy replication topology management" src="https://www.slideshare.net/slideshow/embed_code/key/xnbYxVn86UhAZp" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> </p>
<div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/shlominoach/pseudo-gtid-easy-replication-topology-management-fosdem" title="Pseudo gtid & easy replication topology management" target="_blank">Pseudo gtid & easy replication topology management</a> </strong> from <strong><a href="https://www.slideshare.net/shlominoach" target="_blank">Shlomi Noach</a></strong> </div>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/speaking-at-fosdem-pseudo-gtid-and-easy-replication-management#respond">Leave a Comment<span class="screen-reader-text"> on Speaking at FOSDEM: Pseudo GTID and easy replication management</span></a></span>	</footer>
</article>

<article id="post-7180" class="post-7180 post type-post status-publish format-standard hentry category-mysql tag-analysis tag-percona-toolkit tag-python tag-replication tag-scripts">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/reading-rbr-binary-logs-with-pt-query-digest" rel="bookmark">Reading RBR binary logs with pt-query-digest</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/analysis" rel="tag">Analysis</a><a href="https://shlomi-noach.github.io/blog/tag/percona-toolkit" rel="tag">Percona Toolkit</a><a href="https://shlomi-noach.github.io/blog/tag/python" rel="tag">python</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a><a href="https://shlomi-noach.github.io/blog/tag/scripts" rel="tag">scripts</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/reading-rbr-binary-logs-with-pt-query-digest" rel="bookmark"><time class="entry-date published" datetime="2015-01-26T17:50:46+02:00">January 26, 2015</time><time class="updated" datetime="2016-03-04T13:43:18+02:00">March 4, 2016</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>For purposes of auditing anything that goes on our servers we’re looking to parse the binary logs of all servers (masters), as with “<a href="https://shlomi-noach.github.io/blog/mysql/anemomaster-dml-visibility-your-must-do-for-tomorrow">Anemomaster</a>“. With Row Based Replication this is problematic since <strong>pt-query-digest</strong> <a href="https://bugs.launchpad.net/percona-toolkit/+bug/1377887">does not support parsing RBR binary logs</a> (true for <strong>2.2.12</strong>, latest at this time).</p>
<p>I’ve written a simple script that translates RBR logs to SBR-like logs, with a little bit of cheating. My interest is that <strong>pt-query-digest</strong> is able to capture and count the queries, nothing else. By doing some minimal text manipulation on the binary log I’m able to now feed it to <strong>pt-query-digest</strong> which seems to be happy.</p>
<p>The script of course does not parse the binary log directly; furthermore, it requires the binary log to be extracted via:</p>
<blockquote>
<pre class="brush: bash; title: ; notranslate" title="">mysqlbinlog --verbose --base64-output=DECODE-ROWS your-mysql-binlog-filemame.000001</pre>
</blockquote>
<p>The above adds the interpretation of the RBR entires in the form of (unconventional) statements, commented, and strips out the cryptic RBR text. All that is left is to do a little manipulation on entry headers and uncomment the interpreted queries.</p>
<p>The script can be found in <a href="https://gist.github.com/shlomi-noach/cc243fd690403e7617e3">my gist repositories</a>. Current version is as follows: <a href="https://shlomi-noach.github.io/blog/mysql/reading-rbr-binary-logs-with-pt-query-digest#more-7180" class="more-link">Continue reading »<span class="screen-reader-text"> “Reading RBR binary logs with pt-query-digest”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/reading-rbr-binary-logs-with-pt-query-digest#comments">2 Comments<span class="screen-reader-text"> on Reading RBR binary logs with pt-query-digest</span></a></span>	</footer>
</article>

<article id="post-7177" class="post-7177 post type-post status-publish format-standard hentry category-mysql tag-open-source tag-orchestrator tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-9-ga-released" rel="bookmark">Orchestrator 1.2.9 GA released</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-9-ga-released" rel="bookmark"><time class="entry-date published updated" datetime="2014-12-18T18:24:59+02:00">December 18, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p><a href="https://github.com/outbrain/orchestrator">Orchestrator</a> <strong>1.2.9 GA</strong> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.2.9">has been released</a>. Noteworthy:</p>
<ul>
<li>Added “<strong>ReadOnly</strong>” (true/false) configuration param. You can have orchestrator completely read-only</li>
<li>Added <strong>“AuthenticationMethod”: “multi”</strong>: works like BasicAuth (your normal HTTP user+password) only it also accepts the special user called <strong>“readonly”</strong>, which, surprise, can only view and not modify</li>
<li>Centralized/serialized most backend database writes (with hundreds/thousands monitored servers it was possible or probable that high concurrency led to too-many-connections openned on the backend database).</li>
<li>Fixed evil evil bug that would skip some checks if binary logs were not enabled</li>
<li>Better hostname resolve (now also asking MySQL server to resolve hostname; resolving is cached)</li>
<li><strong>Pseudo-GTID</strong> (read <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">here</a>, <a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure">here</a>, <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour">here</a>) support now considered stable (apart from being tested it has already been put to practice multiple times in production at <strong>Outbrain</strong>, in different planned and unplanned crash scenarios)</li>
</ul>
<p>I continue developing <em>orchestrator</em> as free and open source at my new employer, <a href="http://www.booking.com">Booking.com</a>.</p>
<p> </p>
<p> </p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-9-ga-released#comments">4 Comments<span class="screen-reader-text"> on Orchestrator 1.2.9 GA released</span></a></span>	</footer>
</article>

<article id="post-7119" class="post-7119 post type-post status-publish format-standard hentry category-mysql tag-orchestrator tag-pseudo-gtid tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/semi-automatic-slavemaster-promotion-via-pseudo-gtid" rel="bookmark">Semi-automatic slave/master promotion via Pseudo GTID</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/semi-automatic-slavemaster-promotion-via-pseudo-gtid" rel="bookmark"><time class="entry-date published updated" datetime="2014-11-10T07:56:58+02:00">November 10, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p><a href="https://github.com/outbrain/orchestrator">Orchestrator</a> release <a href="https://github.com/outbrain/orchestrator/releases">1.2.7-beta</a> now supports semi-automatic slave promotion to master upon master death, via <a href="code.openark.org/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a>.</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-make-master-highlighted.png"><img class="alignnone size-full wp-image-7150" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-make-master-highlighted.png" alt="orchestrator-make-master-highlighted" width="809" height="363" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-make-master-highlighted.png 809w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-make-master-highlighted-300x134.png 300w" sizes="(max-width: 809px) 100vw, 809px"></a></p></blockquote>
<p>When the master is dead, <em>orchestrator</em> automatically picks the most up-to-date slaves and marks them as <strong>“Master candidates”</strong>. It allows a <strong>/api/make-master</strong> call on such a slave (S), in which case it uses <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a> to enslave its siblings, and set S as <strong>read-only = 0</strong>. All we need to do is click the <strong>“Make master”</strong> button. <a href="https://shlomi-noach.github.io/blog/mysql/semi-automatic-slavemaster-promotion-via-pseudo-gtid#more-7119" class="more-link">Continue reading »<span class="screen-reader-text"> “Semi-automatic slave/master promotion via Pseudo GTID”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/semi-automatic-slavemaster-promotion-via-pseudo-gtid#comments">2 Comments<span class="screen-reader-text"> on Semi-automatic slave/master promotion via Pseudo GTID</span></a></span>	</footer>
</article>

<article id="post-7088" class="post-7088 post type-post status-publish format-standard hentry category-mysql tag-orchestrator tag-pseudo-gtid tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour" rel="bookmark">Refactoring replication topologies with Pseudo GTID: a visual tour</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour" rel="bookmark"><time class="entry-date published" datetime="2014-10-27T11:55:39+02:00">October 27, 2014</time><time class="updated" datetime="2014-10-27T16:33:38+02:00">October 27, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p><em>Orchestrator</em> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.2.1-beta">1.2.1-beta</a> supports Pseudo GTID (<a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure">read announcement</a>): a means to refactor the replication topology and connect slaves even without direct relationship; even across failed servers. This post illustrates two such scenarios and shows the visual way of mathcing/re-synching slaves.</p>
<p>Of course, orchestrator is not just a GUI tool; anything done with drag-and-drop is also done via web API (in fact, the drag-and-drop invoke the web API) as well as via command line. I’m mentioning this as this is the grounds for failover automation planned for the future.</p>
<h4>Scenario 1: the master unexpectedly dies</h4>
<p>The master crashes and cannot be contacted. All slaves are stopped as effect, but each in a different position. Some managed to salvage relay logs just before the master dies, some didn’t. In our scenario, all three slaves are at least caught up with the relay log (that is, whatever they managed to pull through the network, they already managed to execute). So they’re otherwise sitting idle waiting for something to happen. Well, something’s about to happen.</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master.png"><img class="alignnone size-large wp-image-7090" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-1024x323.png" alt="orchestrator-pseudo-gtid-dead-master" width="1024" height="323" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-1024x323.png 1024w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-300x94.png 300w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-900x284.png 900w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master.png 1132w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p></blockquote>
<p>Note the green “Safe mode” button to the right. This means operation is through calculation of binary log files & positions with relation to one’s master. But the master is now dead, so let’s switch to adventurous mode; in this mode we can drag and drop slaves onto instances normally forbidden. At this stage the web interface allows us to drop a slave onto its sibling or any of its ancestors (including its very own parent, which is a means of reconnecting a slave with its parent). Anyhow:</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode.png"><img class="alignnone size-large wp-image-7091" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode-1024x296.png" alt="orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode" width="1024" height="296" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode-1024x296.png 1024w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode-300x86.png 300w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode-900x260.png 900w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode.png 1188w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p></blockquote>
<p>We notice that orchestrator is already kind enough to say which slave is best candidate to be the new master (<strong>127.0.0.1:22990</strong>): this is the slave (or one of the slaves) with most up-to-date data. So we choose to take another server and make it a slave of <strong>127.0.0.1:22990</strong>: <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour#more-7088" class="more-link">Continue reading »<span class="screen-reader-text"> “Refactoring replication topologies with Pseudo GTID: a visual tour”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour#respond">Leave a Comment<span class="screen-reader-text"> on Refactoring replication topologies with Pseudo GTID: a visual tour</span></a></span>	</footer>
</article>

<article id="post-7114" class="post-7114 post type-post status-publish format-standard hentry category-mysql tag-open-source tag-orchestrator tag-pseudo-gtid tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure" rel="bookmark">Orchestrator 1.2.1 BETA: Pseudo GTID support, reconnect slaves even after master failure</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure" rel="bookmark"><time class="entry-date published updated" datetime="2014-10-27T11:51:51+02:00">October 27, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p><em>orchestrator</em> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.2.1-beta">1.2.1 BETA is released</a>. This version supports <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a>, and provides one with powerful refactoring of one’s replication topologies, even across failed instances.</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag.png"><img class="alignnone size-large wp-image-7101" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag-1024x292.png" alt="orchestrator-pseudo-gtid-dead-relay-master-begin-drag" width="1024" height="292" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag-1024x292.png 1024w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag-300x85.png 300w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag-900x256.png 900w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag.png 1097w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p>
<p>Depicted: moving a slave up the topology even though its local master is inaccessible</p></blockquote>
<h4>Enabling Pseudo-GTID</h4>
<p>You will need to:</p>
<ol>
<li>Inject a periodic unique entry onto your binary logs</li>
<li>Configure <em>orchestrator</em> to recognize said entry.</li>
</ol>
<h4>Pseudo GTID injection example</h4>
<p>We will use the <a href="http://dev.mysql.com/doc/refman/5.5/en/events.html">event scheduler</a> (must be enabled) to inject an entry every <strong>10</strong> seconds, recognized both in statement-based and row-based replication.</p>
<blockquote>
<pre>create database if not exists meta;

drop event if exists meta.create_pseudo_gtid_view_event;

delimiter ;;
create event if not exists
  meta.create_pseudo_gtid_view_event
  on schedule every 10 second starts current_timestamp
  on completion preserve
  enable
  do
    begin
      set @pseudo_gtid := uuid();
      set @_create_statement := concat('create or replace view meta.pseudo_gtid_view as select \'', @pseudo_gtid, '\' as pseudo_gtid_unique_val from dual');
      PREPARE st FROM @_create_statement;
      EXECUTE st;
      DEALLOCATE PREPARE st;
    end
;;

delimiter ;

set global event_scheduler := 1;</pre>
</blockquote>
<p>Make sure to enable <em>event_scheduler</em> in your <strong>my.cnf</strong> config file.</p>
<p>An entry in the binary logs would look like this: <a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure#more-7114" class="more-link">Continue reading »<span class="screen-reader-text"> “Orchestrator 1.2.1 BETA: Pseudo GTID support, reconnect slaves even after master failure”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure#comments">1 Comment<span class="screen-reader-text"> on Orchestrator 1.2.1 BETA: Pseudo GTID support, reconnect slaves even after master failure</span></a></span>	</footer>
</article>

	<nav class="navigation posts-navigation" role="navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://shlomi-noach.github.io/blog/tag/replication/page/4">Older posts</a></div><div class="nav-next"><a href="https://shlomi-noach.github.io/blog/tag/replication/page/2">Newer posts</a></div></div>
	</nav>
	</main>


	<footer id="colophon" class="site-footer">
		<div class="site-info">
			<a href="https://wordpress.org/">
				Powered by WordPress			</a>
			<span class="sep"> | </span>
				Theme: <a href="http://openark.org">openark-primer</a> by <a href="http://underscores.me/">Underscores.me</a>.		</div>
	</footer>
</div>

	<div style="display:none">
	</div>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushBash.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://shlomi-noach.github.io/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.head.appendChild( corecss );
		var themecssurl = "https://shlomi-noach.github.io/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeEclipse.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		document.head.appendChild( themecss );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = true;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}
</script>
<script>
var pollsL10n = {"ajax_url":"https:\/\/shlomi-noach.github.io\/blog\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-js.js"></script>
<script src="https://secure.gravatar.com/js/gprofiles.js?ver=2020Junaa"></script>
<script>
var WPGroHo = {"my_hash":""};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/modules/wpgroho.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/navigation.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/skip-link-focus-fix.js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202024.js" async="async" defer></script>
<script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:8.2.1',blog:'32412571',post:'0',tz:'2',srv:'code.openark.org'} ]);
	_stq.push([ 'clickTrackerInit', '32412571', '0' ]);
</script>

</body>
</html>
