<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	

	<title>TokuDB – code.openark.org</title>
<link rel="dns-prefetch" href="//secure.gravatar.com">
<link rel="dns-prefetch" href="//s.w.org">



<link rel="stylesheet" id="wp-block-library-css" href="https://shlomi-noach.github.io/blog/wp-includes/css/dist/block-library/style.min.css" media="all">
<style id="wp-block-library-inline-css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="wp-polls-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-css.css" media="all">
<style id="wp-polls-inline-css">
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel="stylesheet" id="openark-primer-style-css" href="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/style.css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/css/jetpack.css" media="all">
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery-migrate.min.js"></script>



<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<link rel="dns-prefetch" href="//v0.wordpress.com">


<meta property="og:type" content="website">
<meta property="og:title" content="TokuDB – code.openark.org">
<meta property="og:url" content="https://shlomi-noach.github.io/blog/tag/tokudb">
<meta property="og:site_name" content="code.openark.org">
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg">
<meta property="og:locale" content="en_US">


<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(242,101,34,.88);}</style></head>

<body class="archive tag tag-tokudb tag-102 hfeed no-sidebar">
<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#primary">Skip to content</a>

	<header id="masthead" class="site-header">
		<div class="site-branding">
							<p class="site-title"><a href="https://shlomi-noach.github.io/blog/" rel="home">code.openark.org</a></p>
								<p class="site-description">Blog by Shlomi Noach</p>
			
			<nav id="site-navigation" class="main-navigation">
				<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">primary-menu</button>
				<div class="menu-primary-menu-container"><ul id="menu-primary-menu" class="menu"><li id="menu-item-8109" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8109"><a href="https://shlomi-noach.github.io/blog/archives">archives</a></li>
<li id="menu-item-8050" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8050"><a href="https://shlomi-noach.github.io/blog/presentations">presentations</a></li>
<li id="menu-item-8055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8055"><a href="https://shlomi-noach.github.io/blog/about">about</a></li>
<li id="menu-item-8071" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8071"><a href="https://github.com/shlomi-noach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li>
<li id="menu-item-8074" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8074"><a href="https://www.linkedin.com/in/shlominoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li>
<li id="menu-item-8072" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8072"><a href="https://twitter.com/ShlomiNoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"></path></svg></a></li>
<li id="menu-item-8073" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8073"><a href="https://shlomi-noach.github.io/blog/feed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-12.832 20c-1.197 0-2.168-.969-2.168-2.165s.971-2.165 2.168-2.165 2.167.969 2.167 2.165-.97 2.165-2.167 2.165zm5.18 0c-.041-4.029-3.314-7.298-7.348-7.339v-3.207c5.814.041 10.518 4.739 10.561 10.546h-3.213zm5.441 0c-.021-7.063-5.736-12.761-12.789-12.792v-3.208c8.83.031 15.98 7.179 16 16h-3.211z"></path></svg></a></li>
</ul></div>			</nav>
		</div>
	</header>

	<main id="primary" class="site-main">

		
			<header class="page-header">
				<h1 class="page-title">Tag: TokuDB</h1>			</header>

			
<article id="post-7223" class="post-7223 post type-post status-publish format-standard hentry category-mysql tag-opinions tag-perconalive tag-secondary tag-tokudb">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/percona-live-2015-reflections" rel="bookmark">Percona Live 2015: Reflections</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/opinions" rel="tag">Opinions</a><a href="https://shlomi-noach.github.io/blog/tag/perconalive" rel="tag">PerconaLive</a><a href="https://shlomi-noach.github.io/blog/tag/secondary" rel="tag">secondary</a><a href="https://shlomi-noach.github.io/blog/tag/tokudb" rel="tag">TokuDB</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/percona-live-2015-reflections" rel="bookmark"><time class="entry-date published updated" datetime="2015-04-18T03:41:07+02:00">April 18, 2015</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Some personal reflections on <a href="https://www.percona.com/live/mysql-conference-2015/">PerconaLive 2015</a>:</p>
<p><strong>Percona acquires Tokutek</strong></p>
<p>Well done! Tokutek develops the TokuDB storage engine for MySQL and TokuMX engine for MongoDB. I will discuss the MySQL aspect only.</p>
<p>TokuDB was released as open source in 2013. It has attained a lot of traction and I have used it myself for some time. I met issues with locking or otherwise operational difficulties which I reported, and otherwise was fascinated by such features as great compression, online schema changes, and more.</p>
<p>Recently another company, InfiniDB, that also released its MySQL-backed codebase as open source, went out of business. I was afraid the same might happen to Tokutek.</p>
<p>I see Percona’s purchase as a very good move for the community. I saw a lot of TokuDB interest in Percona for some time now, and it is clearly interested in the technology. I expect they will add their own hands-on experience into the development of more operations-friendly features; put effort in solving locking issues (it’s been a while since I last checked, of course some of these may have been addressed by now). I am guessing they will work on a Galera/TokuDB integration and offer a “Toku-XtraDB-Cluster”.</p>
<p>TokuDB can compete with InnoDB in many places, while in others each will have its distinct advantage.</p>
<p>I see this is as good news for the community.</p>
<p><strong>Community Awards and Lightning Talks</strong></p>
<p>On a completely different subject, I believe it is commonly accepted that this year’s setup for the community awards & lightning talks was unsuccessful. The noise was astounding, human traffic was interrupting and overall this was a poor experience. We (Giuseppe Maxia, Kortney Runyan & myself) made a quick, informal brainstorming on this and came up with a couple ideas. One of which we hope to try in the upcoming <em>Percona Live Europe – Amsterdam</em>.</p>
<p>We apologize to the speakers for the difficulties.</p>
<p><strong>Percona Live Europe – Amsterdam</strong></p>
<p>Haha! Having recently relocated to the Netherlands I’m of course very happy. But regardless, Percona Live London was fun – and yet running on low fuel. I think it was a great idea to change location (and more locations expected in the future). This is the path taken by such conferences as OSCon, Velocity, Strata and more. Amsterdam in particular, as I’ve recently learned, is especially appreciated by many. I think this conf will do great!</p>
<p><strong>Woz</strong></p>
<p>And now for something completely different. Woz’ talk was that. I’m happy he came; I appreciate that he discussed education; and it was fun.</p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/percona-live-2015-reflections#respond">Leave a Comment<span class="screen-reader-text"> on Percona Live 2015: Reflections</span></a></span>	</footer>
</article>

<article id="post-6613" class="post-6613 post type-post status-publish format-standard hentry category-mysql tag-configuration tag-innodb tag-performance tag-tokudb">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/tokudb-configuration-variables-of-interest" rel="bookmark">TokuDB configuration variables of interest</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/configuration" rel="tag">Configuration</a><a href="https://shlomi-noach.github.io/blog/tag/innodb" rel="tag">InnoDB</a><a href="https://shlomi-noach.github.io/blog/tag/performance" rel="tag">Performance</a><a href="https://shlomi-noach.github.io/blog/tag/tokudb" rel="tag">TokuDB</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/tokudb-configuration-variables-of-interest" rel="bookmark"><time class="entry-date published" datetime="2013-10-23T19:42:12+02:00">October 23, 2013</time><time class="updated" datetime="2013-10-24T07:27:22+02:00">October 24, 2013</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>During our experiments I came upon a few TokuDB variables of interest; if you are using TokuDB you might want to look into these:</p>
<ul>
<li>
<h4>tokudb_analyze_time</h4>
</li>
</ul>
<p style="padding-left: 30px;">This is a boundary on the number of seconds an <strong>ANALYZE TABLE</strong> will operate on each index on each partition on a TokuDB table.</p>
<p style="padding-left: 30px;">That is, if <strong>tokudb_analyze_time = 5</strong>, and your table has <strong>4</strong> indexes (including <strong>PRIMARY</strong>) and <strong>7</strong> partitions, then the total runtime is limited to <strong>5*4*7 = 140</strong> seconds.</p>
<p style="padding-left: 30px;">Default in <strong>7.1.0</strong>: <strong>5</strong> seconds</p>
<ul>
<li>
<h4>tokudb_cache_size</h4>
</li>
</ul>
<p style="padding-left: 30px;">Similar to <strong>innodb_buffer_pool_size</strong>, this variable sets the amount of memory allocated by TokuDB for caching pages. Like InnoDB the table is clustered within the index, so the cache includes pages for both indexes and data.</p>
<p style="padding-left: 30px;">Default: <strong>50%</strong> of total memory</p>
<ul>
<li>
<h4>tokudb_directio</h4>
</li>
</ul>
<p style="padding-left: 30px;">Boolean, values are <strong>0/1</strong>. Setting <strong>tokudb_directio = 1</strong> is like specifying <strong>innodb_flush_method = O_DIRECT</strong>. Which in turn means the OS should not cache pages requested by TokuDB. Default: <strong>0</strong>.</p>
<p style="padding-left: 30px;">Now here’s the interesting part: we are used to tell InnoDB to get the most memory we can provide (because we want it to cache as much as it can) and to avoid OS caching (because that would mean a page would appear both in the buffer pool and in OS memory, which is a waste). So the following setup is common: <a href="https://shlomi-noach.github.io/blog/mysql/tokudb-configuration-variables-of-interest#more-6613" class="more-link">Continue reading »<span class="screen-reader-text"> “TokuDB configuration variables of interest”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/tokudb-configuration-variables-of-interest#comments">14 Comments<span class="screen-reader-text"> on TokuDB configuration variables of interest</span></a></span>	</footer>
</article>

<article id="post-6603" class="post-6603 post type-post status-publish format-standard hentry category-mysql tag-common_schema tag-innodb tag-tokudb">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-3-operational-stuff" rel="bookmark">Converting an OLAP database to TokuDB, part 3: operational stuff</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/common_schema" rel="tag">common_schema</a><a href="https://shlomi-noach.github.io/blog/tag/innodb" rel="tag">InnoDB</a><a href="https://shlomi-noach.github.io/blog/tag/tokudb" rel="tag">TokuDB</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-3-operational-stuff" rel="bookmark"><time class="entry-date published updated" datetime="2013-10-14T12:03:43+02:00">October 14, 2013</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>This is the third post in a series of posts describing our experience in migrating a large DWH server to TokuDB (see <a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-1">1st</a> and <a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-2-the-process-of-migration">2nd</a> parts). This post discusses operations; namely ALTER TABLE operations in TokuDB. We ran into quite a few use cases by this time that we can shed light on.</p>
<p>Quick recap: we’ve altered one of out DWH slaves to TokuDB, with the goal of migrating most of out servers, including the master, to TokuDB.</p>
<h4>Adding an index</h4>
<p>Shortly after migrating our server to TokuDB we noticed an unreasonably disproportionate slave lag on our TokuDB slave (red line in chart below) as compared to other slaves.</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2013/09/tokudb-slave-lag.png"><img alt="tokudb-slave-lag" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2013/09/tokudb-slave-lag.png" width="700" height="329"></a></p></blockquote>
<p>Quick investigation led to the fact that, coincidentally, a manual heavy-duty operation was just taking place, which updated some year’s worth of data retroactively. OK, but why so slow on TokuDB? Another quick investigation led to an apples vs. oranges problem: as depicted in <a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-1">part 1</a>, our original setup included MONTHly partitioning on our larger tables, whereas we could not do the same in TokuDB, where we settled for YEARly partitioning.</p>
<p>The heavy-duty operation included a query that was relying on the MONTHly partitioning to do reasonable pruning: a <strong>WHERE</strong> condition on a date column did the right partition pruning; but where on InnoDB that would filter <strong>1</strong> month’s worth of data, on TokuDB it would filter <strong>1</strong> <em>year</em>.</p>
<p>Wasn’t it suggested that TokuDB has online table operations? I decided to give it a shot, and add a proper index on our date column (I actually created a compound index, but irrelevant).</p>
<p>It took <strong>13</strong> minutes to add an index on a <strong>1GB</strong> TokuDB table (approx. <strong>20GB</strong> InnoDB uncompressed equivalent):</p>
<ul>
<li>The <strong>ALTER</strong> was non blocking: table was unlocked at that duration</li>
<li>The client issuing the <strong>ALTER</strong> <em>was</em> blocked (I thought it would happen completely in the background) — but who cares?</li>
<li>I would say <strong>13</strong> minutes is fast</li>
</ul>
<p>Not surprisingly adding the index eliminated the problem altogether.</p>
<h4>Modifying a PRIMARY KEY</h4>
<p>It was suggested by our DBA that there was a long time standing need to modify our <strong>PRIMARY KEY</strong>. It was impossible to achieve with our InnoDB setup (not enough disk space for the operation, would take weeks to complete if we did have the disk space). Would it be possible to modify our TokuDB tables? On some of our medium-sized tables we issued an <strong>ALTER</strong> of the form: <a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-3-operational-stuff#more-6603" class="more-link">Continue reading »<span class="screen-reader-text"> “Converting an OLAP database to TokuDB, part 3: operational stuff”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-3-operational-stuff#comments">7 Comments<span class="screen-reader-text"> on Converting an OLAP database to TokuDB, part 3: operational stuff</span></a></span>	</footer>
</article>

<article id="post-6530" class="post-6530 post type-post status-publish format-standard hentry category-mysql tag-common_schema tag-percona-toolkit tag-tokudb">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-2-the-process-of-migration" rel="bookmark">Converting an OLAP database to TokuDB, part 2: the process of migration</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/common_schema" rel="tag">common_schema</a><a href="https://shlomi-noach.github.io/blog/tag/percona-toolkit" rel="tag">Percona Toolkit</a><a href="https://shlomi-noach.github.io/blog/tag/tokudb" rel="tag">TokuDB</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-2-the-process-of-migration" rel="bookmark"><time class="entry-date published" datetime="2013-09-09T05:29:30+02:00">September 9, 2013</time><time class="updated" datetime="2016-12-10T11:26:50+02:00">December 10, 2016</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>This is a second in a series of posts describing our experience in migrating a large DWH server to TokuDB. This post discusses the process of migration itself.</p>
<p>As a quick recap (<a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-1">read part 1 here</a>), we have a <strong>2TB</strong> compressed InnoDB (<strong>4TB</strong> uncompressed) based DWH server. Space is running low, and we’re looking at TokuDB for answers. Early experiments show that TokuDB’s compression could make a good impact on disk space usage. I’m still not discussing performance — keeping this till later post.</p>
<p>Those with weak hearts can skip right to the end, where we finally have a complete conversion. You can also peek at the very end to find out how much <strong>4TB</strong> uncompressed InnoDB data is worth in TokuDB. But you might want to read through. The process was not smooth, and not as expected (it’s a war story thing). Throughout the migration we got a lot of insight on TokuDB’s behaviour, limitations, conveniences, inconveniences and more.</p>
<p>Disclosure: I have no personal interests and no company interests; throughout the process we were in touch with Tokutek engineers, getting free, friendly & professional advice and providing with input of our own. Most of this content has already been presented to Tokutek throughout the process. TokuDB is open source and free to use, though commercial license is also available.</p>
<h4>How do you convert 4TB worth of data to TokuDB?</h4>
<p>Obviously one table at a time. But we had another restriction: you may recall I took a live slave for the migration process. And we wanted to end the process with a live slave. So the restriction was: keep it replicating!</p>
<p>How easy would that be? Based on our initial tests, I extrapolated over <strong>20</strong> days of conversion from InnoDB to TokuDB. Even with one table at a time, our largest table was expected to convert in some <strong>12-14</strong> days. Can we retain <strong>14</strong> days of binary logs on a server already running low on disk space? If only I knew then what I know today 🙂 <a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-2-the-process-of-migration#more-6530" class="more-link">Continue reading »<span class="screen-reader-text"> “Converting an OLAP database to TokuDB, part 2: the process of migration”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-2-the-process-of-migration#comments">7 Comments<span class="screen-reader-text"> on Converting an OLAP database to TokuDB, part 2: the process of migration</span></a></span>	</footer>
</article>

<article id="post-6473" class="post-6473 post type-post status-publish format-standard hentry category-mysql tag-common_schema tag-compression tag-innodb tag-open-source tag-performance tag-queryscript tag-tokudb">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-1" rel="bookmark">Converting an OLAP database to TokuDB, part 1</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/common_schema" rel="tag">common_schema</a><a href="https://shlomi-noach.github.io/blog/tag/compression" rel="tag">compression</a><a href="https://shlomi-noach.github.io/blog/tag/innodb" rel="tag">InnoDB</a><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/performance" rel="tag">Performance</a><a href="https://shlomi-noach.github.io/blog/tag/queryscript" rel="tag">QueryScript</a><a href="https://shlomi-noach.github.io/blog/tag/tokudb" rel="tag">TokuDB</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-1" rel="bookmark"><time class="entry-date published" datetime="2013-09-03T09:04:12+02:00">September 3, 2013</time><time class="updated" datetime="2013-09-03T20:34:35+02:00">September 3, 2013</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>This is the first in a series of posts describing my impressions of converting a large OLAP server to TokuDB. There’s a lot to tell, and the experiment is not yet complete, so this is an ongoing blogging. In this post I will describe the case at hand and out initial reasons for looking at TokuDB.</p>
<p>Disclosure: I have no personal interests and no company interests; we did get friendly, useful and free advice from Tokutek engineers. TokuDB is open source and free to use, though commercial license is also available.</p>
<h4>The case at hand</h4>
<p>We have a large and fast growing DWH MySQL setup. This data warehouse is but one component in a larger data setup, which includes Hadoop, Cassandra and more. For online dashboards and most reports, MySQL is our service. We populate this warehouse mainly via Hive/Hadoop. Thus, we have an hourly load of data from Hive, as well as a larger daily load.</p>
<p>There are some updates on the data, but the majority of writes are just <strong>mysqlimport</strong>s of Hive queries.</p>
<p>Usage of this database is OLAP: no concurrency issues here; we have some should-be-fast-running queries issued by our dashboards, as well as ok-to-run-longer queries issued for reports.</p>
<p>Our initial and most burning trouble is with size. Today we use <strong>COMPRESSED</strong> InnoDB tables (<strong>KEY_BLOCK_SIZE</strong> is default, i.e. <strong>8</strong>). Our data volume sums right now at about <strong>2TB</strong>. I happen to know this translates as <strong>4TB</strong> of uncompressed data.</p>
<p>However growth of data is accelerating. A year ago we would capture a dozen GB per month. Today it is a <strong>100GB</strong> per month, and by the end of this year it may climb to <strong>150GB</strong> per month or more.</p>
<p>Our data is not sharded. We have a simple replication topology of some <strong>6</strong> servers. Machines are quite generous as detailed following. And yet, we will be running out of resources shortly: disk space (total <strong>2.7TB</strong>) is now running low and is expected to run out in about six months. One of my first tasks in Outbrain is to find a solution to our DWH growth problem. The solution could be sharding; it could be a commercial DWH product; anything that works. <a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-1#more-6473" class="more-link">Continue reading »<span class="screen-reader-text"> “Converting an OLAP database to TokuDB, part 1”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/converting-an-olap-database-to-tokudb-part-1#comments">8 Comments<span class="screen-reader-text"> on Converting an OLAP database to TokuDB, part 1</span></a></span>	</footer>
</article>

<article id="post-6368" class="post-6368 post type-post status-publish format-standard hentry category-mysql tag-innodb tag-tokudb">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/converting-compressed-innodb-tables-to-tokudb-7-0-1" rel="bookmark">Converting compressed InnoDB tables to TokuDB 7.0.1</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/innodb" rel="tag">InnoDB</a><a href="https://shlomi-noach.github.io/blog/tag/tokudb" rel="tag">TokuDB</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/converting-compressed-innodb-tables-to-tokudb-7-0-1" rel="bookmark"><time class="entry-date published updated" datetime="2013-06-05T09:10:12+02:00">June 5, 2013</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Or: how to make it work in TokuDB version <strong>7.0.1</strong>. This is a follow up on a <a href="https://groups.google.com/forum/?fromgroups=#!topic/tokudb-user/hLlHwlp2AL0">discussion on the tokudb-user group</a>.</p>
<h4>Background</h4>
<p>I wanted to test TokuDB’s compression. I took a staging machine of mine, with production data, and migrated it from <strong>Percona Server 5.5</strong> To <strong>MariaDB 5.5+TokuDB 7.0.1</strong>. Migration went well, no problems.</p>
<p>To my surprise, when I converted tables from InnoDB to TokuDB, I saw an <em>increase</em> in table file size on disk. As explained by Tim Callaghan, this was due to TokuDB interpreting my compressed table’s <strong>“KEY_BLOCK_SIZE=4”</strong> as an instruction for TokuDB’s page size. TokuDB should be using <strong>4MB</strong> block size, but thinks it’s being instructed to use <strong>4KB</strong>. Problem is, you <a href="http://bugs.mysql.com/bug.php?id=67727">can’t get rid of table options</a>. When one converts a table to InnoDB in <strong>ROW_FORMAT=COMPACT</strong>, or even to MyISAM, the <strong>KEY_BLOCK_SIZE</strong> option keeps lurking in the dark.</p>
<p>So until this is hopefully resolved in TokuDB’s next version, here’s a way to go around the problem. <a href="https://shlomi-noach.github.io/blog/mysql/converting-compressed-innodb-tables-to-tokudb-7-0-1#more-6368" class="more-link">Continue reading »<span class="screen-reader-text"> “Converting compressed InnoDB tables to TokuDB 7.0.1”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/converting-compressed-innodb-tables-to-tokudb-7-0-1#comments">4 Comments<span class="screen-reader-text"> on Converting compressed InnoDB tables to TokuDB 7.0.1</span></a></span>	</footer>
</article>

<article id="post-6320" class="post-6320 post type-post status-publish format-standard hentry category-mysql tag-tokudb">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/on-compiling-tokudb-from-source" rel="bookmark">On compiling TokuDB from source</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/tokudb" rel="tag">TokuDB</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/on-compiling-tokudb-from-source" rel="bookmark"><time class="entry-date published" datetime="2013-05-02T07:14:55+02:00">May 2, 2013</time><time class="updated" datetime="2013-05-02T10:53:37+02:00">May 2, 2013</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Sharing my experience of compiling TokuDB + MariaDB <strong>5.5</strong>. Why? Because I must have <a href="https://shlomi-noach.github.io/blog/mysql/sphinx-sphinx_snippets-mysql-5-5">this patch</a> to Sphinx <strong>2.0.4</strong>.</p>
<p><strong>Note</strong>: I was using what seems to be the “old” method of compiling; quoting Leif Walsh:</p>
<blockquote><p>… We are looking at deprecating that method of building (MariaDB source plus binary fractal tree handlerton).  It only really needed to be that complex when we were closed source.</p></blockquote>
<p>I also tried the “new” method of compiling, which I couldn’t work out.</p>
<p>Here’s how it goes: TokuDB is newly <a href="http://www.tokutek.com/2013/04/announcing-tokudb-v7-open-source-and-more/">released as open source</a>. As such, it got a lot of attention, many downloads and I hope it will succeed.</p>
<p>However as stable as the product may be, it’s new to open source, which means anyone compiling it from source is an early adopter (at least for the compilation process).</p>
<h4>Installation process</h4>
<p>This is an unorthodox, and actually weird process. See <a href="http://www.tokutek.com/wp-content/uploads/2013/04/mariadb-5.5.30-tokudb-7.0.1-users-guide.pdf">section 6 on the Tokutek docs</a>. In order to compile the project you must download:</p>
<ul>
<li>The source code tar.gz</li>
<li><em>And</em> the binary (?!) tar.gz</li>
<li>And the binary checksum</li>
<li>And the Tokutek patches</li>
<li>And the patches checksum <a href="https://shlomi-noach.github.io/blog/mysql/on-compiling-tokudb-from-source#more-6320" class="more-link">Continue reading »<span class="screen-reader-text"> “On compiling TokuDB from source”</span></a></li>
</ul>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/on-compiling-tokudb-from-source#comments">14 Comments<span class="screen-reader-text"> on On compiling TokuDB from source</span></a></span>	</footer>
</article>

	</main>


	<footer id="colophon" class="site-footer">
		<div class="site-info">
			<a href="https://wordpress.org/">
				Powered by WordPress			</a>
			<span class="sep"> | </span>
				Theme: <a href="http://openark.org">openark-primer</a> by <a href="http://underscores.me/">Underscores.me</a>.		</div>
	</footer>
</div>

	<div style="display:none">
	</div>
<script>
var pollsL10n = {"ajax_url":"https:\/\/shlomi-noach.github.io\/blog\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-js.js"></script>
<script src="https://secure.gravatar.com/js/gprofiles.js?ver=2020Junaa"></script>
<script>
var WPGroHo = {"my_hash":""};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/modules/wpgroho.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/navigation.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/skip-link-focus-fix.js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202024.js" async="async" defer></script>
<script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:8.2.1',blog:'32412571',post:'0',tz:'2',srv:'code.openark.org'} ]);
	_stq.push([ 'clickTrackerInit', '32412571', '0' ]);
</script>

</body>
</html>
