<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	
	xmlns:georss="http://www.georss.org/georss"
	xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
	>

<channel>
	<title>gh-ost &#8211; code.openark.org</title>
	<atom:link href="https://shlomi-noach.github.io/blog/tag/gh-ost/feed" rel="self" type="application/rss+xml" />
	<link>http://shlomi-noach.github.io/blog/</link>
	<description>Blog by Shlomi Noach</description>
	<lastBuildDate>Mon, 11 May 2020 06:28:06 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.3.3</generator>
<site xmlns="com-wordpress:feed-additions:1">32412571</site>	<item>
		<title>Using dbdeployer in CI tests</title>
		<link>https://shlomi-noach.github.io/blog/mysql/using-dbdeployer-in-ci-tests</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/using-dbdeployer-in-ci-tests#respond</comments>
				<pubDate>Tue, 20 Feb 2018 07:29:58 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[dbdeployer]]></category>
		<category><![CDATA[gh-ost]]></category>
		<category><![CDATA[Open Source]]></category>
		<category><![CDATA[Replication]]></category>
		<category><![CDATA[testing]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=7848</guid>
				<description><![CDATA[I was very pleased when Giuseppe Maxia (aka datacharmer) unveiled dbdeployer in his talk at pre-FOSDEM MySQL day. The announcement came just at the right time. I wish to briefly describe how we use dbdeployer (work in progress). The case for gh-ost A user opened an issue on gh-ost, and the user was using MySQL [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>I was very pleased when Giuseppe Maxia (aka <a href="http://datacharmer.blogspot.co.il/">datacharmer</a>) unveiled <a href="https://github.com/datacharmer/dbdeployer">dbdeployer</a> in his talk at <a href="http://lefred.be/content/pre-fosdem-mysql-day-2018-the-schedule/">pre-FOSDEM MySQL day</a>. The announcement came just at the right time. I wish to briefly describe how we use <code>dbdeployer</code> (work in progress).</p>
<h3>The case for gh-ost</h3>
<p>A user opened <a href="https://github.com/github/gh-ost/issues/538">an issue</a> on <a href="https://github.com/github/gh-ost"><code>gh-ost</code></a>, and the user was using MySQL <code>5.5</code>. <code>gh-ost</code> is being tested on <code>5.7</code> where the problem does not reproduce. A discussion with Gillian Gunson raised the concern of not testing on all versions. Can we run <code>gh-ost</code> tests for all MySQL/Percona/MariaDB versions? Should we? How easy would it be?</p>
<h3>gh-ost tests</h3>
<p><code>gh-ost</code> has three different test types:</p>
<ul>
<li>Unit tests: these are plain <code>golang</code> logic tests which are very easy and quick to run.</li>
<li>Integration tests: the topic of this post, see following. Today these do not run as part of an automated CI testing.</li>
<li>System tests: putting our production tables to the test, continuously migrating our production data on dedicated replicas, verifying checksums are identical and data is intact, <a href="https://githubengineering.com/mysql-testing-automation-at-github/#schema-migrations">read more</a>.</li>
</ul>
<p>Unit tests are already running as part of automated CI (every PR is subjected to those tests). Systems tests are clearly tied to our production servers. What&#8217;s the deal with the integration tests?<span id="more-7848"></span></p>
<h3>gh-ost integration tests</h3>
<p>The <code>gh-ost</code> <a href="https://github.com/github/gh-ost/tree/master/localtests">integration tests </a>are a suite of scenarios which verify <code>gh-ost</code>&#8216;s operation is sound. These scenarios are mostly concerned with data types, special <code>alter</code> statements etc. Is converting <code>DATETIME</code> to <code>TIMESTAMP</code> working properly? Are <code>latin1</code> columns being updated correctly? How about renaming a column? Changing a <code>PRIMARY KEY</code>? Column reorder? <code>5.7</code> JSON values? And so on. Each test will recreate the table, run migration, stop replication, check the result, resume replication&#8230;</p>
<p>The environment for these tests is a master-replica setup, where <code>gh-ost</code> modifies on the table on the replica and can then checksum or compare both the original and the altered <em>ghost</em> table.</p>
<p>We develop <code>gh-ost</code> internally at GitHub, but it&#8217;s also an open source project. We have our own internal CI environment, but then we also wish the public to have visibility into test failures (so that a user can submit a PR and get a reliable automated feedback). We use <a href="https://travis-ci.org/">Travis CI</a> for the public facing tests.</p>
<p>To run <code>gh-ost</code>&#8216;s integration tests as described above as part of our CI tests we should be able to:</p>
<ul>
<li>Create a master/replica setup in CI.</li>
<li>Actually, create a master/replica setup in <em>any</em> CI, and namely in Travis CI.</li>
<li>Actually, create multiple master/replica setups, of varying versions and vendors, in any ci, including both our internal CI and Travis CI.</li>
</ul>
<p>I was about to embark on a MySQL Sandbox setup, which I was not keen on. But FOSDEM was around the corner and I had other things to complete beforehand. Lucky me, <code>dbdeplyer</code> stepped in.</p>
<h3>dbdeployer</h3>
<p><code>dbdeployer</code> is a rewrite, a replacement to <a href="https://mysqlsandbox.net/">MySQL Sandbox</a>. I&#8217;ve been using MySQL Sandbox for many years, and my laptop is running two sandboxes at this very moment. But MySQL Sandbox has a few limitations or complications:</p>
<ul>
<li>Perl. Versions of Perl. Dependencies of packages of Perl. I mean, it&#8217;s fine, we can automate that.</li>
<li>Command line flag complexity: I always get lost in the complexity of the flags.</li>
<li>Get it right or prepare for battle: if you deployed something, but not the way you wanted, there&#8217;s sometimes limbo situations where you cannot re-deploy the same sandbox again, or you should start deleting files everywhere.</li>
<li>Deploy, not remove. Adding a sandbox is one thing. How about removing it?</li>
</ul>
<p><code>dbdeployer</code> is a <code>golang</code> rewrite, which solves the dependency problem. It ships as a single binary and nothing more is needed. It is simple to use. While it generates the equivalence of a that of a MySQL Sandbox, it does so with less command line flags and less confusion. There&#8217;s first class handling of the MySQL binaries: you unpack MySQL tarballs, you can list what&#8217;s available. You can then create sandbox environments: replication, standalone, etc. You can then delete those.</p>
<p>It&#8217;s pretty simple and I have not much more to add &#8212; which is the best thing about it.</p>
<p>So, with <code>dbdeployer</code> it is easy to create a master/replica. Something like:</p>
<blockquote>
<pre>dbdeployer unpack path/to/5.7.21.tar.gz --unpack-version=5.7.21 --sandbox-binary <span class="pl-smi">${PWD}</span>/sandbox/binary
dbdeployer replication 5.7.21 --nodes 2 --sandbox-binary <span class="pl-smi">${PWD}</span>/sandbox/binary --sandbox-home <span class="pl-smi">${PWD}</span>/sandboxes --gtid --my-cnf-options log_slave_updates --my-cnf-options log_bin --my-cnf-options binlog_format=ROW</pre>
</blockquote>
<h3>Where does it all fit in, and what about the MySQL binaries though?</h3>
<p>So, should <code>dbdeployer</code> be part of the <code>gh-ost</code> repo? And where does one get those MySQL binaries from? Are they to be part of the <code>gh-ost</code> repo? Aren&#8217;t they a few GB to extract?</p>
<p>Neither <code>dbdeployer</code> nor MySQL binaries should be added to the <code>gh-ost</code> repo. And fortunately, Giuseppe also <a href="https://github.com/datacharmer/mysql-docker-minimal">solved</a> the MySQL binaries problem.</p>
<p>The scheme I&#8217;m looking at right now is as follows:</p>
<ul>
<li>A new public repo, <a href="https://github.com/github/gh-ost-ci-env">gh-ost-ci-env</a> is created. This repo includes:
<ul>
<li><code>dbdeployer</code> compiled binaries</li>
<li>Minimal MySQL tarballs for selected versions. Those tarballs are reasonably small: between `14MB` and `44MB` at this time.</li>
</ul>
</li>
<li><code>gh-ost</code>&#8216;s CI to <code>git cloneÂ https://github.com/github/gh-ost-ci-env.git</code> (<a href="https://github.com/github/gh-ost/pull/546/files#diff-d78e7acd07ce8a2aad92026ae10cbec2R7">code</a>)</li>
<li><code>gh-ost</code>&#8216;s CI to setup a master/replica sandbox (<a href="https://github.com/github/gh-ost/pull/546/files#diff-d78e7acd07ce8a2aad92026ae10cbec2R13">one</a>, <a href="https://github.com/github/gh-ost/pull/546/files#diff-d78e7acd07ce8a2aad92026ae10cbec2R15">two</a>).</li>
<li><a href="https://github.com/github/gh-ost/pull/546/files#diff-d78e7acd07ce8a2aad92026ae10cbec2R30">Kick the tests</a>.</li>
</ul>
<p>The above is a work in progress:</p>
<ul>
<li>At this time only runs a single MySQL version.</li>
<li>There is a known issue where after a test, replication may take time to resume. Currently on slower boxes (such as the Travis CI containers) this leads to failures.</li>
</ul>
<p>Another concern I have at this time is build time. For a single MySQL version, it takes some <code>5-7</code> minutes on my local laptop to run all integration tests. It will be faster on our internal CI. It will be considerably <em>slower</em> on Travis CI, I can expect between <code>10m - 15m</code>. Add multiple versions and we&#8217;re looking at a <code>1hr</code> build. Such long build times will affect our development and delivery times, and so we will split them off the main build. I need to consider what the best approach is.</p>
<p>That&#8217;s all for now. I&#8217;m pretty excited for the potential of <code>dbdeployer</code> and will be looking into incorporating the same for <code>orchestrator</code> CI tests.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/using-dbdeployer-in-ci-tests/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">7848</post-id>	</item>
		<item>
		<title>gh-ost 1.0.42 released: JSON support, optimizations</title>
		<link>https://shlomi-noach.github.io/blog/mysql/gh-ost-1-0-42-released-json-support-optimizations</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/gh-ost-1-0-42-released-json-support-optimizations#comments</comments>
				<pubDate>Thu, 14 Sep 2017 07:26:16 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[gh-ost]]></category>
		<category><![CDATA[Open Source]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=7799</guid>
				<description><![CDATA[gh-ost 1.0.42 is released and available for download. JSON MySQL 5.7&#8217;s JSON data type is now supported. There is a soft-limitation, that your JSON may not be part of your PRIMARY KEY. Currently this isn&#8217;t even supported by MySQL anyhow. Performance Two noteworthy changes are: Client side prepared statements reduce network traffic and round trips [&#8230;]]]></description>
								<content:encoded><![CDATA[<p><strong>gh-ost</strong> 1.0.42 is <a href="https://github.com/github/gh-ost/releases/tag/v1.0.42">released and available for download</a>.</p>
<h3>JSON</h3>
<p>MySQL 5.7&#8217;s <code>JSON</code> data type is now supported.</p>
<p>There is a soft-limitation, that your <code>JSON</code> may not be part of your <code>PRIMARY KEY</code>. Currently this isn&#8217;t even supported by MySQL anyhow.</p>
<h3>Performance</h3>
<p>Two noteworthy changes are:</p>
<ul>
<li>Client side prepared statements reduce network traffic and round trips to the server.</li>
<li>Range query iteration avoids creating temporary tables and filesorting.</li>
</ul>
<p>We&#8217;re not running benchmarks at this time to observe performance gains.</p>
<h3>5.7</h3>
<p>More tests validating <code>5.7</code> compatibility (at this time GitHub runs MySQL <code>5.7</code> in production).</p>
<h3>Ongoing</h3>
<p>Many other changes included.</p>
<p>We are grateful for all community feedback in form of open Issues, Pull Requests and questions!</p>
<p><code>gh-ost</code> is authored by <a href="http://github.com/">GitHub</a>. It is free and open source and is available under the MIT license.</p>
<h3>Speaking</h3>
<p>In two weeks time, <a href="https://github.com/jonahberquist">Jonah Berquist</a> will present <a href="https://www.percona.com/live/e17/sessions/gh-ost-triggerless-painless-trusted-online-schema-migrations">gh-ost: Triggerless, Painless, Trusted Online Schema Migrations</a> at Percona Live, Dublin.</p>
<p><a href="https://github.com/tomkrouper">Tom Krouper</a> and myself will present <a href="https://www.percona.com/live/e17/sessions/mysql-infrastructure-testing-automation-at-github">MySQL Infrastructure Testing Automation at GitHub</a>, where, among other things, we describe how we test <code>gh-ost</code> in production.</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/gh-ost-1-0-42-released-json-support-optimizations/feed</wfw:commentRss>
		<slash:comments>4</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">7799</post-id>	</item>
		<item>
		<title>Speaking at August Penguin, MySQL Track, GitHub sponsored</title>
		<link>https://shlomi-noach.github.io/blog/mysql/speaking-at-august-penguin-mysql-track-github-sponsored</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/speaking-at-august-penguin-mysql-track-github-sponsored#respond</comments>
				<pubDate>Sun, 03 Sep 2017 10:42:05 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[gh-ost]]></category>
		<category><![CDATA[GitHub]]></category>
		<category><![CDATA[Open Source]]></category>
		<category><![CDATA[orchestrator]]></category>
		<category><![CDATA[Speaking]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=7772</guid>
				<description><![CDATA[This Thursday I&#8217;ll be presenting at August Penguin, conveniently taking place September 7th, 8th, Ramat Gan, Israel. I will be speaking as part of the MySQL track, 2nd half of Thursday. The (Hebrew) schedule is here. My talk is titled Reliable failovers, safe schema migrations: open source solutions to MySQL problems. I will describe some [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>This Thursday I&#8217;ll be presenting at <a href="http://ap.hamakor.org.il/2017/en/">August Penguin</a>, conveniently taking place <em>September</em> 7th, 8th, Ramat Gan, Israel.</p>
<p>I will be speaking as part of the MySQL track, 2nd half of Thursday. The (Hebrew) schedule is <a href="http://ap.hamakor.org.il/2017/index.html#schedule">here</a>.</p>
<p>My talk is titled <strong>Reliable failovers, safe schema migrations: open source solutions to MySQL problems</strong>. I will describe some of the open source MySQL infrastructure work we run at GitHub ; how it solves reliability, availability and usability. I&#8217;ll describe some of our internal workflows and our use of chat and chatops.</p>
<p>I&#8217;m proud to announce <strong><a href="http://github.com/">GitHub</a></strong> sponsors the event. We won&#8217;t have a booth, but please do grab me in the hallways or over lunch to chat!</p>
<p>And, yes, octocat stickers will be made available <img src="https://s.w.org/images/core/emoji/12.0.0-1/72x72/1f642.png" alt="ðŸ™‚" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<p>&nbsp;</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/speaking-at-august-penguin-mysql-track-github-sponsored/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">7772</post-id>	</item>
		<item>
		<title>Discussing online schema migrations with Oracle&#8217;s MySQL engineering managers</title>
		<link>https://shlomi-noach.github.io/blog/mysql/discussing-online-schema-migrations-with-oracles-mysql-engineering-managers</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/discussing-online-schema-migrations-with-oracles-mysql-engineering-managers#comments</comments>
				<pubDate>Wed, 23 Nov 2016 13:23:18 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[community]]></category>
		<category><![CDATA[gh-ost]]></category>
		<category><![CDATA[operations]]></category>
		<category><![CDATA[Replication]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=7646</guid>
				<description><![CDATA[Last week I had the pleasant opportunity of introducing and discussing the operation of online schema migrations to MySQL&#8217;s engineering managers, as part of their annual meeting, in London. Together with Simon J. Mudd of Booking.com, we discussed our perception of what it takes to run online schema migrations on a live, busy system. While [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>Last week I had the pleasant opportunity of introducing and discussing the operation of online schema migrations to MySQL&#8217;s engineering managers, as part of their annual meeting, in London.</p>
<p>Together with Simon J. Mudd of Booking.com, we discussed our perception of what it takes to run online schema migrations on a live, busy system.</p>
<p>While theÂ Oracle/MySQL engineers develop new features or optimize behavior in the MySQL, we of the industry have the operational expertise and understanding of theÂ flow of working with MySQL. In all topics, and in schema migration in particular, there is a gap between what&#8217;s perceived to be the use case and what the use case actually is. It is the community&#8217;s task to provide feedback back to Oracle so as to align development toÂ match operations need where possible.</p>
<p>Our meetingÂ included the following:</p>
<h3>Need for schema migrations</h3>
<p>We presented, based on our experience in current and past companies, and based on our friends of the community&#8217;s experience, the case for online schema migrations. At GitHub, at Booking.com and in many other companies I&#8217;m familiar with, we continuously deploy to production, and this implies continuous schema migrations to our production databases. We have migrations running daily; sometimes multiple per day, some time none.<span id="more-7646"></span></p>
<p>With continuous deployment, we as Guardians of the Database do not wish to be blockers for the development cycle. On the contrary, we want to be out of the way as soon as possible, other than verifying a requested migration is safe. We wish to be able to deliver a migration at any given time.</p>
<p>Not all companies behave this way; some run a weekly aggregation of migrations. Others yet still use the Though Shall Not Pass DBA model. We tried to depict the various approaches with strong emphasis on our own approach, which is the most demanding of schema migration solutions.</p>
<h3>The MySQL ALTER</h3>
<p>We proceeded to discuss the in-houseÂ ALTER statement &amp; InnoDB online DDL, and pointed out the limitations those impose on &#8220;online&#8221; operations to the effect of rendering these solutions unused by many. The serialization in replication stream means losing serving capacity, gettingÂ lagging replicas. The lack of escape path means a commitment into an hours worth of uninterruptible operation. The lack of resource control implies getting performance degraded throughout the operation.</p>
<p>We briefly touched on the TokuDB&#8217;s ALTER and how it worked.</p>
<h3>Replication solutions</h3>
<p>We discussed migrating via replication: running migrations on one or more replicas at a time, finally failing over onto a promotedÂ replica once all replicas are updated.</p>
<p>We know this solution to be in use in companies such as DropBox, Etsy and others. We illustrated our own reasoning for not using this solution:</p>
<ul>
<li>Increased clock-time for running a migration: running a one-replica-at-a-time or few-replicas-at-a-time can double, triple, quadruple and so forth the overall migration time.</li>
<li>Concurrent migration complexity: and since runtime increases, so does the likelihood of needing to run additional migration at the same time, which highly complicates the flow in aÂ one-at-a-time or few-at-a-time model.</li>
<li>Serving capacity: in this model some, or up to half the number of servers, are non operational. Serving capacity is reduced and we need to have more hardware to support that</li>
<li>Failover: the failover is not smooth; it either includes some outage or some block time, and at any case noticeable in production. Having a planned failover once in a while is OK, but having a failover multiple times a day is too much of a hustle, in our current setup.</li>
<li>Topology complexity: how our topologies always have some special cases, such as cross-DC replication with reduced cross-DC network traffic via intermediate masters, testing replicas with newer versions, developer-dedicated servers and others, that make shuffling of replicas around difficult to automate.</li>
</ul>
<p>We have not discussed Galera&#8217;s Rolling Schema Upgrades as we personally do not have the experience of working with it. It solves the failover issue above, but given a &#8220;normal&#8221; replication tree under the cluster, same problems as above apply.</p>
<p>We concluded with our personal take, that like everything else, we just like to write stuff directly onto our masters, and let the natural replication flow deal with it and get our entire topology to be consistent.</p>
<h3>Existing trigger based migrations</h3>
<p>We drilled down into the algorithms behindÂ <strong>pt-online-schema-change</strong> and Facebook&#8217;sÂ <strong>OSC</strong> (the latter being rewritten today, not yet released as open source). We elaborated on the pains we saw in trigger based migrations: being unsuspendible, causing lock spaghetti, impacting write latency on the master to the point of a standstill on busy servers, being untestable.</p>
<h3>gh-ost</h3>
<p>I presented Â <a href="https://github.com/github/gh-ost"><strong>gh-ost</strong></a>, our own, triggerless take on schema migrations. I discussed the logic behindÂ <strong>gh-ost</strong> and how it decouples migration load from production load; the low impact the triggerless migration has on the master and on the entire replication chain, leading toÂ low, subsecond replication lags throughout the migration and eliminating locking contention on the master. Basically the <a href="https://speakerdeck.com/shlominoach/githubs-online-schema-migrations-for-mysql">presentation</a>Â Tom Krouper and I gave at Percona Live Amsterdam.</p>
<h3>Want to Have</h3>
<p>We followed up by a list of feature requests we could enjoy. These were largely technical issues <strong>gh-ost</strong> would benefit from, simplifying its behavior or ensuring its correctness in complex cases. We discussed dropping tables at end of migration, getting more info in the binary logs, GTID issues and more.</p>
<h3>Acknowledgements</h3>
<p>Thank you to Morgan Tocker for officially inviting us to this gathering. There were quite a few familiar faces in the room, and it was a friendly gathering. Thank you to all the engineering managers with whom we met!</p>
<p>The discussion was lively, friendly and receptive. The Oracle engineers laid outÂ the internals of the online DDL; some of their thoughts on the potential of the JSON format; gave advice on technical issues presented. I&#8217;d like to thank them for listening to our take on the subject. There was a discussion on the possible paths Oracle can take to improveÂ online schema operations, and I&#8217;d like to thank Oracle for sharing their own thoughts and advice!</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/discussing-online-schema-migrations-with-oracles-mysql-engineering-managers/feed</wfw:commentRss>
		<slash:comments>1</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">7646</post-id>	</item>
		<item>
		<title>Three wishes for a new year</title>
		<link>https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year-4</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year-4#comments</comments>
				<pubDate>Wed, 28 Sep 2016 14:20:54 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[gh-ost]]></category>
		<category><![CDATA[GTID]]></category>
		<category><![CDATA[operations]]></category>
		<category><![CDATA[Opinions]]></category>
		<category><![CDATA[Replication]]></category>
		<category><![CDATA[SQL]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=7643</guid>
				<description><![CDATA[(Almost) another new year by Jewish calendar. What do I wish for the following year? World peace Good health to all Relaxed GTID constraints I&#8217;m still not using GTID, and still see operational issues with working with GTID. As a latest example, our new schema migration solution, gh-ost, allows us to test migrations in production, [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>(Almost) another new year by Jewish calendar. What do I wish for the following year?</p>
<ol>
<li>World peace</li>
<li>Good health to all</li>
<li>Relaxed GTID constraints</li>
</ol>
<p>I&#8217;m still not using GTID, and still see operational issues with working with GTID. As a latest example, our new schema migration solution, gh-ost, allows us to test migrations in production, on replicas. The GTID catch? <code>gh-ost</code>Â has to write something to the binary log. Thus, it &#8220;corrupts&#8221; the replica with a bogus GTID entry that will never be met in another server, thus making said replica unsafe to promote. We can work around this, but&#8230;</p>
<p>I understand the idea and need for the <code>Executed GTID Set</code>. It willÂ certainly come in handy with multi-writer InnoDB Cluster. However for most use cases GTID poses a burden. The reason is that our topologies are imperfect, and we as humans are imperfect, and operations are most certainly imperfect. We may wish to operate on a replica: test something, by intention or mistake. We may wish to use a subchain as the seed for a new cluster split. We may wish to be able to write to downstream replicas. We may use a 3rd party tool that issues a <code>flush tables with read lock</code>Â without disabling <code>sql_log_bin</code>. Things just happen.</p>
<p>For that, I would like to suggest GTID control levels, such as:</p>
<ol>
<li><em>Strict</em>: same as Oracle&#8217;s existingÂ implementation. Executed sets, purged sets, whatnot.</li>
<li><em>Last executed</em>: a mode where the only thing that counts is the last executed GTID value. If I repoint replica,Â all it needs to check is &#8220;hey this is my last executed GTID entry, give me the coordinates of yours. And, no, I don&#8217;t care about comparing executed and purged sets, I will trust you and keep running from that point on&#8221;</li>
<li><em>Declarative</em>: GTIDs are generated, are visible in each and every binary log entry, but are completely ignored.</li>
</ol>
<p>I realize Oracle MySQL GTID is out for some over 3 years now, but I&#8217;m sorry &#8211; I still have reservations and seeÂ use cases where I fear it will not serve me right.</p>
<p>How about my previous years wishes? World peace and good health never came through, however:</p>
<ul>
<li>My <a href="https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year-2015">2015 wish</a> for &#8220;decent, operations friendly built in online table refactoring&#8221; was unmet, however <code>gh-ost</code>Â is a thing now and exceeds my expectations. No, really. Please come see <a href="https://www.percona.com/live/plam16/sessions/introducing-gh-ost-triggerless-painless-trusted-online-schema-migrations">Tom &amp; myself present gh-ost</a> and how it changed our migration paradigm.</li>
<li>My <a href="https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year-201">2012 wish</a> for &#8220;decent, long waited for, implementation of <a href="http://en.wikipedia.org/wiki/Window_function_%28SQL%29#Window_function">Window Functions</a> (aka Analytic Functions) for MySQL&#8221; was met byÂ MariaDB&#8217;s <a href="https://mariadb.com/kb/en/mariadb/window-functions/">window functions</a>.<br />
Not strictly Window Functions, but Oracle MySQL 8.0 will <a href="http://mysqlserverteam.com/mysql-8-0-labs-recursive-common-table-expressions-in-mysql-ctes/">support CTE</a> (hierarchial/recursive), worth a mention.</li>
</ul>
<p>See you in Amsterdam!</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year-4/feed</wfw:commentRss>
		<slash:comments>2</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">7643</post-id>	</item>
		<item>
		<title>gh-ost 1.0.17: Hooks, Sub-second lag control, Amazon RDS and more</title>
		<link>https://shlomi-noach.github.io/blog/mysql/gh-ost-1-0-17-hooks-sub-second-lag-control-amazon-rds-and-more</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/gh-ost-1-0-17-hooks-sub-second-lag-control-amazon-rds-and-more#respond</comments>
				<pubDate>Tue, 06 Sep 2016 09:44:14 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[gh-ost]]></category>
		<category><![CDATA[New Features]]></category>
		<category><![CDATA[Open Source]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=7632</guid>
				<description><![CDATA[gh-ost version 1.0.17 is now released, with various additions and fixes. Here are some notes of interest: Hooks gh-ost now supports hooks. These are your own executables that gh-ost will invoke at particular points of interest (validation pass, about to cut-over, success, failure, status, etc.) gh-ost will set various environment variables for your executables to [&#8230;]]]></description>
								<content:encoded><![CDATA[<p><a href="https://github.com/github/gh-ost">gh-ost</a> version <a href="https://github.com/github/gh-ost/releases/tag/v1.0.17">1.0.17</a> is now released, with various additions and fixes. Here are some notes of interest:</p>
<h3>Hooks</h3>
<p><code>gh-ost</code> now supports <a href="https://github.com/github/gh-ost/blob/master/doc/hooks.md">hooks</a>. These are your own executables that <code>gh-ost</code> will invoke at particular points of interest (validation pass, about to cut-over, success, failure, status, etc.)</p>
<p><code>gh-ost</code> will set various environment variables for your executables to pick up, passing along such information as migrated/<em>ghost</em> table name, elapsed time, processed rows, migrated host etc.</p>
<h3>Sub-second lag control</h3>
<p>At GitHub we&#8217;re very strict about replication lag. We keep it well under <code>1</code> second at most times. <code>gh-ost</code> can now identify <a href="https://github.com/github/gh-ost/blob/master/doc/subsecond-lag.md">sub-second lag on replicas</a> (well, you need to supply with the right query). Our current production migrations are set by default with <code>--max-lag-millis=500</code> or less, and our most intensive migrations keep replication lag well below <code>1sec</code> or even below <code>500ms</code></p>
<h3>No SUPER</h3>
<p>The <code>SUPER</code> privilege is required to <code>set global binlog_format='ROW'</code> and for <code>STOP SLAVE; START SLAVE;</code></p>
<p>If you <em>know</em> your replica has RBR, you can pass <code>--assume-rbr</code> and skips those steps.</p>
<h3>RDS</h3>
<p>Hooks + No Super = RDS, as seems to be the case. For <code>--test-on-replica</code> you will need to supply your own <code>gh-ost-on-stop-replication</code> hook, to stop your RDS replica at cut-over phase. See <a href="https://github.com/github/gh-ost/issues/163#issuecomment-244694616">this tracking issue</a><span id="more-7632"></span></p>
<h3>master-master</h3>
<p>While active-active are still not supported, you now have greater control over master-master topologies by being able to explicitly pick your master (as <code>gh-ost</code> arbitrarily picks one of the co-masters). Do so by passing <code>--assume-master-host</code>. See <a href="https://github.com/github/gh-ost/blob/master/doc/cheatsheet.md">cheatsheet</a>.</p>
<h3>tungsten replicator</h3>
<p>Similarly, <code>gh-ost</code> cannot crawl your <code>tungsten</code> topology, and you are able to specify <code>--tungsten --assume-master-host=the.master.com</code>. See <a href="https://github.com/github/gh-ost/blob/master/doc/cheatsheet.md">cheatsheet</a>.</p>
<h3>Concurrent-rowcount</h3>
<p><code>--exact-rowcount</code> is awesomeness, keeping quite accurate estimate of progress. With <code>--concurrent-rowcount</code> we begin migration with a rough estimate, and execute <code>select count(*) from your_table</code> in parallel, updating our estimate later on throughout the migration</p>
<h3>Stricter, safer</h3>
<p><code>gh-ost</code> works in <code>STRICT_ALL_TABLES</code> mode, meaning it would fail rather than set the wrong value to a column.</p>
<p>In addition to unit-testing and production continuous test, a set of <a href="https://github.com/github/gh-ost/blob/master/doc/local-tests.md">local tests</a> is growing, hopefully to run as CI tests later on.</p>
<h3>Fixed problems</h3>
<p>Fixed <code>time_zone</code> related bug, high <code>unsigned</code> values bug; added strict check for triggers, relaxed config file parsing, and more. Thank you to community contributors for PRs, from <code>ipv6</code> to typos!</p>
<h3>Known issues</h3>
<p>Issues coming and going at all times &#8212; thank you for reporting Issues!</p>
<p>We have a confirmed <a href="https://github.com/github/gh-ost/issues/226">bug with non-UTF charsets</a> at this time. Some other minor issues and feature requests are open &#8212; we&#8217;ll take them as we go along.</p>
<h3>Feedback requests</h3>
<p>We are not testing <code>gh-ost</code> on RDS ourselves. We appreciate community feedback on <a href="https://github.com/github/gh-ost/issues/163">this tracking issue</a>.</p>
<p>We are not testing <code>gh-ost</code> on Galera/XtraDB cluster ourselves. We appreciate community feedback on <a href="https://github.com/github/gh-ost/issues/224">this tracking issue</a>.</p>
<p>We value submitted Issues and questions.</p>
<h3>Speaking</h3>
<p>We will be presenting <code>gh-ost</code> in the next month:</p>
<ul>
<li>I will be <a href="http://githubuniverse.com/program/sessions/#gh-ost">presenting gh-ost at GitHub Universe</a>, Sep. 14th</li>
<li>Tom Krouper will be <a href="https://datalayer.com/">presenting gh-ost at DataLayer</a>, Seattle, Sep 28th</li>
<li>Tom Krouper and myself will be <a href="https://www.percona.com/live/plam16/sessions/introducing-gh-ost-triggerless-painless-trusted-online-schema-migrations">presenting gh-ost at PerconaLive</a>, Amsterdam, Oct 5th</li>
</ul>
<p>Hope to see you there, and thank you again to all contributors!</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/gh-ost-1-0-17-hooks-sub-second-lag-control-amazon-rds-and-more/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">7632</post-id>	</item>
	</channel>
</rss>
