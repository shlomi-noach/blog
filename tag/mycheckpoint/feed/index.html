<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	
	xmlns:georss="http://www.georss.org/georss"
	xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
	>

<channel>
	<title>mycheckpoint &#8211; code.openark.org</title>
	<atom:link href="https://shlomi-noach.github.io/blog/tag/mycheckpoint/feed" rel="self" type="application/rss+xml" />
	<link>http://shlomi-noach.github.io/blog/</link>
	<description>Blog by Shlomi Noach</description>
	<lastBuildDate>Thu, 06 Mar 2014 10:27:28 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.3.3</generator>
<site xmlns="com-wordpress:feed-additions:1">32412571</site>	<item>
		<title>mycheckpoint, discontinued</title>
		<link>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-discontinued</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-discontinued#comments</comments>
				<pubDate>Thu, 06 Mar 2014 10:27:28 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Monitoring]]></category>
		<category><![CDATA[mycheckpoint]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=6745</guid>
				<description><![CDATA[Time to admit to myself: mycheckpoint has to be discontinued. I started mycheckpoint back in 2009, as a free &#38; open source lightweight monitoring tool for MySQL. Over some years it evolved and became an actual (lightweight) monitoring solution, used by many. It has a unique and original design, which, alas, is also its bane. [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>Time to admit to myself: <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a> has to be discontinued.</p>
<p>I started <em>mycheckpoint</em> back in <strong>2009</strong>, as a free &amp; open source lightweight monitoring tool for MySQL. Over some years it evolved and became an actual (lightweight) monitoring solution, used by many. It has a unique and original design, which, alas, is also its bane.</p>
<p><em>mycheckpoint</em> uses the relational model &amp; SQL to store and query monitored metrics. This leads to quite a sophisticated service, which can make practically anything visible to the user. The raw data is just numbers. but with some SQL-Fu one can <a href="https://shlomi-noach.github.io/blog/mysql/generating-google-line-charts-with-sql-part-ii">generate charts out of it</a>,  (<a href="http://mycheckpoint.googlecode.com/svn/trunk/doc/html/sample/http/mcp_sql00/sv_report_html_brief">interactive</a> ones as well), human readable <a href="http://mycheckpoint.googlecode.com/svn/trunk/doc/html/sample/http/mcp_sql00/sv_report_html_brief">reports</a> and full blown email messages. It is still the only common solution I&#8217;m aware of that <a href="http://code.openark.org/forge/mycheckpoint/documentation/detecting-parameters-change">keeps track of variable changes</a> and provides with clear &#8220;what changed, when, from value &amp; to_value&#8221;. I caught many deployment bugs by just observing this. It&#8217;s a single file that provides with full blown HTTP service, alerting, mail notifications, multi-database monitoring, custom monitoring queries, query execution time monitoring, OS metrics, &#8230;</p>
<p>While developing <em>mycheckpoint</em> I learned a lot on MySQL status &amp; configuration, complex SQL queries, Python, linux, packaging and more. I got a lot of feedback from users, as I still do (thank you!). Didn&#8217;t always manage to fix all bugs or answer all questions.</p>
<p>The design of <em>mycheckpoint</em> does not meet today&#8217;s reality. Heck, today there are more counters &amp; variables than possible table columns. The schema-per-monitored-instance design makes for simplicity, but does not fare well with dozens or hundreds of servers to monitor. There is no cross-instance aggregation or visualization of data. The per-<strong>10</strong> minute aggregation is too rough. <em>There isn&#8217;t a test suite</em>.</p>
<p>Some of the above issues can be fixed, and if you like, the source code is still <a href="http://code.google.com/p/mycheckpoint/source/checkout">freely available</a>. I&#8217;ll even migrate the entire SVN to GitHub at some stage. But I believe the current state might only be good for small scale deployments;  not something you would consider to scale up with.</p>
<p>For me, there&#8217;s nothing more motivating in code development than knowing the code will go public. The efforts in making the code look as best it can, as easily deployable as possibly can, with good documentation, makes for a lot of effort &#8211; but very satisfying. Open Source FTW!!!1</p>
<p>&nbsp;</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-discontinued/feed</wfw:commentRss>
		<slash:comments>1</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">6745</post-id>	</item>
		<item>
		<title>mycheckpoint revision 231 released</title>
		<link>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-revision-released</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-revision-released#comments</comments>
				<pubDate>Thu, 23 May 2013 12:21:52 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Development]]></category>
		<category><![CDATA[Monitoring]]></category>
		<category><![CDATA[mycheckpoint]]></category>
		<category><![CDATA[Open Source]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=6353</guid>
				<description><![CDATA[A new release for mycheckpoint: lightweight, SQL oriented MySQL monitoring solution. If you&#8217;re unfamiliar with mycheckpoint, well, the one minute sales pitch is: it&#8217;s a free and open source monitoring tool for MySQL, which is extremely easy to install and execute, and which includes custom queries, alerts (via emails), and out of the box HTTP [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>A <a href="http://code.google.com/p/mycheckpoint/">new release</a> for <strong><a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a></strong>: lightweight, SQL oriented MySQL monitoring solution.</p>
<p>If you&#8217;re unfamiliar with <em>mycheckpoint</em>, well, the one minute sales pitch is: it&#8217;s a free and open source monitoring tool for MySQL, which is extremely easy to install and execute, and which includes <a href="http://code.openark.org/forge/mycheckpoint/documentation/custom-monitoring">custom queries</a>, <a href="http://code.openark.org/forge/mycheckpoint/documentation/alerts">alerts</a> (via <a href="http://code.openark.org/forge/mycheckpoint/documentation/emails">emails</a>), and out of the box <a href="http://code.openark.org/forge/mycheckpoint/documentation/http-web-server">HTTP server</a> and <a href="http://mycheckpoint.googlecode.com/svn/trunk/doc/html/sample/http/mcp_sql00/sv_report_html_brief">charting</a>.</p>
<p>This is mostly a maintenance release, with some long-time requested features, and of course solved bugs. Here are a few highlights:</p>
<ul>
<li>Supports MariaDB and MySQL 5.6 (issues with new variables, space padded variables, text-valued variables)</li>
<li>Supports alerts via function invocation on monitored host (so not only checking alerts via aggregated data like <strong>&#8216;Seconds_behind_master&#8217;</strong> but also by <strong>SELECT my_sanity_check_function()</strong> on monitored instance). See <a href="http://code.openark.org/forge/mycheckpoint/documentation/alerts">alerts.</a></li>
<li>Supports single-running-instance via <strong>&#8220;&#8211;single&#8221;</strong> command line argument</li>
<li>Supports strict <strong>sql_mode</strong>, including <strong>ONLY_FULL_GROUP_BY</strong>, overcoming <a href="http://bugs.mysql.com/bug.php?id=69310">bug #69310</a>.<strong><br />
</strong></li>
<li>Supports sending of pending email HTML report</li>
<li>Better re-deployment process</li>
<li>Better recognizing of SIGNED/UNSIGNED values</li>
<li>Some other improvements in charting, etc.</li>
</ul>
<p><em>mycheckpoint</em> is released under the BSD license.</p>
<p><a href="http://code.google.com/p/mycheckpoint/">Downloads are available</a> from the project&#8217;s page.</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-revision-released/feed</wfw:commentRss>
		<slash:comments>2</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">6353</post-id>	</item>
		<item>
		<title>MySQL monitoring: storing, not caching</title>
		<link>https://shlomi-noach.github.io/blog/mysql/mysql-monitoring-storing-not-caching</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/mysql-monitoring-storing-not-caching#comments</comments>
				<pubDate>Wed, 22 Feb 2012 07:44:47 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Monitoring]]></category>
		<category><![CDATA[mycheckpoint]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4736</guid>
				<description><![CDATA[I&#8217;ve followed with interest on Baron&#8217;s Why don’t our new Nagios plugins use caching? and Sheeri&#8217;s Caching for Monitoring: Timing is Everything. I wish to present my take on this, from mycheckpoint&#8216;s point of view. So mycheckpoint works in a completely different way. On one hand, it doesn&#8217;t bother with caching. On the other hand, [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>I&#8217;ve followed with interest on Baron&#8217;s <a href="http://www.mysqlperformanceblog.com/2012/02/19/why-dont-our-new-nagios-plugins-use-caching/">Why don’t our new Nagios plugins use caching?</a> and Sheeri&#8217;s <a href="http://www.sheeri.com/content/caching-monitoring-timing-everything">Caching for Monitoring: Timing is Everything</a>. I wish to present my take on this, from <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a>&#8216;s point of view.</p>
<p>So <em>mycheckpoint</em> works in a completely different way. On one hand, it doesn&#8217;t bother with caching. On the other hand, it doesn&#8217;t bother with re-reads of data.</p>
<p>There are no staleness issues, the data is consistent as it can get (you can <em>never</em> get a completely atomic read of everything in MySQL), and you can issue as many calculations as you want at the price of one take of monitoring. As in Sheere&#8217;s example, you can run <strong>Threads_connected/max_connections*100</strong>, mix status variables, system variables, meta-variables (e.g. Seconds_behind_master), user-created variables (e.g. number of purchases in your online shop) etc.</p>
<p><em>mycheckpoint</em>&#8216;s concept is to <strong>store</strong> data. And store it in relational format. That is, <strong>INSERT</strong> it to a table.</p>
<p>A sample-run generates a row, which lists all status, server, OS, user, meta variables. It&#8217;s a huge row, with hundreds of columns. Columns like <strong>threads_connected</strong>, <strong>max_connections</strong>, <strong>innodb_buffer_pool_size</strong>, <strong>seconds_behind_master</strong>, etc.</p>
<p><em>mycheckpoint</em> hardly cares about these columns. It identifies them dynamically. Have you just upgraded to MySQL <strong>5.5</strong>? Oh, there&#8217;s a new bunch of server and status variables? No problem, <em>mycheckpoint</em> will notice it doesn&#8217;t have the matching columns and will add them via ALTER TABLE. There you go, now we have a place to store them.</p>
<p>Running a formula like <strong>Threads_connected/max_connections*100</strong> is as easy as issuing the following query:</p>
<blockquote>
<pre>SELECT Threads_connected/max_connections*100 FROM status_variables WHERE id = ...</pre>
</blockquote>
<p>Hmmm. This means I can run this formula on the most recent row I&#8217;ve just added. But wait, this also means I can run this formula on <em>any</em> row I&#8217;ve ever gathered.<span id="more-4736"></span></p>
<p>With <em>mycheckpoint</em> you can generate graphs <strong>retroactively</strong> using new formulas. The data is there, vanilla style. Any formula which can be calculated via SQL is good to go with. Plus, you get the benefit of cross referencing in fun ways: cross reference to the timestamp at which the sample was taken (so, for example, ignore the spikes generated at this and that timeframe due to maintenance. Don&#8217;t alert me on these), to system issues like load average or CPU usage (show me the average <strong>Seconds_behind_master</strong> when load average is over <strong>8</strong>, or the average load average when slow query rate is over some threshold. You don&#8217;t do that all the time, but when you need it, well, you can get all the insight you ever wanted.</p>
<p>Actually storing the monitored data in an easy to access format allows one to query, re-query, re-formulate. No worries about caching, you only sample once.</p>
<p>For completeness, all the above is relevant when the data is of numeric types. Other types are far more complicated to manage (the list of running queries is a common example).</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/mysql-monitoring-storing-not-caching/feed</wfw:commentRss>
		<slash:comments>8</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">4736</post-id>	</item>
		<item>
		<title>Documentation in SQL: CALL for help()</title>
		<link>https://shlomi-noach.github.io/blog/mysql/documentation-in-sql-call-for-help</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/documentation-in-sql-call-for-help#comments</comments>
				<pubDate>Wed, 11 Jan 2012 07:01:54 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[Development]]></category>
		<category><![CDATA[MySQL]]></category>
		<category><![CDATA[common_schema]]></category>
		<category><![CDATA[documentation]]></category>
		<category><![CDATA[mycheckpoint]]></category>
		<category><![CDATA[Open Source]]></category>
		<category><![CDATA[openark kit]]></category>
		<category><![CDATA[Stored routines]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4536</guid>
				<description><![CDATA[Documentation is an important part of any project. On the projects I maintain I put a lot of effort on documentation, and, frankly, the majority of time spent on my projects is on documentation. The matter of keeping the documentation faithful is a topic of interest. I&#8217;d like to outline a few documentation bundling possibilities, [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>Documentation is an important part of any project. On the projects I maintain I put a lot of effort on documentation, and, frankly, the majority of time spent on my projects is on documentation.</p>
<p>The matter of keeping the documentation faithful is a topic of interest. I&#8217;d like to outline a few documentation bundling possibilities, and the present the coming new documentation method for <a href="http://code.google.com/p/common-schema/" rel="nofollow">common_schema</a>. I&#8217;ll talk about any bundling that is NOT <em>man pages</em>.</p>
<h4>High level: web docs</h4>
<p>This is the initial method of documentation I used for <a title="openark kit" href="../../forge/openark-kit">openark kit</a> and <a title="mycheckpoint" href="../../forge/mycheckpoint">mycheckpoint</a>. It&#8217;s still valid for <em>mycheckpoint</em>. Documentation is web-based. You need Internet access to read it. It&#8217;s in HTML format.</p>
<p>Well, not exactly HTML format: I wrote it in WordPress. Yes, it&#8217;s HTML, but there&#8217;s a lot of noise around (theme, menus, etc.) which is not strictly part of the documentation.</p>
<p>While this is perhaps the easiest way to go, here&#8217;s a few drawbacks:<span id="more-4536"></span></p>
<ul>
<li>You&#8217;re bound to some framework (WordPress in this case)</li>
<li>Docs are split between MySQL database (my underlying WordPRess storage) &amp; WordPress files (themes, style, header, footer etc.)</li>
<li>Documentation is separate from your code &#8211; they&#8217;re just not in the same place</li>
<li>There is no version control over the documentation.</li>
</ul>
<p>The result is a single source of documentation, which applies to whatever version is latest. It&#8217;s impossible to maintain docs for multiple versions. You must manually synchronize your WordPress updates with code commits (or rather &#8211; code release!).</p>
<h4>Mid level: version controlled HTML docs</h4>
<p>I first saw this approach on Baron&#8217;s <a href="http://www.xaprb.com/blog/2010/09/22/aspersa-gets-a-user-manual/" rel="bookmark">Aspersa gets a user manual</a> post. I loved it: the documentation is HTML, but stored as part of your project&#8217;s code, in same version control.</p>
<p>This means one can <a href="http://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/introduction.html">browse the documentation</a> (<em>openark kit</em> in this example) exactly as it appears in the baseline. Depending on your project hosting, one may be able to do so per version.</p>
<p>The approach has the great benefit of having the docs tightly coupled with the code in terms of development. Before committing code, one updates documentation for that code, then commits/releases both together.</p>
<p>You&#8217;re also not bound to any development framework. You may edit with <em>vim, emacs, gedit, bluefish, eclipse,</em> &#8230; any tool of your choice. It&#8217;s all down to plain old text files.</p>
<h4>Mid level #2: documentation bundling</h4>
<p>One thing I started doing with common_schema is to release a doc bundle with the code. So one can download a compressed bundle of all HTML files. That way one is absolutely certain what&#8217;s the right documentation for revision <strong>178</strong>. There&#8217;s no effort about it: the docs are already tightly coupled with code versions. Just compress and distribute.</p>
<h4>Low level: documentation coupled with your code</h4>
<p>Perl scripts can be written as Perl modules, in which case they are eligible for using the <em>perldoc</em> convention. You code your documentation within your script itself, as comment. <em>Perldoc</em> can extract the documentation and present in man-like format. Same happens with Python&#8217;s <em>pydoc</em>. Baron&#8217;s <a href="http://www.xaprb.com/blog/2011/11/07/when-documentation-is-code/" rel="bookmark">When documentation is code</a> illustrates that approach. <a href="http://www.maatkit.org/">Maatkit</a> (now <em>Percona Toolkit</em>) has been using it for years.</p>
<p>This method has the advantage of having the documentation ready right within your shell. You don&#8217;t need a browser, nor firewall access. The docs are just there for you in the same environment where you&#8217;re executing the code.</p>
<h4>SQL Low level: CALL for help()</h4>
<p><em>common_schema</em> is a different type of project. It is merely a schema. There&#8217;s no Perl nor Python. One imports the schema into one&#8217;s MySQL server.</p>
<p>What&#8217;s the low-level approach for this type of code?</p>
<p>For <em>common_schema</em> I use three levels of documentation: the mid-level, where one can <a href="http://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/introduction.html">browse through the versioned docs</a>, the 2nd mid-level, where one can <a href="http://code.google.com/p/common-schema/downloads/list">download bundled documentation</a>, and then a low-level approach: documentation embedded within the code.</p>
<p>MySQL&#8217;s documentation is also built into the server: see the <strong>help_*</strong> tables within the <strong>mysql</strong> schema. The <em>mysql</em> command line client allows one to access help by supporting the help command, e.g.</p>
<blockquote>
<pre>mysql&gt; help create table;</pre>
</blockquote>
<p>The client intercepts this command (this is not server side command) and searches through the <strong>mysql.help_*</strong> docs.</p>
<p>With <em>common_schema</em>, I don&#8217;t have control over the client; it&#8217;s all on server side. But the code being a schema, what with stored routines and tables, it&#8217;s easy enough to set up documentation.</p>
<p>As of the next version of <em>common_schema</em>, and following MySQL&#8217;s method, <em>common_schema</em> provides a <strong>help</strong> table:</p>
<blockquote>
<pre>DESC help;
+--------------+-------------+------+-----+---------+-------+
| Field        | Type        | Null | Key | Default | Extra |
+--------------+-------------+------+-----+---------+-------+
| topic        | varchar(32) | NO   | PRI | NULL    |       |
| help_message | text        | NO   |     | NULL    |       |
+--------------+-------------+------+-----+---------+-------+</pre>
</blockquote>
<p>And a <strong>help()</strong> procedure, so that you can call for <em>help()</em>. The procedure will look for the best matching document based on your search expression:</p>
<blockquote>
<pre>root@mysql-5.1.51&gt; <strong>CALL help('match');</strong>
<strong>+---------------------------------------</strong>----------------------------------------+
| help                                                                          |
+-------------------------------------------------------------------------------+
|                                                                               |
| NAME                                                                          |
|                                                                               |
| match_grantee(): Match an existing account based on user+host.                |
|                                                                               |
| TYPE                                                                          |
|                                                                               |
| Function                                                                      |
|                                                                               |
| DESCRIPTION                                                                   |
|                                                                               |
| MySQL does not provide with identification of logged in accounts. It only     |
| provides with user + host:port combination within processlist. Alas, these do |
| not directly map to accounts, as MySQL lists the host:port from which the     |
| connection is made, but not the (possibly wildcard) user or host.             |
| This function matches a user+host combination against the known accounts,     |
| using the same matching method as the MySQL server, to detect the account     |
| which MySQL identifies as the one matching. It is similar in essence to       |
| CURRENT_USER(), only it works for all sessions, not just for the current      |
| session.                                                                      |
|                                                                               |
| SYNOPSIS                                                                      |
|                                                                               |
|                                                                               |
|                                                                               |
|        match_grantee(connection_user char(16) CHARSET utf8,                   |
|        connection_host char(70) CHARSET utf8)                                 |
|          RETURNS VARCHAR(100) CHARSET utf8                                    |
|                                                                               |
|                                                                               |
| Input:                                                                        |
|                                                                               |
| * connection_user: user login (e.g. as specified by PROCESSLIST)              |
| * connection_host: login host. May optionally specify port number (e.g.       |
|   webhost:12345), which is discarded by the function. This is to support      |
|   immediate input from as specified by PROCESSLIST.                           |
|                                                                               |
|                                                                               |
| EXAMPLES                                                                      |
|                                                                               |
| Find an account matching the given use+host combination:                      |
|                                                                               |
|                                                                               |
|        mysql&gt; SELECT match_grantee('apps', '192.128.0.1:12345') AS            |
|        grantee;                                                               |
|        +------------+                                                         |
|        | grantee    |                                                         |
|        +------------+                                                         |
|        | 'apps'@'%' |                                                         |
|        +------------+                                                         |
|                                                                               |
|                                                                               |
|                                                                               |
| ENVIRONMENT                                                                   |
|                                                                               |
| MySQL 5.1 or newer                                                            |
|                                                                               |
| SEE ALSO                                                                      |
|                                                                               |
| processlist_grantees                                                          |
|                                                                               |
| AUTHOR                                                                        |
|                                                                               |
| Shlomi Noach                                                                  |
|                                                                               |
+-------------------------------------------------------------------------------+</pre>
</blockquote>
<p>I like HTML for documentation. I think it&#8217;s a good format, provided you don&#8217;t start doing funny things. Perhaps <em>TROFF</em> is more suitable; certainly more popular on Unix machines. But I already have everything in HTML. So, what do I do?</p>
<p>My decision was to keep documentation in HTML, and use the handy <em>html2text</em> tool to do the job. And it does it pretty well! The sample you see above is an automated translation of HTML to plain text.</p>
<p>I add a few touches of my own: SELECTing long texts is ugly, whether you do it via &#8220;<strong>;</strong>&#8221; or &#8220;<strong>\G</strong>&#8220;. The <strong>help()</strong> routine breaks the text by &#8216;<strong>\n</strong>&#8216;, returning a multi row result set. The above sample makes for some <strong>60+</strong> rows, nicely formatted, broken from the original single text appearing in the <strong>help</strong> table.</p>
<p>So now you have an internal help method for <em>common_schema</em>, right where the code is. You don&#8217;t have to leave the command line client in order to get help.</p>
<p><a href="http://datacharmer.blogspot.com/">Giuseppe</a> offered me the idea for this, even while my own thinking about it was in early stages.</p>
<p>The next version of <em>common_schema</em> will be available in a few weeks. The code is pretty much ready. I just need to work on, ahem&#8230;, the documentation.</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/documentation-in-sql-call-for-help/feed</wfw:commentRss>
		<slash:comments>2</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">4536</post-id>	</item>
		<item>
		<title>Generating Google line charts with SQL, part II</title>
		<link>https://shlomi-noach.github.io/blog/mysql/generating-google-line-charts-with-sql-part-ii</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/generating-google-line-charts-with-sql-part-ii#comments</comments>
				<pubDate>Thu, 03 Mar 2011 07:38:10 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Graphs]]></category>
		<category><![CDATA[mycheckpoint]]></category>
		<category><![CDATA[SQL]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=3337</guid>
				<description><![CDATA[This post continues Generating Google line charts with SQL, part I, in pursue of generating time series based image charts. We ended last post with the following chart: http://chart.apis.google.com/chart?cht=lc&#038;chs=400x200&#038;chtt=SQL%20chart&#038;chxt=x,y&#038;chxr=1,-4716.6,5340.0&#038;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL which has a nice curve, and a proper y-legend, but incorrect x-legend and no ticks nor grids. To date, Google Image Charts do not support time-series [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>This post continues <a href="https://shlomi-noach.github.io/blog/mysql/generating-google-line-charts-with-sql-part-i">Generating Google line charts with SQL, part I</a>, in pursue of generating time series based image charts.</p>
<p>We ended last post with the following chart:</p>
<blockquote>
<pre><img class="alignnone" title="Sample SQL Google Chart" src="http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,-4716.6,5340.0&amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL" alt="" width="400" height="200" />
http://chart.apis.google.com/chart?cht=lc&chs=400x200&chtt=SQL%20chart&chxt=x,y&chxr=1,-4716.6,5340.0&chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL
</pre>
</blockquote>
<p>which has a nice curve, and a proper y-legend, but incorrect x-legend and no ticks nor grids.</p>
<p>To date, Google Image Charts do not support time-series charts. We can&#8217;t just throw timestamp values and expect the chart to properly position them. We need to work these by hand.</p>
<p>This is not easily done; if our input consists of evenly spread timestamp values, we are in a reasonable position. If not, what do we do?</p>
<p>There are several solutions to this:</p>
<ul>
<li>We can present whatever points we have on the chart, making sure to position them properly. This makes for an uneven distribution of ticks on the x-axis, and is not pleasant to watch.</li>
<li>We can extrapolate values for round hours (or otherwise round timestamp resolutions), and so show evenly spread timestamps. I don&#8217;t like this solution one bit, since we&#8217;re essentially inventing values here. Extrapolation is nice when you know you have nice curves, but not when you&#8217;re doing database monitoring, for example. You must have the precise values.</li>
<li>We can do <a href="http://en.wikipedia.org/wiki/Oversampling">oversampling</a>, then group together several measurements within round timestamp resolutions. For example, we can make a measurement every <strong>2</strong> minutes, yet present only <strong>6</strong> measurements per hour, each averaging up <strong>10</strong> round minutes. This is the approach I take with <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a>.</li>
</ul>
<p>The latest approach goes even beyond that: what if we missed 30 minutes of sampling? Say the server was down. We then need to &#8220;invent&#8221; the missing timestamps. Note that we invent the timestamps, we do not invent values. We must present the chart with missing values on our invented timestamps.</p>
<p>I may show how to do this in a future post. Meanwhile, let&#8217;s simplify and assume our values <em>are</em> evenly spread.<span id="more-3337"></span></p>
<h4>Sample data</h4>
<p>We use <a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2011/03/google_charts.sql_.txt">google_charts.sql</a>. Note that the timestamp values provided in Part I of this post is skewed, so make sure to use this file.</p>
<h4>x-axis values</h4>
<p>We use <strong>chxl</strong> to present with x-axis values. We may be tempted to just list all values. Would that work?</p>
<p>Sadly, no, for two reasons:</p>
<ol>
<li>Google is not smart enough; whatever we throw at it, it will try to present. So, if we have <strong>288</strong> rows, that&#8217;s <strong>288</strong> x-axis values. Not enough room, to be sure! Smarter implementations would automatically hide some values, so as only to present with non-overlapping values.</li>
<li>Our URL will turn out to be too long. Remember: <strong>2048</strong> characters is our maximum limit for GET request!</li>
</ol>
<p>Also, we must format our timestamp to be of minimal width. In our example, we have a <strong>24</strong> hour range. We therefore present timestamps in hh:MM format. So, a naive approach would be to:</p>
<blockquote>
<pre>SELECT
  CONCAT(
    'http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,',
    ROUND(min_value, 1), ',',
    ROUND(max_value, 1),
    '&amp;chd=s:',
    GROUP_CONCAT(
      IF(
        data IS NULL,
        '_',
        SUBSTRING(
          'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR ''
    ),
   '&amp;chxl=0:|',
    <strong>GROUP_CONCAT(</strong>
<strong>      DATE_FORMAT(ts, '%H:%i')</strong>
<strong>      SEPARATOR '|'</strong>
<strong>    )</strong>
  ) FROM chart_data, chart_data_minmax</pre>
</blockquote>
<p>The resulting URL is just too long.</p>
<p>Solution? Let&#8217;s only consider round hour timestamps! Our next attempt looks like this (we also throw in <strong>chxs</strong>, to show ticks):</p>
<blockquote>
<pre>SELECT
  CONCAT(
    'http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,',
    ROUND(min_value, 1), ',',
    ROUND(max_value, 1),
    '&amp;chd=s:',
    GROUP_CONCAT(
      IF(
        data IS NULL,
        '_',
        SUBSTRING(
          'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR ''
    ),
   <strong>'&amp;chxs=0,505050,10,0,lt',</strong>
<strong>   '&amp;chxl=0:|',</strong>
<strong>    GROUP_CONCAT(</strong>
<strong>      IF(</strong>
<strong>        MINUTE(ts) = 0,</strong>
<strong>        DATE_FORMAT(ts, '%H:%i'),</strong>
<strong>        NULL</strong>
<strong>      )</strong>
<strong>      SEPARATOR '|'</strong>
<strong>    )</strong>
  ) FROM chart_data, chart_data_minmax
</pre>
</blockquote>
<p>and results with:</p>
<blockquote>
<pre><img class="alignnone" title="SQL line chart" src="http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,-4716.6,5340.0&amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&amp;chxs=0,505050,10,0,lt&amp;chxl=0:|00:00|01:00|02:00|03:00|04:00|05:00|06:00|07:00|08:00|09:00|10:00|11:00|12:00|13:00|14:00|15:00|16:00|17:00|18:00|19:00|20:00|21:00|22:00|23:00" alt="" width="400" height="200" />
http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,-4716.6,5340.0&amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&amp;chxs=0,505050,10,0,lt&amp;chxl=0:|00:00|01:00|02:00|03:00|04:00|05:00|06:00|07:00|08:00|09:00|10:00|11:00|12:00|13:00|14:00|15:00|16:00|17:00|18:00|19:00|20:00|21:00|22:00|23:00</pre>
</blockquote>
<p>Too messy, isn&#8217;t it?</p>
<h4>A word about ticks</h4>
<p>You would think: OK, then, let&#8217;s just present every <strong>4</strong> round hours timestamps. But there&#8217;s a catch: a tick will show only when there&#8217;s an x-axis value. It&#8217;s nice to have a tick for every hour, but we only want to present values every <strong>4</strong> hours.</p>
<p>Fortunately, we can provide with an unseen value: a space (URL encoded as &#8216;<strong>+</strong>&#8216;). So we complicate things up a bit on the <strong>chxl</strong> to read:</p>
<blockquote>
<pre>SELECT
  CONCAT(
    'http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,',
    ROUND(min_value, 1), ',',
    ROUND(max_value, 1),
    '&amp;chd=s:',
    GROUP_CONCAT(
      IF(
        data IS NULL,
        '_',
        SUBSTRING(
          'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR ''
    ),
   '&amp;chxs=0,505050,10,0,lt',
   '&amp;chxl=0:|',
    <strong>GROUP_CONCAT(</strong>
<strong>      IF(</strong>
<strong>        MINUTE(ts) = 0,</strong>
<strong>        IF(</strong>
<strong>          HOUR(ts) MOD 4 = 0,</strong>
<strong>          DATE_FORMAT(ts, '%H:%i'),</strong>
<strong>          '+'</strong>
<strong>        ),</strong>
<strong>        NULL</strong>
<strong>      )</strong>
<strong>      SEPARATOR '|'</strong>
<strong>    )</strong>
  ) FROM chart_data, chart_data_minmax</pre>
</blockquote>
<p>and get:</p>
<blockquote>
<pre><img class="alignnone" title="SQL line chart" src="http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,-4716.6,5340.0&amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&amp;chxs=0,505050,10,0,lt&amp;chxl=0:|00:00|+|+|+|04:00|+|+|+|08:00|+|+|+|12:00|+|+|+|16:00|+|+|+|20:00|+|+|+" alt="" width="400" height="200" />
http://chart.apis.google.com/chart?cht=lc&chs=400x200&chtt=SQL%20chart&chxt=x,y&chxr=1,-4716.6,5340.0&chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&chxs=0,505050,10,0,lt&chxl=0:|00:00|+|+|+|04:00|+|+|+|08:00|+|+|+|12:00|+|+|+|16:00|+|+|+|20:00|+|+|+
</pre>
</blockquote>
<h4>OK, I cheated</h4>
<p>Who says sample data starts with a round hour? We have that hidden assumption here, since the first tick is necessarily a round hour in our code. Yet our data may start at <strong>12:35</strong>, for example. Sorry, you&#8217;ll have to dig into <a href="http://code.google.com/p/mycheckpoint/source/browse/trunk/src/mycheckpoint.py">mycheckpoint&#8217;s source code</a> to see a thorough solution. It&#8217;s just too much for this post.</p>
<h4>Grids</h4>
<p>Let&#8217;s wrap this up with grids. Grids work by specifying the step size (in percent of overall height/width) and initial offset (again, in percent).</p>
<p>Wouldn&#8217;t it be nicer if grids were automatically attached to ticks? I mean, REALLY! What were those guys thinking? (I know, they&#8217;re doing great work. Keep it up!)</p>
<p>Problem is, I have no idea how Google chooses to distribute values on the y-axis. I don&#8217;t know where y-axis ticks will be placed. So on y-axis, I just choose to split charts to <strong>4</strong> even parts, and draw horizontal grids between them. Percent is <strong>25</strong> (<strong>100/4</strong>), offset is <strong>0</strong>.</p>
<p>But I do have control over the x-axis. In our case, I know how many ticks we&#8217;ll be having. Plus, I made life easier by assuming we start with a round hour, so no offset is required.</p>
<p>Umm&#8230; How many ticks do we have? Easy: the number of round hours. This can be calculated by: <strong>SUM(MINUTE(ts) = 0</strong>. Actually, we need to take <strong>1</strong> off.</p>
<p>We now build the <a href="http://code.google.com/apis/chart/docs/chart_params.html#gcharts_grid_lines"><strong>chg</strong></a> parameter:</p>
<blockquote>
<pre>SELECT
  CONCAT(
    'http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,',
    ROUND(min_value, 1), ',',
    ROUND(max_value, 1),
    '&amp;chd=s:',
    GROUP_CONCAT(
      IF(
        data IS NULL,
        '_',
        SUBSTRING(
          'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR ''
    ),
   '&amp;chxs=0,505050,10,0,lt',
   '&amp;chxl=0:|',
    GROUP_CONCAT(
      IF(
        MINUTE(ts) = 0,
        IF(
          HOUR(ts) MOD 4 = 0,
          DATE_FORMAT(ts, '%H:%i'),
          '+'
        ),
        NULL
      )
      SEPARATOR '|'
    ),
   <strong>'&amp;chg=', ROUND(100.0/((SUM(MINUTE(ts) = 0) -1)), 2), ',25,1,2,0,0'</strong>
  ) FROM chart_data, chart_data_minmax
</pre>
</blockquote>
<p>and get:</p>
<blockquote>
<pre><img class="alignnone" title="SQL line chart" src="http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,-4716.6,5340.0&amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&amp;chxs=0,505050,10,0,lt&amp;chxl=0:|00:00|+|+|+|04:00|+|+|+|08:00|+|+|+|12:00|+|+|+|16:00|+|+|+|20:00|+|+|+&amp;chg=4.35,25,1,2,0,0" alt="" width="400" height="200" />
http://chart.apis.google.com/chart?cht=lc&chs=400x200&chtt=SQL%20chart&chxt=x,y&chxr=1,-4716.6,5340.0&chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL&chxs=0,505050,10,0,lt&chxl=0:|00:00|+|+|+|04:00|+|+|+|08:00|+|+|+|12:00|+|+|+|16:00|+|+|+|20:00|+|+|+&chg=4.35,25,1,2,0,0
</pre>
</blockquote>
<p>Phew!</p>
<h4>Conclusion</h4>
<p>So we haven&#8217;t worked on offsets. And, this is a single line chart. What about multiple lines? Legend? The following chart:</p>
<blockquote>
<pre><img class="alignnone" title="SQL multi line chart" src="http://chart.apis.google.com/chart?cht=lc&amp;chs=370x180&amp;chts=303030,12&amp;chtt=Latest+24+hours:+Nov+9,+05:50++-++Nov+10,+05:50&amp;chf=c,s,ffffff&amp;chdl=com_select_psec|com_insert_psec|com_delete_psec|com_update_psec|com_replace_psec&amp;chdlp=b&amp;chco=ff8c00,4682b4,9acd32,dc143c,9932cc&amp;chd=s:RTOSRORPNSSORROQTNQQMQRPQSOMUMPQOQUNRUQPUPSRQPUPSTRPQPPQQQQPPURPSQKUQPUQPUTPUQRUTRSRRWTRURRUPQUQSWTSUSOUURTRUTSPSRPPRMRRPRROQSNPQNPPSSRMQPQPQNRQV,MMMRQMPMNPOLOLLORLPOLQSLPRNNUNNQOPSNOQMNRNNPNMRMOQNNNOMNNLOPLPNNOOJPMMOOKRTMPONQNNQOLOMLOMLOKPXNMPMOOMKNNMPNMY976eMMRNQOOMKLOMKLKMMNKMOIPRJPMJMNK,EEDEEDEEDEFEEEDEFEEEDEFEEFEDEEEFEEEEEFEEEFEFEEFEEFEDEEEFEEEEEFEEEEEEFFEFFFEEEFFFFEEEFFFEEEEFDEEEEFFEEEEEFEEFFPx0xXFEEDEFEEEDEFEEEDEFEEEDEEDEEDEFF,FFEFFEFEEFFEFEEFFEFFEFGDEFDEFDEFEEGEEFEEFEEFEEFEEFEEEEEFEEFFDFEEFFDFEEFFEFEEFEEFEEFFDFEEFEDFEEFEEFDEFEDFEEFFENGDFEEFEEFEEFEEFFEFEEEFEFEEEFDFEEFGE,AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&amp;chxt=x,y&amp;chxr=1,0,356.830000&amp;chxl=0:|+||08:00||+||12:00||+||16:00||+||20:00||+||00:00||+||04:00||&amp;chxs=0,505050,10,0,lt&amp;chg=4.17,25,1,2,0.69,0&amp;chxp=0,0.69,4.86,9.03,13.20,17.37,21.54,25.71,29.88,34.05,38.22,42.39,46.56,50.73,54.90,59.07,63.24,67.41,71.58,75.75,79.92,84.09,88.26,92.43,96.60&amp;tsstart=2010-11-09+05:50:00&amp;tsstep=600" alt="" width="370" height="180" />
</pre>
</blockquote>
<p>is harder to achieve. I&#8217;m leaving this up to you!</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/generating-google-line-charts-with-sql-part-ii/feed</wfw:commentRss>
		<slash:comments>2</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">3337</post-id>	</item>
		<item>
		<title>Generating Google line charts with SQL, part I</title>
		<link>https://shlomi-noach.github.io/blog/mysql/generating-google-line-charts-with-sql-part-i</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/generating-google-line-charts-with-sql-part-i#comments</comments>
				<pubDate>Tue, 01 Feb 2011 08:29:31 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Graphs]]></category>
		<category><![CDATA[mycheckpoint]]></category>
		<category><![CDATA[SQL]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=1468</guid>
				<description><![CDATA[In this series of posts I wish to show how Google Charts can be generated via SQL. We discuss the Google Charts limitations which must be challenged, and work towards a simple chart. I&#8217;m going to present the algorithm I use in mycheckpoint, a MySQL monitoring utility, which generates Google charts by raw data using [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>In this series of posts I wish to show how <a href="http://code.google.com/apis/chart/image_charts.html">Google Charts</a> can be generated via SQL. We discuss the Google Charts limitations which must be challenged, and work towards a simple chart.</p>
<p>I&#8217;m going to present the algorithm I use in <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a>, a MySQL monitoring utility, which generates Google charts by raw data using views. An example of such chart follows:</p>
<blockquote>
<pre><img class="alignnone" title="Sample Google Chart" src="http://chart.apis.google.com/chart?cht=lc&amp;chs=370x180&amp;chts=303030,12&amp;chtt=Latest+24+hours:+Nov+9,+05:50++-++Nov+10,+05:50&amp;chf=c,s,ffffff&amp;chdl=Rentals+rate:+custom_1_psec&amp;chdlp=b&amp;chco=ff8c00&amp;chd=s:GDGKGFLFGMJHRLMPPNULJRPLTOPRUMYPPVRNbQUSUSbSNWUOfSWTObVSUVWSVYVPbTPjfTbRTdXReUWhcTQRQZbTWYVYPaVZXdYYWPTabYUTbW99QLgLNIOIRNNMIKRJEHGFHGJGGFIFDFGDK&amp;chxt=x,y&amp;chxr=1,0,8.720000&amp;chxl=0:|+||08:00||+||12:00||+||16:00||+||20:00||+||00:00||+||04:00||&amp;chxs=0,505050,10,0,lt&amp;chg=4.17,25,1,2,0.69,0&amp;chxp=0,0.69,4.86,9.03,13.20,17.37,21.54,25.71,29.88,34.05,38.22,42.39,46.56,50.73,54.90,59.07,63.24,67.41,71.58,75.75,79.92,84.09,88.26,92.43,96.60&amp;tsstart=2010-11-09+05:50:00&amp;tsstep=600" alt="" width="370" height="180" />
http://chart.apis.google.com/chart?cht=lc&amp;chs=370x180&amp;chts=303030,12&amp;chtt=Latest+24+hours:+Nov+9,+05:50++-++Nov+10,+05:50&amp;chf=c,s,ffffff&amp;chdl=Rentals+rate:+custom_1_psec&amp;chdlp=b&amp;chco=ff8c00&amp;chd=s:GDGKGFLFGMJHRLMPPNULJRPLTOPRUMYPPVRNbQUSUSbSNWUOfSWTObVSUVWSVYVPbTPjfTbRTdXReUWhcTQRQZbTWYVYPaVZXdYYWPTabYUTbW99QLgLNIOIRNNMIKRJEHGFHGJGGFIFDFGDK&amp;chxt=x,y&amp;chxr=1,0,8.720000&amp;chxl=0:|+||08:00||+||12:00||+||16:00||+||20:00||+||00:00||+||04:00||&amp;chxs=0,505050,10,0,lt&amp;chg=4.17,25,1,2,0.69,0&amp;chxp=0,0.69,4.86,9.03,13.20,17.37,21.54,25.71,29.88,34.05,38.22,42.39,46.56,50.73,54.90,59.07,63.24,67.41,71.58,75.75,79.92,84.09,88.26,92.43,96.60&amp;tsstart=2010-11-09+05:50:00&amp;tsstep=600</pre>
</blockquote>
<p><em>mycheckpoint</em> does not actually call on Google to do the chart rendering, but invokes its own JavaScript code to visualize the URL locally.</p>
<p>Here are some downsides for using Google charts:</p>
<ul>
<li>The URL cannot be as long as you like. 2048 characters is an upper bound you&#8217;ll want to keep behind. <em>[Google charts POST method calls are available, which leads to 16K equivalent of URL length &#8212; this is still not too helpful due to the nature of POST calls]</em></li>
<li>Features are inconsistent. To specify label or tick positions, one must specify exact positions. To specify grid positions, one must supply with step, offset, etc. There are more such inconsistencies.</li>
<li>Google charts are not too friendly. Taking the ticks and grids example from above, there really shouldn&#8217;t be a reason why grids would not be automatically generated according to ticks definitions. But we are required to specify positions for the ticks as well as for the grids.</li>
<li>There is no support for time-series. One must translate time as x-axis values.</li>
<li>Perhaps most intimidating to many people: to generate a Google chart, once must send data to Google. Which is the main reason I used local JavaScript rendering.</li>
</ul>
<p>Anyway, let&#8217;s build a very simple chart. Since I will not cover everything in this post, we make for some relaxed conditions.<span id="more-1468"></span></p>
<h4>Sample data</h4>
<p>Consider the chart_data table, below:</p>
<blockquote>
<pre>SELECT * FROM chart_data;
+-----+---------------------+-------------------+
| id  | ts                  | data              |
+-----+---------------------+-------------------+
|   1 | 2011-02-01 09:59:15 |  1.99666833293656 |
|   2 | 2011-02-01 09:59:15 |  7.94677323180245 |
|   3 | 2011-02-01 09:59:15 |  17.7312123996804 |
|   4 | 2011-02-01 09:59:15 |   31.153467384692 |
|   5 | 2011-02-01 09:59:15 |  47.9425538604203 |
|   6 | 2011-02-01 09:59:15 |  67.7570968074042 |
|   7 | 2011-02-01 09:59:15 |  90.1904762132767 |
|   8 | 2011-02-01 09:59:15 |  114.776974543924 |
|   9 | 2011-02-01 09:59:15 |  140.998843732947 |
|  10 | 2011-02-01 09:59:15 |  168.294196961579 |
|  11 | 2011-02-01 09:59:15 |  196.065619213516 |
|  12 | 2011-02-01 09:59:15 |  223.689380632134 |
|  13 | 2011-02-01 09:59:15 |   250.52512820847 |
...</pre>
</blockquote>
<p>Find complete SQL script in <a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2011/02/google_charts.sql_.txt">google_charts.sql</a></p>
<p>In the above table we assume the timestamp values are evenly distributed. This is because of the aforementioned fact that Google Charts do not support time-series. So, if the given timnestamps are not evenly distributed, or maybe some values are skipped, we must manually compensate for that. In <em>mycheckpoint</em> I do that. In this blog post, we skip it.</p>
<h4>Axis boundaries</h4>
<p>By default, Google Charts expect data to lie within the range 0..100. We need to reset the scale to match our minimum/maximum values, and lay out our values within that range.</p>
<p>We will be using views in this solution, and here is the first view:</p>
<blockquote>
<pre>CREATE OR REPLACE VIEW
 chart_data_minmax
AS
 SELECT MIN(data) AS min_value, MAX(data) AS max_value
FROM
 chart_data
;</pre>
</blockquote>
<p>In our example we will just settle with the min/max values. In real worlds we may:</p>
<ul>
<li>Choose <strong>0</strong> to be the lower value, even if the minimal value is positive</li>
<li>Choose to round min-max values to a nearest power of <strong>10</strong>.</li>
</ul>
<p>The axis boundaries go under the following parameters:</p>
<ul>
<li><strong>chxt=x,y</strong> (we hard code bottom axis, left axis)</li>
<li><strong>chxr=1,<em>min</em>,<em>max</em></strong> (with min, max as computed by the above)</li>
</ul>
<p>The following query produces these params:</p>
<blockquote>
<pre>SELECT CONCAT('&amp;chxt=x,y&amp;chxr=1,', ROUND(min_value, 1), ',', ROUND(max_value, 1)) AS minmax FROM chart_data_minmax;
+---------------------------------+
| minmax                          |
+---------------------------------+
| &amp;chxt=x,y&amp;chxr=1,-4716.6,5340.0 |
+---------------------------------+
</pre>
</blockquote>
<h3>Data values</h3>
<p>Next, we have some <strong>244</strong> rows of data. Data is double. Can we be certain this all fits within <strong>2048</strong> characters? What if we had more rows?</p>
<p>Alas, we must make a trade-off. We will sacrifice accuracy in favor of a short URL. We will use <a href="http://code.google.com/apis/chart/docs/data_formats.html#simple">simple encoding</a> for our data. This means just one character per value, encoded <strong>A-Za-z0-9</strong>. This means just <strong>62</strong> distinct values.</p>
<p>So we must translate each data value into the range 0..61, and then into a character. First step is:</p>
<blockquote>
<pre>SELECT (data - min_value)/(max_value - min_value) AS range_01 FROM chart_data, chart_data_minmax;
+---------------------+
| range_01            |
+---------------------+
|   0.469204617275163 |
|   0.469796281944551 |
|   0.470769223945374 |
|   0.472103901937297 |
|   0.473773369865649 |
|   0.475743682188048 |
|   0.477974405550919 |
...
</pre>
</blockquote>
<p>The above translates the data into the 0..1 range. Next is to simply multiply by 61:</p>
<blockquote>
<pre>SELECT 61*(data - min_value)/(max_value - min_value) AS range_0_61 FROM chart_data, chart_data_minmax;
+-------------------+
| range_0_61        |
+-------------------+
|  28.6214816537849 |
|  28.6575731986176 |
|  28.7169226606678 |
|  28.7983380181751 |
|  28.9001755618046 |
|  29.0203646134709 |
|  29.1564387386061 |
|  29.3055730348683 |
|  29.4646269983728 |
|  29.6301923928522 |
...</pre>
</blockquote>
<p>To translate into a <em>simple format</em> character we parse a constant string:</p>
<blockquote>
<pre>SELECT
  SUBSTRING(
    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
    1+61*(data - min_value)/(max_value - min_value),
    1
  ) AS c FROM chart_data, chart_data_minmax;
+------+
| c    |
+------+
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| e    |
| e    |
...</pre>
</blockquote>
<p>Oh, and we should handle NULLs, as well, so:</p>
<blockquote>
<pre>SELECT
  IF(
    data IS NULL,
    '_',
    SUBSTRING(
      'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
      1+61*(data - min_value)/(max_value - min_value),
      1
    )
  ) AS c FROM chart_data, chart_data_minmax;
</pre>
<pre>+------+
| c    |
+------+
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| d    |
| e    |
| e    |
...</pre>
</blockquote>
<p>And, to present it as a char sequence, we use the <strong>chd</strong> parameter and call <strong>GROUP_CONCAT</strong> to the rescue:</p>
<blockquote>
<pre>SELECT
  CONCAT('&amp;chd=s:',
    GROUP_CONCAT(
      IF(
        data IS NULL,
        '_',
        SUBSTRING(
          'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR ''
    )
  ) AS c FROM chart_data, chart_data_minmax
\G
*************************** 1. row ***************************
c: &amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL</pre>
</blockquote>
<h4>Wrap up</h4>
<p>Combining the above two queries, with some URL necessities, we get:</p>
<blockquote>
<pre>SELECT
  CONCAT(
    'http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,',
    ROUND(min_value, 1), ',',
    ROUND(max_value, 1),
    '&amp;chd=s:',
    GROUP_CONCAT(
      IF(
        data IS NULL,
        '_',
        SUBSTRING(
          'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
          1+61*(data - min_value)/(max_value - min_value),
          1
        )
      )
      SEPARATOR ''
    )
  ) FROM chart_data, chart_data_minmax
;
</pre>
</blockquote>
<p>And get:</p>
<blockquote>
<pre><img class="alignnone" title="Sample SQL Google Chart" src="http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chtt=SQL%20chart&amp;chxt=x,y&amp;chxr=1,-4716.6,5340.0&amp;chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL" alt="" width="400" height="200" />
http://chart.apis.google.com/chart?cht=lc&chs=400x200&chtt=SQL%20chart&chxt=x,y&chxr=1,-4716.6,5340.0&chd=s:dddddddddeeeeeefffffffffeeeedddcccbbaaZZZYYYXXXXXXXXXYYYZZabbcdeefghhijkkllmmmmmmmmllkkjihgfedcbZYXWVUTSRRQQPPPPQQQRSTUVWXZacdfgijlmnpqrssttuuuttssrqonmkigfdbZXVTSQONMLKJIIIIIIJKLMOPRTVXZbegilnprtvwyz01111110zyxvtrpnkifcaXUSPNLJHFECBBAAABBCEFHJLNQTWZcfilortwy1346789999876420yvspmjfcYVSOL
</pre>
</blockquote>
<p>The above chart depicts our visualized data. Alas, x-axis ranges are wrong; no ticks nor grids are yet presented.</p>
<p>Granularity is not the best, either: the different <strong>62</strong> values are spread across a <strong>200</strong> pixel high chart, making for a <strong>3</strong> pixel distinction between two values, evident on the left area of the chart.</p>
<p>Continues on <a href="https://shlomi-noach.github.io/blog/mysql/generating-google-line-charts-with-sql-part-ii">Generating Google line charts with SQL, part II</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/generating-google-line-charts-with-sql-part-i/feed</wfw:commentRss>
		<slash:comments>3</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">1468</post-id>	</item>
		<item>
		<title>mycheckpoint (rev 208): aggregation tables, enhanced charting, RPM distribution</title>
		<link>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-rev-208-aggregation-tables-enhanced-charting-rpm-distribution</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-rev-208-aggregation-tables-enhanced-charting-rpm-distribution#comments</comments>
				<pubDate>Mon, 08 Nov 2010 10:45:45 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Monitoring]]></category>
		<category><![CDATA[mycheckpoint]]></category>
		<category><![CDATA[Open Source]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[scripts]]></category>
		<category><![CDATA[Web]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=3066</guid>
				<description><![CDATA[Revision 208 of mycheckpoint, a MySQL monitoring solution, has been released. New and updated in this revision: Aggregation tables: aggregated data makes for fast reports on previously slow queries. Enhanced charting: interactive charts now present time stamps dynamically (see demo); &#8220;Zoom in&#8221; charts are available (see demo) on mycheckpoint&#8216;s HTTP server. RPM distribution: a &#8220;noarch&#8221; [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>Revision <strong>208</strong> of <a href="../../forge/mycheckpoint">mycheckpoint</a>, a MySQL monitoring solution, has  been released. New and updated in this revision:</p>
<ul>
<li><strong>Aggregation tables</strong>: aggregated data makes for fast reports on previously slow queries.</li>
<li><strong>Enhanced charting</strong>: interactive charts now present time stamps dynamically (see <a href="http://mycheckpoint.googlecode.com/svn/trunk/doc/html/sample/http/mcp_sql00/sv_report_html_brief"><strong>demo</strong></a>); &#8220;Zoom in&#8221; charts are available (see <a href="http://mycheckpoint.googlecode.com/svn/trunk/doc/html/sample/http/mcp_sql00/zoom/questions"><strong>demo</strong></a>) on <em>mycheckpoint</em>&#8216;s HTTP server.</li>
<li><strong>RPM distribution</strong>: a &#8220;noarch&#8221; RPM <em>mycheckpoint</em> build is now available.</li>
<li>Initial work on formalizing test environment</li>
</ul>
<p><em>mycheckpoint</em> celebrates one year of existence!</p>
<h4>Aggregation tables</h4>
<p>I really wanted to avoid using these: everything was so more beautiful with one single dataset and dozens of supporting views (OK, the views themselves are hardly &#8220;beautiful&#8221;).</p>
<p>However it was impossible (for my level of expertise) to optimize query performance what with all those views on per-hour and per-day aggregation. The GROUP BYs and the JOINs did not make it possible for condition pushdown (i.e. using MERGE algorithm) where desired.</p>
<p>As result, mycheckpoint now manages aggregation tables: per-hour and per-day. The impact on sample taking is neglect able (making for two additional fast queries), but the impact on reading aggregated data is overwhelming. Generating a HTML full report could take a few minutes to complete. It now returns in no time. This makes charting more attractive, and allows for enhanced charting, such as zooming in on charts, as described following.</p>
<p>Aggregation tables will automatically be created and retroactively populated upon using revision 208. There&#8217;s nothing special to do; be advised that for one single execution of <em>mycheckpoint</em>, many INSERT queries are going to be executed. Shouldn&#8217;t take more than a couple minutes on commodity hardware and a few months of history.</p>
<p>It is possible to disable aggregation tables, or make for a complete rebuild of tables; by default, though, aggregation is ON.</p>
<h4>Enhanced charting</h4>
<p>Two enhancements here:<span id="more-3066"></span></p>
<ol>
<li>The interactive line charts already know how to update legend data as mouse hovers over them. Now they also present accurate date &amp; time. This provides with fully informative charts.</li>
<li>As with other monitoring tools, it is possible to &#8220;zoom in&#8221; on a chart: zooming in will present any chart in &#8220;last 24 hours&#8221;, &#8220;last 10 days&#8221; and &#8220;complete history&#8221; views, magnified on screen. See <a href="http://mycheckpoint.googlecode.com/svn/trunk/doc/html/sample/http/mcp_sql00/zoom/questions"><strong>demo</strong></a> here.</li>
</ol>
<h4>RPM distribution</h4>
<p>No excuse for this being so late, I know. But RPM distribution is now <a href="http://code.google.com/p/mycheckpoint/">available</a>. Yeepee!</p>
<p>This is a <em>noarch</em> distribution, courtesy of Python&#8217;s <a href="http://docs.python.org/distutils/">distutils</a>; you should be able to install the package on any RPM supporting platform. I have only tested in on CentOS; feedback is welcome.</p>
<h4>Future plans</h4>
<p>Work is going on. These are the non-scheduled future tasks I see:</p>
<ul>
<li>Monitoring InnoDB Plugin &amp; XtraDB status.</li>
<li>A proper <em>man</em> page.</li>
<li>Anything else that interests me &amp; the users.</li>
</ul>
<h4>Try it out</h4>
<p>Try out <em>mycheckpoint</em>. It’s a different kind of monitoring    solution. Simple monitoring (charting) is immediate. For more  interesting results you will need basic SQL skills, and in return you’ll  get a lot   of power under your hands.</p>
<ul>
<li>Download mycheckpoint <a href="https://code.google.com/p/mycheckpoint/">here</a></li>
<li>Visit the project’s <a href="../../forge/mycheckpoint">homepage</a></li>
<li>Browse the <a href="../../forge/mycheckpoint/documentation">documentation</a></li>
<li>Report <a href="https://code.google.com/p/mycheckpoint/issues/list">bugs</a></li>
</ul>
<p><em>mycheckpoint</em> is released under the <a href="http://www.opensource.org/licenses/bsd-license.php">New BSD  License</a>.</p>
<p>Umm, I&#8217;ll repeat this last one: <em>mycheckpoint</em> is released under the <a href="http://www.opensource.org/licenses/bsd-license.php">New BSD  License</a>. Still, and will continue to be. Thanks for the <a href="https://shlomi-noach.github.io/blog/mysql/openark-kit-facebook-online-schema-change-and-thoughts-on-open-source-licenses#comments">good advice</a> by Lenz, Domas and others.</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-rev-208-aggregation-tables-enhanced-charting-rpm-distribution/feed</wfw:commentRss>
		<slash:comments>5</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">3066</post-id>	</item>
		<item>
		<title>openark-kit, Facebook Online Schema Change, and thoughts on open source licenses</title>
		<link>https://shlomi-noach.github.io/blog/mysql/openark-kit-facebook-online-schema-change-and-thoughts-on-open-source-licenses</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/openark-kit-facebook-online-schema-change-and-thoughts-on-open-source-licenses#comments</comments>
				<pubDate>Thu, 16 Sep 2010 06:02:53 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[mycheckpoint]]></category>
		<category><![CDATA[Open Source]]></category>
		<category><![CDATA[openark kit]]></category>
		<category><![CDATA[Opinions]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=2947</guid>
				<description><![CDATA[MySQL@Facebook team have recently published an Online Schema Change code for non blocking ALTER TABLE operations. Thumbs Up! The code is derived from oak-online-alter-table, part of openark-kit, a toolkit I&#8217;m authoring. Looking at the documentation I can see many ideas were incorporated as well. And of course many things are different, a lot of work [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>MySQL@Facebook team have recently published an <a href="http://www.facebook.com/note.php?note_id=430801045932">Online Schema Change</a> code for non blocking ALTER TABLE operations. Thumbs Up!</p>
<p>The code is derived from <em>oak-online-alter-table</em>, part of <a href="http://code.openark.org/forge/openark-kit">openark-kit</a>, a toolkit I&#8217;m authoring. Looking at the documentation I can see many ideas were incorporated as well. And of course many things are different, a lot of work has been put to it by MySQL@Facebook.</p>
<p><em>openark-kit</em> is currently released under the new BSD license, and, as far as I can tell (I&#8217;m not a lawyer), Facebook&#8217;s work has followed the license to the letter. It is a strange thing to see your code incorporated into another project. While I knew work has begun on the tool by Facebook, I wasn&#8217;t in on it except for a few preliminary email exchanges.</p>
<h4>And this is the beauty</h4>
<p>You release code under open source license, and anyone can pick it up and continue working on it. One doesn&#8217;t have to ask or even let you know. Eventually one may release back to the community improved code, more tested (not many comments on <em>oak-online-alter-table</em> in the past <strong>18</strong> months).</p>
<p>It is a beauty, that you can freely use one&#8217;s patches, and he can then use yours.</p>
<h4>And here is my concern</h4>
<p>When I created both <em>openark-kit</em> and <em>mycheckpoint</em>, I licensed them under the BSD license. A very permissive license. <em>Let anyone do what they want with it</em>, I thought. However Facebook&#8217;s announcement suddenly hit me: what license would other people use for their derived work?</p>
<p>The OSC has been release under permissive license back to the community (again, I am not a lawyer). But, someone else could have made it less friendly. Perhaps not release the code at all: just sell it, closed-source, embedded in their product. And I found out that <em>I do not want anyone to do whatever they want with my code</em>.</p>
<h4>I want all derived work to <em>remain open</em>!</h4>
<p>Which is why in next releases of code I&#8217;m authoring the license will change to <em>less permissive</em> and <em>more open</em> license, such as GPL or LGPL. (Of course, all code released so far remains under the BSD license).</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/openark-kit-facebook-online-schema-change-and-thoughts-on-open-source-licenses/feed</wfw:commentRss>
		<slash:comments>20</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">2947</post-id>	</item>
		<item>
		<title>mycheckpoint (rev. 190): HTTP server; interactive charts</title>
		<link>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-rev-190-http-server-interactive-charts</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-rev-190-http-server-interactive-charts#comments</comments>
				<pubDate>Tue, 07 Sep 2010 05:53:01 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Monitoring]]></category>
		<category><![CDATA[mycheckpoint]]></category>
		<category><![CDATA[Open Source]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[scripts]]></category>
		<category><![CDATA[Web]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=2866</guid>
				<description><![CDATA[Revision 190 of mycheckpoint, a MySQL monitoring solution, has been released. New and updated in this revision: HTTP server: mycheckpoint can now act as a web server. Point your browser and start browsing through HTML reports. See mock up demo. Interactive charts: HTML line charts are now interactive, presenting with accurate data as you move [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>Revision <strong>190</strong> of <a href="../../forge/mycheckpoint">mycheckpoint</a>, a MySQL monitoring solution, has  been released. New and updated in this revision:</p>
<ul>
<li><strong>HTTP server</strong>: <em>mycheckpoint</em> can now act as a web server. Point your browser and start browsing through HTML reports. See mock up <a href="http://code.openark.org/forge/wp-content/uploads/2010/09/r190/mcp_sql00/sv_report_html_brief.html"><strong>demo</strong></a>.</li>
<li><strong>Interactive charts</strong>: HTML line charts are now interactive, presenting with accurate data as you move over them. See <a href="http://code.openark.org/forge/wp-content/uploads/2010/09/r190/mcp_sql00_samples/sv_report_html_brief.html"><strong>sample</strong></a>.</li>
<li><strong>Enhanced auto-deploy</strong>: now auto-recognizing failed upgrades.</li>
<li><strong>Reduced footprint</strong>: much code taken out of the views, leading to faster loading times.</li>
<li><strong>Better configuration file use</strong>: now supporting all command line options in config file.</li>
<li><strong>Remote host monitoring accessibility</strong>: now supporting complete configurable accessibility details.</li>
<li><strong>Bug fixes</strong>: thanks to the bug reporters!</li>
</ul>
<p><em>mycheckpoint</em> is free, simple, easy to use (now easier with HTTP server) and <strong>useful</strong>. I encourage you to try it out: even compared with other existing and emerging monitoring tools, I believe you will find it a breeze; it&#8217;s low impact and lightness appealing; it&#8217;s alerts mechanism assuring; its geeky SQL-based nature with ability to drill down to fine details &#8212; geeky-kind-of-attractive.</p>
<p>&lt;/encouragement&gt;</p>
<h4>HTTP server</h4>
<p>You can now run <em>mycheckpoint</em> in <em>http</em> mode:</p>
<blockquote>
<pre>bash$ <strong>mycheckpoint http</strong></pre>
</blockquote>
<p><em>mycheckpoint</em> will listen on port <strong>12306</strong>, and will present you with easy browsing through the reports of your <em>mycheckpoint</em> databases.<span id="more-2866"></span></p>
<p>The <em>http</em> server automatically detects those schemata used by mycheckpoint, and utilizes the existing HTML views, integrating them into the greater web framework.</p>
<p>While in <em>http</em> mode, mycheckpoint does nothing besides serving web pages. It does not actively exercise monitoring: you must still use the usual cron jobs or other scheduled tasks by which you invoke <em>mycheckpoint</em> for monitoring.</p>
<p>The http server is directed at a single MySQL server, as with the following example:</p>
<blockquote>
<pre>bash$ <strong>mycheckpoint --host=slave1.localdomain --port=3306 --http-port=12306 http</strong></pre>
</blockquote>
<p>It is assumed that this server has the monitoring schemata.</p>
<p>See mock up <a href="http://code.openark.org/forge/wp-content/uploads/2010/09/r190/mcp_sql00/sv_report_html_brief.html"><strong>demo</strong></a>. The demo uses presents with real output from a mycheckpoint HTTP server; I haven&#8217;t got the means to put up a live demo.</p>
<h4>Interactive charts</h4>
<p>The <em>openark line charts</em>, used in the HTML reports, are now interactive. As you scroll over, the legend presents you with series values.</p>
<p>No more <em>&#8220;I have this huge spike once every 4 hours, which reduces all other values to something that looks like zero but is actually NOT&#8221;</em>. Hover, and see the real values.</p>
<p>See <a href="http://code.openark.org/forge/wp-content/uploads/2010/09/r190/mcp_sql00_samples/sv_report_html_brief.html"><strong>sample</strong></a>.</p>
<h4>Enhanced auto-deploy</h4>
<p>The idea with mycheckpoint is that it should know how to self upgrade the schema on version upgrade (much like automatic WordPress upgrades). mycheckpoint does bookkeeping of installed versions within the database, and upgrades by simple comparison.</p>
<p>It now, following a couple of reported bugs, also recognizes failure of partial, failed upgrades. This adds to the automation of <em>mycheckpoint</em>&#8216;s installation.</p>
<h4>Reduced footprint</h4>
<p>Some of <em>mycheckpoint</em>&#8216;s views are complicated, and lead to a large amount of code in view declaration. This leads to increased table definition size (large <strong>.frm</strong> files). There has been some work to reduce this size where possible. Work is still ongoing, but some 30% has been taken off already. This leads to faster table (view) load time.</p>
<h4>Better configuration file use</h4>
<p>Any argument supported on the command line is now also supported in the config style. Much like is handled with MySQL. For example, one can issue:</p>
<blockquote>
<pre>mycheckpoint --monitored-host=sql02.mydb.com  --monitored-user=monitor --monitored-password=123456</pre>
</blockquote>
<p>But now also:</p>
<blockquote>
<pre>mycheckpoint</pre>
</blockquote>
<p>With the following in <strong>/etc/mycheckpoint.cnf</strong>:</p>
<blockquote>
<pre>[mycheckpoint]
monitored_host     = sql02.mydb.com
monitored_user     = monitor
monitored_password = 123456
</pre>
</blockquote>
<p>Rules are:</p>
<ul>
<li>If an option is specified on command line, it takes precedence over anything else.</li>
<li>Otherwise, if it&#8217;s specified in the configuration file, value is read from file.</li>
<li>Otherwise use default value is used.</li>
<li>On command line, option format is<strong> xxx-yyy-zzz</strong>: words split with dash/minus character.</li>
<li>On configuration file, option format is <strong>xxx_yyy_zzz</strong>: words split with underscore. Unlike MySQL configuration format, dashes cannot be used.</li>
<li>If an option is specified multiple times on configuration file &#8212; well &#8212; I have the answer, but I won&#8217;t tell. Just don&#8217;t do it. It&#8217;s bad for your health.</li>
</ul>
<h4>Future plans</h4>
<p>Work is going on. These are the non-scheduled future tasks I see:</p>
<ul>
<li>Monitoring InnoDB Plugin &amp; XtraDB status.</li>
<li>A proper <em>man</em> page.</li>
<li>Anything else that interests me &amp; the users.</li>
</ul>
<h4>Try it out</h4>
<p>Try out <em>mycheckpoint</em>. It’s a different kind of monitoring   solution. Simple monitoring (charting) is immediate. For more interesting results you will need basic SQL skills, and in return you’ll get a lot   of power under your hands.</p>
<ul>
<li>Download mycheckpoint <a href="https://code.google.com/p/mycheckpoint/">here</a></li>
<li>Visit the project’s <a href="../../forge/mycheckpoint">homepage</a></li>
<li>Browse the <a href="../../forge/mycheckpoint/documentation">documentation</a></li>
<li>Report <a href="https://code.google.com/p/mycheckpoint/issues/list">bugs</a></li>
</ul>
<p><em>mycheckpoint</em> is released under the <a href="http://www.opensource.org/licenses/bsd-license.php">New BSD  License</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-rev-190-http-server-interactive-charts/feed</wfw:commentRss>
		<slash:comments>1</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">2866</post-id>	</item>
		<item>
		<title>mycheckpoint (rev. 170): improved custom queries; local charting; page/swap I/O monitoring; improved HTML reports</title>
		<link>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-rev-170-improved-custom-queries-local-charting-pageswap-io-monitoring-improved-html-reports</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-rev-170-improved-custom-queries-local-charting-pageswap-io-monitoring-improved-html-reports#comments</comments>
				<pubDate>Fri, 16 Jul 2010 08:58:40 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Graphs]]></category>
		<category><![CDATA[Linux]]></category>
		<category><![CDATA[Monitoring]]></category>
		<category><![CDATA[mycheckpoint]]></category>
		<category><![CDATA[Open Source]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=2650</guid>
				<description><![CDATA[Revision 170 of mycheckpoint, a MySQL monitoring solution, has been released. New and updated in this revision: Improved custom queries: lifting of limitations from previous, introductory revision; better HTML presentation Local, inline charting: no rendering of Google Charts, unless explicitly requested. All charts are now rendered locally using JavaScript. No data is now sent over [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>Revision <strong>170</strong> of <a href="../../forge/mycheckpoint">mycheckpoint</a>, a MySQL monitoring solution, has  been released. New and updated in this revision:</p>
<ul>
<li><strong>Improved custom queries</strong>: lifting of limitations from previous, introductory revision; better HTML presentation</li>
<li><strong>Local, inline charting</strong>: no rendering of Google Charts, unless explicitly requested. All charts are now rendered locally using JavaScript. No data is now sent over the network.</li>
<li><strong>Page/Swap I/O monitoring</strong>: now monitoring for page ins and outs, swap ins and outs (Linux only).</li>
<li><strong>Improved HTML reports</strong>: several improvements on presentation (see <a href="http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-brief-169.html">sample</a>, more follow).</li>
</ul>
<h4>Improved custom queries</h4>
<p>Some limitations, introduced in revision <strong>132</strong>, are now lifted. New features are introduced.</p>
<ul>
<li>There is now no limit to the number of custom queries (well, an INT limit).</li>
<li>In fact, the data tables adjust themselves to the existing custom queries in the form of auto-deploy: once a new <a href="http://code.openark.org/forge/mycheckpoint/documentation/custom-monitoring">custom query is added</a> or an old one removed, mycheckpoint will add or remove the relevant columns from the data tables.</li>
<li>The <strong>chart_order</strong> column is now utilized: HTML reports which include custom query charts now order those charts according to <strong>chart_order</strong> values. This makes for nicer reports.</li>
<li>The standard <a href="http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-brief-169.html">HTML brief report</a> (<strong>SELECT html FROM sv_report_html_brief</strong>) now automatically includes all custom charts. The HTML brief report is the report one usually wants to look at: it provides with the latest 24 hours metrics for selected values. It now becomes a centralized place for all that is interesting in the past 24 hours.</li>
<li>Custom queries are now allowed to return <strong>NULL</strong>, treated as a missing value. This is a bugfix from previous revisions.</li>
</ul>
<h4>Local charting</h4>
<p>Motivation for local charting is clear: no one likes having their data being sent over the network. And no one likes Google to know about their DML values.</p>
<p>I&#8217;ve been playing around with quite a few charting solutions, and have gone into depths with two of them, adding and rewriting quite a lot of code. Eventually, I settled on my very own rendering. Here&#8217;s what I&#8217;ve seen &amp; tested:<span id="more-2650"></span></p>
<ul>
<li><a href="http://danvk.org/dygraphs/">dygraphs</a>: a very nice time series charting library. I&#8217;ve presented a use case on <a href="https://shlomi-noach.github.io/blog/mysql/static-charts-vs-interactive-charts">a previous post</a>.
<ul>
<li>Pros: slick, easy to work with.</li>
<li>Cons: uses HTML Canvas for rendering. This is fine on Firefox, Chrome, Safari, you name it. This isn&#8217;t fine on IE, which does not support Canvas. There&#8217;s <a href="http://excanvas.sourceforge.net/">ExplorerCanvas</a>, a hack tool which converts canvas to IE&#8217;s VML, but it is far from being satisfactory: it is <em>sloooow</em>. Very, very slow. It is slow with one chart; but loading of 21 charts, as I do in some of <em>mycheckpoint</em>&#8216;s reports can take <em>long minutes</em> on Internet explorer.</li>
<li>Cons: Only provides with a time series chart. No scatter plots.</li>
</ul>
</li>
<li>Because they&#8217;re using ExplorerCanvas for IE, <a href="http://code.google.com/p/flot/">flot</a>, <a href="http://www.jqplot.com/">jqPlot</a> etc., are all unacceptable.</li>
<li><a href="http://g.raphaeljs.com/">gRaphael</a>: very slick charts based on Raphael. The original line charts are very basic, and I have invested a lot of time rewriting a great deal (you can find it all <a href="http://code.google.com/p/mycheckpoint/source/browse/#svn/trunk/graphael">here</a>). Raphael uses VML on IE, and SVG for all other browsers.
<ul>
<li>Pros: very slick. Supports various chart types, including line (though not time-series) and scatter.</li>
<li>Cons: <em>slooooooooow</em> when instantiating multiple charts. Unbearably slow, both on Firefox and IE. Slow as in minutes of waiting.</li>
</ul>
</li>
</ul>
<p>In addition, all of the above solutions were quite heavyweight: at about 45KB to start with, then add ExplorerCanvas or jQuery, or Raphael as supporting libraries, these became a real burden.</p>
<p>So, I had some time to spare (business is fine, thank you. I was a bit Ill. I&#8217;m feeling well now, thank you), and was upset what with all the time I invested in the above coding. And I decided to invest even more time, and build <em>my own</em> charts.</p>
<p>Enter <em>openark-charts</em>.</p>
<blockquote>
<pre><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2010/07/mycheckpoint-report-html-screenshot.png"><img class="alignnone size-full wp-image-2662" title="mycheckpoint-report-html-screenshot" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2010/07/mycheckpoint-report-html-screenshot.png" alt="" width="808" height="307" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2010/07/mycheckpoint-report-html-screenshot.png 808w, https://shlomi-noach.github.io/blog/wp-content/uploads/2010/07/mycheckpoint-report-html-screenshot-300x113.png 300w" sizes="(max-width: 808px) 100vw, 808px" /></a>

<a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2010/07/mycheckpoint-24-7-report-html-screenshot.png"><img class="alignnone size-full wp-image-2663" title="mycheckpoint-24-7-report-html-screenshot" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2010/07/mycheckpoint-24-7-report-html-screenshot.png" alt="" width="808" height="267" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2010/07/mycheckpoint-24-7-report-html-screenshot.png 808w, https://shlomi-noach.github.io/blog/wp-content/uploads/2010/07/mycheckpoint-24-7-report-html-screenshot-300x99.png 300w" sizes="(max-width: 808px) 100vw, 808px" /></a></pre>
</blockquote>
<p>Currently, these line charts and scatter charts know how to parse a Google Image chart URL (only some features supported &#8212; only those I&#8217;m actually using with <em>mycheckpoint</em>). These are not full blown solutions: they come to serve mycheckpoint. And they do so nicely, if I may say so. Using Canvas for most browsers, or VML for IE, these very small pieces of code (10K for line chart, 6K for scatter chart, minified) load fast, use very little memory, and do their work well.</p>
<p>Granted, neither provides with interactive features: this is planned for the future.</p>
<h4>Page/swap I/O monitoring</h4>
<p>(Linux only) <em>mycheckpoint</em> now reads <strong>/proc/vmstat</strong> to get the <em>pageins</em>, <em>pageouts</em>, <em>swapins</em> and <em>swapouts</em> (since last reboot). I was actually looking at completely different places on the <strong>/proc</strong> file system to get swap info, and was frustrated with the complexity involved, till I bumped on <strong>/proc/vmstat</strong>&#8230; New tricks every day!</p>
<h4>Improved HTML reports</h4>
<p>This is mostly HTML make-up. Some minimal design, some more details thrown into the HTML pages (name of DB, MySQL version, <em>mycheckpoint</em> version). A little more verbosity; all sorts of stuff which was neglected so far.</p>
<p>Here are some <span style="text-decoration: line-through;"><strong>show off</strong></span> examples of the new HTML views: <a href="http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-full-169.html">[full report]</a>, <a href="http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-brief-169.html">[brief report]</a>, <a href="http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-24-7-169.html">[24/7 report]</a>, <a href="http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-custom-full-169.html">[custom full report]</a>, <a href="http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-report-custom-brief-169.html">[custom brief report]</a>, <a href="http://code.openark.org/forge/wp-content/uploads/2010/07/mycheckpoint-alert-pending-169.html">[alert pending report]</a>.</p>
<p>All HTML views now utilize the new <em>openark-charts</em>, and none renders charts with Google charts. This means when you <a href="http://code.openark.org/forge/mycheckpoint/documentation/generating-html-reports">use your HTML view</a>, your data is safe. No data is sent over the net. All charts are rendered using Javascript, which is loaded and executed locally.</p>
<p>But if you like, there&#8217;s a [url] link next to each chart, which leads to a (online) Google chart image. Why? Because neither HTML Canvas nor VML allow for a complete rendering of the charts to an image. So this is a way for one to retrieve &amp; store a chart&#8217;s image. Don&#8217;t use it if you see no reason for it; it&#8217;s just there.</p>
<p>And I even threw in rounded corners (IE users: only as of Windows 7).</p>
<h4>Future plans</h4>
<p>Work is going on. These are the non-scheduled future tasks I see:</p>
<ul>
<li>Monitoring InnoDB Plugin &amp; XtraDB status.</li>
<li>Interactive charts. See my <a href="../mysql/static-charts-vs-interactive-charts">earlier  post</a>.</li>
<li>A proper <em>man</em> page.</li>
<li>Anything else that interests me.</li>
</ul>
<h4>Try it out</h4>
<p>Try out <em>mycheckpoint</em>. It’s a different kind of monitoring  solution. You will need basic SQL skills, and in return you’ll get a lot  of power under your hands.</p>
<ul>
<li>Download mycheckpoint <a href="https://code.google.com/p/mycheckpoint/">here</a></li>
<li>Visit the project’s <a href="../../forge/mycheckpoint">homepage</a></li>
<li>Browse the <a href="../../forge/mycheckpoint/documentation">documentation</a></li>
<li>Report <a href="https://code.google.com/p/mycheckpoint/issues/list">bugs</a></li>
</ul>
<p><em>mycheckpoint</em> is released under the <a href="http://www.opensource.org/licenses/bsd-license.php">New BSD  License</a>.</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/mycheckpoint-rev-170-improved-custom-queries-local-charting-pageswap-io-monitoring-improved-html-reports/feed</wfw:commentRss>
		<slash:comments>3</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">2650</post-id>	</item>
	</channel>
</rss>
