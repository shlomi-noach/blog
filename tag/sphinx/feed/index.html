<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	
	xmlns:georss="http://www.georss.org/georss"
	xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
	>

<channel>
	<title>Sphinx &#8211; code.openark.org</title>
	<atom:link href="https://shlomi-noach.github.io/blog/tag/sphinx/feed" rel="self" type="application/rss+xml" />
	<link>http://shlomi-noach.github.io/blog/</link>
	<description>Blog by Shlomi Noach</description>
	<lastBuildDate>Tue, 03 Apr 2012 11:05:42 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.3.3</generator>
<site xmlns="com-wordpress:feed-additions:1">32412571</site>	<item>
		<title>Thoughts on using MySQL plugins</title>
		<link>https://shlomi-noach.github.io/blog/mysql/thoughts-on-using-mysql-plugins</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/thoughts-on-using-mysql-plugins#comments</comments>
				<pubDate>Tue, 03 Apr 2012 11:05:42 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Opinions]]></category>
		<category><![CDATA[plugin]]></category>
		<category><![CDATA[Sphinx]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4769</guid>
				<description><![CDATA[I&#8217;m giving thoughts on the viability of MySQL plugins. This is due to a particular experience I&#8217;ve had, which is thankfully solved. However, it left some bitter taste in my mouth. MySQL plugins are a tricky business. To create a plugin, you must compile it against the MySQL version you wish the users to use [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>I&#8217;m giving thoughts on the viability of MySQL plugins. This is due to a particular experience I&#8217;ve had, which is thankfully solved. However, it left some bitter taste in my mouth.</p>
<p>MySQL plugins are a tricky business. To create a plugin, you must compile it against the MySQL version you wish the users to use it with. Theoretically, you should compile it against any existing MySQL version, minors as well (I&#8217;m not sure whether it may sometimes or most times work across minor versions).</p>
<p>But, most important, you must adapt your plugin to major versions.</p>
<p>Another option for plugin makers, is to actually <em>not</em> recompile it, but rather provide with the source code, and let the end user compile it with her own MySQL version. But here, too, the code must be compatible with whatever changes the new MySQL version may have.</p>
<h4>And if it doesn&#8217;t compile with the new MySQL version?</h4>
<p>That&#8217;s what happened to me. The particular case at hand was SphinxSE, a plugin which serves as a bridge between MySQL and a <a href="http://sphinxsearch.com/">Sphinx Search</a> server. I&#8217;ve been using it for years and was happy about it. But, as it happened, it took well over a year for sphinx to compile with MySQL <strong>5,5</strong>. This meant I was unable to upgrade my <strong>5.1</strong> installation to <strong>5.5</strong>, a thing I was aiming to do for quite a while.<span id="more-4769"></span></p>
<p>Even when fixed, not all features were included, and thankfully I was able to come up with <a href="https://shlomi-noach.github.io/blog/mysql/sphinx-sphinx_snippets-mysql-5-5">my own patch</a>.</p>
<p>Not complaining about this particular project &#8212; I think Sphinx is <em>awesome</em>, with latest versions providing great features I&#8217;m putting into immediate use.</p>
<p>However, how much am I willing to rely on 3rd party projects when planning my MySQL upgrades? I&#8217;m now thinking I shouldn&#8217;t.</p>
<h4>A central repository?</h4>
<p>MariaDB does a great thing: it provides with several <a href="http://kb.askmonty.org/en/mariadb-versus-mysql-features">additional features</a> over standard MySQL, including a set of plugins. They turn into a debian-like repository, in which they maintain the plugins for their own distribution.</p>
<p>[<em>Darn!</em> I just realized I should have looked at what they did with Sphinx in their <strong>5.5</strong> distribution! Need to do my monthly mental examination.]</p>
<p>Anyway, this is something I would like to see outside MariaDB as well: a central repository where plugins are maintained and kept up to the latest releases.</p>
<p>Thoughts, anyone?</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/thoughts-on-using-mysql-plugins/feed</wfw:commentRss>
		<slash:comments>5</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">4769</post-id>	</item>
		<item>
		<title>sphinx, sphinx_snippets() &#038; MySQL 5.5</title>
		<link>https://shlomi-noach.github.io/blog/mysql/sphinx-sphinx_snippets-mysql-5-5</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/sphinx-sphinx_snippets-mysql-5-5#comments</comments>
				<pubDate>Wed, 21 Mar 2012 13:57:59 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Development]]></category>
		<category><![CDATA[Open Source]]></category>
		<category><![CDATA[Sphinx]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4775</guid>
				<description><![CDATA[I&#8217;ve written a patch which completes Sphinx&#8217;s integration with MySQL 5.5. Up until a couple months ago, Sphinx would not compile with MySQL 5.5 at all. This is, thankfully, resolved as of Sphinx 2.0.3. However, to my disdain, I&#8217;ve found out that it only partially work: the sphinx_snippets() user defined function is not included within [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>I&#8217;ve written a patch which completes Sphinx&#8217;s integration with MySQL <strong>5.5</strong>.</p>
<p>Up until a couple months ago, Sphinx would not compile with MySQL <strong>5.5</strong> at all. This is, thankfully, resolved as of Sphinx <strong>2.0.3</strong>.</p>
<p>However, to my disdain, I&#8217;ve found out that it only partially work: the <a href="http://sphinxsearch.com/docs/manual-2.0.4.html#sphinxse-snippets">sphinx_snippets()</a> user defined function is not included within the plugin library. After some quick poking I discovered that it was not added to the build, and when added, would not compile.</p>
<p>I rely on <strong>sphinx_snippets()</strong> quite a lot, and like it. Eventually I wrote the fix to the <strong>snippets_udf.cc</strong> which allows it to run in a MySQL <strong>5.5</strong> server.</p>
<p>Here are the changes for the <strong>2.0.4</strong> version of Sphinx:</p>
<ul>
<li><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2012/03/snippets_udf.cc">snippets_udf.cc</a></li>
<li><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2012/03/CMakeLists.txt">CMakeLists.txt</a></li>
</ul>
<p>Replace your <strong>2.0.4</strong> files with these two and get on compiling your MySQL server.</p>
<h4>Compilation guide</h4>
<p>For completeness, here&#8217;s how to compile Percona Server <strong>5.5</strong> with Sphinx <strong>2.0.4</strong> including the above patches:<span id="more-4775"></span></p>
<p>Get <a href="http://www.percona.com/downloads/Percona-Server-5.5/LATEST/">Percona Server source code</a> and <a href="http://sphinxsearch.com/downloads/release/">Sphinx Search source code</a>.</p>
<p>I&#8217;ll be using Percona Server <strong>5.5.21-25.0</strong>. I use <strong>/data/tmp/mysql</strong> as compilation path, and install MySQL on <strong>/usr/local/mysql55</strong>.</p>
<blockquote>
<pre>mkdir -p /data/tmp/mysql
cd /data/tmp/mysql
tar xzfv Percona-Server-5.5.21-rel25.0.tar.gz
tar xzfv sphinx-2.0.4-release.tar.gz
cd Percona-Server-5.5.21-rel25.0/
cp -R /data/tmp/mysql/sphinx-2.0.4-release/mysqlse storage/sphinx</pre>
</blockquote>
<p>Overwrite with patched files included in this post:</p>
<blockquote>
<pre>cp /tmp/CMakeLists.txt storage/sphinx/CMakeLists.txt
cp /tmp/snippets_udf.cc storage/sphinx/snippets_udf.cc</pre>
</blockquote>
<p>Build MySQL:</p>
<blockquote>
<pre>sh BUILD/autorun.sh
./configure --with-plugin-sphinx --prefix=/usr/local/mysql55
make
sudo make install</pre>
</blockquote>
<p>Install the mysql55 service:</p>
<blockquote>
<pre>cd /usr/local/mysql55
sudo cp support-files/mysql.server /etc/init.d/mysql55</pre>
</blockquote>
<p>In <strong>/etc/bash.bashrc</strong>, add:</p>
<blockquote>
<pre>export PATH=/usr/local/mysql55/bin:${PATH}</pre>
</blockquote>
<p>Start MySQL:</p>
<blockquote>
<pre>sudo service mysql55 start</pre>
</blockquote>
<p>Login to MySQL as an administrato (typically <strong>root</strong>) and install Sphinx:</p>
<blockquote>
<pre>mysql&gt; INSTALL PLUGIN sphinx SONAME 'ha_sphinx.so';
mysql&gt; CREATE FUNCTION sphinx_snippets RETURNS STRING SONAME 'ha_sphinx.so';</pre>
</blockquote>
<h4>Notes</h4>
<p>See also <a href="http://sphinxsearch.com/bugs/view.php?id=1090">http://sphinxsearch.com/bugs/view.php?id=1090</a> and <a href="http://sphinxsearch.com/forum/view.html?id=8982">http://sphinxsearch.com/forum/view.html?id=8982</a></p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/sphinx-sphinx_snippets-mysql-5-5/feed</wfw:commentRss>
		<slash:comments>8</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">4775</post-id>	</item>
		<item>
		<title>Sphinx &#038; MySQL: facts and misconceptions</title>
		<link>https://shlomi-noach.github.io/blog/mysql/sphinx-mysql-facts-and-misconceptions</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/sphinx-mysql-facts-and-misconceptions#comments</comments>
				<pubDate>Thu, 02 Sep 2010 08:56:15 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Open Source]]></category>
		<category><![CDATA[Sphinx]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=2754</guid>
				<description><![CDATA[Sphinx search is a full text search engine, commonly used with MySQL. There are some misconceptions about Sphinx and its usage. Following is a list of some of Sphinx&#8217; properties, hoping to answer some common questions. Sphinx is not part of MySQL/Oracle. It is a standalone server; an external application to MySQL. Actually, it is [&#8230;]]]></description>
								<content:encoded><![CDATA[<p><a href="http://www.sphinxsearch.com/">Sphinx search</a> is a full text search engine, commonly used with MySQL.</p>
<p>There are some misconceptions about Sphinx and its usage. Following is a list of some of Sphinx&#8217; properties, hoping to answer some common questions.</p>
<ul>
<li>Sphinx is not part of MySQL/Oracle.</li>
<li>It is a standalone server; an external application to MySQL.</li>
<li>Actually, it is not MySQL specific. It can work with other RDBMS: PostgreSQL, MS SQL Server.</li>
<li>And, although described as &#8220;free open-source SQL full-text search engine&#8221;, it is not SQL-specific: Sphinx can read documents from XML.</li>
<li>It is often described as &#8220;full text search for InnoDB&#8221;. This description  is misleading. Sphinx indexes text; be it from any storage engine or  external source. It solves, in a way, the issue of &#8220;FULLTEXT is only  supported by MyISAM&#8221;. Essentially, it provided full-text indexing for InnoDB tables, but in a <em>very</em> different way than the way MyISAM&#8217;s <strong>FULLTEXT</strong> index works.</li>
</ul>
<p>Sphinx works by reading documents, usually from databases. Considering the case of MySQL, Sphinx issues a SQL query which retrieves relevant data (mostly the text you want to index, but other properties allowed).<span id="more-2754"></span></p>
<ul>
<li>Being an external module, it does not update its indexes on the fly. So  if <strong>10</strong> new rows are <strong>INSERT</strong>ed, it has no knowledge of this. It must be  called externally to re-read the data (or just read the new data), and re-index.
<ul>
<li>This is perhaps the greatest difference, functionality-wise, between Sphinx and MyISAM&#8217;s <strong>FULLTEXT</strong>. The latter is always updated, for every row <strong>INSERT</strong>ed, <strong>DELETE</strong>d or <strong>UPDATE</strong>d. The latter also suffers by this property, as this makes for serious overhead with large volumes.</li>
<li>There&#8217;s more than one way to make that less of an issue. I&#8217;ll write some more in future posts.</li>
</ul>
</li>
<li>Sphinx does not keep the text to itself; just the index. Sphinx cannot be asked &#8220;Give me the blog post content for those posts containing &#8216;open source'&#8221;.
<ul>
<li>Sphinx will only tell you the ID (i.e. Primary Key) for the row that matches your search.</li>
<li>It is up to you to then get the content from the table.</li>
<li>With SphinxSE (Sphinx Storage Engine for MySQL) this becomes easier, all-in-one query.</li>
</ul>
</li>
<li>It can keep other numeric data. Such data can be used to filter results.</li>
<li>It provides with <strong>GROUP BY</strong>-like, as well as <strong>ORDER BY</strong>-like mechanism.</li>
<li>It allows for ordering results by relevance.</li>
<li>It allows for exact match search, boolean search, and more.</li>
<li>It has an API &amp; implementation for popular programming languages: PHP, Python, Perl, Ruby, Java.</li>
</ul>
<p>The above describes Sphinx as a general fulltext search engine for databases. It does, however, have special treatment for MySQL:</p>
<ul>
<li>First and foremost, it knows how to query MySQL for data (duh!)</li>
<li>If you don&#8217;t mind compiling from source, you can rebuild MySQL with <a href="http://www.sphinxsearch.com/docs/current.html#sphinxse">SphinxSE</a>: a storage engine implementation. This storage engine does not actually hold any data, but rather provides an SQL-like interface to the search daemon.
<ul>
<li>Thus, you can query for search results using <strong>SELECT</strong> statements, <strong>JOIN</strong>ing to document tables, retrieving results, all in one step.</li>
<li>If you do mind compiling MySQL, be aware that MariaDB <a href="http://askmonty.org/wiki/MariaDB_versus_MySQL">comes with SphinxSE</a> built in in newer versions.</li>
</ul>
</li>
<li>It implements the MySQL protocol. You can connect to the sphinx server using a MySQL client, and actually issue SQL statements to retrieve data. Not all SQL is supported. The valid subset is called <a href="http://www.sphinxsearch.com/docs/current.html#sphinxql">SphinxQL</a>.</li>
<li>Snippets (excerpts) are <a href="http://www.sphinxsearch.com/docs/current.html#sphinxse-snippets">supported</a> via MySQL UDF.</li>
</ul>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/sphinx-mysql-facts-and-misconceptions/feed</wfw:commentRss>
		<slash:comments>12</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">2754</post-id>	</item>
		<item>
		<title>SphinxSE 0.9.9-RC2 bug workaround</title>
		<link>https://shlomi-noach.github.io/blog/mysql/sphinxse-0-9-9-rc2-bug-workaround</link>
				<comments>https://shlomi-noach.github.io/blog/mysql/sphinxse-0-9-9-rc2-bug-workaround#respond</comments>
				<pubDate>Mon, 07 Sep 2009 08:23:21 +0000</pubDate>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
				<category><![CDATA[MySQL]]></category>
		<category><![CDATA[Installation]]></category>
		<category><![CDATA[Sphinx]]></category>

		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=1245</guid>
				<description><![CDATA[There is a serious bug with the sphinx storage engine, introduced in 0.9.9-RC2 (and which has not been fixed in latest revisions, as yet &#8211; last checked with rev 2006). I would usually just revert to an older version (0.9.9-RC1 does not contain this bug), but for the reason that RC2 introduces an important feature: [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>There is a serious bug with the sphinx storage engine, introduced in 0.9.9-RC2 (and which has not been fixed in latest revisions, as yet &#8211; last checked with rev 2006).</p>
<p>I would usually just revert to an older version (0.9.9-RC1 does not contain this bug), but for the reason that RC2 introduces an important feature: the <strong>sphinx_snippets()</strong> function, which allows for creation of snippets from within MySQL, and which makes the sphinx integration with MySQL complete, as far as the application is concerned.</p>
<h4>The bug</h4>
<p>The bug is described <a href="http://sphinxsearch.com/forum/view.html?id=3589">here</a> and <a href="http://sphinxsearch.com/forum/view.html?id=4081">here</a> (and see further discussions). Though it&#8217;s claimed to have been fixed, it&#8217;s been re-reported, and I&#8217;ve tried quite a few revisions and verified it has not been fixed (tested on Debian/Ubuntu x64).  <span>Essentially, the bug does not allow you to set filters on a query issued from within the SphinxSE. For example, the following queries fail:</span></p>
<blockquote>
<pre>SELECT ... FROM ... WHERE query='python;mode=any;sort=relevance;limit=200;range=myUnixTimestamp,1249506000,1252184400;'
SELECT ... FROM ... WHERE query='python;mode=any;sort=relevance;limit=200;filter=my_field,1;'</pre>
</blockquote>
<p>While the following query succeeds:</p>
<blockquote>
<pre>SELECT ... FROM ... WHERE query='python;mode=any;sort=relevance;limit=200;'</pre>
</blockquote>
<p>The error message is this:</p>
<blockquote>
<pre><span>ERROR 1430 (HY000): There was a problem processing the query on the foreign data source. Data source error: searchd error: invalid or truncated request</span></pre>
</blockquote>
<p><span>I see this as a serious bug in the SphinxSE: it renders it useless; searching without the ability to filter is not something I can live with.<span id="more-1245"></span></span></p>
<h4><span>The motivation</span></h4>
<p><span>Sphinx does not store the actual text content. To get search results with snippets, you need to:</span></p>
<ul>
<li><span>Ask sphinx for the documents ids</span></li>
<li><span>Get the content for those documents</span></li>
<li><span>Ask sphinx for snippets based on the provided content and search phrase.</span></li>
</ul>
<p>With the introduction of the <strong>sphinx_snippets()</strong> function, this can all be done with a single query, like this:</p>
<blockquote>
<pre>SELECT my_docs.my_docs_id,  my_docs.publish_time,  CONVERT(sphinx_snippets(my_docs.id.content, 'my_docs_index', 'python') USING utf8) AS snippet  FROM tets.my_docs INNER JOIN test.my_docs_sphinx USING(my_docs_id) WHERE query='python;mode=any;sort=relevance;limit=200;range=publish_time_unix,1249506000,1252184400;';</pre>
</blockquote>
<p><span>This is really a life saver; without this function, you need to get the resutls back to your application, then send the data again to MySQL, in which case you might altogether discard the SphinxSE and talk to sphinx directly. But with a single query you get to ask the results just as if you were asking for any result set from your database (with extra syntax).</span></p>
<h4><span>The workaround</span></h4>
<p><span>My setup is Percona&#8217;s </span><strong>mysql-5.1.34-xtradb5</strong> source, on Ubuntu server <strong>8.04 amd64</strong>. The trick is to first compile MySQL with sphinx <strong>0.9.9-RC2</strong>, in order to produce the <strong>sphinx.so</strong> file (where the <strong>sphinx_snippets()</strong> function is found), backup the <strong>sphinx.so</strong> file, then recompile everything with <strong>sphinx 0.9.9-RC1</strong>. The steps being:</p>
<p>Compile MySQL with sphinx <strong>0.9.9-Rc2</strong> (I choose to install MySQL on <strong>/usr/local/mysql51</strong>):</p>
<blockquote>
<pre>tar xzfv mysql-5.1.34-xtradb5.tar.gz
cd mysql-5.1.34-xtradb5
cp -R /tmp/resources/sphinx-0.9.9-rc2/mysqlse storage/sphinx
sh BUILD/autorun.sh
./configure --with-plugins=innobase,sphinx --prefix=/usr/local/mysql51
make</pre>
</blockquote>
<p>This produces the <strong>sphinx.so</strong>, <strong>sphinx.so.0</strong>, <strong>sphinx.so.0.0.0</strong> files. Back them up!</p>
<p>Next, recompile with sphinx <strong>0.9.9-RC1</strong>. I&#8217;ve found that simple copying and recompiling doesn&#8217;t work well. So just cleanup everything and start afresh:</p>
<blockquote>
<pre>cd ..
rm -rf mysql-5.1.34-xtradb5
tar xzfv mysql-5.1.34-xtradb5.tar.gz
cd mysql-5.1.34-xtradb5
cp -R /tmp/resources/sphinx-0.9.9-rc1/mysqlse storage/sphinx
sh BUILD/autorun.sh
./configure --with-plugins=innobase,sphinx --prefix=/usr/local/mysql51
make
sudo make install</pre>
</blockquote>
<p>Copy the <strong>sphinx.so</strong> files into the MySQL plugin directory (<strong>/usr/local/mysql51/lib/mysql/plugin</strong> in our case).</p>
<p>Then build sphinx (you must have MySQL includes for sphinx to compile, so this must be the second step):</p>
<blockquote>
<pre>cd /tmp/resources/sphinx-0.9.9-rc1/
./configure --prefix=/usr/local/sphinx --with-mysql=/usr/local/mysql51
make
sudo make install</pre>
</blockquote>
<p>Essentially, we&#8217;re working now with <strong>0.9.9-RC1</strong>, but the <strong>sphinx_snippets()</strong> function is from the <strong>0.9.9-RC2</strong> version, and happily no one bothers about this mix.</p>
<p>I hope this helps.</p>
]]></content:encoded>
							<wfw:commentRss>https://shlomi-noach.github.io/blog/mysql/sphinxse-0-9-9-rc2-bug-workaround/feed</wfw:commentRss>
		<slash:comments>0</slash:comments>
						<post-id xmlns="com-wordpress:feed-additions:1">1245</post-id>	</item>
	</channel>
</rss>
