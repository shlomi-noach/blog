<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	

	<title>SQL – Page 7 – code.openark.org</title>
<link rel="dns-prefetch" href="//secure.gravatar.com">
<link rel="dns-prefetch" href="//s.w.org">



<link rel="stylesheet" id="wp-block-library-css" href="https://shlomi-noach.github.io/blog/wp-includes/css/dist/block-library/style.min.css" media="all">
<style id="wp-block-library-inline-css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="wp-polls-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-css.css" media="all">
<style id="wp-polls-inline-css">
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel="stylesheet" id="openark-primer-style-css" href="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/style.css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/css/jetpack.css" media="all">
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery-migrate.min.js"></script>



<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<link rel="dns-prefetch" href="//v0.wordpress.com">


<meta property="og:type" content="website">
<meta property="og:title" content="SQL – Page 7 – code.openark.org">
<meta property="og:url" content="https://shlomi-noach.github.io/blog/tag/sql">
<meta property="og:site_name" content="code.openark.org">
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg">
<meta property="og:locale" content="en_US">


<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(242,101,34,.88);}</style></head>

<body class="archive paged tag tag-sql tag-21 paged-7 tag-paged-7 hfeed no-sidebar">
<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#primary">Skip to content</a>

	<header id="masthead" class="site-header">
		<div class="site-branding">
							<p class="site-title"><a href="https://shlomi-noach.github.io/blog/" rel="home">code.openark.org</a></p>
								<p class="site-description">Blog by Shlomi Noach</p>
			
			<nav id="site-navigation" class="main-navigation">
				<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">primary-menu</button>
				<div class="menu-primary-menu-container"><ul id="menu-primary-menu" class="menu"><li id="menu-item-8109" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8109"><a href="https://shlomi-noach.github.io/blog/archives">archives</a></li>
<li id="menu-item-8050" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8050"><a href="https://shlomi-noach.github.io/blog/presentations">presentations</a></li>
<li id="menu-item-8055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8055"><a href="https://shlomi-noach.github.io/blog/about">about</a></li>
<li id="menu-item-8071" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8071"><a href="https://github.com/shlomi-noach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li>
<li id="menu-item-8074" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8074"><a href="https://www.linkedin.com/in/shlominoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li>
<li id="menu-item-8072" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8072"><a href="https://twitter.com/ShlomiNoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"></path></svg></a></li>
<li id="menu-item-8073" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8073"><a href="https://shlomi-noach.github.io/blog/feed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-12.832 20c-1.197 0-2.168-.969-2.168-2.165s.971-2.165 2.168-2.165 2.167.969 2.167 2.165-.97 2.165-2.167 2.165zm5.18 0c-.041-4.029-3.314-7.298-7.348-7.339v-3.207c5.814.041 10.518 4.739 10.561 10.546h-3.213zm5.441 0c-.021-7.063-5.736-12.761-12.789-12.792v-3.208c8.83.031 15.98 7.179 16 16h-3.211z"></path></svg></a></li>
</ul></div>			</nav>
		</div>
	</header>

	<main id="primary" class="site-main">

		
			<header class="page-header">
				<h1 class="page-title">Tag: SQL</h1>			</header>

			
<article id="post-1009" class="post-1009 post type-post status-publish format-standard hentry category-mysql tag-graphs tag-sql">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/generic-auto-scaling-scaled-sql-graphs" rel="bookmark">Generic, auto scaling, scaled SQL graphs</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/graphs" rel="tag">Graphs</a><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/generic-auto-scaling-scaled-sql-graphs" rel="bookmark"><time class="entry-date published" datetime="2009-07-27T12:17:16+02:00">July 27, 2009</time><time class="updated" datetime="2009-07-28T15:08:13+02:00">July 28, 2009</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>In <a href="https://shlomi-noach.github.io/blog/mysql/rotating-sql-graphs-horizontally">Rotating SQL graphs horizontally</a>, I have shown how to rotate an ASCII SQL graph into horizontal position.</p>
<p>I was dissatisfied with some parts of the solution, which I will show now how to fix:</p>
<ul>
<li>I had to manually scale the graph values so as to fit nicely into screen.</li>
<li>I had to rely on hard coded scaling schemes.</li>
<li>I had to rely on hard coded column names.</li>
<li>I had no y-axis legend.</li>
</ul>
<p>I will now present an SQL query which allows for <em>pluggable queries</em>, which creates self, <em>auto scaling graphs</em>, along with <em>y-axis scales</em>.</p>
<p>Using deeply nested subqueries, we will evolve a simple SELECT query into an elaborate graph. I will present the many steps required, followed by explanations and sample results. But in the end – the steps are unimportant. I’ll present a <em>generic query</em>, into which your own SELECT can be embedded, and which will provide you with the graph.</p>
<p>We’ll use the same example, found in <a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2009/07/graph2.sql">graph.sql</a>.</p>
<h4> <a href="https://shlomi-noach.github.io/blog/mysql/generic-auto-scaling-scaled-sql-graphs#more-1009" class="more-link">Continue reading »<span class="screen-reader-text"> “Generic, auto scaling, scaled SQL graphs”</span></a></h4>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/generic-auto-scaling-scaled-sql-graphs#comments">9 Comments<span class="screen-reader-text"> on Generic, auto scaling, scaled SQL graphs</span></a></span>	</footer>
</article>

<article id="post-984" class="post-984 post type-post status-publish format-standard hentry category-mysql tag-graphs tag-sql">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/rotating-sql-graphs-horizontally" rel="bookmark">Rotating SQL graphs horizontally</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/graphs" rel="tag">Graphs</a><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/rotating-sql-graphs-horizontally" rel="bookmark"><time class="entry-date published" datetime="2009-07-24T06:00:12+02:00">July 24, 2009</time><time class="updated" datetime="2009-07-27T12:53:50+02:00">July 27, 2009</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>We all love graphs. We all love SQL hacks. We all know the SQL hack which displays a character-based graph (example follows for those unfamiliar).</p>
<p>But we all love <em>horizontal</em> graphs, not vertical ones. We are used to the X axis being horizontal, Y being vertical. Not vice versa.</p>
<p>In this post I’ll present a SQL hack which rotates a vertical graph to horizontal. In fact, the technique shown will rotate any ‘textual image’; but graphs are a nice example.</p>
<h4>A vertical graph example</h4>
<p>What’s prettier than a sinus curve? I have prepared a simple table that will serve nicely, and can be found in <a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2009/07/graph.sql">graph_tables.sql</a>.</p>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/rotating-sql-graphs-horizontally#more-984" class="more-link">Continue reading »<span class="screen-reader-text"> “Rotating SQL graphs horizontally”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/rotating-sql-graphs-horizontally#comments">10 Comments<span class="screen-reader-text"> on Rotating SQL graphs horizontally</span></a></span>	</footer>
</article>

<article id="post-840" class="post-840 post type-post status-publish format-standard hentry category-mysql tag-books tag-sql">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/unwalking-a-string-with-group_concat" rel="bookmark">Unwalking a string with GROUP_CONCAT</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/books" rel="tag">Books</a><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/unwalking-a-string-with-group_concat" rel="bookmark"><time class="entry-date published" datetime="2009-06-16T07:54:49+02:00">June 16, 2009</time><time class="updated" datetime="2009-09-27T14:08:16+02:00">September 27, 2009</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>“Walking a string” is an SQL technique to convert a single value into multiple rows result set. For example, walking the string <strong>‘hello’</strong> results with 5 rows, each of which contains a single character from the text.</p>
<p>I’ll present a brief example of walking a string, and then show how to “unwalk” the string: do the reverse operation.</p>
<p>To walk a string, an integers table is required (or this could be a good use for <a href="http://www.mysqlconf.com/mysql2009/public/schedule/detail/6891">SeqEngine</a>): <a href="https://shlomi-noach.github.io/blog/mysql/unwalking-a-string-with-group_concat#more-840" class="more-link">Continue reading »<span class="screen-reader-text"> “Unwalking a string with GROUP_CONCAT”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/unwalking-a-string-with-group_concat#comments">13 Comments<span class="screen-reader-text"> on Unwalking a string with GROUP_CONCAT</span></a></span>	</footer>
</article>

<article id="post-705" class="post-705 post type-post status-publish format-standard hentry category-mysql tag-indexing tag-performance tag-sql">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/sql-finding-a-users-countryregion-based-on-ip" rel="bookmark">SQL: finding a user’s country/region based on IP</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/indexing" rel="tag">Indexing</a><a href="https://shlomi-noach.github.io/blog/tag/performance" rel="tag">Performance</a><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/sql-finding-a-users-countryregion-based-on-ip" rel="bookmark"><time class="entry-date published" datetime="2009-05-26T08:35:17+02:00">May 26, 2009</time><time class="updated" datetime="2009-12-16T09:11:00+02:00">December 16, 2009</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>I’ve encountered the same problem twice for different customers, so I guess it’s worth a discussion.</p>
<p>A common task for web applications is to find out the country/region of a user, based on her IP address, as can be detected in the HTTP request. Depending on the country of origin, the website can translate dates for different time zones, can change locale settings, and, perhaps most commonly, show advertisements in her native language.</p>
<p>To start with, there’s a table which lists the IP ranges per country/region. Let’s assume we’re only dealing with IPv4:</p>
<blockquote>
<pre>CREATE TABLE regions_ip_range (
  regions_ip_range_id INT UNSIGNED AUTO_INCREMENT,
  country VARCHAR(64) CHARSET utf8,
  region VARCHAR(64) CHARSET utf8,
  start_ip INT UNSIGNED,
  end_ip INT UNSIGNED,
  …
  PRIMARY KEY(regions_ip_range_id),
  ...
);</pre>
</blockquote>
<p>The table is fixed, and is populated. Now the question arises: how do we query this table, and which indexes should be created?</p>
<h4>The wrong way</h4>
<p>The form I’ve encountered is as follows: an index is declared on regions_ip_range:</p>
<blockquote>
<pre>KEY ip_range_idx (start_ip, end_ip)</pre>
</blockquote>
<p>And the query goes like this:</p>
<blockquote>
<pre>SELECT * FROM regions_ip_range
WHERE my_ip BETWEEN start_ip AND end_ip</pre>
</blockquote>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/sql-finding-a-users-countryregion-based-on-ip#more-705" class="more-link">Continue reading »<span class="screen-reader-text"> “SQL: finding a user’s country/region based on IP”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/sql-finding-a-users-countryregion-based-on-ip#comments">20 Comments<span class="screen-reader-text"> on SQL: finding a user’s country/region based on IP</span></a></span>	</footer>
</article>

<article id="post-695" class="post-695 post type-post status-publish format-standard hentry category-mysql tag-books tag-execution-plan tag-indexing tag-sql tag-syntax">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/7-ways-to-convince-mysql-to-use-the-right-index" rel="bookmark">7 ways to convince MySQL to use the right index</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/books" rel="tag">Books</a><a href="https://shlomi-noach.github.io/blog/tag/execution-plan" rel="tag">Execution plan</a><a href="https://shlomi-noach.github.io/blog/tag/indexing" rel="tag">Indexing</a><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a><a href="https://shlomi-noach.github.io/blog/tag/syntax" rel="tag">Syntax</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/7-ways-to-convince-mysql-to-use-the-right-index" rel="bookmark"><time class="entry-date published" datetime="2009-04-02T18:06:32+02:00">April 2, 2009</time><time class="updated" datetime="2009-09-27T14:08:11+02:00">September 27, 2009</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Sometimes MySQL gets it wrong. It doesn’t use the right index.</p>
<p>It happens that MySQL generates a query plan which is really bad (EXPLAIN says it’s going to explore some 10,000,000 rows), when another plan (soon to show how was generated) says: “Sure, I can do that with 100 rows using a key”.</p>
<h4>A true story</h4>
<p>A customer had issues with his database. Queries were taking 15 minutes to complete, and the db in general was not responsive. Looking at the slow query log, I found the criminal query. Allow me to bring you up to speed:</p>
<p>A table is defined like this:</p>
<blockquote>
<pre>CREATE TABLE t (
  id INT UNSIGNED AUTO_INCREMENT,
  type INT UNSIGNED,
  level TINYINT unsigned,
  ...
  PRIMARY KEY(id),
  KEY `type` (type)
) ENGINE=InnoDB;</pre>
</blockquote>
<p>The offending query was this:</p>
<blockquote>
<pre>SELECT id FROM data
WHERE type=12345 AND level > 3
ORDER BY id</pre>
</blockquote>
<p>The facts were:</p>
<ul>
<li>`t` has about 10,000,000 rows.</li>
<li>The index on `type` is selective: about 100 rows per value on average.</li>
<li>The query took a long time to complete.</li>
<li>EXPLAIN has shown that MySQL uses the PRIMARY KEY, hence searches 10,000,000 rows, filtered “using where”.</li>
<li>The <em>other</em> EXPLAIN has shown that by using the `type` key, only 110 rows are expected, to be filtered “using where”, then sorted “using filesort”</li>
</ul>
<p>So MySQL acknowledged it was generating the wrong plan. The <em>other</em> plan was better by its own standards.</p>
<h4>Solving the problem</h4>
<p>Let’s walk through 7 ways to solve the problem, starting with the more aggressive solutions, refining to achieve desired behavior through subtle changes. <a href="https://shlomi-noach.github.io/blog/mysql/7-ways-to-convince-mysql-to-use-the-right-index#more-695" class="more-link">Continue reading »<span class="screen-reader-text"> “7 ways to convince MySQL to use the right index”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/7-ways-to-convince-mysql-to-use-the-right-index#comments">39 Comments<span class="screen-reader-text"> on 7 ways to convince MySQL to use the right index</span></a></span>	</footer>
</article>

<article id="post-145" class="post-145 post type-post status-publish format-standard hentry category-mysql tag-security tag-sql tag-triggers">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/using-triggers-to-block-malicious-code-an-example" rel="bookmark">Using triggers to block malicious code: an example</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/security" rel="tag">Security</a><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a><a href="https://shlomi-noach.github.io/blog/tag/triggers" rel="tag">Triggers</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/using-triggers-to-block-malicious-code-an-example" rel="bookmark"><time class="entry-date published updated" datetime="2009-01-01T23:05:54+02:00">January 1, 2009</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Web applications face constant exploitation attempts. Those with a user base must keep their users’ private data, well… private.</p>
<p>While the MySQL security model allows restricting users access to databases, tables and even columns, it has no built in feature for restricting the rows access within the given table.</p>
<p>One cannot allow a user to only update rows 0 through 99, but restrict that user from updating rows 100 to 199. Such restrictions are usually managed in the application level, by adding a necessary “… AND filtering_column = some_value…”</p>
<p>Many web application have the notion of an ‘admin’ account, or several such accounts, which provide greater control over the application. The ‘admin’ account is one account to which many attacks are targeted. One such attack is an attempt to modify the admin’s password, such that the attacker can later log in with and access restricted data. <a href="https://shlomi-noach.github.io/blog/mysql/using-triggers-to-block-malicious-code-an-example#more-145" class="more-link">Continue reading »<span class="screen-reader-text"> “Using triggers to block malicious code: an example”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/using-triggers-to-block-malicious-code-an-example#comments">8 Comments<span class="screen-reader-text"> on Using triggers to block malicious code: an example</span></a></span>	</footer>
</article>

<article id="post-10" class="post-10 post type-post status-publish format-standard hentry category-mysql tag-data-types tag-sql tag-syntax">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/mysqls-character-sets-and-collations-demystified" rel="bookmark">MySQL’s character sets and collations demystified</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/data-types" rel="tag">Data Types</a><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a><a href="https://shlomi-noach.github.io/blog/tag/syntax" rel="tag">Syntax</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/mysqls-character-sets-and-collations-demystified" rel="bookmark"><time class="entry-date published" datetime="2008-12-08T08:44:24+02:00">December 8, 2008</time><time class="updated" datetime="2008-12-16T09:58:14+02:00">December 16, 2008</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>MySQL’s character sets and collations are often considered as a mystery, and many users either completely disregard them and keep with the defaults, or set everything to UTF8.</p>
<p>This post will attempt to shed some light on the mystery, and provide with some best practices for use with text columns with regard to character sets. <a href="https://shlomi-noach.github.io/blog/mysql/mysqls-character-sets-and-collations-demystified#more-10" class="more-link">Continue reading »<span class="screen-reader-text"> “MySQL’s character sets and collations demystified”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/mysqls-character-sets-and-collations-demystified#comments">21 Comments<span class="screen-reader-text"> on MySQL’s character sets and collations demystified</span></a></span>	</footer>
</article>

<article id="post-271" class="post-271 post type-post status-publish format-standard hentry category-mysql tag-sql tag-syntax">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/dynamic-sequencing-with-a-single-query" rel="bookmark">Dynamic sequencing with a single query</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a><a href="https://shlomi-noach.github.io/blog/tag/syntax" rel="tag">Syntax</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/dynamic-sequencing-with-a-single-query" rel="bookmark"><time class="entry-date published" datetime="2008-12-03T19:59:14+02:00">December 3, 2008</time><time class="updated" datetime="2008-12-13T06:32:56+02:00">December 13, 2008</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>It is a known trick to use a session variables for dynamically counting/sequencing rows. The way to go is to SET a variable to zero, then use arithmetic within assignment to increment its value for each row in the SELECTed rows.</p>
<p>For example, the following query lists the top 10 populated countries, using <a title="MySQL's world database setup" href="http://dev.mysql.com/doc/world-setup/en/world-setup.html">MySQL’s world database</a>:</p>
<blockquote>
<pre>SELECT Code, Name, Population
FROM Country ORDER BY Population DESC LIMIT 10;

+------+--------------------+------------+
| Code | Name               | Population |
+------+--------------------+------------+
| CHN  | China              | 1277558000 |
| IND  | India              | 1013662000 |
| USA  | United States      |  278357000 |
| IDN  | Indonesia          |  212107000 |
| BRA  | Brazil             |  170115000 |
| PAK  | Pakistan           |  156483000 |
| RUS  | Russian Federation |  146934000 |
| BGD  | Bangladesh         |  129155000 |
| JPN  | Japan              |  126714000 |
| NGA  | Nigeria            |  111506000 |
+------+--------------------+------------+</pre>
</blockquote>
<p>The results do not provide any sequence number. Nor does the table have an AUTO_INCREMENT or otherwise unique row number. If I were to rate the countries by population, the common trick is:</p>
<blockquote>
<pre>SET @rank := 0;
SELECT
  @rank := @rank+1 AS rank,
  Code, Name, Population
FROM Country ORDER BY Population DESC LIMIT 10;

+------+------+--------------------+------------+
| rank | Code | Name               | Population |
+------+------+--------------------+------------+
|    1 | CHN  | China              | 1277558000 |
|    2 | IND  | India              | 1013662000 |
|    3 | USA  | United States      |  278357000 |
|    4 | IDN  | Indonesia          |  212107000 |
|    5 | BRA  | Brazil             |  170115000 |
|    6 | PAK  | Pakistan           |  156483000 |
|    7 | RUS  | Russian Federation |  146934000 |
|    8 | BGD  | Bangladesh         |  129155000 |
|    9 | JPN  | Japan              |  126714000 |
|   10 | NGA  | Nigeria            |  111506000 |
+------+------+--------------------+------------+</pre>
</blockquote>
<p>The first query sets the @rank to zero, so that it is not NULL (since no arithmetic can be done with NULL).  The second query relies on its success.</p>
<p><strong>Can the same be achieved with one query only? </strong>That’s more of a problem. <a href="https://shlomi-noach.github.io/blog/mysql/dynamic-sequencing-with-a-single-query#more-271" class="more-link">Continue reading »<span class="screen-reader-text"> “Dynamic sequencing with a single query”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/dynamic-sequencing-with-a-single-query#comments">12 Comments<span class="screen-reader-text"> on Dynamic sequencing with a single query</span></a></span>	</footer>
</article>

<article id="post-246" class="post-246 post type-post status-publish format-standard hentry category-mysql tag-sql tag-syntax">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/selecting-a-specific-non-aggregated-column-data-in-group-by" rel="bookmark">Selecting a specific non aggregated column data in GROUP BY</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a><a href="https://shlomi-noach.github.io/blog/tag/syntax" rel="tag">Syntax</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/selecting-a-specific-non-aggregated-column-data-in-group-by" rel="bookmark"><time class="entry-date published" datetime="2008-12-01T18:16:51+02:00">December 1, 2008</time><time class="updated" datetime="2008-12-13T06:33:43+02:00">December 13, 2008</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>In a GROUP BY query, MySQL may allow specifying non aggregated columns. For example, using <a title="Setting up the world database" href="http://dev.mysql.com/doc/world-setup/en/world-setup.html">MySQL’s world database</a>, I wish to get the number of countries per continent, along with a “sample” country:</p>
<blockquote>
<pre><strong>SELECT </strong>Continent, <strong>COUNT</strong>(*), Name
<strong>FROM </strong>`Country` <strong>GROUP BY </strong>Continent

+---------------+----------+----------------+
| Continent     | COUNT(*) | Name           |
+---------------+----------+----------------+
| Asia          |       51 | Afghanistan    |
| Europe        |       46 | Albania        |
| North America |       37 | Aruba          |
| Africa        |       58 | Angola         |
| Oceania       |       28 | American Samoa |
| Antarctica    |        5 | Antarctica     |
| South America |       14 | Argentina      |
+---------------+----------+----------------+</pre>
</blockquote>
<p>What if I want to choose that “sample” country? For example, for each continent, I wish to show the country with the largest population. To simply see the largest population, I would use MAX(Population). But which country is referred? I wish to provide a solution which does not involve sub-queries, HAVING or JOINs. <a href="https://shlomi-noach.github.io/blog/mysql/selecting-a-specific-non-aggregated-column-data-in-group-by#more-246" class="more-link">Continue reading »<span class="screen-reader-text"> “Selecting a specific non aggregated column data in GROUP BY”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/selecting-a-specific-non-aggregated-column-data-in-group-by#comments">12 Comments<span class="screen-reader-text"> on Selecting a specific non aggregated column data in GROUP BY</span></a></span>	</footer>
</article>

<article id="post-188" class="post-188 post type-post status-publish format-standard hentry category-mysql tag-analysis tag-indexing tag-information_schema tag-sql tag-syntax">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/useful-database-analysis-queries-with-information_schema" rel="bookmark">Useful database analysis queries with INFORMATION_SCHEMA</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/analysis" rel="tag">Analysis</a><a href="https://shlomi-noach.github.io/blog/tag/indexing" rel="tag">Indexing</a><a href="https://shlomi-noach.github.io/blog/tag/information_schema" rel="tag">INFORMATION_SCHEMA</a><a href="https://shlomi-noach.github.io/blog/tag/sql" rel="tag">SQL</a><a href="https://shlomi-noach.github.io/blog/tag/syntax" rel="tag">Syntax</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/useful-database-analysis-queries-with-information_schema" rel="bookmark"><time class="entry-date published" datetime="2008-11-26T08:47:12+02:00">November 26, 2008</time><time class="updated" datetime="2009-08-26T09:33:06+02:00">August 26, 2009</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>A set of useful queries on INFORMATION_SCHEMA follows. These queries can be used when approaching a new database, to learn about some of its properties, or they can be regularly used on an existing schema, so as to verify its integrity.</p>
<p>I will present queries for:</p>
<ul>
<li>Checking on database engines and size</li>
<li>Locating duplicate and redundant indexes</li>
<li>Checking on character sets for columns and tables, looking for variances</li>
<li>Checking on processes and long queries (only with MySQL 5.1) <a href="https://shlomi-noach.github.io/blog/mysql/useful-database-analysis-queries-with-information_schema#more-188" class="more-link">Continue reading »<span class="screen-reader-text"> “Useful database analysis queries with INFORMATION_SCHEMA”</span></a></li>
</ul>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/useful-database-analysis-queries-with-information_schema#comments">3 Comments<span class="screen-reader-text"> on Useful database analysis queries with INFORMATION_SCHEMA</span></a></span>	</footer>
</article>

	<nav class="navigation posts-navigation" role="navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://shlomi-noach.github.io/blog/tag/sql/page/8">Older posts</a></div><div class="nav-next"><a href="https://shlomi-noach.github.io/blog/tag/sql/page/6">Newer posts</a></div></div>
	</nav>
	</main>


	<footer id="colophon" class="site-footer">
		<div class="site-info">
			<a href="https://wordpress.org/">
				Powered by WordPress			</a>
			<span class="sep"> | </span>
				Theme: <a href="http://openark.org">openark-primer</a> by <a href="http://underscores.me/">Underscores.me</a>.		</div>
	</footer>
</div>

	<div style="display:none">
	</div>
<script>
var pollsL10n = {"ajax_url":"https:\/\/shlomi-noach.github.io\/blog\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-js.js"></script>
<script src="https://secure.gravatar.com/js/gprofiles.js?ver=2020Junaa"></script>
<script>
var WPGroHo = {"my_hash":""};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/modules/wpgroho.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/navigation.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/skip-link-focus-fix.js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202024.js" async="async" defer></script>
<script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:8.2.1',blog:'32412571',post:'0',tz:'2',srv:'code.openark.org'} ]);
	_stq.push([ 'clickTrackerInit', '32412571', '0' ]);
</script>

</body>
</html>
