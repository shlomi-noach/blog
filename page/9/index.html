<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	

	<title>code.openark.org – Page 9 – Blog by Shlomi Noach</title>
<link rel="dns-prefetch" href="//secure.gravatar.com">
<link rel="dns-prefetch" href="//s.w.org">


<link rel="stylesheet" id="wp-block-library-css" href="https://shlomi-noach.github.io/blog/wp-includes/css/dist/block-library/style.min.css" media="all">
<style id="wp-block-library-inline-css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="wp-polls-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-css.css" media="all">
<style id="wp-polls-inline-css">
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel="stylesheet" id="openark-primer-style-css" href="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/style.css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/css/jetpack.css" media="all">
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery-migrate.min.js"></script>




<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<link rel="dns-prefetch" href="//v0.wordpress.com">


<meta property="og:type" content="website">
<meta property="og:title" content="code.openark.org">
<meta property="og:description" content="Blog by Shlomi Noach">
<meta property="og:url" content="https://shlomi-noach.github.io/blog/">
<meta property="og:site_name" content="code.openark.org">
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg">
<meta property="og:locale" content="en_US">


<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(242,101,34,.88);}</style></head>

<body class="home blog paged paged-9 hfeed no-sidebar">
<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#primary">Skip to content</a>

	<header id="masthead" class="site-header">
		<div class="site-branding">
							<h1 class="site-title"><a href="https://shlomi-noach.github.io/blog/" rel="home">code.openark.org</a></h1>
								<p class="site-description">Blog by Shlomi Noach</p>
			
			<nav id="site-navigation" class="main-navigation">
				<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">primary-menu</button>
				<div class="menu-primary-menu-container"><ul id="menu-primary-menu" class="menu"><li id="menu-item-8109" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8109"><a href="https://shlomi-noach.github.io/blog/archives">archives</a></li>
<li id="menu-item-8050" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8050"><a href="https://shlomi-noach.github.io/blog/presentations">presentations</a></li>
<li id="menu-item-8055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8055"><a href="https://shlomi-noach.github.io/blog/about">about</a></li>
<li id="menu-item-8071" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8071"><a href="https://github.com/shlomi-noach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li>
<li id="menu-item-8074" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8074"><a href="https://www.linkedin.com/in/shlominoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li>
<li id="menu-item-8072" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8072"><a href="https://twitter.com/ShlomiNoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"></path></svg></a></li>
<li id="menu-item-8073" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8073"><a href="https://shlomi-noach.github.io/blog/feed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-12.832 20c-1.197 0-2.168-.969-2.168-2.165s.971-2.165 2.168-2.165 2.167.969 2.167 2.165-.97 2.165-2.167 2.165zm5.18 0c-.041-4.029-3.314-7.298-7.348-7.339v-3.207c5.814.041 10.518 4.739 10.561 10.546h-3.213zm5.441 0c-.021-7.063-5.736-12.761-12.789-12.792v-3.208c8.83.031 15.98 7.179 16 16h-3.211z"></path></svg></a></li>
</ul></div>			</nav>
		</div>
	</header>

	<main id="primary" class="site-main">

		
<article id="post-7019" class="post-7019 post type-post status-publish format-standard hentry category-mysql tag-backup tag-open-source tag-orchestrator tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/announcing-orchestrator-agent" rel="bookmark">Announcing orchestrator-agent</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/backup" rel="tag">Backup</a><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/announcing-orchestrator-agent" rel="bookmark"><time class="entry-date published updated" datetime="2014-10-13T14:59:24+02:00">October 13, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p><strong><a href="https://github.com/outbrain/orchestrator-agent">orchestrator-agent</a></strong> is a side-kick, complementary project of <strong><a href="https://github.com/outbrain/orchestrator">orchestrator</a></strong>, implementing a daemon service on one’s MySQL hosts which communicates with and accepts commands from <em>orchestrator</em>, built with the original purpose of providing an automated solution for provisioning new or corrupted slaves.</p>
<p>It was built by <a href="https://github.com/outbrain">Outbrain</a>, with Outbrain’s specific use case in mind. While we release it as open source, only a small part of its functionality will appeal to the public (this is why it’s not strictly part of the <em>orchestrator</em> project, which is a general purpose, wide-audience solution). Nevertheless, it is a simple implementation of a daemon, such that can be easily extended by the community. The project is open for pull-requests!</p>
<p>A quick breakdown of <em>orchestrator-agent</em> is as follows:</p>
<ul>
<li>Executes as a daemon on linux hosts</li>
<li>Interacts and invokes OS commands (via <em>bash</em>)</li>
<li>Does not directly interact with a MySQL server running on that host (does not connect via mysql credentials)</li>
<li>Expects a single MySQL service on host</li>
<li>Can control the MySQL service (e.g. stop, start)</li>
<li>Is familiar with LVM layer on host</li>
<li>Can take LVM snapshots, mount snapshots, remove snapshots</li>
<li>Is familiar with the MySQL data directory, disk usage, file system</li>
<li>Can send snapshot data from a mounted snapshot on a running MySQL host</li>
<li>Can prepare data directory and receive snapshot data from another host</li>
<li>Recognizes local/remote datacenters</li>
<li>Controlled by <em>orchestrator,</em> two <em>orchestrator-agents</em> implement an automated and audited solution for seeding a new/corrupted MySQL host based on a running server.</li>
</ul>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/announcing-orchestrator-agent#more-7019" class="more-link">Continue reading »<span class="screen-reader-text"> “Announcing orchestrator-agent”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/announcing-orchestrator-agent#comments">1 Comment<span class="screen-reader-text"> on Announcing orchestrator-agent</span></a></span>	</footer>
</article>

<article id="post-7007" class="post-7007 post type-post status-publish format-standard hentry category-mysql tag-common_schema tag-security">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/get-per-object-grants-via-common_schema" rel="bookmark">Get per-object grants via common_schema</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/common_schema" rel="tag">common_schema</a><a href="https://shlomi-noach.github.io/blog/tag/security" rel="tag">Security</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/get-per-object-grants-via-common_schema" rel="bookmark"><time class="entry-date published updated" datetime="2014-09-29T13:30:09+02:00">September 29, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Did you know <a href="http://code.google.com/p/common-schema">common_schema</a> supports a complete breakdown of all accounts on your database server? It can provide you with the <strong>GRANT</strong> statements required to set up an account, the <strong>REVOKE</strong> statements to undo the former, and this can be broken down on a per-object & per-object-type basis. Consider the <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_grants.html">sql_grants</a> view:</p>
<p><em>Find who has privileges on a table called <strong>t</strong></em>:</p>
<blockquote>
<pre>select * from <strong>common_schema.sql_grants</strong> where <strong>priv_level_name</strong>='table' and <strong>object_name</strong>='t'\G

           GRANTEE: 'power1'@'localhost'
              user: power1
              host: localhost
        priv_level: `mytst`.`t`
   priv_level_name: table
     object_schema: mytst
       object_name: t
current_privileges: SELECT
      IS_GRANTABLE: NO
         sql_grant: GRANT SELECT ON `mytst`.`t` TO 'power1'@'localhost'
        sql_revoke: REVOKE SELECT ON `mytst`.`t` FROM 'power1'@'localhost'
     sql_drop_user: DROP USER 'power1'@'localhost'</pre>
</blockquote>
<p>or, <em>who has privileges on the <strong>test</strong> schema</em>:</p>
<blockquote>
<pre>select * from common_schema.sql_grants where priv_level_name='schema' and object_name='test' \G

           GRANTEE: 'power1'@'localhost'
              user: power1
              host: localhost
        priv_level: `test`.*
   priv_level_name: schema
     object_schema: NULL
       object_name: test
current_privileges: ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE
      IS_GRANTABLE: NO
         sql_grant: GRANT ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON `test`.* TO 'power1'@'localhost'
        sql_revoke: REVOKE ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON `test`.* FROM 'power1'@'localhost'
     sql_drop_user: DROP USER 'power1'@'localhost'

           GRANTEE: 'test'@'localhost'
              user: test
              host: localhost
        priv_level: `test`.*
   priv_level_name: schema
     object_schema: NULL
       object_name: test
current_privileges: ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE
      IS_GRANTABLE: NO
         sql_grant: GRANT ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON `test`.* TO 'test'@'localhost'
        sql_revoke: REVOKE ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, CREATE TEMPORARY TABLES, CREATE VIEW, DELETE, DROP, EVENT, EXECUTE, INDEX, INSERT, LOCK TABLES, REFERENCES, SELECT, SHOW VIEW, TRIGGER, UPDATE ON `test`.* FROM 'test'@'localhost'
     sql_drop_user: DROP USER 'test'@'localhost'

</pre>
</blockquote>
<p>In the same manner, you can easily SELECT for all grants that are defined per-table, per-schema, … <strong>priv_level_name</strong>: is any one of <strong>‘user’</strong>, <strong>‘schema’</strong>, <strong>‘table’</strong>, <strong>‘column’</strong>, <strong>‘routine’</strong>.</p>
<p>The above is a view, which aggregates data from all relevant <strong>INFORMATION_SCHEMA</strong> tables, normalizing and de-normalizing as necessary.</p>
<p>You might also want to look at <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_show_grants.html">sql_show_grants</a> which provides with a no-breakdown GRANT for all accounts. It’s like a SHOW ALL GRANTS which doesn’t exist, plus it’s SELECTable.</p>
<p>Also, thanks to <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/eval.html">eval()</a>, the above make for executable code. Consider: <a href="https://shlomi-noach.github.io/blog/mysql/get-per-object-grants-via-common_schema#more-7007" class="more-link">Continue reading »<span class="screen-reader-text"> “Get per-object grants via common_schema”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/get-per-object-grants-via-common_schema#respond">Leave a Comment<span class="screen-reader-text"> on Get per-object grants via common_schema</span></a></span>	</footer>
</article>

<article id="post-7002" class="post-7002 post type-post status-publish format-standard hentry category-mysql tag-opinions tag-secondary">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year-3" rel="bookmark">Three wishes for a new year</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/opinions" rel="tag">Opinions</a><a href="https://shlomi-noach.github.io/blog/tag/secondary" rel="tag">secondary</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year-3" rel="bookmark"><time class="entry-date published" datetime="2014-09-23T11:21:13+02:00">September 23, 2014</time><time class="updated" datetime="2014-09-23T16:04:54+02:00">September 23, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<div>
<p>Another new year by Jewish calendar. What do I wish for the following year?</p>
<ol>
<li>World peace</li>
<li>Good health to all</li>
<li>Multi-core execution for queries</li>
</ol>
<p>After having evaluated a few columnar databases, and having seen how a single query gets 24 cores busy, I can’t look at MySQL the same way again. The fact that a single query consumes a single core only doesn’t seem right in the year 2014. <a href="https://github.com/greenlion/swanhart-tools/tree/master/shard-query">Shard-query</a> is a cool application-level attempt to solve the above; I would like to see stuff like this implemented inside the server (or inside the storage engine where possible).</p>
<p>None of my wishes in previous years [<a href="https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year">2010</a>], [<a href="https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year-2">2011</a>], [<a href="https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year-201">2012</a>], [<a href="https://shlomi-noach.github.io/blog/mysql/three-wished-for-a-new-year-2013">2013</a>] came true (and mostly gone worse). I’m still willing to settle for two out of three.</p>
</div>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/three-wishes-for-a-new-year-3#comments">7 Comments<span class="screen-reader-text"> on Three wishes for a new year</span></a></span>	</footer>
</article>

<article id="post-6980" class="post-6980 post type-post status-publish format-standard hentry category-development category-linux tag-command-line tag-go tag-open-source tag-zookeeper">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/linux/zookeepercli-lightweight-powerful-controlled-command-line-client-for-zookeeper" rel="bookmark">zookeepercli: lightweight, powerful, controlled command line client for ZooKeeper</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/development" rel="category tag">Development</a> <a href="https://shlomi-noach.github.io/blog/category/linux" rel="category tag">Linux</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/command-line" rel="tag">command line</a><a href="https://shlomi-noach.github.io/blog/tag/go" rel="tag">go</a><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/zookeeper" rel="tag">ZooKeeper</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/linux/zookeepercli-lightweight-powerful-controlled-command-line-client-for-zookeeper" rel="bookmark"><time class="entry-date published updated" datetime="2014-09-17T09:08:20+02:00">September 17, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>I’m happy to announce the availability of <a href="https://github.com/outbrain/zookeepercli"><strong>zookeepercli</strong></a>: a lightweight, simple, fast and controlled command line client for ZooKeeper.</p>
<p><strong>zookeepercli</strong> allows for:</p>
<ul class="task-list">
<li>Basic CRUD-like operations: <strong><code>create</code></strong>,  <strong><code>set</code></strong>,  <strong><code>delete</code></strong>,  <strong><code>exists</code></strong>,  <strong><code>get</code></strong>,  <strong><code>ls</code></strong> (aka <strong><code>children</code></strong>).</li>
<li>Extended operations: <strong><code>lsr</code></strong> (ls recursive),  <strong><code>creater</code></strong> (create recursively)</li>
<li>Well formatted and controlled output: supporting either <strong><code>txt</code></strong> or <strong><code>json</code></strong> format</li>
<li>Single, no-dependencies binary file, based on a native Go ZooKeeper library by <a href="http://github.com/samuel/go-zookeeper">github.com/samuel/go-zookeeper</a> (<a href="https://github.com/outbrain/zookeepercli/blob/master/go-zookeeper-LICENSE">LICENSE</a>)</li>
</ul>
<p>I was dissatisfied with existing command line access to ZooKeeper. Uncontrolled and noisy output as well as large footprint were among the reasons. <strong>zookeepercli</strong> overcomes the above and provides with often required powers.</p>
<p>Usage samples:</p>
<blockquote>
<pre><code>
$ zookeepercli --servers srv-1,srv-2,srv-3 -c create /demo_only "path placeholder"
$ zookeepercli --servers srv-1,srv-2,srv-3 -c create /demo_only/key1 "value1"
$ zookeepercli --servers srv-1,srv-2,srv-3 -c create /demo_only/key2 "value2"
$ zookeepercli --servers srv-1,srv-2,srv-3 -c create /demo_only/key3 "value3"

$ zookeepercli --servers srv-1,srv-2,srv-3 -c ls /demo_only
<span style="color: #808000;">key3
key2
key1
</span>
<span style="color: #ff6600;"># Same as above, JSON format output:</span>
$ zookeepercli --servers srv-1,srv-2,srv-3 --format=json -c ls /demo_only
<span style="color: #808000;">["key3","key2","key1"]</span>

$ zookeepercli --servers srv-1,srv-2,srv-3 -c delete /demo_only/key1
$ zookeepercli --servers srv-1,srv-2,srv-3 -c delete /demo_only/key2
$ zookeepercli --servers srv-1,srv-2,srv-3 -c delete /demo_only/key3
$ zookeepercli --servers srv-1,srv-2,srv-3 -c delete /demo_only

<span style="color: #ff6600;"># Create a path recursively (auto-generate parent directories if not exist):</span>
$ zookeepercli --servers=srv-1,srv-2,srv-3 -c creater "/demo_only/child/key1" "val1"
$ zookeepercli --servers=srv-1,srv-2,srv-3 -c creater "/demo_only/child/key2" "val2"

$ zookeepercli --servers=srv-1,srv-2,srv-3 -c get "/demo_only/child/key1"
<span style="color: #808000;">val1</span>

<span style="color: #ff6600;"># This path was auto generated due to recursive create:</span>
$ zookeepercli --servers=srv-1,srv-2,srv-3 -c get "/demo_only" 
<span style="color: #808000;">zookeepercli auto-generated</span>

<span style="color: #ff6600;"># ls recursively a path and all sub children:</span>
$ zookeepercli --servers=srv-1,srv-2,srv-3 -c lsr "/demo_only" 
<span style="color: #808000;">child
child/key1
child/key2 </span></code></pre>
</blockquote>
<p><strong>zookeepercli</strong> is released as open source by <a href="https://github.com/outbrain">Outbrain</a> under the <a href="https://github.com/outbrain/zookeepercli/blob/master/LICENSE">Apache 2.0 license</a>.</p>
<p>Quick links:</p>
<ul>
<li><a href="https://github.com/outbrain/zookeepercli">Project page</a></li>
<li><a href="https://github.com/outbrain/zookeepercli/releases">Pre-built binaries</a> for download</li>
<li><a href="https://github.com/outbrain/zookeepercli/blob/master/LICENSE">License</a></li>
</ul>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/linux/zookeepercli-lightweight-powerful-controlled-command-line-client-for-zookeeper#comments">9 Comments<span class="screen-reader-text"> on zookeepercli: lightweight, powerful, controlled command line client for ZooKeeper</span></a></span>	</footer>
</article>

<article id="post-6964" class="post-6964 post type-post status-publish format-standard hentry category-mysql tag-open-source tag-orchestrator tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-0-5-refactoring-masters-multi-master-replication" rel="bookmark">Orchestrator 1.0.5: refactoring masters, multi-master replication</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-0-5-refactoring-masters-multi-master-replication" rel="bookmark"><time class="entry-date published updated" datetime="2014-08-06T14:14:39+02:00">August 6, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Outbrain’s <em>orchestrator</em> Version <strong>1.0.5</strong> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.0.5">is released</a>.</p>
<blockquote><p>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></p></blockquote>
<p><em>Orchestrator</em> now supports refactoring of masters via master-master topologies. It now allows promoting slaves as co-masters and detachment of instances from a co-master topology, effectively allowing for replacing an active master.</p>
<h4>Like this</h4>
<p>Drag a master:</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/08/orchestator-cm-simple-drag-master-01.png"><img class="alignnone size-full wp-image-6965" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/08/orchestator-cm-simple-drag-master-01.png" alt="orchestator-cm-simple-drag-master-01" width="804" height="340" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/08/orchestator-cm-simple-drag-master-01.png 804w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/08/orchestator-cm-simple-drag-master-01-300x126.png 300w" sizes="(max-width: 804px) 100vw, 804px"></a></p></blockquote>
<p>Onto one of its slaves: <a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-0-5-refactoring-masters-multi-master-replication#more-6964" class="more-link">Continue reading »<span class="screen-reader-text"> “Orchestrator 1.0.5: refactoring masters, multi-master replication”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-0-5-refactoring-masters-multi-master-replication#respond">Leave a Comment<span class="screen-reader-text"> on Orchestrator 1.0.5: refactoring masters, multi-master replication</span></a></span>	</footer>
</article>

<article id="post-6945" class="post-6945 post type-post status-publish format-standard hentry category-mysql tag-open-source tag-orchestrator tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-0-4-released" rel="bookmark">Orchestrator 1.0.4 released</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-0-4-released" rel="bookmark"><time class="entry-date published updated" datetime="2014-07-29T13:42:06+02:00">July 29, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Outbrain’s <em>orchestrator</em> Version <strong>1.0.4</strong> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.0.4">is released</a>.</p>
<blockquote><p>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></p></blockquote>
<p>What’s new?</p>
<h4>Co-masters</h4>
<p>orchestrator now does a much better visualization of Master-Master replication:</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/07/orchestrator-co-masters.png"><img class="alignnone size-full wp-image-6946" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/07/orchestrator-co-masters.png" alt="orchestrator-co-masters" width="783" height="357" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/07/orchestrator-co-masters.png 783w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/07/orchestrator-co-masters-300x136.png 300w" sizes="(max-width: 783px) 100vw, 783px"></a></p></blockquote>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-0-4-released#more-6945" class="more-link">Continue reading »<span class="screen-reader-text"> “Orchestrator 1.0.4 released”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-0-4-released#respond">Leave a Comment<span class="screen-reader-text"> on Orchestrator 1.0.4 released</span></a></span>	</footer>
</article>

<article id="post-6482" class="post-6482 post type-post status-publish format-standard hentry category-mysql tag-security">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/some-mysql-security-tips" rel="bookmark">Some MySQL security tips</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/security" rel="tag">Security</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/some-mysql-security-tips" rel="bookmark"><time class="entry-date published updated" datetime="2014-07-28T11:13:36+02:00">July 28, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>This is a brief list of security tips for MySQL. It is by no means complete.</p>
<ul>
<li>Follow the <strong>sudo</strong> example. Don’t let all you DBAs and Ops have the password for the <strong>root</strong> account. Have each and every one of them have their own personal super-duper account, with their own personal and private password. This makes it so easy when someone leaves the company. No need to change passwords, just to remove the employee’s account.</li>
<li>Block <strong>root</strong>. Either remove it completely or forbid it from logging in. Yes, there’s a <del>way</del> hack in MySQL to have a valid account blocked from logging in. One way of making this happen is via <em>common_schema</em>‘s <a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/sql_accounts.html">sql_accounts</a>. Here’s how to block root account using common_schema:</li>
</ul>
<blockquote>
<pre>mysql> CALL common_schema.eval("SELECT sql_block_account FROM sql_accounts WHERE USER = 'root'");</pre>
</blockquote>
<ul>
<li>Make lots of small users. Give <em>nagios</em> its own user. Give <em>collectd</em> its own user. Give <em>orchestrator</em> its own user. Give <em>innotop</em> its own user. Give <em>whatever</em> its own user. Yes, it’s more users to create, but you get to have each user as limited in privileges as possible, and you don’t get to wonder why your heartbeat script has <strong>SUPER</strong>, <strong>LOCK</strong> and <strong>SHUTDOWN</strong> privileges.</li>
<li>Verify: <strong>set @@old_passwords=0;</strong> before setting a new password. Make sure your configuration does not specify <strong>old_passwords = 1</strong>. There is no reason to use “<a href="https://shlomi-noach.github.io/blog/mysql/upgrading-passwords-from-old_passwords-to-new-passwords">old passwords</a>“. In fact, a <strong>5.6</strong> client will refuse connecting with an “old password”.</li>
<li>Give no access to <strong>mysql.*</strong>. No one should be tampering directly with the <strong>mysql</strong> system tables.</li>
<li>Run <a href="https://openarkkit.googlecode.com/svn/trunk/openarkkit/doc/html/oak-security-audit.html">oak-security-audit</a> or, if you have <em>common_schema</em> installed (you mean you don’t?), just <strong><a href="https://common-schema.googlecode.com/svn/trunk/common_schema/doc/html/security_audit.html">CALL security_audit()</a>;</strong> I can (almost) guarantee you’d be surprised and thankful for the security breakdown. Users without passwords, users sharing same passwords, users with unreasonable privileges, and more… You’ll see them all.</li>
<li>If you have web interfaces to your database or some of its aspects (e.g. Anemometer, Propagator, Orchestrator, monitoring, …), protect it via LDAP group or similar. Not everyone who has access to your network needs to see you database. Neither does every employee.</li>
</ul>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/some-mysql-security-tips#comments">4 Comments<span class="screen-reader-text"> on Some MySQL security tips</span></a></span>	</footer>
</article>

<article id="post-6867" class="post-6867 post type-post status-publish format-standard hentry category-mysql tag-open-source tag-orchestrator tag-replication tag-tools">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/introducing-orchestrator-manage-and-visualize-your-mysql-replication-topologies-and-get-home-for-dinner" rel="bookmark">Introducing Orchestrator: manage and visualize your MySQL replication topologies and get home for dinner</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a><a href="https://shlomi-noach.github.io/blog/tag/tools" rel="tag">tools</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/introducing-orchestrator-manage-and-visualize-your-mysql-replication-topologies-and-get-home-for-dinner" rel="bookmark"><time class="entry-date published updated" datetime="2014-06-09T09:02:26+02:00">June 9, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>I’m happy to announce the availability of <a href="http://www.outbrain.com/">Outbrain</a>‘s <strong><a href="https://github.com/outbrain/orchestrator">Orchestrator</a></strong>: MySQL replication management & visualization tool.</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/orchestrator-simple.png"><img class="alignnone size-full wp-image-6898" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/orchestrator-simple.png" alt="orchestrator - simple topology" width="785" height="353" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/orchestrator-simple.png 785w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/orchestrator-simple-300x134.png 300w" sizes="(max-width: 785px) 100vw, 785px"></a></p></blockquote>
<ul>
<li>Orchestrator reads your replication topologies (give it one server – be it master or slave – in each topology, and it will reveal the rest).</li>
<li>It keeps a state of this topology.</li>
<li>It can continuously poll your servers to get an up to date topology map.</li>
<li>It visualizes the topology in a clear and slick D3 tree.</li>
<li>It allows you to <em>modify your topology;</em> move slaves around. You can use the command line variation, the JSON API, or you can use the web interface.</li>
</ul>
<p>Quick links: <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">Orchestrator Manual</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/wiki/FAQ">FAQ</a></strong>, <strong><a href="https://github.com/outbrain/orchestrator/releases">Downloads</a></strong></p>
<h4>Nothing like nice screenshots</h4>
<p>To move slaves around the topology (repoint a slave to a different master) through <em>orchestrator</em>‘s web interface, we use <em>Drag and Drop</em>, <a href="https://shlomi-noach.github.io/blog/mysql/introducing-orchestrator-manage-and-visualize-your-mysql-replication-topologies-and-get-home-for-dinner#more-6867" class="more-link">Continue reading »<span class="screen-reader-text"> “Introducing Orchestrator: manage and visualize your MySQL replication topologies and get home for dinner”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/introducing-orchestrator-manage-and-visualize-your-mysql-replication-topologies-and-get-home-for-dinner#comments">6 Comments<span class="screen-reader-text"> on Introducing Orchestrator: manage and visualize your MySQL replication topologies and get home for dinner</span></a></span>	</footer>
</article>

<article id="post-6865" class="post-6865 post type-post status-publish format-standard hentry category-mysql tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/using-deep-nested-replication-topologies" rel="bookmark">Using deep nested replication topologies</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/using-deep-nested-replication-topologies" rel="bookmark"><time class="entry-date published updated" datetime="2014-06-02T10:04:09+02:00">June 2, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>If you’re running more than a few slaves in a replication topology, you might choose to use deeply nested replication: slaves replicating from other slaves at 2, 3 or even 4 levels. There are pros and cons to such topologies, discussed below.</p>
<p>A simple, small deep nested topology is depicted below (it is also a real production topology of ours):</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/topology-sample-02.png"><img class="alignnone size-full wp-image-6878" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/topology-sample-02.png" alt="topology-sample-02" width="736" height="309" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/topology-sample-02.png 736w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/topology-sample-02-300x125.png 300w" sizes="(max-width: 736px) 100vw, 736px"></a></p></blockquote>
<p>Two slaves, <strong>srv-4</strong> and <strong>srv-8</strong> act as local masters to yet other slaves. Why would we want to have this complexity?</p>
<h4>Pros</h4>
<ul>
<li>Reduce load on master: too many slaves replicating from single master means the master becomes loaded with serving the binary logs. Typically, when all slaves are up to date, this isn’t a big deal, since they all get served roughly the same entries, and caching works great. If not all are in sync, the master needs to look up different log entries and pays with more disk I/O.</li>
<li>Reduce network load. We serve from three different data centres. Our master is in one DC, and our slaves are spread through all three. Inter-DC network is naturally slower; it is also more expensive, hence more easily saturated. Reducing cross-DC network is done across all our systems, including MySQL. <strong>srv-4</strong>, for example, could depict a slave that is a local master in its own DC, serving <strong>srv-5</strong>, <strong>srv-6</strong>, <strong>srv-7</strong> all in the same DC, hence only using cross-DC network for one slave instead of four. A bit over-simplistic example but true.</li>
<li>Failover. <a href="http://code.google.com/p/mysql-master-ha/">MHA</a> does a good job at synchronizing slaves of same master by figuring out the missing binary log entries for each slave. It should do well within a single region, but I do not know that it would do the same cross region (I’m assuming the binlog entries copy should work, but I haven’t tried it cross region). In case of a disaster such as an entire DC going down (we actually had such a case a couple weeks ago; power went out for the entire DC), we have a designated master into which we can fail over in each other DC, and which contains enough slaves (from each remaining DCs) to keep serving. That it, we’re willing to skip the fancy syncing and just point to a newly promoted master, with the benefit that the entire replication topology under it is intact.</li>
<li>Testing & upgrades. For example, I might want to upgrade to <strong>5.6</strong>. Upgrading a slave from <strong>5.5</strong> to <strong>5.6</strong> is a good start; we look at replication and see that nothing gets broken. But how will our production master behave with <strong>5.6</strong>? Put some more slaves under your newly upgraded <strong>5.6</strong> server and get a clearer picture. At some stage you might just promote this entire subtree as the new topology.</li>
</ul>
<p>Here’s another topology; DC info is not depicted in this image, but you can guess what designated masters we have: <a href="https://shlomi-noach.github.io/blog/mysql/using-deep-nested-replication-topologies#more-6865" class="more-link">Continue reading »<span class="screen-reader-text"> “Using deep nested replication topologies”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/using-deep-nested-replication-topologies#comments">5 Comments<span class="screen-reader-text"> on Using deep nested replication topologies</span></a></span>	</footer>
</article>

<article id="post-6861" class="post-6861 post type-post status-publish format-standard hentry category-mysql tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/from-percona-server-to-mysql-and-back-to-percona-server-beware-of-crash-safe-replication-info" rel="bookmark">From Percona Server to MySQL and back to Percona Server: beware of crash safe replication info</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/from-percona-server-to-mysql-and-back-to-percona-server-beware-of-crash-safe-replication-info" rel="bookmark"><time class="entry-date published" datetime="2014-05-27T07:50:55+02:00">May 27, 2014</time><time class="updated" datetime="2014-05-27T07:52:29+02:00">May 27, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>We’re migrating some of our “vanilla” MySQL 5.5 servers to Percona Server 5.5. One of the major incentives is the <a href="http://www.percona.com/doc/percona-server/5.5/reliability/crash_resistant_replication.html">crash-safe replication</a> feature, allowing slaves to die (power failure) and resume replication without losing position in relay logs.</p>
<p>Whether or not we will migrate all our servers depends on further benchmarking; so far we’ve noticed unexpected results, but these are still premature to publish.</p>
<p>However the fact that we are using both MySQL & Percona Server has led us into a peculiar situation which I’d like to share. We reseed our servers via LVM snapshots. If we need a new machine, or have a corrupted slave, we capture an image of a running slave and duplicate it, a process which takes the better part of a day. This duplicates not only the data, of course, but also the relay logs, the <strong>relay-log.info</strong> file, <strong>master.info</strong> file, implying the <em>position within the topology</em>.</p>
<p>With crash safe replication this also means the transactional relay log position. Recap: crash safe replication writes, per transaction, the relay log status into <strong>ibdata1</strong> file. So the relay log info in <strong>ibdata1</strong> is in perfect alignment with your committed transactions. Upon server startup, Percona Server reads the info from <strong>ibdata1</strong> and overwrites <strong>relay-log.info</strong> file (it completely disregards whatever was in that file prior to startup).</p>
<p>Can you guess what could get wrong here? Here’s the scenario we had; the same problem can unfold in different scenarios.</p>
<p>Take a look at the following topology:</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/simple-topology.png"><img class="alignnone size-full wp-image-6869" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/simple-topology.png" alt="simple topology" width="701" height="297" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/simple-topology.png 701w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/05/simple-topology-300x127.png 300w" sizes="(max-width: 701px) 100vw, 701px"></a></p></blockquote>
<p>(this image is an actual online visualization of a replication topology; for purposes of this blog it’s a sandbox topology on my laptop. Please stand by for some very cool open source release announcement shortly)</p>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/from-percona-server-to-mysql-and-back-to-percona-server-beware-of-crash-safe-replication-info#more-6861" class="more-link">Continue reading »<span class="screen-reader-text"> “From Percona Server to MySQL and back to Percona Server: beware of crash safe replication info”</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/from-percona-server-to-mysql-and-back-to-percona-server-beware-of-crash-safe-replication-info#respond">Leave a Comment<span class="screen-reader-text"> on From Percona Server to MySQL and back to Percona Server: beware of crash safe replication info</span></a></span>	</footer>
</article>

	<nav class="navigation posts-navigation" role="navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://shlomi-noach.github.io/blog/page/10">Older posts</a></div><div class="nav-next"><a href="https://shlomi-noach.github.io/blog/page/8">Newer posts</a></div></div>
	</nav>
	</main>


	<footer id="colophon" class="site-footer">
		<div class="site-info">
			<a href="https://wordpress.org/">
				Powered by WordPress			</a>
			<span class="sep"> | </span>
				Theme: <a href="http://openark.org">openark-primer</a> by <a href="http://underscores.me/">Underscores.me</a>.		</div>
	</footer>
</div>

	<div style="display:none">
	</div>
<script>
var pollsL10n = {"ajax_url":"https:\/\/shlomi-noach.github.io\/blog\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-js.js"></script>
<script src="https://secure.gravatar.com/js/gprofiles.js?ver=2020Junaa"></script>
<script>
var WPGroHo = {"my_hash":""};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/modules/wpgroho.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/navigation.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/skip-link-focus-fix.js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202024.js" async="async" defer></script>
<script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:8.2.1',blog:'32412571',post:'0',tz:'2',srv:'code.openark.org'} ]);
	_stq.push([ 'clickTrackerInit', '32412571', '0' ]);
</script>

</body>
</html>
