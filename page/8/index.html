<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	

	<title>code.openark.org â€“ Page 8 â€“ Blog by Shlomi Noach</title>
<link rel="dns-prefetch" href="//secure.gravatar.com">
<link rel="dns-prefetch" href="//s.w.org">


<link rel="stylesheet" id="wp-block-library-css" href="https://shlomi-noach.github.io/blog/wp-includes/css/dist/block-library/style.min.css" media="all">
<style id="wp-block-library-inline-css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="wp-polls-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-css.css" media="all">
<style id="wp-polls-inline-css">
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel="stylesheet" id="openark-primer-style-css" href="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/style.css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/css/jetpack.css" media="all">
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-includes/js/jquery/jquery-migrate.min.js"></script>




<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<link rel="dns-prefetch" href="//v0.wordpress.com">


<meta property="og:type" content="website">
<meta property="og:title" content="code.openark.org">
<meta property="og:description" content="Blog by Shlomi Noach">
<meta property="og:url" content="https://shlomi-noach.github.io/blog/">
<meta property="og:site_name" content="code.openark.org">
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg">
<meta property="og:locale" content="en_US">


<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(242,101,34,.88);}</style></head>

<body class="home blog paged paged-8 hfeed no-sidebar">
<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#primary">Skip to content</a>

	<header id="masthead" class="site-header">
		<div class="site-branding">
							<h1 class="site-title"><a href="https://shlomi-noach.github.io/blog/" rel="home">code.openark.org</a></h1>
								<p class="site-description">Blog by Shlomi Noach</p>
			
			<nav id="site-navigation" class="main-navigation">
				<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">primary-menu</button>
				<div class="menu-primary-menu-container"><ul id="menu-primary-menu" class="menu"><li id="menu-item-8109" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8109"><a href="https://shlomi-noach.github.io/blog/archives">archives</a></li>
<li id="menu-item-8050" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8050"><a href="https://shlomi-noach.github.io/blog/presentations">presentations</a></li>
<li id="menu-item-8055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8055"><a href="https://shlomi-noach.github.io/blog/about">about</a></li>
<li id="menu-item-8071" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8071"><a href="https://github.com/shlomi-noach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li>
<li id="menu-item-8074" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8074"><a href="https://www.linkedin.com/in/shlominoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li>
<li id="menu-item-8072" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8072"><a href="https://twitter.com/ShlomiNoach"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"></path></svg></a></li>
<li id="menu-item-8073" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8073"><a href="https://shlomi-noach.github.io/blog/feed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-12.832 20c-1.197 0-2.168-.969-2.168-2.165s.971-2.165 2.168-2.165 2.167.969 2.167 2.165-.97 2.165-2.167 2.165zm5.18 0c-.041-4.029-3.314-7.298-7.348-7.339v-3.207c5.814.041 10.518 4.739 10.561 10.546h-3.213zm5.441 0c-.021-7.063-5.736-12.761-12.789-12.792v-3.208c8.83.031 15.98 7.179 16 16h-3.211z"></path></svg></a></li>
</ul></div>			</nav>
		</div>
	</header>

	<main id="primary" class="site-main">

		
<article id="post-7171" class="post-7171 post type-post status-publish format-standard hentry category-mysql tag-secondary">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/joining-booking-com" rel="bookmark">Joining Booking.com</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/secondary" rel="tag">secondary</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/joining-booking-com" rel="bookmark"><time class="entry-date published updated" datetime="2014-11-14T14:04:47+02:00">November 14, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Iâ€™m excited to be joining <a href="https://workingatbooking.com/">Booking.com</a> at the Netherlands in a couple weeks ğŸ™‚</p>
<p>Iâ€™m looking forward to be working with a great team and friendly people! I hope to contribute from my experience and of course be challenged by difficult problems.</p>
<p><em>Booking.com</em> is a supporter of open source in multiple aspects, and I am looking forward to continue working with open source solutions as well as releasing open source code.</p>
<p>I am leaving my work at <a href="http://www.outbrain.com/">Outbrain</a> feeling grateful for the opportunity of working at this wonderful company! I am awed and humbled by the amazing teams Iâ€™ve worked with, whose level of knowledge and insights I can only aspire to match. Thank you in particular to the Infrastructure team, of which I was proud to be part of.</p>
<p>Outbrain allowed me and others (and in fact encouraged and supported) to develop as much <a href="https://github.com/outbrain/">open source</a> as we saw fit. This is not a minor thing: when you orient your code towards open source, you need to make generalizations which are not always providing direct benefit to the company, and which consume precious time. I hold Outbrain in the highest respect for their support for open source.</p>
<p>Â </p>
<p>Â </p>
<p>Â </p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/joining-booking-com#comments">2 Comments<span class="screen-reader-text"> on Joining Booking.com</span></a></span>	</footer>
</article>

<article id="post-7119" class="post-7119 post type-post status-publish format-standard hentry category-mysql tag-orchestrator tag-pseudo-gtid tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/semi-automatic-slavemaster-promotion-via-pseudo-gtid" rel="bookmark">Semi-automatic slave/master promotion via Pseudo GTID</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/semi-automatic-slavemaster-promotion-via-pseudo-gtid" rel="bookmark"><time class="entry-date published updated" datetime="2014-11-10T07:56:58+02:00">November 10, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p><a href="https://github.com/outbrain/orchestrator">Orchestrator</a> release <a href="https://github.com/outbrain/orchestrator/releases">1.2.7-beta</a> now supports semi-automatic slave promotion to master upon master death, via <a href="code.openark.org/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a>.</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-make-master-highlighted.png"><img class="alignnone size-full wp-image-7150" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-make-master-highlighted.png" alt="orchestrator-make-master-highlighted" width="809" height="363" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-make-master-highlighted.png 809w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-make-master-highlighted-300x134.png 300w" sizes="(max-width: 809px) 100vw, 809px"></a></p></blockquote>
<p>When the master is dead, <em>orchestrator</em> automatically picks the most up-to-date slaves and marks them as <strong>â€œMaster candidatesâ€</strong>. It allows a <strong>/api/make-master</strong> call on such a slave (S), in which case it uses <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a> to enslave its siblings, and set S as <strong>read-only = 0</strong>. All we need to do is click the <strong>â€œMake masterâ€</strong> button. <a href="https://shlomi-noach.github.io/blog/mysql/semi-automatic-slavemaster-promotion-via-pseudo-gtid#more-7119" class="more-link">Continue reading Â»<span class="screen-reader-text"> â€œSemi-automatic slave/master promotion via Pseudo GTIDâ€</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/semi-automatic-slavemaster-promotion-via-pseudo-gtid#comments">2 Comments<span class="screen-reader-text"> on Semi-automatic slave/master promotion via Pseudo GTID</span></a></span>	</footer>
</article>

<article id="post-7155" class="post-7155 post type-post status-publish format-standard hentry category-mysql tag-perconalive tag-secondary tag-speaking">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/percona-live-2015-call-for-papers-is-open" rel="bookmark">Percona Live 2015: Call for Papers is open</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/perconalive" rel="tag">PerconaLive</a><a href="https://shlomi-noach.github.io/blog/tag/secondary" rel="tag">secondary</a><a href="https://shlomi-noach.github.io/blog/tag/speaking" rel="tag">Speaking</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/percona-live-2015-call-for-papers-is-open" rel="bookmark"><time class="entry-date published updated" datetime="2014-10-31T08:25:26+02:00">October 31, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>And not for long!</p>
<p>The Call for Papers for <a href="https://www.percona.com/live/mysql-conference-2015">Percona Live MySQL Conference and Expo</a>, to be held at Santa Clara in April 2015, is open. The dead line for submissions is <strong>Nov. 16th</strong>; thatâ€™s just around the corner.</p>
<p>As with previous years, we will hold a <strong>4</strong> day conference, the first being a tutorials day and three days for sessions, BoF and lightning talks, as well as community events. The committee is expecting to review at about 250-300 submissions, out of which it will pick at about 100 talks to schedule or reserve.</p>
<p>We will be using these tracks:</p>
<ul>
<li>High Availability</li>
<li>DevOps</li>
<li>Programming</li>
<li>Performance Optimization</li>
<li>Replication and Backup</li>
<li>MySQL in the Cloud</li>
<li>MySQL and NoSQL</li>
<li>MySQL Case Studies</li>
<li>Security</li>
<li>Whatâ€™s New in MySQL</li>
</ul>
<p>This year we will roughly pre-define the desired number of sessions we wish to have per track. This is not set in stone and everything is fluid. Yet, this will give us better guidelines at choosing and pursuing content for this conference.</p>
<h4>Submitting a proposal</h4>
<p>We encourage all members of the community to submit their tutorial/session/BoF proposals as soon as possible. Please register/login at the <a href="https://www.percona.com/live/mysql-conference-2015/">conference home page</a>.</p>
<p>The guidelines for submitting a proposal are generally unchanged; please review past recommendations: <a href="http://datacharmer.blogspot.com/2008/09/how-to-get-your-proposal-accepted-to.html">[1],</a> <a href="http://www.xaprb.com/blog/2009/12/19/how-to-write-a-good-mysql-conference-proposal/">[2]</a>, <a href="https://shlomi-noach.github.io/blog/mysql/percona-live-mysql-conference-and-expo-2012-a-note-on-proposals">[3], </a><a href="https://shlomi-noach.github.io/blog/mysql/percona-live-mysql-conference-expo-2014-call-for-papers-guidelines">[4]</a>. To add to all these:</p>
<ul>
<li>Do note that we are likely to only review a proposal just once. Please submit only after you have finalized your draft.</li>
<li>Make a reasonable length of proposal. We believe 250 â€“ 300 words are quite enough for a good proposal. Please donâ€™t write an essay, and remember that you proposal is what gets printed on the schedule, and what is read by the conference attendees when choosing the next talk to go to.</li>
<li>Write a descent Bio.</li>
</ul>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/percona-live-2015-call-for-papers-is-open#more-7155" class="more-link">Continue reading Â»<span class="screen-reader-text"> â€œPercona Live 2015: Call for Papers is openâ€</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/percona-live-2015-call-for-papers-is-open#respond">Leave a Comment<span class="screen-reader-text"> on Percona Live 2015: Call for Papers is open</span></a></span>	</footer>
</article>

<article id="post-7088" class="post-7088 post type-post status-publish format-standard hentry category-mysql tag-orchestrator tag-pseudo-gtid tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour" rel="bookmark">Refactoring replication topologies with Pseudo GTID: a visual tour</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour" rel="bookmark"><time class="entry-date published" datetime="2014-10-27T11:55:39+02:00">October 27, 2014</time><time class="updated" datetime="2014-10-27T16:33:38+02:00">October 27, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p><em>Orchestrator</em> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.2.1-beta">1.2.1-beta</a> supports Pseudo GTID (<a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure">read announcement</a>): a means to refactor the replication topology and connect slaves even without direct relationship; even across failed servers. This post illustrates two such scenarios and shows the visual way of mathcing/re-synching slaves.</p>
<p>Of course, orchestrator is not just a GUI tool; anything done with drag-and-drop is also done via web API (in fact, the drag-and-drop invoke the web API) as well as via command line. Iâ€™m mentioning this as this is the grounds for failover automation planned for the future.</p>
<h4>Scenario 1: the master unexpectedly dies</h4>
<p>The master crashes and cannot be contacted. All slaves are stopped as effect, but each in a different position. Some managed to salvage relay logs just before the master dies, some didnâ€™t. In our scenario, all three slaves are at least caught up with the relay log (that is, whatever they managed to pull through the network, they already managed to execute). So theyâ€™re otherwise sitting idle waiting for something to happen. Well, somethingâ€™s about to happen.</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master.png"><img class="alignnone size-large wp-image-7090" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-1024x323.png" alt="orchestrator-pseudo-gtid-dead-master" width="1024" height="323" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-1024x323.png 1024w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-300x94.png 300w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-900x284.png 900w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master.png 1132w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p></blockquote>
<p>Note the green â€œSafe modeâ€ button to the right. This means operation is through calculation of binary log files & positions with relation to oneâ€™s master. But the master is now dead, so letâ€™s switch to adventurous mode; in this mode we can drag and drop slaves onto instances normally forbidden. At this stage the web interface allows us to drop a slave onto its sibling or any of its ancestors (including its very own parent, which is a means of reconnecting a slave with its parent). Anyhow:</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode.png"><img class="alignnone size-large wp-image-7091" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode-1024x296.png" alt="orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode" width="1024" height="296" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode-1024x296.png 1024w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode-300x86.png 300w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode-900x260.png 900w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-master-pseudo-gtid-mode.png 1188w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p></blockquote>
<p>We notice that orchestrator is already kind enough to say which slave is best candidate to be the new master (<strong>127.0.0.1:22990</strong>): this is the slave (or one of the slaves) with most up-to-date data. So we choose to take another server and make it a slave of <strong>127.0.0.1:22990</strong>: <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour#more-7088" class="more-link">Continue reading Â»<span class="screen-reader-text"> â€œRefactoring replication topologies with Pseudo GTID: a visual tourâ€</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topologies-with-pseudo-gtid-a-visual-tour#respond">Leave a Comment<span class="screen-reader-text"> on Refactoring replication topologies with Pseudo GTID: a visual tour</span></a></span>	</footer>
</article>

<article id="post-7114" class="post-7114 post type-post status-publish format-standard hentry category-mysql tag-open-source tag-orchestrator tag-pseudo-gtid tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure" rel="bookmark">Orchestrator 1.2.1 BETA: Pseudo GTID support, reconnect slaves even after master failure</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure" rel="bookmark"><time class="entry-date published updated" datetime="2014-10-27T11:51:51+02:00">October 27, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p><em>orchestrator</em> <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.2.1-beta">1.2.1 BETA is released</a>. This version supports <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid">Pseudo GTID</a>, and provides one with powerful refactoring of oneâ€™s replication topologies, even across failed instances.</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag.png"><img class="alignnone size-large wp-image-7101" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag-1024x292.png" alt="orchestrator-pseudo-gtid-dead-relay-master-begin-drag" width="1024" height="292" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag-1024x292.png 1024w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag-300x85.png 300w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag-900x256.png 900w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-pseudo-gtid-dead-relay-master-begin-drag.png 1097w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p>
<p>Depicted: moving a slave up the topology even though its local master is inaccessible</p></blockquote>
<h4>Enabling Pseudo-GTID</h4>
<p>You will need to:</p>
<ol>
<li>Inject a periodic unique entry onto your binary logs</li>
<li>Configure <em>orchestrator</em> to recognize said entry.</li>
</ol>
<h4>Pseudo GTID injection example</h4>
<p>We will use the <a href="http://dev.mysql.com/doc/refman/5.5/en/events.html">event scheduler</a> (must be enabled) to inject an entry every <strong>10</strong> seconds, recognized both in statement-based and row-based replication.</p>
<blockquote>
<pre>create database if not exists meta;

drop event if exists meta.create_pseudo_gtid_view_event;

delimiter ;;
create event if not exists
Â  meta.create_pseudo_gtid_view_event
Â  on schedule every 10 second starts current_timestamp
Â  on completion preserve
Â  enable
Â  do
Â Â Â  begin
Â Â Â Â Â  set @pseudo_gtid := uuid();
Â Â Â Â Â  set @_create_statement := concat('create or replace view meta.pseudo_gtid_view as select \'', @pseudo_gtid, '\' as pseudo_gtid_unique_val from dual');
Â Â Â Â Â  PREPARE st FROM @_create_statement;
Â Â Â Â Â  EXECUTE st;
Â Â Â Â Â  DEALLOCATE PREPARE st;
Â Â Â  end
;;

delimiter ;

set global event_scheduler := 1;</pre>
</blockquote>
<p>Make sure to enable <em>event_scheduler</em> in your <strong>my.cnf</strong> config file.</p>
<p>An entry in the binary logs would look like this: <a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure#more-7114" class="more-link">Continue reading Â»<span class="screen-reader-text"> â€œOrchestrator 1.2.1 BETA: Pseudo GTID support, reconnect slaves even after master failureâ€</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-2-1-beta-pseudo-gtid-support-reconnect-slaves-even-after-master-failure#comments">1 Comment<span class="screen-reader-text"> on Orchestrator 1.2.1 BETA: Pseudo GTID support, reconnect slaves even after master failure</span></a></span>	</footer>
</article>

<article id="post-7046" class="post-7046 post type-post status-publish format-standard hentry category-mysql tag-gtid tag-orchestrator tag-pseudo-gtid tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid" rel="bookmark">Refactoring replication topology with Pseudo GTID</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/gtid" rel="tag">GTID</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid" rel="bookmark"><time class="entry-date published updated" datetime="2014-10-23T12:37:17+02:00">October 23, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>This post describes in detail the method of usingÂ Pseudo GTID to achieve unplanned replication topology changes, i.e. connecting two arbitrary slaves, or recovering from a master failure even as all its slaves are hanging in different positions.</p>
<p>Please read <a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid">Pseudo GTID</a> and <a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid-row-based-replication">Pseudo GTID, RBR</a> as introduction.</p>
<p>Consider the following case: the master dies unexpectedly, and its three slaves are all hanging, not necessarily at same binary log file/position (network broke down while some slaves managed to salvage more entries into their relay logs than others)</p>
<blockquote><p><a href="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-failed-master.jpeg"><img class="alignnone size-full wp-image-7059" src="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-failed-master.jpeg" alt="orchestrator-failed-master" width="801" height="365" srcset="https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-failed-master.jpeg 801w,https://shlomi-noach.github.io/blog/wp-content/uploads/2014/10/orchestrator-failed-master-300x136.jpeg 300w" sizes="(max-width: 801px) 100vw, 801px"></a></p></blockquote>
<p>(Did you notice the <strong>â€œCandidate for masterâ€</strong> message? To be discussed shortly)</p>
<h4>GTID</h4>
<p>With GTID each transaction (and entry in the binary log) is associated with a unique mark â€” the Global Transaction ID. Just pick the slave with the most advanced GTID to be the next master, and just <strong>CHANGE MASTER TO MASTER_HOST=â€™chosen_slaveâ€™</strong> on the other slaves, and everything magically works. A slave knows which GTID it has already processed, and can look that entry on its masterâ€™s binary logs, resuming replication on the one that follows.</p>
<p>How does that work? The masterâ€™s binary logs are searched for that GTID entry. Iâ€™m not sure how brute-force this is, since Iâ€™m aware of a subtlety which requires brute-force scan of all binary logs; I donâ€™t actually know if itâ€™s always like that.</p>
<h4>Pseudo GTID</h4>
<p>We can mimick that above, but our solution canâ€™t be as fine grained. With the injection of Pseudo GTID we mark the binary log for unique entries. But instead of having a unique identifier for every entry, we have a unique identifier for every second, 10 seconds, or what have you, with otherwise normal, non-unique entries in between our Pseudo GTID entries.</p>
<h4>Recognizing which slave is more up to date</h4>
<p>Given two slaves, which is more up to date?</p>
<ul>
<li>If both replicate(d) from same master, a <strong>SHOW SLAVE STATUS</strong> comparison answers (safe method: wait till SQL thread catches up with broken IO thread, compare <strong>relay_master_log_file</strong>, <strong>exec_master_log_pos</strong> on both machines). This is the method by which the above â€œCandidate for masterâ€ message is produced.</li>
<li>If one is/was descendent of the other, then obviously it is less advanced or equals its ancestor.</li>
<li>Otherwise weâ€™re unsure â€“ still solvable via bi-directional trial & error, as explained later on.</li>
</ul>
<p>For now, letâ€™s assume we know which slave is more up to date (has received and executed more relay logs). Letâ€™s call it <strong>S1</strong>, whereas the less up-to-date will be <strong>S2</strong>. This will make our discussion simpler. <a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid#more-7046" class="more-link">Continue reading Â»<span class="screen-reader-text"> â€œRefactoring replication topology with Pseudo GTIDâ€</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/refactoring-replication-topology-with-pseudo-gtid#comments">5 Comments<span class="screen-reader-text"> on Refactoring replication topology with Pseudo GTID</span></a></span>	</footer>
</article>

<article id="post-7043" class="post-7043 post type-post status-publish format-standard hentry category-mysql tag-gtid tag-orchestrator tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid-row-based-replication" rel="bookmark">Pseudo GTID, Row Based Replication</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/gtid" rel="tag">GTID</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid-row-based-replication" rel="bookmark"><time class="entry-date published updated" datetime="2014-10-23T06:18:52+02:00">October 23, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>This post continues <a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid">Pseudo GTID</a>, in a series of posts describing an alternative to using MySQL GTIDs.</p>
<p>The solution offered in the last post does not work too well for row based replication. The binary log entries for the INSERT statement look like this:</p>
<blockquote>
<pre># at 1020
# at 1074
#141020 12:36:21 server id 1Â  end_log_pos 1074Â  Table_map: `test`.`pseudo_gtid` mapped to number 33
#141020 12:36:21 server id 1Â  end_log_pos 1196Â  Update_rows: table id 33 flags: STMT_END_F

BINLOG '
lddEVBMBAAAANgAAADIEAAAAACEAAAAAAAEABHRlc3QAC3BzZXVkb19ndGlkAAMDBw8CQAAE
lddEVBgBAAAAegAAAKwEAAAAACEAAAAAAAEAA///+AEAAACL10RUJDg2ZmRhMDk1LTU4M2MtMTFl
NC05NzYyLTNjOTcwZWEzMWVhOPgBAAAAlddEVCQ4Y2YzOWMyYy01ODNjLTExZTQtOTc2Mi0zYzk3
MGVhMzFlYTg=
'/*!*/;
</pre>
</blockquote>
<p>Whereâ€™s our unique value? Encoded within something that cannot be trusted to be unique. Issuing <strong>mysqlbinlog â€“verbose</strong> helps out:</p>
<blockquote>
<pre>BEGIN
/*!*/;
# at 183
# at 237
#141020 12:35:51 server id 1Â  end_log_pos 237Â Â  Table_map: `test`.`pseudo_gtid` mapped to number 33
#141020 12:35:51 server id 1Â  end_log_pos 359Â Â  Update_rows: table id 33 flags: STMT_END_F

BINLOG '
d9dEVBMBAAAANgAAAO0AAAAAACEAAAAAAAEABHRlc3QAC3BzZXVkb19ndGlkAAMDBw8CQAAE
d9dEVBgBAAAAegAAAGcBAAAAACEAAAAAAAEAA///+AEAAABt10RUJDc1MWJkYzEwLTU4M2MtMTFl
NC05NzYyLTNjOTcwZWEzMWVhOPgBAAAAd9dEVCQ3YjExZDQzYy01ODNjLTExZTQtOTc2Mi0zYzk3
MGVhMzFlYTg=
'/*!*/;
### UPDATE `test`.`pseudo_gtid`
### WHERE
###Â Â  @1=1
###Â Â  @2=1413797741
###Â Â  <strong>@3='751bdc10-583c-11e4-9762-3c970ea31ea8'</strong>
### SET
###Â Â  @1=1
###Â Â  @2=1413797751
###Â Â  @3='7b11d43c-583c-11e4-9762-3c970ea31ea8'</pre>
</blockquote>
<p>and thatâ€™s something we can work with. However, I like to do stuff from within MySQL, and rely as little as possible on external tools. How do the binary log entries look via <strong>SHOW BINLOG EVENTS</strong>? Not good.</p>
<blockquote>
<pre>master [localhost] {msandbox} (test) > show binlog events in 'mysql-bin.000058' limit 20;
+------------------+------+-------------+-----------+-------------+---------------------------------------+
| Log_nameÂ Â Â Â Â Â Â Â  | PosÂ  | Event_typeÂ  | Server_id | End_log_pos | InfoÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
+------------------+------+-------------+-----------+-------------+---------------------------------------+
| mysql-bin.000058 |Â Â Â  4 | Format_desc |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  107 | Server ver: 5.5.32-log, Binlog ver: 4 |
| mysql-bin.000058 |Â  107 | QueryÂ Â Â Â Â Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  183 | BEGINÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  183 | Table_mapÂ Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  237 | table_id: 33 (test.pseudo_gtid)Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  237 | Update_rows |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  359 | table_id: 33 flags: STMT_END_FÂ Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  359 | XidÂ Â Â Â Â Â Â Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  386 | COMMIT /* xid=5460 */Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  386 | QueryÂ Â Â Â Â Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  462 | BEGINÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  462 | Table_mapÂ Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  516 | table_id: 33 (test.pseudo_gtid)Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  516 | Update_rows |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  638 | table_id: 33 flags: STMT_END_FÂ Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  638 | XidÂ Â Â Â Â Â Â Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  665 | COMMIT /* xid=5471 */Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  665 | QueryÂ Â Â Â Â Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  741 | BEGINÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  741 | Table_mapÂ Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  795 | table_id: 33 (test.pseudo_gtid)Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  795 | Update_rows |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  917 | table_id: 33 flags: STMT_END_FÂ Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  917 | XidÂ Â Â Â Â Â Â Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â Â  944 | COMMIT /* xid=5474 */Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| mysql-bin.000058 |Â  944 | QueryÂ Â Â Â Â Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â  1020 | BEGINÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| mysql-bin.000058 | 1020 | Table_mapÂ Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â  1074 | table_id: 33 (test.pseudo_gtid)Â Â Â Â Â Â  |
| mysql-bin.000058 | 1074 | Update_rows |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â  1196 | table_id: 33 flags: STMT_END_FÂ Â Â Â Â Â Â  |
| mysql-bin.000058 | 1196 | XidÂ Â Â Â Â Â Â Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â  1223 | COMMIT /* xid=5476 */Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| mysql-bin.000058 | 1223 | QueryÂ Â Â Â Â Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â  1299 | BEGINÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
| mysql-bin.000058 | 1299 | Table_mapÂ Â  |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â  1353 | table_id: 33 (test.pseudo_gtid)Â Â Â Â Â Â  |
| mysql-bin.000058 | 1353 | Update_rows |Â Â Â Â Â Â Â Â  1 |Â Â Â Â Â Â Â  1475 | table_id: 33 flags: STMT_END_FÂ Â Â Â Â Â Â  |
+------------------+------+-------------+-----------+-------------+---------------------------------------+</pre>
</blockquote>
<p>The representation of row-format entries in the <strong>SHOW BINLOG EVENTS</strong> output is really poor. Why, thereâ€™s nothing to tell me at all about whatâ€™s been done, except that this is some operation on <strong>test.pseudo_gtid</strong>. Obviously I cannot find anything unique over here.</p>
<p>Not all is lost. How about DDL statements? Those are still written in SBR format (thereâ€™s no <em>rows</em> to log upon creating a table). A solution could be somehow manipulating a unique value in a DDL statement. There could be various such solutions, and I chose to use a <strong>CREATE VIEW</strong> statement, dynamically composed of a <strong>UUID()</strong>: <a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid-row-based-replication#more-7043" class="more-link">Continue reading Â»<span class="screen-reader-text"> â€œPseudo GTID, Row Based Replicationâ€</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid-row-based-replication#comments">2 Comments<span class="screen-reader-text"> on Pseudo GTID, Row Based Replication</span></a></span>	</footer>
</article>

<article id="post-7036" class="post-7036 post type-post status-publish format-standard hentry category-mysql tag-gtid tag-orchestrator tag-pseudo-gtid tag-replic">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid" rel="bookmark">Pseudo GTID</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/gtid" rel="tag">GTID</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/pseudo-gtid" rel="tag">Pseudo GTID</a><a href="https://shlomi-noach.github.io/blog/tag/replic" rel="tag">replic</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid" rel="bookmark"><time class="entry-date published" datetime="2014-10-22T07:22:26+02:00">October 22, 2014</time><time class="updated" datetime="2015-08-20T10:39:26+02:00">August 20, 2015</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>Pseudo GTID is a method to implement a GTID-like solution where slaves are easily connected to one another. This blog post and the following ones will describe work in progress (some 80% completed), where simulation of GTID makes for a <em>good enough</em> basis for refactoring replication topologies. Iâ€™m coding this in <a href="https://github.com/outbrain/orchestrator">orchestrator</a>, which already provides a substantial infrastructure support for this.</p>
<p>The final goal: <em>orchestrator</em> will allow you to move a slave below another, using only the data available by those two slaves. The usage is obvious:</p>
<ul>
<li>Easy master failover (master dead? <em>Orchestrator</em> will choose the most advanced slave to promote <em>and</em> make it master of its siblings)</li>
<li>Slave promotion in complex topologies (with <a href="https://shlomi-noach.github.io/blog/mysql/using-deep-nested-replication-topologies">deep nested topologies</a>, be able to move a slave up the hierarchy even if its local master is corrupted).</li>
</ul>
<p>This can all happen with your normal, <em>non GTID</em>, MySQL replication, using your normal binary log files & positions.</p>
<p>This work in progress is inspired by <strong><a href="https://github.com/samlambert">Sam Lambert</a></strong> at GitHub, who has worked on a similar solution with different implementation. I also recall discussions with other DBAs having similar solution.</p>
<h4>Pseudo GTID</h4>
<p>First thingâ€™s first, the basis for proposed solution is a <em>pseudo-GTID</em>. A unique entry in the binary logs (not necessarily sequential; not necessarily in ascending order). While in GTID implementations we have a unique identifier <em>for each entry</em> in the binary log, with pseudo-GTID we accept an <em>occasional</em> (or <em>frequent</em>) unique entry in the binary log.</p>
<p>There are many ways to do so. Certainly a client can generate a unique Id and invoke some statement on MySQL involving that ID. That would serve as valid grounds for the proposed solution. But I like things to be contained within MySQL. Consider, for example, the following event, which would be my preferred choice in Statement Based Replication (for RBR solution, see next post):</p>
<blockquote>
<pre>drop table if exists test.pseudo_gtid;
create table if not exists test.pseudo_gtid (
Â  id int unsigned not null primary key,
Â  ts timestamp,
Â  gtid varchar(64) charset ascii
);


drop event if exists test.update_pseudo_gtid_event;

delimiter ;;
create event if not exists
Â  test.update_pseudo_gtid_event
Â  on schedule every 10 second starts current_timestamp
Â  on completion preserve
Â  enable
Â  do
Â Â Â  begin
Â Â Â Â Â  set @pseudo_gtid := uuid();
Â Â Â Â Â  insert into test.pseudo_gtid (id, ts, gtid) values (1, NOW(), @pseudo_gtid) on duplicate key update ts=NOW(), gtid=VALUES(gtid);
Â Â Â  end
;;

delimiter ;</pre>
</blockquote>
<p>The above is based on <a title="Link to Making UUID() and RAND() replication safe" href="https://shlomi-noach.github.io/blog/mysql/making-uuid-and-rand-replication-safe" rel="bookmark">Making UUID() and RAND() replication safe</a>. What do we get? Once in 10 seconds (or what have you), a unique entry is written to the binary log.</p>
<p> <a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid#more-7036" class="more-link">Continue reading Â»<span class="screen-reader-text"> â€œPseudo GTIDâ€</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/pseudo-gtid#comments">1 Comment<span class="screen-reader-text"> on Pseudo GTID</span></a></span>	</footer>
</article>

<article id="post-7034" class="post-7034 post type-post status-publish format-standard hentry category-mysql tag-hack tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/making-uuid-and-rand-replication-safe" rel="bookmark">Making UUID() and RAND() replication safe</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/hack" rel="tag">Hack</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/making-uuid-and-rand-replication-safe" rel="bookmark"><time class="entry-date published updated" datetime="2014-10-20T08:40:04+02:00">October 20, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p>MySQLâ€™s <a href="http://dev.mysql.com/doc/refman/5.5/en/miscellaneous-functions.html#function_uuid"><strong>UUID()</strong></a> and <a href="http://dev.mysql.com/doc/refman/5.5/en/mathematical-functions.html#function_rand"><strong>RAND()</strong></a> functions both provide with (pseudo) indeterministic result. <strong>UUID()</strong>â€˜s result is moreover bound to the host on which it executes. For this reason, both are unsafe to replicate with <strong>STATEMENT</strong> binlog format. As an example, consider:</p>
<blockquote>
<pre><strong>master></strong> create table test.uuid_test (id int, u varchar(64));

<strong>master></strong> insert into test.uuid_test values (1, UUID());
Query OK, 1 row affected, 1 warning (0.03 sec)

<strong>master></strong> select * from test.uuid_test;
+------+--------------------------------------+
| idÂ Â  | uÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
+------+--------------------------------------+
|Â Â Â  1 | 7e3596d8-56ac-11e4-b284-3c970ea31ea8 |
+------+--------------------------------------+</pre>
</blockquote>
<p>The warning we got on the insert directly relates to the following inconsistency on a slave:</p>
<blockquote>
<pre><strong>slave1></strong> select * from test.uuid_test;
+------+--------------------------------------+
| idÂ Â  | uÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
+------+--------------------------------------+
|Â Â Â  1 | 7e379d63-56ac-11e4-8477-3c970ea31ea8 |
+------+--------------------------------------+</pre>
</blockquote>
<p>The data on the slave is clearly inconsistent with the masterâ€™s. The slave, replicating via <strong>STATEMENT</strong> binlog format, re-executes the <strong>INSERT</strong> command and gets a different UUID value.</p>
<h4>External</h4>
<p>One solution to the above is to generate the UUID value from your application. By the time MySQL gets the <strong>INSERT</strong> statement, the UUID value is a constant string, as far as MySQL is concerned.</p>
<h4>Internal</h4>
<p>However thereâ€™s a way to do it from within MySQL, by decoupling the <strong>UUID()</strong> function from the <strong>INSERT</strong> statement. It takes a session variable. Consider: <a href="https://shlomi-noach.github.io/blog/mysql/making-uuid-and-rand-replication-safe#more-7034" class="more-link">Continue reading Â»<span class="screen-reader-text"> â€œMaking UUID() and RAND() replication safeâ€</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/making-uuid-and-rand-replication-safe#comments">5 Comments<span class="screen-reader-text"> on Making UUID() and RAND() replication safe</span></a></span>	</footer>
</article>

<article id="post-7026" class="post-7026 post type-post status-publish format-standard hentry category-mysql tag-open-source tag-orchestrator tag-replication">
	<header class="entry-header">
		<h2 class="entry-title"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-1-18-new-features-support-for-orchestrator-agent" rel="bookmark">orchestrator 1.1.18: new features, support for orchestrator-agent</a></h2>			<div class="entry-meta">
				<span class="cat-links"><a href="https://shlomi-noach.github.io/blog/category/mysql" rel="category tag">MySQL</a></span><span class="tags-links"><a href="https://shlomi-noach.github.io/blog/tag/open-source" rel="tag">Open Source</a><a href="https://shlomi-noach.github.io/blog/tag/orchestrator" rel="tag">orchestrator</a><a href="https://shlomi-noach.github.io/blog/tag/replication" rel="tag">Replication</a></span><span class="posted-on alignright"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-1-18-new-features-support-for-orchestrator-agent" rel="bookmark"><time class="entry-date published updated" datetime="2014-10-13T15:00:35+02:00">October 13, 2014</time></a></span>			</div>
			</header>

	
	<div class="entry-content">
		<p><a href="https://github.com/outbrain">Outbrain</a>â€˜s <a href="https://github.com/outbrain/orchestrator"><strong>orchestrator 1.1.18</strong></a> is released:</p>
<ul>
<li>Support for <a href="https://github.com/outbrain/orchestrator-agent"><strong>orchestrator-agent</strong></a> (see <a href="https://shlomi-noach.github.io/blog/mysql/announcing-orchestrator-agent">announcement</a>): agent pages, support for agent actions, initiation of seeds (provisioning of new/corrupted servers), auditing of seeds.</li>
<li>Clusters dashboard</li>
<li>Support for long query auditing</li>
<li>SSL</li>
<li>Proxy authentication (e.g. apache2 serving as reverse-proxy with LDAP)</li>
<li>User control</li>
<li>Better slave moving rules.</li>
</ul>
<p>Quick links:</p>
<ul>
<li>Get <a href="https://github.com/outbrain/orchestrator/releases/tag/v1.1.18"><strong>orchestrator 1.1.18</strong></a></li>
<li>Read the <strong><a href="https://github.com/outbrain/orchestrator/wiki/Orchestrator-Manual">orchestrator manual</a></strong></li>
<li>Check out <strong><a href="https://github.com/outbrain/orchestrator-agent">orchestrator-agent</a></strong></li>
</ul>
<p><em>orchestrator</em> now allows for seeding/provisioning of servers via <em>orchestrator-agent</em>. It communicates with agents executing on the MySQL hosts and coordinate transfer of data between them. orchestrator now supports invocation and auditing of seeding operations, and protects you from breaking your seeds. The <em>orchestrator-agent</em> is a solution to Outbrainâ€™s specific use case, and may not appeal to the greater crowd. Nonetheless it is extendible and is released as open source. <a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-1-18-new-features-support-for-orchestrator-agent#more-7026" class="more-link">Continue reading Â»<span class="screen-reader-text"> â€œorchestrator 1.1.18: new features, support for orchestrator-agentâ€</span></a></p>
	</div>

	<footer class="entry-footer">
		<span class="comments-link"><a href="https://shlomi-noach.github.io/blog/mysql/orchestrator-1-1-18-new-features-support-for-orchestrator-agent#respond">Leave a Comment<span class="screen-reader-text"> on orchestrator 1.1.18: new features, support for orchestrator-agent</span></a></span>	</footer>
</article>

	<nav class="navigation posts-navigation" role="navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://shlomi-noach.github.io/blog/page/9">Older posts</a></div><div class="nav-next"><a href="https://shlomi-noach.github.io/blog/page/7">Newer posts</a></div></div>
	</nav>
	</main>


	<footer id="colophon" class="site-footer">
		<div class="site-info">
			<a href="https://wordpress.org/">
				Powered by WordPress			</a>
			<span class="sep"> | </span>
				Theme: <a href="http://openark.org">openark-primer</a> by <a href="http://underscores.me/">Underscores.me</a>.		</div>
	</footer>
</div>

	<div style="display:none">
	</div>
<script>
var pollsL10n = {"ajax_url":"https:\/\/shlomi-noach.github.io\/blog\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/wp-polls/polls-js.js"></script>
<script src="https://secure.gravatar.com/js/gprofiles.js?ver=2020Junaa"></script>
<script>
var WPGroHo = {"my_hash":""};
</script>
<script src="https://shlomi-noach.github.io/blog/wp-content/plugins/jetpack/modules/wpgroho.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/navigation.js"></script>
<script src="https://shlomi-noach.github.io/blog/wp-content/themes/openark-primer/js/skip-link-focus-fix.js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202024.js" async="async" defer></script>
<script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:8.2.1',blog:'32412571',post:'0',tz:'2',srv:'code.openark.org'} ]);
	_stq.push([ 'clickTrackerInit', '32412571', '0' ]);
</script>

</body>
</html>
