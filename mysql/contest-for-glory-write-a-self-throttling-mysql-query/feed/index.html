<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	
	xmlns:georss="http://www.georss.org/georss"
	xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
	
	>
<channel>
	<title>
	Comments on: Contest for Glory: write a self throttling MySQL query	</title>
	<atom:link href="https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/feed" rel="self" type="application/rss+xml" />
	<link>https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query</link>
	<description>Blog by Shlomi Noach</description>
	<lastBuildDate>Thu, 24 Nov 2011 18:28:36 +0000</lastBuildDate>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.3.3</generator>
			<item>
				<title>
				By: shlomi				</title>
				<link>https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/comment-page-1#comment-60256</link>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
		<pubDate>Thu, 24 Nov 2011 18:27:30 +0000</pubDate>
		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4245#comment-60256</guid>
					<description><![CDATA[@harald,

The solution has long been published. You should check on my site more often!
Here&#039;s the link:
&lt;a href=&quot;https://shlomi-noach.github.io/blog/mysql/self-throttling-mysql-queries&quot; rel=&quot;nofollow&quot;&gt;Self throttling MySQL queries&lt;/a&gt;]]></description>
		<content:encoded><![CDATA[<p>@harald,</p>
<p>The solution has long been published. You should check on my site more often!<br />
Here&#8217;s the link:<br />
<a href="https://shlomi-noach.github.io/blog/mysql/self-throttling-mysql-queries" rel="nofollow">Self throttling MySQL queries</a></p>
]]></content:encoded>
						</item>
						<item>
				<title>
				By: harald				</title>
				<link>https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/comment-page-1#comment-60247</link>
		<dc:creator><![CDATA[harald]]></dc:creator>
		<pubDate>Thu, 24 Nov 2011 16:28:56 +0000</pubDate>
		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4245#comment-60247</guid>
					<description><![CDATA[how many days are &quot;a couple of days&quot;? ;-)

thanks!]]></description>
		<content:encoded><![CDATA[<p>how many days are &#8220;a couple of days&#8221;? ðŸ˜‰</p>
<p>thanks!</p>
]]></content:encoded>
						</item>
						<item>
				<title>
				By: Self throttling MySQL queries &#124; code.openark.org				</title>
				<link>https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/comment-page-1#comment-57291</link>
		<dc:creator><![CDATA[Self throttling MySQL queries &#124; code.openark.org]]></dc:creator>
		<pubDate>Tue, 01 Nov 2011 07:58:01 +0000</pubDate>
		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4245#comment-57291</guid>
					<description><![CDATA[[...] Contest for Glory: write a self throttling MySQL query [...]]]></description>
		<content:encoded><![CDATA[<p>[&#8230;] Contest for Glory: write a self throttling MySQL query [&#8230;]</p>
]]></content:encoded>
						</item>
						<item>
				<title>
				By: shlomi				</title>
				<link>https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/comment-page-1#comment-57034</link>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
		<pubDate>Sat, 29 Oct 2011 04:38:15 +0000</pubDate>
		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4245#comment-57034</guid>
					<description><![CDATA[@Baron,
This contest is so desolate! Apart from Marc no one has submitted anything...
I&#039;ll give it a couple more days, then publish a solution. Do feel free to post your ideas.]]></description>
		<content:encoded><![CDATA[<p>@Baron,<br />
This contest is so desolate! Apart from Marc no one has submitted anything&#8230;<br />
I&#8217;ll give it a couple more days, then publish a solution. Do feel free to post your ideas.</p>
]]></content:encoded>
						</item>
						<item>
				<title>
				By: Baron Schwartz				</title>
				<link>https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/comment-page-1#comment-56993</link>
		<dc:creator><![CDATA[Baron Schwartz]]></dc:creator>
		<pubDate>Fri, 28 Oct 2011 19:44:21 +0000</pubDate>
		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4245#comment-56993</guid>
					<description><![CDATA[I guess I can say that I figured it out in a conversation with Shlomi after recalling something funny about most SHOW commands... and maybe that is a hint.  But it&#039;s better than posting the solution and depriving others of the fun :-)]]></description>
		<content:encoded><![CDATA[<p>I guess I can say that I figured it out in a conversation with Shlomi after recalling something funny about most SHOW commands&#8230; and maybe that is a hint.  But it&#8217;s better than posting the solution and depriving others of the fun ðŸ™‚</p>
]]></content:encoded>
						</item>
						<item>
				<title>
				By: shlomi				</title>
				<link>https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/comment-page-1#comment-56948</link>
		<dc:creator><![CDATA[shlomi]]></dc:creator>
		<pubDate>Fri, 28 Oct 2011 05:38:27 +0000</pubDate>
		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4245#comment-56948</guid>
					<description><![CDATA[@Marc,

very cool. Actually, I forgot to add an important thing: my talk suggested no stored routines are required ... ;)]]></description>
		<content:encoded><![CDATA[<p>@Marc,</p>
<p>very cool. Actually, I forgot to add an important thing: my talk suggested no stored routines are required &#8230; ðŸ˜‰</p>
]]></content:encoded>
						</item>
						<item>
				<title>
				By: Marc Alff				</title>
				<link>https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/comment-page-1#comment-56914</link>
		<dc:creator><![CDATA[Marc Alff]]></dc:creator>
		<pubDate>Thu, 27 Oct 2011 22:55:40 +0000</pubDate>
		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4245#comment-56914</guid>
					<description><![CDATA[Proposed entry, which assumes mysql 5.6 and the performance schema:

-- helper


create function tools.throttle(every_n integer, delay integer)
returns varchar(20)
begin
  declare sent integer;
  declare dummy integer;

  if (every_n &#060;= 0) then
    signal sqlstate &#039;HUMMM&#039; set message_text = &quot;Very funny. Try harder.&quot;,
                                mysql_errno = 50000;
  end if;

  set sent =
   (select ROWS_SENT from performance_schema.events_statements_current
    where THREAD_ID = @my_tid);

  if ((sent &#062; 0) and (sent % every_n = 0)) then
    set dummy = (select sleep(delay));
  end if;

  return sysdate();
end
$$


-- once in the session, do this:


set @my_tid= (select THREAD_ID from performance_schema.threads
  where PROCESSLIST_ID = connection_id());


-- before

select * from big_table;
select anything_you_want from big_table;


-- after

select big_table.*, tools.throttle(1000, 2) from big_table;
select anything_you_want, tools.throttle(1000, 2) from big_table;
]]></description>
		<content:encoded><![CDATA[<p>Proposed entry, which assumes mysql 5.6 and the performance schema:</p>
<p>&#8212; helper</p>
<p>create function tools.throttle(every_n integer, delay integer)<br />
returns varchar(20)<br />
begin<br />
  declare sent integer;<br />
  declare dummy integer;</p>
<p>  if (every_n &lt;= 0) then<br />
    signal sqlstate &#8216;HUMMM&#8217; set message_text = &#8220;Very funny. Try harder.&#8221;,<br />
                                mysql_errno = 50000;<br />
  end if;</p>
<p>  set sent =<br />
   (select ROWS_SENT from performance_schema.events_statements_current<br />
    where THREAD_ID = @my_tid);</p>
<p>  if ((sent &gt; 0) and (sent % every_n = 0)) then<br />
    set dummy = (select sleep(delay));<br />
  end if;</p>
<p>  return sysdate();<br />
end<br />
$$</p>
<p>&#8212; once in the session, do this:</p>
<p>set @my_tid= (select THREAD_ID from performance_schema.threads<br />
  where PROCESSLIST_ID = connection_id());</p>
<p>&#8212; before</p>
<p>select * from big_table;<br />
select anything_you_want from big_table;</p>
<p>&#8212; after</p>
<p>select big_table.*, tools.throttle(1000, 2) from big_table;<br />
select anything_you_want, tools.throttle(1000, 2) from big_table;</p>
]]></content:encoded>
						</item>
						<item>
				<title>
				By: Marc Alff				</title>
				<link>https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/comment-page-1#comment-56910</link>
		<dc:creator><![CDATA[Marc Alff]]></dc:creator>
		<pubDate>Thu, 27 Oct 2011 22:25:17 +0000</pubDate>
		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4245#comment-56910</guid>
					<description><![CDATA[Correction (due to brackets tags lost in post)

select anything-you-want from big_table
becomes
select anything-you-want, tools.throttle(1000, 2) from big_table.]]></description>
		<content:encoded><![CDATA[<p>Correction (due to brackets tags lost in post)</p>
<p>select anything-you-want from big_table<br />
becomes<br />
select anything-you-want, tools.throttle(1000, 2) from big_table.</p>
]]></content:encoded>
						</item>
						<item>
				<title>
				By: Marc Alff				</title>
				<link>https://shlomi-noach.github.io/blog/mysql/contest-for-glory-write-a-self-throttling-mysql-query/comment-page-1#comment-56909</link>
		<dc:creator><![CDATA[Marc Alff]]></dc:creator>
		<pubDate>Thu, 27 Oct 2011 22:22:53 +0000</pubDate>
		<guid isPermaLink="false">https://shlomi-noach.github.io/blog/?p=4245#comment-56909</guid>
					<description><![CDATA[Sounds fun, so I take the bait ;)

This proposed solution assumes 5.6, with the performance schema.


create function tools.throttle(every_n integer, delay integer)
returns varchar(20)
begin
  declare sent integer;
  declare dummy integer;

  if (every_n  0) and (sent % every_n = 0)) then
    set dummy = (select sleep(delay));
  end if;

  return sysdate();
end


Execute this once in the current session:


set @my_tid= (select THREAD_ID from performance_schema.threads
  where PROCESSLIST_ID = connection_id());


Then, rewrite queries like this:


select * from big_table;
select  from big_table;


to the throttled version:


select big_table.*, tools.throttle(1000, 2) from big_table;
select , tools.throttle(1000, 2) from big_table;


To prove it works, the short answer is to look at the timestamps returned by tools.throttle.
The long version is to look at the performance schema waits in events_waits_history_long and see the sleeps there.

Regards,
-- Marc]]></description>
		<content:encoded><![CDATA[<p>Sounds fun, so I take the bait ðŸ˜‰</p>
<p>This proposed solution assumes 5.6, with the performance schema.</p>
<p>create function tools.throttle(every_n integer, delay integer)<br />
returns varchar(20)<br />
begin<br />
  declare sent integer;<br />
  declare dummy integer;</p>
<p>  if (every_n  0) and (sent % every_n = 0)) then<br />
    set dummy = (select sleep(delay));<br />
  end if;</p>
<p>  return sysdate();<br />
end</p>
<p>Execute this once in the current session:</p>
<p>set @my_tid= (select THREAD_ID from performance_schema.threads<br />
  where PROCESSLIST_ID = connection_id());</p>
<p>Then, rewrite queries like this:</p>
<p>select * from big_table;<br />
select  from big_table;</p>
<p>to the throttled version:</p>
<p>select big_table.*, tools.throttle(1000, 2) from big_table;<br />
select , tools.throttle(1000, 2) from big_table;</p>
<p>To prove it works, the short answer is to look at the timestamps returned by tools.throttle.<br />
The long version is to look at the performance schema waits in events_waits_history_long and see the sleeps there.</p>
<p>Regards,<br />
&#8212; Marc</p>
]]></content:encoded>
						</item>
			</channel>
</rss>
